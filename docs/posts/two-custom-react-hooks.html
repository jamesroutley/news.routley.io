<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.molecule.dev/the-only-custom-react-hooks-we-use/">Original</a>
    <h1>Two custom React hooks</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody"><p>If I&#39;ve learned anything from being glued to a code editor for (probably too many) years, it&#39;s that the simplest approach is almost always the best one.</p><p>In the case of modern front end engineering and React especially, you can reduce everything down to two simple concepts...</p><ol><li>Rendering the current state</li><li>Updating the state</li></ol><p>Realistically, it&#39;s a bit more complex than that. You&#39;ll often need to consider shared application state and internal component state. Updates can also occur asynchronously with potentially many different states along the way, possibly arriving at an unexpected state when there&#39;s an error or if the user aborts the asynchronous operation. You may also need to consider performance when rendering lots of data or animating complex scenes.</p><p>But when it all comes down to it, everything is just a function of state.</p><p>With that in mind, we have a couple of super simple React hooks that we use everywhere. Combined with a design pattern which we&#39;ll cover later in this blog post, it&#39;s hard to imagine needing much more for the vast majority of cases. We still use basic hooks like <a href="https://reactjs.org/docs/hooks-reference.html#usestate" target="_blank" rel="noopener noreferrer"><code>useState</code></a>, <a href="https://reactjs.org/docs/hooks-reference.html#useeffect" target="_blank" rel="noopener noreferrer"><code>useEffect</code></a>, <a href="https://reactjs.org/docs/hooks-reference.html#usememo" target="_blank" rel="noopener noreferrer"><code>useMemo</code></a>, and <a href="https://reactjs.org/docs/hooks-reference.html#useref" target="_blank" rel="noopener noreferrer"><code>useRef</code></a> as necessary, but as far as complex state management goes, the following two custom hooks are usually all we need. </p><h2 id="useasyncextendedstate"><code>useAsyncExtendedState</code><a aria-hidden="true" href="#useasyncextendedstate" title="Direct link to heading">​</a></h2><p>This hook works almost exactly like React&#39;s built-in <a href="https://reactjs.org/docs/hooks-reference.html#usestate" target="_blank" rel="noopener noreferrer"><code>useState</code></a> hook, but with two additions. It&#39;s probably easiest to understand by example.</p><ol><li><p>It includes an extra method to extend the current state.</p><p>Define the <code>State</code> interface.</p><div><div><pre tabindex="0"><code><span><span>interface</span><span> </span><span>State</span><span> </span><span>{</span><span></span><br/></span><span><span>  foo</span><span>:</span><span> </span><span>string</span><span></span><br/></span><span><span>  bar</span><span>:</span><span> </span><span>string</span><span></span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div><p>Use the hook.</p><div><div><pre tabindex="0"><code><span><span>const</span><span> </span><span>[</span><span> state</span><span>,</span><span> setState</span><span>,</span><span> extendState </span><span>]</span><span> </span><span>=</span><span> </span><span>useAsyncExtendedState</span><span>&lt;</span><span>State</span><span>&gt;</span><span>(</span><span>{</span><span></span><br/></span><span><span>  foo</span><span>:</span><span> </span><span>`</span><span>foo</span><span>`</span><span>,</span><span></span><br/></span><span><span>  bar</span><span>:</span><span> </span><span>`</span><span>bar</span><span>`</span><span></span><br/></span><span><span></span><span>}</span><span>)</span><br/></span></code></pre></div></div><p>Setting state works as usual.</p><div><div><pre tabindex="0"><code><span><span>setState</span><span>(</span><span>{</span><span> foo</span><span>:</span><span> </span><span>`</span><span>Hello</span><span>`</span><span>,</span><span> bar</span><span>:</span><span> </span><span>`</span><span>World!</span><span>`</span><span> </span><span>}</span><span>)</span><span></span><br/></span><span><span></span><span>setState</span><span>(</span><span>state </span><span>=&gt;</span><span> </span><span>(</span><span>{</span><span> foo</span><span>:</span><span> </span><span>`</span><span>Hello</span><span>`</span><span>,</span><span> bar</span><span>:</span><span> </span><span>`</span><span>World!</span><span>`</span><span> </span><span>}</span><span>)</span><span>)</span><br/></span></code></pre></div></div><p>Or you can extend the state.</p><div><div><pre tabindex="0"><code><span><span></span><br/></span><span><span></span><span>extendState</span><span>(</span><span>{</span><span> foo</span><span>:</span><span> </span><span>`</span><span>Hello</span><span>`</span><span> </span><span>}</span><span>)</span><span></span><br/></span><span><span></span><br/></span><span><span></span><span></span><br/></span><span><span></span><span>extendState</span><span>(</span><span>state </span><span>=&gt;</span><span> </span><span>(</span><span>{</span><span> foo</span><span>:</span><span> state</span><span>.</span><span>foo</span><span>.</span><span>toUpperCase</span><span>(</span><span>)</span><span> </span><span>}</span><span>)</span><span>)</span><br/></span></code></pre></div></div><p>Don&#39;t use <code>extendState</code> for everything! Use it only when you know you need to merge a partial state. It&#39;s syntactic sugar to make your code slightly more concise.</p><blockquote><p>With Molecule.dev, we try to give you as much control over your Molecule&#39;s code as possible. All of <a href="https://github.com/Molecule-dev/molecule-app/blob/9c9a12788013a1218c4f790039b931fca1a8b4f0/src/hooks/useAsyncExtendedState.ts" target="_blank" rel="noopener noreferrer">this code is open source</a>, so you can quickly change it to suit your needs and preferences.</p></blockquote></li><li><p>You can pass promises to both <code>setState</code> and <code>extendState</code> to asynchronously update the state.</p><p>Suppose you have a function which asynchronously fetches data from your API and returns the data as the next state.</p><div><div><pre tabindex="0"><code><span><span>const</span><span> </span><span>fetchState</span><span> </span><span>=</span><span> </span><span>(</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>API</span><span>.</span><span>client</span><span>.</span><span>get</span><span>&lt;</span><span>State</span><span>&gt;</span><span>(</span><span>`</span><span>data</span><span>`</span><span>)</span><span>.</span><span>then</span><span>(</span><span>response </span><span>=&gt;</span><span> </span><span>{</span><span></span><br/></span><span><span>  </span><span>return</span><span> response</span><span>.</span><span>data</span><span></span><br/></span><span><span></span><span>}</span><span>)</span><br/></span></code></pre></div></div><p>Alternatively, the promise may also resolve a function of the current state, similar to <code>setState(state =&gt; ({ ...state }))</code>.</p><div><div><pre tabindex="0"><code><span><span>const</span><span> </span><span>fetchState</span><span> </span><span>=</span><span> </span><span>(</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>API</span><span>.</span><span>client</span><span>.</span><span>get</span><span>&lt;</span><span>State</span><span>&gt;</span><span>(</span><span>`</span><span>data</span><span>`</span><span>)</span><span>.</span><span>then</span><span>(</span><span>response </span><span>=&gt;</span><span> </span><span>{</span><span></span><br/></span><span><span>  </span><span>return</span><span> </span><span>(</span><span>state</span><span>:</span><span> </span><span>State</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span><br/></span><span><span>    </span><span>return</span><span> response</span><span>.</span><span>data</span><span></span><br/></span><span><span>  </span><span>}</span><span></span><br/></span><span><span></span><span>}</span><span>)</span><br/></span></code></pre></div></div><p>Call the asynchronous function and pass the promise to <code>setState</code>. The state will eventually be set to the resolved value.</p><div><div><pre tabindex="0"><code><span><span>setState</span><span>(</span><span>fetchState</span><span>(</span><span>)</span><span>)</span><br/></span></code></pre></div></div><p>Similarly for <code>extendState</code>, suppose you have a function which asynchronously fetches partial data from your API.</p><div><div><pre tabindex="0"><code><span><span>const</span><span> </span><span>fetchPartialState</span><span> </span><span>=</span><span> </span><span>(</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>API</span><span>.</span><span>client</span><span>.</span><span>get</span><span>&lt;</span><span>Partial</span><span>&lt;</span><span>State</span><span>&gt;&gt;</span><span>(</span><span>`</span><span>data</span><span>`</span><span>)</span><span>.</span><span>then</span><span>(</span><span>response </span><span>=&gt;</span><span> </span><span>{</span><span></span><br/></span><span><span>  </span><span>return</span><span> response</span><span>.</span><span>data</span><span></span><br/></span><span><span></span><span>}</span><span>)</span><span></span><br/></span><span><span></span><br/></span><span><span></span><span></span><br/></span><span><span></span><span>const</span><span> </span><span>fetchPartialState</span><span> </span><span>=</span><span> </span><span>(</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>API</span><span>.</span><span>client</span><span>.</span><span>get</span><span>&lt;</span><span>Partial</span><span>&lt;</span><span>State</span><span>&gt;&gt;</span><span>(</span><span>`</span><span>data</span><span>`</span><span>)</span><span>.</span><span>then</span><span>(</span><span>response </span><span>=&gt;</span><span> </span><span>{</span><span></span><br/></span><span><span>  </span><span>return</span><span> </span><span>(</span><span>state</span><span>:</span><span> </span><span>State</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span><br/></span><span><span>    </span><span>return</span><span> response</span><span>.</span><span>data</span><span></span><br/></span><span><span>  </span><span>}</span><span></span><br/></span><span><span></span><span>}</span><span>)</span><br/></span></code></pre></div></div><p>Call <code>fetchPartialState</code> and pass the promise to <code>extendState</code>. The state will eventually be extended by the resolved value.</p><div><div><pre tabindex="0"><code><span><span>extendState</span><span>(</span><span>fetchPartialState</span><span>(</span><span>)</span><span>)</span><br/></span></code></pre></div></div></li></ol><h2 id="usepromise"><code>usePromise</code><a aria-hidden="true" href="#usepromise" title="Direct link to heading">​</a></h2><p>More often than not, when something is happening asynchronously, you&#39;ll want to display some feedback to the user.</p><p>This hook accepts any asynchronous function (i.e., a function which returns a promise) and returns a new asynchronous function wrapping the original, along with the state of the promise plus <code>cancel</code> and <code>reset</code> methods.</p><p>For example, suppose we want to fetch data from the API and display the current state of the request to the user.</p><p>Define the <code>State</code> interface.</p><div><div><pre tabindex="0"><code><span><span>interface</span><span> </span><span>State</span><span> </span><span>{</span><span></span><br/></span><span><span>  foo</span><span>:</span><span> </span><span>string</span><span></span><br/></span><span><span>  bar</span><span>:</span><span> </span><span>string</span><span></span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div><p>Define a function which returns a promise. In this example, we&#39;ll fetch API data and resolve it as <code>State</code>.</p><div><div><pre tabindex="0"><code><span><span>const</span><span> </span><span>read</span><span> </span><span>=</span><span> </span><span>(</span><span>id</span><span>:</span><span> </span><span>string</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>API</span><span>.</span><span>client</span><span>.</span><span>get</span><span>&lt;</span><span>State</span><span>&gt;</span><span>(</span><span>`</span><span>things/</span><span>${</span><span>id</span><span>}</span><span>`</span><span>)</span><span>.</span><span>then</span><span>(</span><span>response </span><span>=&gt;</span><span> </span><span>{</span><span></span><br/></span><span><span>  </span><span>return</span><span> response</span><span>.</span><span>data</span><span></span><br/></span><span><span></span><span>}</span><span>)</span><br/></span></code></pre></div></div><p>Pass the function to the <code>usePromise</code> hook.</p><div><div><pre tabindex="0"><code><span><span>const</span><span> </span><span>[</span><span> readThingRequest</span><span>,</span><span> readThing </span><span>]</span><span> </span><span>=</span><span> </span><span>usePromise</span><span>(</span><span>read</span><span>)</span><br/></span></code></pre></div></div><p><code>readThingRequest</code> contains the state of the promise plus a <code>reset</code> method, defined below:</p><div><div><pre tabindex="0"><code><span><span>interface</span><span> </span><span>PromiseState</span><span>&lt;</span><span>T</span><span>&gt;</span><span> </span><span>{</span><span></span><br/></span><span><span>  status</span><span>?</span><span>:</span><span> </span><span>`</span><span>pending</span><span>`</span><span> </span><span>|</span><span> </span><span>`</span><span>resolved</span><span>`</span><span> </span><span>|</span><span> </span><span>`</span><span>rejected</span><span>`</span><span></span><br/></span><span><span>  promise</span><span>?</span><span>:</span><span> </span><span>Promise</span><span>&lt;</span><span>T</span><span>&gt;</span><span></span><br/></span><span><span>  value</span><span>?</span><span>:</span><span> </span><span>Awaited</span><span>&lt;</span><span>T</span><span>&gt;</span><span></span><br/></span><span><span>  error</span><span>?</span><span>:</span><span> </span><span>Error</span><span></span><br/></span><span><span>  cancel</span><span>?</span><span>:</span><span> </span><span>(</span><span>message</span><span>?</span><span>:</span><span> </span><span>string</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>void</span><span></span><br/></span><span><span></span><span>}</span><span></span><br/></span><span><span></span><br/></span><span><span></span><span>type</span><span> </span><span>PromiseStateWithReset</span><span>&lt;</span><span>T</span><span>&gt;</span><span> </span><span>=</span><span> </span><span>PromiseState</span><span>&lt;</span><span>T</span><span>&gt;</span><span> </span><span>&amp;</span><span> </span><span>{</span><span></span><br/></span><span><span>  </span><span>reset</span><span>:</span><span> </span><span>(</span><span>keys</span><span>?</span><span>:</span><span> </span><span>Array</span><span>&lt;</span><span>keyof</span><span> </span><span>PromiseState</span><span>&lt;</span><span>T</span><span>&gt;&gt;</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>void</span><span></span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div><p>If you would like to initialize the <code>readThingRequest</code> state, pass the initial state as the second argument:</p><div><div><pre tabindex="0"><code><span><span>const</span><span> </span><span>[</span><span> readThingRequest</span><span>,</span><span> readThing </span><span>]</span><span> </span><span>=</span><span> </span><span>usePromise</span><span>(</span><span>read</span><span>,</span><span> </span><span>{</span><span></span><br/></span><span><span>  status</span><span>:</span><span> </span><span>`</span><span>resolved</span><span>`</span><span>,</span><span></span><br/></span><span><span>  value</span><span>:</span><span> state</span><br/></span><span><span></span><span>}</span><span>)</span><br/></span></code></pre></div></div><p><code>readThing</code> has the same function signature as <code>read</code>. In other words, you&#39;ll call <code>readThing(id)</code> the same way you&#39;d call <code>read(id)</code>.</p><p>Initially, before <code>readThing</code> is called, the <code>readThingRequest</code> will be an empty object (other than the <code>reset</code> method) if an initial state was unprovided.</p><p>When you call <code>readThing(id)</code>, the <code>readThingRequest</code> state becomes:</p><div><div><pre tabindex="0"><code><span><span>const</span><span> readThingRequest </span><span>=</span><span> </span><span>{</span><span></span><br/></span><span><span>  status</span><span>:</span><span> </span><span>`</span><span>pending</span><span>`</span><span>,</span><span></span><br/></span><span><span>  promise</span><span>,</span><span> </span><span>// the promise returned by `read(id)`</span><span></span><br/></span><span><span>  cancel</span><span>,</span><span> </span><span>// a method to cancel the asychronous update</span><span></span><br/></span><span><span>  reset</span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div><p>When the promise has resolved, the <code>readThingRequest</code> state then becomes:</p><div><div><pre tabindex="0"><code><span><span>const</span><span> readThingRequest </span><span>=</span><span> </span><span>{</span><span></span><br/></span><span><span>  status</span><span>:</span><span> </span><span>`</span><span>resolved</span><span>`</span><span>,</span><span></span><br/></span><span><span>  value</span><span>,</span><span> </span><span>// the resolved value</span><span></span><br/></span><span><span>  reset</span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div><p>If there is an error and the promise is rejected:</p><div><div><pre tabindex="0"><code><span><span>const</span><span> readThingRequest </span><span>=</span><span> </span><span>{</span><span></span><br/></span><span><span>  status</span><span>:</span><span> </span><span>`</span><span>rejected</span><span>`</span><span>,</span><span></span><br/></span><span><span>  error</span><span>,</span><span> </span><span>// an instance of `Error`</span><span></span><br/></span><span><span>  reset</span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div><p>If <code>readThingRequest.cancel</code> was called before the promise resolves, the <code>readThingRequest</code> state immediately becomes:</p><div><div><pre tabindex="0"><code><span><span>const</span><span> readThingRequest </span><span>=</span><span> </span><span>{</span><span></span><br/></span><span><span>  status</span><span>:</span><span> </span><span>`</span><span>rejected</span><span>`</span><span>,</span><span></span><br/></span><span><span>  error</span><span>,</span><span> </span><span>// an instance of `Error` with the message passed to `readThingRequest.cancel`, if any</span><span></span><br/></span><span><span>  reset</span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div><p>To reset the state entirely:</p><div><div><pre tabindex="0"><code><span><span>readThingRequest</span><span>.</span><span>reset</span><span>(</span><span>)</span><br/></span></code></pre></div></div><p>Or if you want to reset a specific value (<code>readThingRequest.error</code>, for example):</p><div><div><pre tabindex="0"><code><span><span>readThingRequest</span><span>.</span><span>reset</span><span>(</span><span>[</span><span>`</span><span>error</span><span>`</span><span>]</span><span>)</span><br/></span></code></pre></div></div><p>You may also call <code>readThing(id)</code> more than once, and in which case, the current <code>readThingRequest.value</code> will remain until it is overridden by the next resolved value. So if you would like to reset the value when refetching:</p><div><div><pre tabindex="0"><code><span><span>readThingRequest</span><span>.</span><span>reset</span><span>(</span><span>[</span><span>`</span><span>value</span><span>`</span><span>]</span><span>)</span><span></span><br/></span><span><span></span><span>readThing</span><span>(</span><span>id</span><span>)</span><br/></span></code></pre></div></div><blockquote><p>Note: If you&#39;re combining <code>readThing</code> with the <code>useAsyncExtendedState</code> hook, you probably don&#39;t care about <code>readThingRequest.value</code>. More on that below.</p></blockquote><h2 id="combining-the-two-hooks">Combining the two hooks<a aria-hidden="true" href="#combining-the-two-hooks" title="Direct link to heading">​</a></h2><p>The <code>usePromise</code> hook pairs especially well with the <code>useAsyncExtendedState</code> hook.</p><p>At the start of this post, I mentioned a design pattern which makes everything clean and predictable. We&#39;ve been using it in the example(s) above, but now we&#39;ll make it more obvious.</p><p>API resources typically have a handful of their own routes, usually following a <a href="https://restfulapi.net/" target="_blank" rel="noopener noreferrer">RESTful</a> design with CRUD (create, read, update, and delete) methods.</p><p><a href="https://github.com/Molecule-dev/molecule-app" target="_blank" rel="noopener noreferrer">Molecule.dev&#39;s core application code</a> is structured such that each API resource has its own directory with an index which exports methods for each route.</p><p>Suppose we have an API resource called a <code>thing</code> with CRUD methods:</p><div><p>src/API/resource/thing.ts</p><div><pre tabindex="0"><code><span><span>import</span><span> </span><span>{</span><span> client </span><span>}</span><span> </span><span>from</span><span> </span><span>&#39;../../client&#39;</span><span></span><br/></span><span><span></span><span>import</span><span> </span><span>*</span><span> </span><span>as</span><span> types</span><span> </span><span>from</span><span> </span><span>&#39;./types&#39;</span><span></span><br/></span><span><span></span><br/></span><span><span></span><span>export</span><span> </span><span>const</span><span> create </span><span>=</span><span> </span><span>(</span><span>props</span><span>:</span><span> types</span><span>.</span><span>CreateProps</span><span>)</span><span>:</span><span> </span><span>Promise</span><span>&lt;</span><span>types</span><span>.</span><span>SuccessResponse</span><span>&gt;</span><span> </span><span>=&gt;</span><span> </span><span>(</span><span></span><br/></span><span><span>  client</span><span>.</span><span>post</span><span>(</span><span>`</span><span>things</span><span>`</span><span>,</span><span> props</span><span>)</span><span></span><br/></span><span><span></span><span>)</span><span></span><br/></span><span><span></span><br/></span><span><span></span><span>export</span><span> </span><span>const</span><span> read </span><span>=</span><span> </span><span>(</span><span>id</span><span>:</span><span> </span><span>string</span><span>)</span><span>:</span><span> </span><span>Promise</span><span>&lt;</span><span>types</span><span>.</span><span>SuccessResponse</span><span>&gt;</span><span> </span><span>=&gt;</span><span> </span><span>(</span><span></span><br/></span><span><span>  client</span><span>.</span><span>get</span><span>(</span><span>`</span><span>things/</span><span>${</span><span>id</span><span>}</span><span>`</span><span>)</span><span></span><br/></span><span><span></span><span>)</span><span></span><br/></span><span><span></span><br/></span><span><span></span><span>export</span><span> </span><span>const</span><span> update </span><span>=</span><span> </span><span>(</span><span>id</span><span>:</span><span> </span><span>string</span><span>,</span><span> props</span><span>:</span><span> types</span><span>.</span><span>UpdateProps</span><span>)</span><span>:</span><span> </span><span>Promise</span><span>&lt;</span><span>types</span><span>.</span><span>SuccessPartialResponse</span><span>&gt;</span><span> </span><span>=&gt;</span><span> </span><span>(</span><span></span><br/></span><span><span>  client</span><span>.</span><span>patch</span><span>(</span><span>`</span><span>things/</span><span>${</span><span>id</span><span>}</span><span>`</span><span>,</span><span> props</span><span>)</span><span></span><br/></span><span><span></span><span>)</span><span></span><br/></span><span><span></span><br/></span><span><span></span><span>export</span><span> </span><span>const</span><span> del </span><span>=</span><span> </span><span>(</span><span>id</span><span>:</span><span> </span><span>string</span><span>)</span><span>:</span><span> </span><span>Promise</span><span>&lt;</span><span>types</span><span>.</span><span>SuccessPartialResponse</span><span>&gt;</span><span> </span><span>=&gt;</span><span> </span><span>(</span><span></span><br/></span><span><span>  client</span><span>.</span><span>delete</span><span>(</span><span>`</span><span>things/</span><span>${</span><span>id</span><span>}</span><span>`</span><span>)</span><span></span><br/></span><span><span></span><span>)</span><br/></span></code></pre></div></div><p>We&#39;ll import these methods and use them with the <code>useAsyncExtendedState</code> and <code>usePromise</code> hooks.</p><p>As an example, let&#39;s create a component to read some <code>thing</code> by id and allow the user to update it.</p><p>First, let&#39;s cover some relevant type definitions.</p><p>Every RESTful API resource will have an <code>id</code>, <code>createdAt</code> date, and <code>updatedAt</code> date:</p><div><p>src/API/resource/types.ts</p><div><pre tabindex="0"><code><span><span>/**</span><br/></span><span><span> * The resource&#39;s properties.</span><br/></span><span><span> */</span><span></span><br/></span><span><span></span><span>export</span><span> </span><span>interface</span><span> </span><span>Props</span><span> </span><span>{</span><span></span><br/></span><span><span>  </span><span>/**</span><br/></span><span><span>   * Usually a UUID.</span><br/></span><span><span>   */</span><span></span><br/></span><span><span>  id</span><span>:</span><span> </span><span>string</span><span></span><br/></span><span><span>  </span><span>/**</span><br/></span><span><span>   * When the resource was created.</span><br/></span><span><span>   * </span><br/></span><span><span>   * Usually an ISO 8601 timestamp.</span><br/></span><span><span>   */</span><span></span><br/></span><span><span>  createdAt</span><span>:</span><span> </span><span>string</span><span></span><br/></span><span><span>  </span><span>/**</span><br/></span><span><span>   * When the resource was last updated.</span><br/></span><span><span>   * </span><br/></span><span><span>   * Usually an ISO 8601 timestamp.</span><br/></span><span><span>   */</span><span></span><br/></span><span><span>  updatedAt</span><span>:</span><span> </span><span>string</span><span></span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div><p>Our <code>thing</code> resource will have a <code>description</code> property:</p><div><p>src/API/resource/thing/types.ts</p><div><pre tabindex="0"><code><span><span>import</span><span> </span><span>*</span><span> </span><span>as</span><span> resourceTypes</span><span> </span><span>from</span><span> </span><span>&#39;../types&#39;</span><span></span><br/></span><span><span></span><br/></span><span><span></span><span>/**</span><br/></span><span><span> * The thing&#39;s properties returned by the API.</span><br/></span><span><span> */</span><span></span><br/></span><span><span></span><span>export</span><span> </span><span>interface</span><span> </span><span>Props</span><span> </span><span>extends</span><span> </span><span>resourceTypes</span><span>.</span><span>Props</span><span> </span><span>{</span><span></span><br/></span><span><span>  </span><span>/**</span><br/></span><span><span>   * The thing description.</span><br/></span><span><span>   */</span><span></span><br/></span><span><span>  description</span><span>?</span><span>:</span><span> </span><span>string</span><span></span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div><div><p><h5><span><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></p><p>We&#39;ve also defined types for every API request and response, which you can <a href="https://github.com/Molecule-dev/molecule-app/tree/_e745872f9c566d0b7c6bdfce748f2ab4b809c0ca/src/API/resource" target="_blank" rel="noopener noreferrer">check out on GitHub</a>.</p></div><p>For the sake of example, we&#39;ll create an <code>Editor</code> component with a predefined initial state and render the current state with an input for updating the <code>description</code>. An &#34;Update thing&#34; button will request an API update when clicked, extending the state with the response data, and we&#39;ll render a cancel button along with the current request status and error, if defined.</p><div><div><pre tabindex="0"><code><span><span>import</span><span> </span><span>React</span><span> </span><span>from</span><span> </span><span>&#39;react&#39;</span><span></span><br/></span><span><span></span><span>import</span><span> </span><span>{</span><span> useAsyncExtendedState</span><span>,</span><span> usePromise </span><span>}</span><span> </span><span>from</span><span> </span><span>&#39;../../hooks&#39;</span><span></span><br/></span><span><span></span><span>import</span><span> </span><span>{</span><span> update </span><span>}</span><span> </span><span>from</span><span> </span><span>&#39;../../API/resource/thing&#39;</span><span></span><br/></span><span><span></span><span>import</span><span> </span><span>{</span><span> types </span><span>}</span><span> </span><span>from</span><span> </span><span>&#39;../../API/resource/thing&#39;</span><span></span><br/></span><span><span></span><br/></span><span><span></span><span>export</span><span> </span><span>const</span><span> </span><span>Editor</span><span> </span><span>=</span><span> </span><span>(</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span><br/></span><span><span>  </span><span>const</span><span> </span><span>[</span><span> state</span><span>,</span><span> setState</span><span>,</span><span> extendState </span><span>]</span><span> </span><span>=</span><span> </span><span>useAsyncExtendedState</span><span>&lt;</span><span>types</span><span>.</span><span>Props</span><span>&gt;</span><span>(</span><span>{</span><span></span><br/></span><span><span>    id</span><span>:</span><span> </span><span>`</span><span>733e26aa-97ea-46d7-b4d4-e556a5f37d68</span><span>`</span><span>,</span><span></span><br/></span><span><span>    createdAt</span><span>:</span><span> </span><span>`</span><span>2021-12-17T12:32:13.981Z</span><span>`</span><span>,</span><span></span><br/></span><span><span>    updatedAt</span><span>:</span><span> </span><span>`</span><span>2021-12-17T12:32:13.981Z</span><span>`</span><span>,</span><span></span><br/></span><span><span>    description</span><span>:</span><span> </span><span>`</span><span>This is a simple but powerful design pattern!</span><span>`</span><span></span><br/></span><span><span>  </span><span>}</span><span>)</span><span></span><br/></span><span><span></span><br/></span><span><span>  </span><span>const</span><span> </span><span>[</span><span> updateThingRequest</span><span>,</span><span> updateThing </span><span>]</span><span> </span><span>=</span><span> </span><span>usePromise</span><span>(</span><span>(</span><span>updateProps</span><span>:</span><span> types</span><span>.</span><span>UpdateProps</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>(</span><span></span><br/></span><span><span>    </span><span>update</span><span>(</span><span>state</span><span>.</span><span>id</span><span>,</span><span> updateProps</span><span>)</span><span>.</span><span>then</span><span>(</span><span>response</span><span> </span><span>=&gt;</span><span> response</span><span>.</span><span>data</span><span>.</span><span>props</span><span>)</span><span></span><br/></span><span><span>  </span><span>)</span><span>)</span><span></span><br/></span><span><span></span><br/></span><span><span>  </span><span>return</span><span> </span><span>(</span><span></span><br/></span><span><span>    </span><span>&lt;</span><span>div</span><span>&gt;</span><span></span><br/></span><span><span>      </span><span>&lt;</span><span>div</span><span>&gt;</span><span></span><br/></span><span><span>        </span><span>{</span><span>`</span><span>Created thing: </span><span>${</span><span>new</span><span> </span><span>Date</span><span>(</span><span>state</span><span>.</span><span>createdAt</span><span>)</span><span>.</span><span>toLocaleString</span><span>(</span><span>)</span><span>}</span><span>`</span><span>}</span><span></span><br/></span><span><span>      </span><span>&lt;/</span><span>div</span><span>&gt;</span><span></span><br/></span><span><span></span><br/></span><span><span>      </span><span>&lt;</span><span>div</span><span>&gt;</span><span></span><br/></span><span><span>        </span><span>{</span><span>`</span><span>Updated thing: </span><span>${</span><span>new</span><span> </span><span>Date</span><span>(</span><span>state</span><span>.</span><span>updatedAt</span><span>)</span><span>.</span><span>toLocaleString</span><span>(</span><span>)</span><span>}</span><span>`</span><span>}</span><span></span><br/></span><span><span>      </span><span>&lt;/</span><span>div</span><span>&gt;</span><span></span><br/></span><span><span></span><br/></span><span><span>      </span><span>&lt;</span><span>textarea</span><span></span><br/></span><span><span>        </span><span>value</span><span>=</span><span>{</span><span>state</span><span>.</span><span>description</span><span>}</span><span></span><br/></span><span><span>        </span><span>onChange</span><span>=</span><span>{</span><span>event</span><span> </span><span>=&gt;</span><span> </span><span>extendState</span><span>(</span><span>{</span><span> description</span><span>:</span><span> event</span><span>.</span><span>target</span><span>.</span><span>value </span><span>}</span><span>)</span><span>}</span><span></span><br/></span><span><span>      </span><span>/&gt;</span><span></span><br/></span><span><span></span><br/></span><span><span>      </span><span>&lt;</span><span>button</span><span> </span><span>onClick</span><span>=</span><span>{</span><span>(</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>extendState</span><span>(</span><span>updateThing</span><span>(</span><span>{</span><span> description</span><span>:</span><span> state</span><span>.</span><span>description </span><span>}</span><span>)</span><span>)</span><span>}</span><span>&gt;</span><span></span><br/></span><span><span>        </span><span>{</span><span>updateThingRequest</span><span>.</span><span>status </span><span>===</span><span> </span><span>`</span><span>pending</span><span>`</span><span> </span><span>?</span><span> </span><span>`</span><span>Updating thing...</span><span>`</span><span> </span><span>:</span><span> </span><span>`</span><span>Update thing</span><span>`</span><span>}</span><span></span><br/></span><span><span>      </span><span>&lt;/</span><span>button</span><span>&gt;</span><span></span><br/></span><span><span></span><br/></span><span><span>      </span><span>{</span><span>updateThingRequest</span><span>.</span><span>cancel </span><span>&amp;&amp;</span><span> </span><span>(</span><span></span><br/></span><span><span>        </span><span>&lt;</span><span>button</span><span> </span><span>onClick</span><span>=</span><span>{</span><span>(</span><span>)</span><span> </span><span>=&gt;</span><span> updateThingRequest</span><span>.</span><span>cancel</span><span>(</span><span>`</span><span>cancelled</span><span>`</span><span>)</span><span>}</span><span>&gt;</span><span></span><br/></span><span><span>          </span><span>Cancel</span><span> update</span><br/></span><span><span>        </span><span>&lt;/</span><span>button</span><span>&gt;</span><span></span><br/></span><span><span>      </span><span>)</span><span>}</span><span></span><br/></span><span><span></span><br/></span><span><span>      </span><span>{</span><span>updateThingRequest</span><span>.</span><span>status </span><span>&amp;&amp;</span><span> </span><span>(</span><span></span><br/></span><span><span>        </span><span>&lt;</span><span>div</span><span>&gt;</span><span></span><br/></span><span><span>          </span><span>{</span><span>`</span><span>Request status: </span><span>${</span><span>updateThingRequest</span><span>.</span><span>status</span><span>}</span><span>`</span><span>}</span><span></span><br/></span><span><span>        </span><span>&lt;/</span><span>div</span><span>&gt;</span><span></span><br/></span><span><span>      </span><span>)</span><span>}</span><span></span><br/></span><span><span>      </span><br/></span><span><span>      </span><span>{</span><span>updateThingRequest</span><span>.</span><span>error </span><span>&amp;&amp;</span><span> </span><span>(</span><span></span><br/></span><span><span>        </span><span>&lt;</span><span>div</span><span> </span><span>style</span><span>=</span><span>{</span><span>{</span><span> color</span><span>:</span><span> </span><span>`</span><span>red</span><span>`</span><span> </span><span>}</span><span>}</span><span>&gt;</span><span></span><br/></span><span><span>          </span><span>{</span><span>`</span><span>Error: </span><span>${</span><span>updateThingRequest</span><span>.</span><span>error</span><span>.</span><span>message</span><span>}</span><span>`</span><span>}</span><span></span><br/></span><span><span>        </span><span>&lt;/</span><span>div</span><span>&gt;</span><span></span><br/></span><span><span>      </span><span>)</span><span>}</span><span></span><br/></span><span><span>    </span><span>&lt;/</span><span>div</span><span>&gt;</span><span></span><br/></span><span><span>  </span><span>)</span><span></span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div><h3 id="check-out-the-source">Check out the source<a aria-hidden="true" href="#check-out-the-source" title="Direct link to heading">​</a></h3><p>You can find the code for these hooks on our GitHub <a href="https://github.com/Molecule-dev/molecule-app/tree/_e745872f9c566d0b7c6bdfce748f2ab4b809c0ca/src/hooks" target="_blank" rel="noopener noreferrer">here</a>.</p><p>If you want to get started on an app and API using these design patterns, git clone <a href="https://github.com/Molecule-dev/molecule-app" target="_blank" rel="noopener noreferrer"><code>molecule-app</code></a> and <a href="https://github.com/Molecule-dev/molecule-api" target="_blank" rel="noopener noreferrer"><code>molecule-api</code></a>. Thorough documentation and guides are included.</p><div><div><pre tabindex="0"><code><span><span>git clone git@github.com:Molecule-dev/molecule-app.git</span><br/></span><span><span>cd molecule-app</span><br/></span><span><span>npm install</span><br/></span></code></pre></div></div><div><div><pre tabindex="0"><code><span><span>git clone git@github.com:Molecule-dev/molecule-api.git</span><br/></span><span><span>cd molecule-api</span><br/></span><span><span>npm install</span><br/></span></code></pre></div></div><h3 id="see-it-in-action">See it in action<a aria-hidden="true" href="#see-it-in-action" title="Direct link to heading">​</a></h3><div><p>Created thing: 12/17/2021, 12:32:13 PM</p><p>Updated thing: 12/17/2021, 12:32:13 PM</p></div><p>This example is also available to play with on <a href="https://codesandbox.io/s/nifty-brown-n7suy?file=/src/App/Thing/Editor.tsx" target="_blank" rel="noopener noreferrer">CodeSandbox</a>.</p><h2 id="conclusion">Conclusion<a aria-hidden="true" href="#conclusion" title="Direct link to heading">​</a></h2><p>You can combine these two hooks to cleanly manage asynchronous state at any level throughout your app, for nearly anything you can think of.</p><p>These design patterns help you simplify your thinking and the code itself by separating concerns in a way that is predictably consistent and incredibly easy to manage and build upon. This naturally leads to both a better user experience and a better developer experience.</p><ul><li><p>Define asynchronous functions on their own.</p></li><li><p>Asynchronously set or extend state with a one-liner, via the <code>useAsyncExtendedState</code> hook.</p></li><li><p>To show the user the current state of any asynchronous operation, pass the async function to the <code>usePromise</code> hook and render the promise state.</p></li></ul><p>We use this for everything throughout applications built with Molecule.dev - signing up, logging in, the users themselves, enabling 2FA, payments, subscriptions, plan changes, device management, push notifications... everything!</p><p>If you like this and want to learn more, check out <a href="https://github.com/Molecule-dev" target="_blank" rel="noopener noreferrer">our GitHub</a> and get started building something of your own by cloning Molecule.dev&#39;s core TypeScript app and API. After installing Node dependencies, you&#39;ll be greeted with documentation generated by <a href="https://typedoc.org/" target="_blank" rel="noopener noreferrer">TypeDoc</a> where you can dig into more internals and play around.</p><p>If you&#39;re a professional web developer, where you&#39;re an indie dev or a CTO, and you want to save months of development time on cross-platform apps, visit <a href="https://www.molecule.dev" target="_blank" rel="noopener noreferrer">Molecule.dev</a> to assemble a codebase tailored to your specific needs. You&#39;re guaranteed a rock solid foundation from which you and your team can scale with ease.</p><p>Also be sure to follow us on Twitter <a href="https://twitter.com/molecule_dev" target="_blank" rel="noopener noreferrer">@molecule_dev</a> for regular updates and more posts like this one!</p></div></div>
  </body>
</html>
