<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jonathancarter.org/2024/08/29/orphaning-bcachefs-tools-in-debian/">Original</a>
    <h1>Orphaning bcachefs-tools in Debian</h1>
    
    <div id="readability-page-1" class="page"><div><div><p>Around a decade ago, I was happy to learn about bcache – a Linux block cache system that implements tiered storage (like a pool of hard disks with SSDs for cache) on Linux. At that stage, ZFS on Linux was nowhere close to where it is today, so any progress on gaining more ZFS features in general Linux systems was very welcome. These days we care a bit less about tiered storage, since any cost benefit in using anything else than nvme tends to quickly evaporate compared to time you eventually lose on it.</p><p>In 2015, it was announced that bcache would grow into its own filesystem. This was particularly exciting and it caused quite a buzz in the Linux community, because it brought along with it more features that compare with <a href="https://en.wikipedia.org/wiki/ZFS">ZFS</a> (and also <a href="https://en.wikipedia.org/wiki/Btrfs">btrfs</a>), including built-in compression, built-in encryption, check-summing and RAID implementations.</p><p>Unlike ZFS, it didn’t have a dkms module, so if you wanted to test bcachefs back then, you’d have to pull the entire upstream bcachefs kernel source tree and compile it. Not ideal, but for a promise of a new, shiny, full-featured filesystem, it was worth it.</p><p>In 2019, it seemed that the <a href="https://lkml.org/lkml/2019/6/10/762">time has come for bcachefs to be merged into Linux</a>, so I thought that it’s about time we have the userspace tools (bcachefs-tools) packaged in Debian. Even if the Debian kernel wouldn’t have it yet by the time the bullseye (Debian 11) release happened, it might still have been useful for a future backported kernel or users who roll their own.</p><p>By total coincidence, the first git snapshot that I got into Debian (version 0.1+git20190829.aa2a42b) was committed exactly 5 years ago today.</p><p>It was quite easy to package it, since it was written in C and shipped with a makefile that just worked, and it made it past NEW into unstable in 19 January 2020, just as I <a href="https://jonathancarter.org/2020/02/07/random-bits-from-fosdem-2020/">was about to head off to FOSDEM</a> as the pandemic started, but that’s of course a whole other story.</p><p>Fast-forwarding towards the end of 2023, version 1.2 shipped with some utilities written in <a href="https://en.wikipedia.org/wiki/Rust_(programming_language)">Rust</a>, this caused a little delay, since I wasn’t at all familiar with Rust packaging yet, so I shipped an update that didn’t yet include those utilities, and saw this as an opportunity to learn more about how the Rust eco-system worked and Rust in Debian.</p><p>So, back in April the Rust dependencies for bcachefs-tools in Debian didn’t at all match the build requirements. I got some help from the Rust team who says that the common practice is to relax the dependencies of Rust software so that it builds in Debian. So errno, which needed the exact version 0.2, was relaxed so that it could build with version 0.4 in Debian, udev 0.7 was relaxed for 0.8 in Debian, memoffset from 0.8.5 to 0.6.5, paste from 1.0.11 to 1.08 and bindgen from 0.69.9 to 0.66.</p><p>I found this a bit disturbing, but it seems that some Rust people have lots of confidence that if something builds, it will run fine. And at least it did build, and the resulting binaries did work, although I’m personally still not very comfortable or confident about this approach (<em>perhaps</em> that might change as I learn more about Rust).</p><p>With that in mind, at this point you may wonder how any distribution could sanely package this. The problem is that they can’t. Fedora and other distributions with stable releases take a similar approach to what we’ve done in Debian, while distributions with much more relaxed policies (like Arch) include all the dependencies as they are vendored upstream.</p><p>As it stands now, bcachefs-tools is impossible to maintain in Debian stable. While my primary concerns when packaging, are for Debian unstable and the next stable release, I also keep in mind people who have to support these packages long after I stopped caring about them (like <a href="https://www.freexian.com/lts/debian/details/">Freexian who does LTS support for Debian</a> or <a href="https://ubuntu.com/about/release-cycle">Canonical who has long-term Ubuntu support</a>, and probably other organisations that I’ve never even heard of yet). And of course, if bcachfs-tools don’t have any usable stable releases, it doesn’t have any LTS releases either, so anyone who needs to support bcachefs-tools long-term has to carry the support burden on their own, and if they bundle it’s dependencies, then those as well.</p><p>I’ll admit that I don’t have any solution for fixing this. I suppose if I were upstream I might look into the possibility of at least supporting a larger range of recent dependencies (<em>usually</em> easy enough if you don’t hop onto the newest features right away) so that distributions with stable releases only need to concern themselves with providing some minimum recent versions, but even if that could work, the upstream author is 100% against any solution other than vendoring all its dependencies with the utility and insisting that it must only be built using these bundled dependencies. I’ve made 6 uploads for this package so far this year, but still I constantly get complaints that it’s out of date and that it’s ancient. If a piece of software is considered so old that it’s useless by the time it’s been published for two or three months, then there’s no way it can survive even a usual stable release cycle, nevermind any kind of long-term support.</p><p>With this in mind (not even considering some hostile emails that I recently received from the upstream developer or his public rants on lkml and reddit), I decided to remove bcachefs-tools from Debian completely. Although after discussing this with another DD, I was convinced to <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1078599" data-type="link" data-id="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1078599">orphan it instead, which I have now done</a>. I made an upload to experimental so that it’s still available if someone wants to work on it (without having to go through NEW again), it’s been <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1079375">removed from unstable</a> so that it doesn’t migrate to testing, and the ancient (especially by bcachefs-tools standards) versions that are in <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1078543">stable and oldstable will be removed too</a>, since they are very likely to cause damage with any recent kernel versions that support bcachefs.</p><p>And so, my adventure with bcachefs-tools comes to an end. I’d advise that if you consider using bcachefs for any kind of production use in the near future, you first consider how supportable it is long-term, and whether there’s really anyone at all that is succeeding in providing stable support for it.</p></div></div></div>
  </body>
</html>
