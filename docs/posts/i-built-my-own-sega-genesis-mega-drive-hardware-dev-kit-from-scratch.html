<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nestenius.se/2022/01/18/how-i-built-my-own-sega-mega-drive-hardware-dev-kit-from-scratch/">Original</a>
    <h1>I built my own Sega Genesis (Mega Drive) hardware dev kit from scratch</h1>
    
    <div id="readability-page-1" class="page"><div data-id="fa4c5be" data-element_type="widget" data-widget_type="theme-post-content.default">
				<div>
					<div data-elementor-type="wp-post" data-elementor-id="1038" data-elementor-settings="[]">
							<div>
							<section data-id="61852cb8" data-element_type="section">
						<div>
					<div data-id="4daf01fe" data-element_type="column">
			<div>
								<div data-id="3467d0cc" data-element_type="widget" data-widget_type="text-editor.default">
				<div>
							<h3><strong>Introduction</strong></h3><p><span>About 30 years ago (when I was around 20) I wanted to develop games, like most developers dream of doing. However, I had one open </span><span>question: which platform should I write it for? Of course I could do it on the Atari 1040 STE that I had at the time, but I wanted to aim higher and do something cooler and more challenging.¬†</span></p><p><span>Eventually I was introduced to the Sega Mega Drive and I was instantly hooked, playing games like Sonic, Truxton, Revenge Of Shinobi and many other great games. The hardware and graphics¬†were amazing, with its built-in hardware parallax scrolling support.</span></p><p><a href="https://tn-data.se/wp-content/uploads/2021/12/Image2-1.jpg"><img alt="" width="1920" height="1280" data-src="https://tn-data.se/wp-content/uploads/2021/12/Image2-1.jpg" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></p><p><span>Ev</span><span>entually, I got the crazy idea that I wanted to develop games for this machine. But surely I¬† would need some crazy expensive and hard-to-get hardware to do that? I had no official developer kit, no money to buy one, no documentation, just a Mega Drive. </span><span><br/></span><span><br/></span><span>So I thought, how hard can it be to build my own kit?¬†</span></p><p><b>First some sanity checks</b></p><p><span>But wait? Was I crazy or what? Why did I think I would be able to pull this off?</span></p><ul><li aria-level="1"><span>The Sega Mega Drive is based around the <a href="https://en.wikipedia.org/wiki/Motorola_68000" target="_blank" rel="noopener">Motorola MC68000 CPU</a></span><span>, a CPU that I was very familiar with on the lowest chip level. It also has a separate¬† <a href="https://en.wikipedia.org/wiki/Zilog_Z80">Z80</a> co-processor for audio and other tasks that I was slightly familiar with.</span></li><li aria-level="1"><span>I was very familiar with the MC68000 <a href="http://wpage.unina.it/rcanonic/didattica/ce1/docs/68000.pdf">assembly language</a>, after many years of low-level assembly demo-programming on the Atari ST home computer. I am one of the original members of SYNC, an Atari ST demo group in Sweden. You can read more about SYNC <a href="http://www.lysator.liu.se/~celeborn/sync/page3.html" target="_blank" rel="noopener">here</a> and <a href="https://demozoo.org/groups/2256">here</a></span><span><span>, and we sure did some quite crazy things on the Atari ST back in the day.</span></span></li></ul><p><a href="https://tn-data.se/wp-content/uploads/2021/12/Image3.jpg"><img alt="" width="1920" height="1440" data-srcset="https://nestenius.se/wp-content/uploads/2021/12/Image3.jpg 1920w, https://nestenius.se/wp-content/uploads/2021/12/Image3-300x225.jpg 300w, https://nestenius.se/wp-content/uploads/2021/12/Image3-1024x768.jpg 1024w, https://nestenius.se/wp-content/uploads/2021/12/Image3-768x576.jpg 768w, https://nestenius.se/wp-content/uploads/2021/12/Image3-1536x1152.jpg 1536w" data-src="https://tn-data.se/wp-content/uploads/2021/12/Image3.jpg" data-sizes="(max-width: 1920px) 100vw, 1920px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></p><p><span>I had tinkered and played with electronics and built small computers for a long time ‚Äì here are some of the random projects from back in the day. However, I don‚Äôt remember what they do üôÇ¬†</span><span><br/></span></p><h2><strong>How to approach the challenge?</strong></h2><p><span>My goal was to design and build a kit that, without modifying the Sega Mega Drive, would allow me to ‚Äúsimulate‚Äù a game cartridge using static ram memory. The kit would then be connected to my Atari ST computer where I would be doing the actual programming. An overview of the kit:</span></p><p><img alt="" width="227" height="298" data-src="https://tn-data.se/wp-content/uploads/2021/12/Image-4.png" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></p><h2><strong>The cartridges</strong></h2><p><span>The first challenge was to reverse engineer a game cartridge and figure out the pin layout of the edge connector. The circuit board inside a cartridge looks like this:</span><span><br/></span></p><p><a href="https://tn-data.se/wp-content/uploads/2021/12/Image5.jpg"><img alt="" width="1144" height="515" data-srcset="https://nestenius.se/wp-content/uploads/2021/12/Image5.jpg 1144w, https://nestenius.se/wp-content/uploads/2021/12/Image5-300x135.jpg 300w, https://nestenius.se/wp-content/uploads/2021/12/Image5-1024x461.jpg 1024w, https://nestenius.se/wp-content/uploads/2021/12/Image5-768x346.jpg 768w" data-src="https://tn-data.se/wp-content/uploads/2021/12/Image5.jpg" data-sizes="(max-width: 1144px) 100vw, 1144px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></p><p><span>After a lot of research in various chip reference books, I eventually figured out it was a standard ROM chip. With that knowledge it made it pretty simple to figure out what most pins on the edge connector were.</span></p><p><span>However, there were still some other pins that I needed to figure out to be able to do a complete development kit.</span></p><h2><strong>The game slot</strong></h2><p><span>Figuring out what the pins meant on the cartridge connector inside the Mega Drive was the next challenge. Inside the console, the connector is located next to the 68K CPU and it looks like this:</span><span><br/></span></p><p><a href="https://tn-data.se/wp-content/uploads/2021/12/Image6.jpg"><img alt="" width="1173" height="577" data-srcset="https://nestenius.se/wp-content/uploads/2021/12/Image6.jpg 1173w, https://nestenius.se/wp-content/uploads/2021/12/Image6-300x148.jpg 300w, https://nestenius.se/wp-content/uploads/2021/12/Image6-1024x504.jpg 1024w, https://nestenius.se/wp-content/uploads/2021/12/Image6-768x378.jpg 768w" data-src="https://tn-data.se/wp-content/uploads/2021/12/Image6.jpg" data-sizes="(max-width: 1173px) 100vw, 1173px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></p><p><span>Using my multimeter, I was able to trace most of the connectors directly to the well-known pin layout of the CPU</span><span><br/></span></p><p><span>However, there were one or two pins where I could not figure out what they did. And without a proper logic analyzer, it would have been pretty hard to figure out what they did. As I was on a very tight budget, I decided to build my own. How hard could that be? After some thinking I figured out that all I needed was to get an 8-bit 2 KB FIFO buffer chip and use it to sample the signals when the console starts up after a reset sequence. By doing this, I could look at the signals and try to decode their relationship with some of the other well-known pins on the CPU bus. As I was very familiar with how the MC68K CPU bus works, I was up to the challenge.</span><span><br/></span><span><br/></span><span>Basically, what I wanted to do was:</span><span><br/></span></p><p><a href="https://tn-data.se/wp-content/uploads/2021/12/Image-7.png"><img alt="" width="938" height="296" data-srcset="https://nestenius.se/wp-content/uploads/2021/12/Image-7.png 938w, https://nestenius.se/wp-content/uploads/2021/12/Image-7-300x95.png 300w, https://nestenius.se/wp-content/uploads/2021/12/Image-7-768x242.png 768w" data-src="https://tn-data.se/wp-content/uploads/2021/12/Image-7.png" data-sizes="(max-width: 938px) 100vw, 938px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></p><p><span>But how could I get hold of a FIFO-buffer chip? At the time I was staying in Paris with a friend, where we were finalizing a music sound tracker called Audio Sculpture for the Atari ST that we had sold to a French publisher.</span></p><p><span>So, back to getting hold of the chip. I somehow found out about an electronics trade show in Paris, so I decided to go there with the goal of asking for a FIFO-buffer engineering sample. I eventually found a helpful company that would give me an engineering sample chip for free. Awesome!</span></p><p><span>Here are some links about the Audio Sculpture sound tracker we published:¬†</span></p><ul><li aria-level="1"><span><a href="https://www.youtube.com/watch?v=76G-OH7lAGs&amp;ab_channel=Dbug%27sstuff" target="_blank" rel="noopener">Audio Sculpture Demo Disk</a> by SYNC and Expose Software on Atari ST</span></li><li aria-level="1"><a href="http://www.atarimania.com/utility-atari-st-audio-sculpture_25173.html" target="_blank" rel="noopener"><span>Audio Sculpture at Atari mania.</span></a></li></ul><p><span>But how would I get the data out of the FIFO-buffer? My Atari ST had an expansion port that directly exposed the CPU bus inside the computer, so with some logic, I tied the FIFO-buffer to this port. I wrote some software to extract the data from the buffer and display it to the screen. Using this technique I was eventually able to figure out the purpose of the mysterious pins.</span></p><p><span>Now I had solved the layout of the cartridge port in the console. On to the next challenge!</span></p><h2><strong>Getting my code into the Mega Drive</strong></h2><p><span>With the hardware all figured out, I now needed to figure out how I would be able to write software for the console.¬†</span></p><p><span>My idea was to have a small boot firmware that, at startup, would wait for a binary data dump from my Atari ST. I would connect the kit to my Atari using a home-built transfer protocol that would send it over an 8-bit parallel cable, similar to the parallel printer post most PCs had back in the day.</span></p><p><span>At startup the Mega Drive boots from the game cartridge, so all I had to do was to add a small boot-firmware that would, at startup, accept the binary data dump and, after receiving the dump, it should start to execute the code. I used two 8-bit EPROM chips to hold the actual firmware.¬†</span><span><br/></span></p><p><span>I did manage to locate some of the source code for the firmware and I have published the code as a</span><a href="https://gist.github.com/tndata/95b14a32c10a01124ce64f81234715e0" target="_blank" rel="noopener"><span> GitHub GIST</span></a>¬†<span>(Not sure if it is the final one) and in this <a href="https://gist.github.com/tndata/313688ffe2e2d24b676e2264a9943d5c">GIST.</a></span></p><h2><strong>The memory board</strong></h2><p><span>My design consisted of two circuit boards, one memory board that just held the static ram memory and one logic board for all the rest.</span></p><p><span>To store the game I created a memory board that consisted of ten 128 KB static ram memory chips (<a href="https://pdf1.alldatasheet.com/datasheet-pdf/view/37309/SAMSUNG/KM681000.html" target="_blank" rel="noopener">KM681000LP-8</a>)</span><span>¬†with a total capacity of 1280 KB. At that time most games on the Mega Drive required 256‚Äì512 KB of storage while some needed more.</span></p><p><span>Besides the memory chips, I added the following buffers to the memory board, just to be sure that I would not overload the system bus on the Mega Drive:¬†¬†</span></p><ul><li aria-level="1"><span>Two <a href="https://assets.nexperia.com/documents/data-sheet/74HC_HCT245.pdf" target="_blank" rel="noopener">74HC245</a> ‚Äì 8-bit bi-directional transceiver for the data bus</span></li><li aria-level="1"><span><span>Three <a href="https://www.alldatasheet.com/view.jsp?Searchword=HC541&amp;sField=3" target="_blank" rel="noopener">HC541</a> ‚Äì 8-bit driver for the address bus</span></span></li></ul><p><span>For the memory board, I eventually designed some proper circuit boards and also created a few different revisions of the board ‚Äì here are a few of them:</span></p><p><a href="https://tn-data.se/wp-content/uploads/2021/12/memory-board.jpg"><img alt="" width="1920" height="1440" data-srcset="https://nestenius.se/wp-content/uploads/2021/12/memory-board.jpg 1920w, https://nestenius.se/wp-content/uploads/2021/12/memory-board-300x225.jpg 300w, https://nestenius.se/wp-content/uploads/2021/12/memory-board-1024x768.jpg 1024w, https://nestenius.se/wp-content/uploads/2021/12/memory-board-768x576.jpg 768w, https://nestenius.se/wp-content/uploads/2021/12/memory-board-1536x1152.jpg 1536w" data-src="https://tn-data.se/wp-content/uploads/2021/12/memory-board.jpg" data-sizes="(max-width: 1920px) 100vw, 1920px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></p><p><span>I was able to extract the PCB layout files from the old DOS-based circuit board designer software that I used, using the <a href="https://dosbox-x.com/" target="_blank" rel="noopener">DOSBox-X DOS emulator</a>, and here is the result:</span></p><p><a href="https://jvns.ca/wp-content/uploads/2021/12/RamCard.pdf" target="_blank" rel="noopener"><img alt="" width="1920" height="1518" data-srcset="https://nestenius.se/wp-content/uploads/2021/12/RamCard.jpg 1920w, https://nestenius.se/wp-content/uploads/2021/12/RamCard-300x237.jpg 300w, https://nestenius.se/wp-content/uploads/2021/12/RamCard-1024x810.jpg 1024w, https://nestenius.se/wp-content/uploads/2021/12/RamCard-768x607.jpg 768w, https://nestenius.se/wp-content/uploads/2021/12/RamCard-1536x1214.jpg 1536w" data-src="https://tn-data.se/wp-content/uploads/2021/12/RamCard.jpg" data-sizes="(max-width: 1920px) 100vw, 1920px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></p><h2><strong>The logic board</strong></h2><p><span>The second circuit board that this kit consisted of contained the following parts:</span></p><ul><li aria-level="1"><span>Two EPROM chips that held the startup firmware</span></li><li aria-level="1"><span>Glue logic¬†</span></li><li aria-level="1"><span>Connector to the memory board</span></li><li aria-level="1"><span><span>Connector to the host computer</span></span></li></ul><p><span>The board went through several iterations, where the one in the middle is the latest and working prototype:</span><span><br/></span></p><p><a href="https://tn-data.se/wp-content/uploads/2021/12/MainBoard.jpg"><img alt="" width="1920" height="1440" data-srcset="https://nestenius.se/wp-content/uploads/2021/12/MainBoard.jpg 1920w, https://nestenius.se/wp-content/uploads/2021/12/MainBoard-300x225.jpg 300w, https://nestenius.se/wp-content/uploads/2021/12/MainBoard-1024x768.jpg 1024w, https://nestenius.se/wp-content/uploads/2021/12/MainBoard-768x576.jpg 768w, https://nestenius.se/wp-content/uploads/2021/12/MainBoard-1536x1152.jpg 1536w" data-src="https://tn-data.se/wp-content/uploads/2021/12/MainBoard.jpg" data-sizes="(max-width: 1920px) 100vw, 1920px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></p><p><span>For rapid prototyping I wire-wrapped these boards as you can see below:</span></p><p><a href="https://tn-data.se/wp-content/uploads/2021/12/MainBoard2.jpg"><img alt="" width="1920" height="1440" data-srcset="https://nestenius.se/wp-content/uploads/2021/12/MainBoard2.jpg 1920w, https://nestenius.se/wp-content/uploads/2021/12/MainBoard2-300x225.jpg 300w, https://nestenius.se/wp-content/uploads/2021/12/MainBoard2-1024x768.jpg 1024w, https://nestenius.se/wp-content/uploads/2021/12/MainBoard2-768x576.jpg 768w, https://nestenius.se/wp-content/uploads/2021/12/MainBoard2-1536x1152.jpg 1536w" data-src="https://tn-data.se/wp-content/uploads/2021/12/MainBoard2.jpg" data-sizes="(max-width: 1920px) 100vw, 1920px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></p><p><span>I started to design a real circuit board as you can see from the screenshots below, but unfortunately I never got around to actually building one using this board.</span></p><div id="gallery-1"><figure>
			<p><a href="https://nestenius.se/wp-content/uploads/2021/12/Image8.jpg"><img width="730" height="903" alt="IT Consulting and Training | Tore Nestenius Datakonsult AB" data-srcset="https://nestenius.se/wp-content/uploads/2021/12/Image8.jpg 730w, https://nestenius.se/wp-content/uploads/2021/12/Image8-243x300.jpg 243w" data-src="https://nestenius.se/wp-content/uploads/2021/12/Image8.jpg" data-sizes="(max-width: 730px) 100vw, 730px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a>
			</p></figure><figure>
			<p><a href="https://nestenius.se/wp-content/uploads/2021/12/Image9.jpg"><img width="730" height="903" alt="IT Consulting and Training | Tore Nestenius Datakonsult AB" data-srcset="https://nestenius.se/wp-content/uploads/2021/12/Image9.jpg 730w, https://nestenius.se/wp-content/uploads/2021/12/Image9-243x300.jpg 243w" data-src="https://nestenius.se/wp-content/uploads/2021/12/Image9.jpg" data-sizes="(max-width: 730px) 100vw, 730px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a>
			</p></figure>
		</div>
<h2><strong>Glue logic</strong></h2><p><span>To tie up all the necessary logic, I added a small PAL (Programmable Array Logic) chip that contained some of the glue logic needed to tie it all up.</span><span><br/></span></p><p><a href="https://tn-data.se/wp-content/uploads/2021/12/Image-10.png"><img alt="" width="611" height="418" data-srcset="https://nestenius.se/wp-content/uploads/2021/12/Image-10.png 611w, https://nestenius.se/wp-content/uploads/2021/12/Image-10-300x205.png 300w" data-src="https://tn-data.se/wp-content/uploads/2021/12/Image-10.png" data-sizes="(max-width: 611px) 100vw, 611px" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></p><p><span>I managed to dig up some source code for this chip and I posted it as a GIST <a href="https://gist.github.com/tndata/e79d6148df490fd45dba012bdb3bb5f4" target="_blank" rel="noopener">here</a></span><span>¬†for you to explore.</span></p><h2><strong>Schematics</strong></h2><p><span>The schematics for the setup can be found <a href="https://jvns.ca/wp-content/uploads/2021/12/Combined-schematics.pdf" target="_blank" rel="noopener">here</a></span><span>. However, as version control was not a thing back then, I am not sure if this is the final schematics or not.</span></p><h2><strong>Did it work?</strong></h2><p><span>Yes, eventually I got it all to work and I was, for example, able to write simple applications and download them directly to the Mega Drive and run it. Eventually I got hold of enough detailed information to be able to control some sprites on the screen and control it using the joystick.</span></p><p><span>To do the actual programming on my Atari ST, I used a tool called <a href="https://sites.google.com/site/stessential/development/turbo-assembler-bugaboo9" target="_blank" rel="noopener">Turbo Assembler</a></span><span>.¬† Turbo Assembler was a very unique assembly language IDE as it would pre-generate the binary data as you typed. The second advantage with Turbo Assembler was that it allowed me to develop my own custom drivers/targets. This allowed me to send the final assembly directly down to my hardware kit! Awesome!</span></p><p><span>Did I write any games? Unfortunately no. As I started my university studies, I didn‚Äôt have the time to pursue my game career any further. But it sure was a very fun project and I learned a lot on the way.</span></p><h2><strong>The final thing</strong></h2><p><span>So, what did the final project look like? Here are some photos:</span></p>
<h2><strong>Advanced firmware</strong></h2><p><span>As a side project I started to write a bit more advanced firmware with some more advanced debugging features and I‚Äôve posted a copy of the source code <a href="https://gist.github.com/tndata/313688ffe2e2d24b676e2264a9943d5c" target="_blank" rel="noopener">here</a> for you to explore.</span></p><p><span>It included features like debugging, setting breakpoints, downloading binary data, and other handy tools. I have no idea if it works or not.</span></p><h2><strong>About the author</strong></h2><p><span>I have been interested in computers since I got my first Commodore VIC-20 computer around 1981. From that I went to Commodore C64, Atari ST, Atari ATW (Yes, I actually owned an Atari ATW back in the day with 5 transputer chips inside it) running the Helios operating system, then today to PCs!¬†¬†</span></p><p><span>After this project, my next big thing was to create Programmers Heaven; it started as two CD-ROMS that I published and then eventually became a major online community for developers from 1996 to 2008. Hopefully I will be able to write a blog post about that in the near future.</span></p><p><span>Today I work as a freelance consultant and trainer. You can read more about me, my other projects and my services at </span><a href="https://www.tn-data.se"><span>https://www.tn-data.se</span></a><span>¬†</span></p><p><span>All trademarks are property of their respective owners in the US and other countries.</span></p>						</div>
				</div>
					</div>
		</div>
							</div>
		</section>
						</div>
					</div>
				</div>
				</div></div>
  </body>
</html>
