<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://research.aurainfosec.io/pentest/threat-on-your-desk-evil-usbc-dock/">Original</a>
    <h1>The threat on your desk: Building an evil USB-C dock</h1>
    
    <div id="readability-page-1" class="page"><article>
  
    
     
    
    
      



    
    




    
  
  
  
  <section>
     
    
      
      <div>
        

        <p>Background&gt;</p>
<h2>Background 
    <span>
        <a href="#background" aria-label="Anchor">#</a></span>        
    
</h2><p>In recent years, laptops have become thinner and all of their I/O ports have started disappearing. However, to solve this, along came dongles and docks.</p>
<figure>
      <img src="https://research.aurainfosec.io/content/blog/pentest/threat-on-your-desk--evil-usbc-dock/usbc-docks.jpg" alt="Image showing an assortment of USB-C docks and dongles"/>
      
    </figure>
  


<p><a href="https://arstechnica.com/features/2019/11/guidemaster-how-to-navigate-the-tricky-world-of-thunderbolt-3-and-usb-c-docks/" target="_blank">
    Image source - arstechnica # Guidemaster: Picking the right Thunderbolt 3 or USB-C dock for your desk</a></p>
<p>USB-C docks like these are now seen all over offices, especially in ‚Äúhot desk‚Äù environments, allowing an employee to sit down at any desk, plug in one cable, and immediately have a ready-to-use workstation. They‚Äôre also common in ‚Äúcoworking spaces‚Äù, where multiple companies and individuals share an office space.</p>
<p>However, I believe an old threat looms in this environment‚Ä¶</p>
<p>Review of USB Attacks&gt;</p>
<h2>Review of USB Attacks 
    <span>
        <a href="#review-of-usb-attacks" aria-label="Anchor">#</a></span>        
    
</h2><p>We‚Äôve all been told the same thing for years <strong>don‚Äôt plug untrusted USB devices into your computer</strong>.</p>
<p>Malicious USB devices can pose a large number of threats, such as:</p>
<ul>
<li>
<p>ü™≤ <strong>Serving malicious files:</strong> Malicious USB storage devices may contain malicious files, such as unwanted .exe, tampered documents with exploits, etc.</p>
</li>
<li>
<p>üë®‚Äçüíª <strong>HID Emulation</strong>: So called ‚ÄúBadUSB‚Äù, ‚ÄúRubber Ducky‚Äù or ‚ÄúBash Bunny‚Äù devices may appear innocuous, but when plugged in they can emulate a keyboard and fire off hundreds of pre-programmed keystrokes per second. This can be used to steal data, install backdoors, or perform all sorts of other attacks.</p>
</li>
<li>
<p>‚ö°Ô∏è <strong>USB Killer:</strong> This one is a bit more extreme, but malicious USB devices may purposefully damage your computer by zapping the USB bus.</p>
</li>
</ul>
<p>USB-C docks should be seen as no exception. In-fact, I believe they are a much bigger threat than traditional USB attacks, as people have learnt to trust name-brand USB docks, and don‚Äôt see them as a threat.</p>
<p>A Fun, Simple Proof-of-Concept&gt;</p>
<h3>A Fun, Simple Proof-of-Concept 
    <span>
        <a href="#a-fun-simple-proof-of-concept" aria-label="Anchor">#</a></span>        
    
</h3><p>To prove my point, I decided to create a simple, practical POC using a name brand USB-C dock with a hidden malicious implant.</p>
<p>Before we get to the horrors of my work, I‚Äôll start with a demo:</p>
<video controls="">
<source src="/content/blog/pentest/threat-on-your-desk--evil-usbc-dock/evil-dock.mp4"/>
</video>
<p>So what‚Äôs happening here? Well, hidden inside the dock is a Raspberry Pi Zero W running <a href="https://github.com/RoganDawes/P4wnP1_aloa" target="_blank">
    P4wn P1 A.L.O.A</a> - a brilliant framework for turning a Pi Zero into ‚ÄúA Little Offensive Appliance‚Äù. This can be used for a range of USB attacks, but here I‚Äôm specifically using it to inject keystorkes.</p>
<p>This can be abused to perform all sorts of attacks, such as:</p>
<ul>
<li>Stealing data.</li>
<li>Installing a reverse shell.</li>
<li>Performing malicious actions on the user‚Äôs behalf.</li>
</ul>
<p>Installing the Implant&gt;</p>
<h3>Installing the Implant 
    <span>
        <a href="#installing-the-implant" aria-label="Anchor">#</a></span>        
    
</h3><p>It‚Äôs not *too* difficult to open these docks, but it takes some work. There is a rubber pad on the bottom stuck down with some adhesive, hiding a series of screws underneath. This makes it easy enough to disassemble, but quite tedious to open and examine. At a quick glance, it also looks unlikely someone could have opened it up and sealed it again.</p>
<figure>
      <img src="https://research.aurainfosec.io/content/blog/pentest/threat-on-your-desk--evil-usbc-dock/2023-03-07-17-07-26-image.png" alt=""/>
      
    </figure>
  


<figure>
      <img src="https://research.aurainfosec.io/content/blog/pentest/threat-on-your-desk--evil-usbc-dock/2023-03-07-17-07-51-image.png" alt=""/>
      
    </figure>
  


<p>Once disassembled, you can see there‚Äôs actually plenty of vertical space to hide malicious components.</p>
<figure>
      <img src="https://research.aurainfosec.io/content/blog/pentest/threat-on-your-desk--evil-usbc-dock/2023-03-07-17-08-33-image.png" alt=""/>
      
    </figure>
  


<p>To keep things simple, I decided to just hijack one of the rear USB 2.0 ports by soldering some leads to the back of the connector.</p>
<figure>
      <img src="https://research.aurainfosec.io/content/blog/pentest/threat-on-your-desk--evil-usbc-dock/2023-03-07-17-10-44-image.png" alt=""/>
      
    </figure>
  


<p>This can then be simply soldered up to a micro USB cable connected to a Pi Zero.</p>
<figure>
      <img src="https://research.aurainfosec.io/content/blog/pentest/threat-on-your-desk--evil-usbc-dock/2023-03-07-17-11-21-image.png" alt=""/>
      
    </figure>
  


<p>To prevent shorts, I also wrapped the Pi in electrical tape. To prevent the Pi from audibly rattling inside the case, I wrapped it several times until it was firmly in-place.</p>
<figure>
      <img src="https://research.aurainfosec.io/content/blog/pentest/threat-on-your-desk--evil-usbc-dock/2023-03-07-17-11-55-image.png" alt=""/>
      
    </figure>
  


<p>Can you tell the difference?&gt;</p>
<h3>Can you tell the difference? 
    <span>
        <a href="#can-you-tell-the-difference" aria-label="Anchor">#</a></span>        
    
</h3><p>Once re-assembled, it looks identical to the real thing:</p>
<figure>
      <img src="https://research.aurainfosec.io/content/blog/pentest/threat-on-your-desk--evil-usbc-dock/IMG20230309115154.jpg" alt=""/>
      
    </figure>
  


<p>It is not obvious the device has been opened, and the only notable side effects are:</p>
<ul>
<li>The top rear USB port doesn‚Äôt work anymore ‚Äì this could be easily solved either by adding a small internal USB hub or wiring it via the Pi</li>
<li>It is slightly heavier I guess?</li>
</ul>
<p>Additionally, spoofing the USB vendor and product ID of the Pi allows it to appear genuine.</p>
<p><img src="https://research.aurainfosec.io/content/blog/pentest/threat-on-your-desk--evil-usbc-dock/sys-info-usb.png"/></p><p>Realistically, you would have to open the device to determine whether or not it has been tampered with.</p>
<p>Conclusion &amp; Further Ideas&gt;</p>
<h2>Conclusion &amp; Further Ideas 
    <span>
        <a href="#conclusion--further-ideas" aria-label="Anchor">#</a></span>        
    
</h2><p>This fun little project took just a few hours from concept to POC, and clearly shows USB-C docks can be scary. Plugging in a malicious devices in a covert location certainly isn‚Äôt anything new, but there is a range of other attack surface here just waiting to be explored, such as:</p>
<ul>
<li>
<p><strong>Invisible key-logging:</strong> Inserting a malicious device in between a physical USB A port and the dock‚Äôs actual bus may allow an attacker to read everything you type, without you knowing. Very dangerous for stealing passwords.</p>
</li>
<li>
<p><strong>Network tapping:</strong> Almost all USB-C docks have built-in ethernet ports. This offers a range of attack opportunities, from sniffing network traffic to acting as a persistent remote device.</p>
</li>
<li>
<p><strong>Screen grabbing:</strong> Docks usually have HDMI ports, and whilst it would be difficult, it is very possible a malicious device could capture the user‚Äôs screen and send images/video back to the attacker. <a href="https://shop.hak5.org/products/screen-crab" target="_blank">
    Inline HDMI capture devices already exist</a>, and it wouldn‚Äôt be impossible to implant one into a dock like this.</p>
</li>
</ul>
<p>I might explore some of these in future, but for now, keep being vigilant with what you plug in to your devices - especially in shared spaces.</p>

        </div>
      
      
      
      
  </section>
  
</article></div>
  </body>
</html>
