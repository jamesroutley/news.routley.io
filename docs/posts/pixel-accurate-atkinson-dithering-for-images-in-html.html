<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://sheep.horse/2022/12/pixel_accurate_atkinson_dithering_for_images_in_ht.html">Original</a>
    <h1>Pixel Accurate Atkinson Dithering for Images in HTML</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody">
    



<p><as-dithered-image src="lizard.jpg" alt="A dithered picture of an iguana" crunch="auto"></as-dithered-image><span>A regal iguana, dithered to perfection at all sizes and included with a single custom tag</span></p>
<p><span>The code and more technical documentation is available in the <a href="https://github.com/andrewstephens75/as-dithered-image">as-dithered-image GitHub repository</a>.</span>I have ways liked the look of images processed with Atkinson Dithering, the algorithm used in the original Apple Macintosh. There are other ways of crushing a multicolored image down to 1-bit monochrome but I think Atkinson&#39;s method produces quite striking results that I thought would look neat on the modern web.</p>
<p>Actually including dithered images on the web is fraught with issues. Dithering relies on a precise correspondence between the source image pixels and the display pixels - any attempt to resize a dithered image is going to be either blurry or covered in distracting Moir√© patterns. The browser is actively working against us here - it resizes images in a way that makes sense for most images but totally destroys the sharp dithering effect I am going for.</p>
<p>Even worse, for responsive designs the size of the image can change dynamically. What is needed is a way to hold off dithering until just before the image is to be displayed in the page. By this time we know the exact size of the destination and can dither accordingly, reprocessing the image as its dimensions change. </p>
<p>This is where as-dithered-image comes in - a stand-alone custom element that handles all the annoying details. It is designed to be almost a drop-in replacement for the standard img tag.</p>
<p>And believe me, there are some very annoying details, namely:</p>
<ul>
<li>the image is scaled and drawn on a canvas then dithered to the proper size. To get a responsive image, this has to be done each time the image resizes as the user resizes the browser window (try it!)</li>
<li>it is quite difficult to get true pixel-pixel accuracy on canvas elements on high DPI screens. In particular, Safari likes to use an annoying filter unless the canvas&#39; backing store is exactly the devicePixelRatio times the css screen size. A lot of the other projects I see on the web get this wrong.</li>
<li>accessibility is important, as-dithered-image supports alt-text for screen readers.</li>
<li>dithering does not make much sense on screens with really high DPI (like modern iPhones), as-dithered-image attempts to preserve the dithering effect automatically.</li>
</ul>
<p>There are a few issues with this approach:</p>
<ul>
<li>unlike the normal img tag as-dithered-image must be resized exactly, it does not resize itself to the aspect ratio of the source image.</li>
<li>The dithering is all done in the UI thread. This can lead to janky behavior on resizing if you have a lot of dithered images. The dithering should really be done in a worker thread but I got lazy.</li>
</ul>
<h3>Other Examples</h3>
<p><as-dithered-image src="monalisa.jpg" alt="The Mona Lisa finely dithered" crunch="pixel"></as-dithered-image><span>Just a little sketch I whipped up. We can control the pixel size the dither algorithm uses. In this case the &#34;crunch&#34; is set so to produce a one-to-one match between screen and image. On high DPI screens this gives a finer image, maybe too fine on really small screens.</span></p>
<p><as-dithered-image src="monalisa.jpg" alt="The Mona Lisa coarsely dithered" crunch="3"></as-dithered-image><span>Of course we can go the other way as well</span></p>
    </div></div>
  </body>
</html>
