<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.jairtrejo.com/blog/2023/08/racket-iteration-ii">Original</a>
    <h1>Iteration in Racket II - A simple game loop</h1>
    
    <div id="readability-page-1" class="page"><div><p>Iteration is useful to go through some data you have. But it can also be
helpful for data you don’t (yet) have.</p>
<p>Consider a game of number-guessing. In a set number of attempts, you have to
guess a number picked in secret by the computer. To help you along, the
computer lets you know if your guess is too high, or too low.</p>
<p>A Racket implementation could be:</p>
<pre><code><span>(</span><span>define</span> <span>(</span><span>guess-game</span><span>)</span>
  <span>(</span><span>define</span> secret <span>(</span><span>random</span> <span>100</span><span>)</span><span>)</span>
  <span>(</span><span>displayln</span> <span>&#34;Which number am I thinking?&#34;</span><span>)</span>
  <span>(</span><span>define</span> won?
    <span>(</span><span>for/or</span> <span>(</span><span>[</span><span>_</span> <span>7</span><span>]</span>
             <span>[</span><span>input</span> <span>(</span><span>in-lines</span><span>)</span><span>]</span><span>)</span>
      <span>(</span><span>define</span> guess <span>(</span><span>string-&gt;number</span> input<span>)</span><span>)</span>
      <span>(</span><span>cond</span>
        <span>[</span><span>(</span><span>&gt;</span> guess secret<span>)</span> <span>(</span><span>displayln</span> <span>&#34;Go lower&#34;</span><span>)</span> <span>#f</span><span>]</span>
        <span>[</span><span>(</span><span>&lt;</span> guess secret<span>)</span> <span>(</span><span>displayln</span> <span>&#34;Go higher&#34;</span><span>)</span> <span>#f</span><span>]</span>
        <span>[</span><span>(</span><span>=</span> guess secret<span>)</span> <span>#t</span><span>]</span><span>)</span><span>)</span><span>)</span>
  <span>(</span><span>cond</span>
    <span>[</span><span>won?</span> <span>(</span><span>displayln</span> <span>&#34;You win!&#34;</span><span>)</span><span>]</span>
    <span>[</span><span>else</span> <span>(</span><span>displayln</span> <span>(</span><span>format</span> <span>&#34;You lose! It was ~a&#34;</span> secret<span>)</span><span>)</span><span>]</span><span>)</span><span>)</span>
</code></pre>
<p>The <code>for/or</code> form at the core goes through a user’s attempts, and for each
step it is deciding whether the user won, represented by returning <code>true</code>, or
hasn’t won yet, returning <code>false</code>.</p>
<p>We use <code>for/or</code> because it will collect those intermediate results and stop as
soon as one of them is <code>true</code>, regardless of how much is “left” of the
sequences it is iterating through. The result will be the <code>or</code> of the results:
<code>true</code> if the user ever won, or <code>false</code> if they never did.</p>
<p>The first iterated sequence is <code>7</code>, shorthand for <code>(in-range 7)</code>, which is a
convenient way of going through the numbers 0 to 7 (or doing something 7
times.) The second one is <code>(in-lines)</code>, which is a sequence of lines read from
standard input. It blocks until it sees a new line, and stops if it sees <code>EOF</code>
(so the game can be stopped by hitting <code>Ctrl+D</code>.)</p>
<p>Both sequences are iterated in parallel. As long as the user doesn’t win,
the game will keep going until seven rounds have happened or input has been
terminated.</p>
<p>The entire <code>for/or</code> call is an expression, so we can use the resulting <code>true</code>
or <code>false</code> to display a Victory or Defeat message.</p>
<p>The <code>for/*</code> forms also support a <code>break</code> clause that you can execute anywhere
in the loop body to stop the iteration imperatively. But I think it’s nice that
in this example we can express each step’s result as a value, and that the
combination of those values is meaningful.</p>
<p>What other game loops could be expressed as an <code>or</code>, an <code>and</code> or some other
comprehension?</p></div></div>
  </body>
</html>
