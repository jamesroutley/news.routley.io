<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.infoq.com/news/2024/06/slack-automatic-test-conversion/">Original</a>
    <h1>Slack Combines ASTs with LLMs to Automatically Convert 80% of 15,000 Unit Tests</h1>
    
    <div id="readability-page-1" class="page"><div>
								<p>Slack&#39;s engineering team recently published <a href="https://slack.engineering/balancing-old-tricks-with-new-feats-ai-powered-conversion-from-enzyme-to-react-testing-library-at-slack/" target="_blank">how it used a large language model (LLM) to automatically convert 15,000 unit and integration tests</a> from <a href="https://enzymejs.github.io/enzyme/" target="_blank">Enzyme</a> to <a href="https://testing-library.com/docs/react-testing-library/intro/" target="_blank">React Testing Library (RTL)</a>. By combining Abstract Syntax Tree (AST) transformations and AI-powered automation, Slack&#39;s innovative approach resulted in an 80% conversion success rate, significantly reducing the manual effort required and showcasing the potential of AI in streamlining complex development tasks.</p>

<p>This transition was prompted by Enzyme&#39;s <a href="https://dev.to/wojtekmaj/enzyme-is-dead-now-what-ekl" target="_blank">lack of support for React 18</a>, necessitating a significant shift to maintain compatibility with the latest <a href="https://react.dev/" target="_blank">React</a> version. The conversion tool&#39;s adoption rate at Slack reached approximately 64%, saving considerable developer time of at least 22% of 10,000 hours. While this figure represents a significant saving, Sergii Gorbachov, senior software engineer at Slack, speculates that, in reality, the figure is probably much higher:</p>

<blockquote>
<p>It&#39;s important to note that this 22% time saving represents only the documented cases where the test case passed. However, it&#39;s conceivable that some test cases were converted properly, yet issues such as setup or importing syntax may have caused the test file not to run at all, and time savings were not accounted for in those instances.</p>
</blockquote>

<p>The team initially attempted to automate the conversion using <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" target="_blank">Abstract Syntax Tree</a> (AST) transformations, aiming for 100% accuracy. However, the complexity and variety of Enzyme methods led to a modest success rate of 45% in automatically converting code. One factor contributing to the low success rate is that correct conversion depends on contextual information regarding the rendered <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction" target="_blank">Document Object Model</a> (DOM) under test, to which the AST conversion has no access.</p>

<p><img alt="" data-src="news/2024/06/slack-automatic-test-conversion/en/resources/1Slack-AST-Representation-1717931855564.png" src="https://imgopt.infoq.com/fit-in/3000x4000/filters:quality(85)/filters:no_upscale()/news/2024/06/slack-automatic-test-conversion/en/resources/1Slack-AST-Representation-1717931855564.png" rel="share"/></p>

<p>Next, the team attempted to perform the conversion using <a href="http://www.anthropic.com/">Anthropic</a>&#39;s LLM, <a href="https://www.anthropic.com/claude" target="_blank">Claude</a> 2.1. Despite efforts to refine prompts, the conversion success rates varied significantly between 40% and 60%. Gorbachov notes that &#34;the outcomes ranged from remarkably effective conversions to disappointingly inadequate ones, depending largely on the complexity of the task.&#34;</p>

<p>Following the unsatisfactory results, the team decided to observe how human developers approached converting the unit tests. They noticed that human developers had access to a broad knowledge base on React, Enzyme and RTL, and they combined that knowledge with access to context on the rendered React element and the AST conversions provided by the initial version of the conversion tool.</p>

<p>Slack&#39;s engineers then adopted a hybrid approach, combining the AST transformations with LLM capabilities and mimicking human behaviour. By feeding the rendered React component under test and the conversions performed by the AST tool into the LLM as part of the prompt and creating a robust control mechanism for the AI, they achieved an 80% conversion success rate, demonstrating the complementary nature of these technologies.</p>

<p><img alt="" data-src="news/2024/06/slack-automatic-test-conversion/en/resources/1Slack-pipeline-flowchart-1717931855564.png" src="https://imgopt.infoq.com/fit-in/3000x4000/filters:quality(85)/filters:no_upscale()/news/2024/06/slack-automatic-test-conversion/en/resources/1Slack-pipeline-flowchart-1717931855564.png" rel="share"/></p>

<p>Claude 2.1 is an LLM model <a href="https://www.infoq.com/news/2023/11/anthropic-announces-claude-2-1/" target="_blank">announced in November 2023</a> by Anthropic. It included a 200K token context window, significant reductions in rates of model hallucination, and system prompts and allowed for the use of tools. Anthropic <a href="https://www.infoq.com/news/2024/03/anthropic-claude-ai/" target="_blank">has since introduced the Claude 3 family models</a> consisting of three distinct models, <a href="https://en.wikipedia.org/wiki/Multimodal_learning" target="_blank">multimodal capabilities</a>, and improved contextual understanding.</p>

<p>An Abstract Syntax Tree (AST) is a tree representation of the abstract syntactic structure of source code written in a programming language. Each node in the tree denotes a construct occurring in the source code. A syntax tree focuses on the structure and content necessary for understanding the code&#39;s functionality. ASTs are commonly used in compilers and interpreters to parse and analyze code, enabling various transformations, optimizations, and translations during compilation.</p>

								









  
    

							</div></div>
  </body>
</html>
