<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/koskimas/kysely">Original</a>
    <h1>Kysely: TypeScript SQL Query Builder</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><p dir="auto"><a href="https://stand-with-ukraine.pp.ua" rel="nofollow"><img src="https://raw.githubusercontent.com/vshymanskyy/StandWithUkraine/main/banner2-direct.svg" alt="Stand With Ukraine"/></a></p>
<p dir="auto"><a href="https://discord.gg/xyBJ3GwvAm" rel="nofollow"><img src="https://camo.githubusercontent.com/556a7d85b446e1b400e3e35deb9aa273bdeb690c6f099595b16dfee34838f8d9/68747470733a2f2f696d672e736869656c64732e696f2f646973636f72642f383930313138343231353837353738393230" alt="Discord" data-canonical-src="https://img.shields.io/discord/890118421587578920"/></a>
<a href="https://github.com/koskimas/kysely"><img src="https://github.com/koskimas/kysely/actions/workflows/test.yml/badge.svg" alt="Tests"/></a></p>

<p dir="auto">Kysely (pronounce “Key-Seh-Lee”) is a type-safe and autocompletion-friendly typescript SQL query builder. Inspired by
<a href="http://knexjs.org/" rel="nofollow">knex</a>. Mainly developed for <a href="https://nodejs.org/en/" rel="nofollow">node.js</a> but also runs on <a href="https://deno.land/" rel="nofollow">deno</a>
and in the browser.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/koskimas/kysely/blob/master/assets/demo.gif"><img src="https://github.com/koskimas/kysely/raw/master/assets/demo.gif" alt="" data-animated-image=""/></a></p>
<p dir="auto">Kysely makes sure you only refer to tables and columns that are visible to the part of the query
you&#39;re writing. The result type only has the selected columns with correct types and aliases. As an
added bonus you get autocompletion for all that stuff.</p>
<p dir="auto">As shown in the gif above, through the pure magic of modern typescript, Kysely is even able to parse
the alias given to <code>pet.name</code> and add the <code>pet_name</code> column to the result row type. Kysely is able to infer
column names, aliases and types from selected subqueries, joined subqueries, <code>with</code> statements and pretty
much anything you can think of.</p>
<p dir="auto">Of course there are cases where things cannot be typed at compile time, and Kysely offers escape
hatches for these situations. See the <a href="https://koskimas.github.io/kysely/interfaces/Sql.html" rel="nofollow">sql template tag</a>
and the <a href="https://koskimas.github.io/kysely/classes/DynamicModule.html#ref" rel="nofollow">DynamicModule</a> for more info.</p>
<p dir="auto">All API documentation is written in the typing files and you can simply <code>cmd-click</code> on the module, class
or method you&#39;re using to see it. The same documentation is also hosted <a href="https://github.com/koskimas/kysely">here</a>.</p>
<p dir="auto">If you start using Kysely and can&#39;t find something you&#39;d want to use, please open an issue or join our
<a href="https://discord.gg/xyBJ3GwvAm" rel="nofollow">discord server</a>.</p>
<p dir="auto">You can find a more thorough introduction <a href="https://www.jakso.me/blog/kysely-a-type-safe-sql-query-builder-for-typescript" rel="nofollow">here</a>.</p>

<ul dir="auto">
<li><a href="#installation">Installation</a>
<ul dir="auto">
<li><a href="#3rd-party-dialects">3rd party dialects</a></li>
</ul>
</li>
<li><a href="#minimal-example">Minimal example</a></li>
<li><a href="#playground">Playground</a></li>
<li><a href="#generating-types">Generating types</a></li>
<li><a href="#query-examples">Query examples</a>
<ul dir="auto">
<li><a href="#select-queries">Select queries</a>
<ul dir="auto">
<li><a href="#stream-select-query-results">Stream select query results</a></li>
</ul>
</li>
<li><a href="#update-queries">Update queries</a></li>
<li><a href="#insert-queries">Insert queries</a></li>
<li><a href="#delete-queries">Delete queries</a></li>
</ul>
</li>
<li><a href="#recipes">Recipes</a></li>
<li><a href="#migrations">Migrations</a>
<ul dir="auto">
<li><a href="#postgresql-migration-example">PostgreSQL migration example</a></li>
<li><a href="#mysql-migration-example">MySQL migration example</a></li>
</ul>
</li>
<li><a href="#deno">Deno</a></li>
<li><a href="#browser">Browser</a></li>
<li><a href="#why-not-just-contribute-to-knex">Why not just contribute to knex</a></li>
</ul>

<p dir="auto">Kysely currently works on PostgreSQL, MySQL and SQLite. You can install it using:</p>
<div data-snippet-clipboard-copy-content="# PostgreSQL
npm install kysely pg

# MySQL
npm install kysely mysql2

# SQLite
npm install kysely better-sqlite3"><pre><code># PostgreSQL
npm install kysely pg

# MySQL
npm install kysely mysql2

# SQLite
npm install kysely better-sqlite3
</code></pre></div>
<p dir="auto">More dialects will be added soon. Kysely also has a simple interface
for <a href="https://koskimas.github.io/kysely/interfaces/Dialect.html" rel="nofollow">3rd party dialects</a>.</p>
<h3 dir="auto"><a id="user-content-3rd-party-dialects" aria-hidden="true" href="#3rd-party-dialects"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>3rd party dialects</h3>
<ul dir="auto">
<li><a href="https://github.com/serverless-stack/kysely-data-api">AWS Data API</a></li>
<li><a href="https://github.com/depot/kysely-planetscale">PlanetScale Serverless Driver</a></li>
<li><a href="https://github.com/igalklebanov/kysely-singlestore">SingleStore Data API</a></li>
<li><a href="https://github.com/aidenwallis/kysely-d1">D1</a></li>
<li><a href="https://github.com/igalklebanov/kysely-surrealdb">SurrealDB</a></li>
</ul>

<p dir="auto">All you need to do is define an interface for each table in the database and pass those
interfaces to the <code>Kysely</code> constructor:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { Pool } from &#39;pg&#39;
import {
  Kysely,
  PostgresDialect,
  Generated,
  ColumnType,
  Selectable,
  Insertable,
  Updateable,
} from &#39;kysely&#39;

interface PersonTable {
  // Columns that are generated by the database should be marked
  // using the `Generated` type. This way they are automatically
  // made optional in inserts and updates.
  id: Generated&lt;number&gt;

  first_name: string
  gender: &#39;male&#39; | &#39;female&#39; | &#39;other&#39;

  // If the column is nullable in the database, make its type nullable.
  // Don&#39;t use optional properties. Optionality is always determined
  // automatically by Kysely.
  last_name: string | null

  // You can specify a different type for each operation (select, insert and
  // update) using the `ColumnType&lt;SelectType, InsertType, UpdateType&gt;`
  // wrapper. Here we define a column `modified_at` that is selected as
  // a `Date`, can optionally be provided as a `string` in inserts and
  // can never be updated:
  modified_at: ColumnType&lt;Date, string | undefined, never&gt;
}

interface PetTable {
  id: Generated&lt;number&gt;
  name: string
  owner_id: number
  species: &#39;dog&#39; | &#39;cat&#39;
}

interface MovieTable {
  id: Generated&lt;string&gt;
  stars: number
}

// Keys of this interface are table names.
interface Database {
  person: PersonTable
  pet: PetTable
  movie: MovieTable
}

// You&#39;d create one of these when you start your app.
const db = new Kysely&lt;Database&gt;({
  // Use MysqlDialect for MySQL and SqliteDialect for SQLite.
  dialect: new PostgresDialect({
    pool: new Pool({
      host: &#39;localhost&#39;,
      database: &#39;kysely_test&#39;
    })
  })
})

async function demo() {
  const { id } = await db
    .insertInto(&#39;person&#39;)
    .values({ first_name: &#39;Jennifer&#39;, gender: &#39;female&#39; })
    .returning(&#39;id&#39;)
    .executeTakeFirstOrThrow()

  await db
    .insertInto(&#39;pet&#39;)
    .values({ name: &#39;Catto&#39;, species: &#39;cat&#39;, owner_id: id })
    .execute()

  const person = await db
    .selectFrom(&#39;person&#39;)
    .innerJoin(&#39;pet&#39;, &#39;pet.owner_id&#39;, &#39;person.id&#39;)
    .select([&#39;first_name&#39;, &#39;pet.name as pet_name&#39;])
    .where(&#39;person.id&#39;, &#39;=&#39;, id)
    .executeTakeFirst()

  if (person) {
    person.pet_name
  }
}"><pre><span>import</span> <span>{</span> <span>Pool</span> <span>}</span> <span>from</span> <span>&#39;pg&#39;</span>
<span>import</span> <span>{</span>
  <span>Kysely</span><span>,</span>
  <span>PostgresDialect</span><span>,</span>
  <span>Generated</span><span>,</span>
  <span>ColumnType</span><span>,</span>
  <span>Selectable</span><span>,</span>
  <span>Insertable</span><span>,</span>
  <span>Updateable</span><span>,</span>
<span>}</span> <span>from</span> <span>&#39;kysely&#39;</span>

<span>interface</span> <span>PersonTable</span> <span>{</span>
  <span>// Columns that are generated by the database should be marked</span>
  <span>// using the `Generated` type. This way they are automatically</span>
  <span>// made optional in inserts and updates.</span>
  <span>id</span>: <span>Generated</span><span>&lt;</span><span>number</span><span>&gt;</span>

  <span>first_name</span>: <span>string</span>
  <span>gender</span>: <span>&#39;male&#39;</span> <span>|</span> <span>&#39;female&#39;</span> <span>|</span> <span>&#39;other&#39;</span>

  <span>// If the column is nullable in the database, make its type nullable.</span>
  <span>// Don&#39;t use optional properties. Optionality is always determined</span>
  <span>// automatically by Kysely.</span>
  <span>last_name</span>: <span>string</span> <span>|</span> <span>null</span>

  <span>// You can specify a different type for each operation (select, insert and</span>
  <span>// update) using the `ColumnType&lt;SelectType, InsertType, UpdateType&gt;`</span>
  <span>// wrapper. Here we define a column `modified_at` that is selected as</span>
  <span>// a `Date`, can optionally be provided as a `string` in inserts and</span>
  <span>// can never be updated:</span>
  <span>modified_at</span>: <span>ColumnType</span><span>&lt;</span><span>Date</span><span>,</span> <span>string</span> <span>|</span> <span>undefined</span><span>,</span> <span>never</span><span>&gt;</span>
<span>}</span>

<span>interface</span> <span>PetTable</span> <span>{</span>
  <span>id</span>: <span>Generated</span><span>&lt;</span><span>number</span><span>&gt;</span>
  <span>name</span>: <span>string</span>
  <span>owner_id</span>: <span>number</span>
  <span>species</span>: <span>&#39;dog&#39;</span> <span>|</span> <span>&#39;cat&#39;</span>
<span>}</span>

<span>interface</span> <span>MovieTable</span> <span>{</span>
  <span>id</span>: <span>Generated</span><span>&lt;</span><span>string</span><span>&gt;</span>
  <span>stars</span>: <span>number</span>
<span>}</span>

<span>// Keys of this interface are table names.</span>
<span>interface</span> <span>Database</span> <span>{</span>
  <span>person</span>: <span>PersonTable</span>
  <span>pet</span>: <span>PetTable</span>
  <span>movie</span>: <span>MovieTable</span>
<span>}</span>

<span>// You&#39;d create one of these when you start your app.</span>
<span>const</span> <span>db</span> <span>=</span> <span>new</span> <span>Kysely</span><span>&lt;</span><span>Database</span><span>&gt;</span><span>(</span><span>{</span>
  <span>// Use MysqlDialect for MySQL and SqliteDialect for SQLite.</span>
  <span>dialect</span>: <span>new</span> <span>PostgresDialect</span><span>(</span><span>{</span>
    <span>pool</span>: <span>new</span> <span>Pool</span><span>(</span><span>{</span>
      <span>host</span>: <span>&#39;localhost&#39;</span><span>,</span>
      <span>database</span>: <span>&#39;kysely_test&#39;</span>
    <span>}</span><span>)</span>
  <span>}</span><span>)</span>
<span>}</span><span>)</span>

<span>async</span> <span>function</span> <span>demo</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>{</span> id <span>}</span> <span>=</span> <span>await</span> <span>db</span>
    <span>.</span><span>insertInto</span><span>(</span><span>&#39;person&#39;</span><span>)</span>
    <span>.</span><span>values</span><span>(</span><span>{</span> <span>first_name</span>: <span>&#39;Jennifer&#39;</span><span>,</span> <span>gender</span>: <span>&#39;female&#39;</span> <span>}</span><span>)</span>
    <span>.</span><span>returning</span><span>(</span><span>&#39;id&#39;</span><span>)</span>
    <span>.</span><span>executeTakeFirstOrThrow</span><span>(</span><span>)</span>

  <span>await</span> <span>db</span>
    <span>.</span><span>insertInto</span><span>(</span><span>&#39;pet&#39;</span><span>)</span>
    <span>.</span><span>values</span><span>(</span><span>{</span> <span>name</span>: <span>&#39;Catto&#39;</span><span>,</span> <span>species</span>: <span>&#39;cat&#39;</span><span>,</span> <span>owner_id</span>: <span>id</span> <span>}</span><span>)</span>
    <span>.</span><span>execute</span><span>(</span><span>)</span>

  <span>const</span> <span>person</span> <span>=</span> <span>await</span> <span>db</span>
    <span>.</span><span>selectFrom</span><span>(</span><span>&#39;person&#39;</span><span>)</span>
    <span>.</span><span>innerJoin</span><span>(</span><span>&#39;pet&#39;</span><span>,</span> <span>&#39;pet.owner_id&#39;</span><span>,</span> <span>&#39;person.id&#39;</span><span>)</span>
    <span>.</span><span>select</span><span>(</span><span>[</span><span>&#39;first_name&#39;</span><span>,</span> <span>&#39;pet.name as pet_name&#39;</span><span>]</span><span>)</span>
    <span>.</span><span>where</span><span>(</span><span>&#39;person.id&#39;</span><span>,</span> <span>&#39;=&#39;</span><span>,</span> <span>id</span><span>)</span>
    <span>.</span><span>executeTakeFirst</span><span>(</span><span>)</span>

  <span>if</span> <span>(</span><span>person</span><span>)</span> <span>{</span>
    <span>person</span><span>.</span><span>pet_name</span>
  <span>}</span>
<span>}</span></pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="// You can extract the select, insert and update interfaces like this
// if you want (you don&#39;t need to):
type Person = Selectable&lt;PersonTable&gt;
type InsertablePerson = Insertable&lt;PersonTable&gt;
type UpdateablePerson = Updateable&lt;PersonTable&gt;"><pre><span>// You can extract the select, insert and update interfaces like this</span>
<span>// if you want (you don&#39;t need to):</span>
<span>type</span> <span>Person</span> <span>=</span> <span>Selectable</span><span>&lt;</span><span>PersonTable</span><span>&gt;</span>
<span>type</span> <span>InsertablePerson</span> <span>=</span> <span>Insertable</span><span>&lt;</span><span>PersonTable</span><span>&gt;</span>
<span>type</span> <span>UpdateablePerson</span> <span>=</span> <span>Updateable</span><span>&lt;</span><span>PersonTable</span><span>&gt;</span></pre></div>

<p dir="auto"><a href="https://github.com/wirekang">@wirekang</a> has created a <a href="https://wirekang.github.io/kysely-playground/?p=f&amp;i=-NLp3n_P5fyeQKMQda8n" rel="nofollow">playground for Kysely</a>. You can use to quickly test stuff out and for creating code examples for your issues, PRs and discord messages.</p>

<p dir="auto">If you want to generate the table types automatically from the database schema please
check out <a href="https://github.com/RobinBlomberg/kysely-codegen">this awesome project</a>.</p>

<h2 dir="auto"><a id="user-content-select-queries" aria-hidden="true" href="#select-queries"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Select queries</h2>
<p dir="auto">You can find examples of select queries in the documentation of the
<a href="https://koskimas.github.io/kysely/classes/SelectQueryBuilder.html#select" rel="nofollow">select method</a> and
the <a href="https://koskimas.github.io/kysely/classes/SelectQueryBuilder.html#where" rel="nofollow">where method</a>
among other places.</p>
<h3 dir="auto"><a id="user-content-stream-select-query-results" aria-hidden="true" href="#stream-select-query-results"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Stream select query results</h3>
<p dir="auto"><em>Currently only supported by <code>postgres</code> and <code>mysql</code> dialects.</em></p>
<div dir="auto" data-snippet-clipboard-copy-content="import { Pool } from &#39;pg&#39;
// or `import * as Cursor from &#39;pg-cursor&#39;` depending on your tsconfig
import Cursor from &#39;pg-cursor&#39;
import { Kysely, PostgresDialect } from &#39;kysely&#39;

const db = new Kysely&lt;Database&gt;({
  // PostgresDialect requires the Cursor dependency
  dialect: new PostgresDialect({
    pool: new Pool({
      host: &#39;localhost&#39;,
      database: &#39;kysely_test&#39;
    }),
    cursor: Cursor
  }),
  // MysqlDialect doesn&#39;t require any special configuration
})

async function demo() {
  for await (const adult of db.selectFrom(&#39;person&#39;)
    .selectAll()
    .where(&#39;age&#39;, &#39;&gt;&#39;, 18)
    .stream()
  ) {
    console.log(`Hello ${adult.first_name}!`)

    if (adult.first_name === &#39;John&#39;) {
      // After this line the db connection is released and no more
      // rows are streamed from the database to the client
      break;
    }
  }
}"><pre><span>import</span> <span>{</span> <span>Pool</span> <span>}</span> <span>from</span> <span>&#39;pg&#39;</span>
<span>// or `import * as Cursor from &#39;pg-cursor&#39;` depending on your tsconfig</span>
<span>import</span> <span>Cursor</span> <span>from</span> <span>&#39;pg-cursor&#39;</span>
<span>import</span> <span>{</span> <span>Kysely</span><span>,</span> <span>PostgresDialect</span> <span>}</span> <span>from</span> <span>&#39;kysely&#39;</span>

<span>const</span> <span>db</span> <span>=</span> <span>new</span> <span>Kysely</span><span>&lt;</span><span>Database</span><span>&gt;</span><span>(</span><span>{</span>
  <span>// PostgresDialect requires the Cursor dependency</span>
  <span>dialect</span>: <span>new</span> <span>PostgresDialect</span><span>(</span><span>{</span>
    <span>pool</span>: <span>new</span> <span>Pool</span><span>(</span><span>{</span>
      <span>host</span>: <span>&#39;localhost&#39;</span><span>,</span>
      <span>database</span>: <span>&#39;kysely_test&#39;</span>
    <span>}</span><span>)</span><span>,</span>
    <span>cursor</span>: <span>Cursor</span>
  <span>}</span><span>)</span><span>,</span>
  <span>// MysqlDialect doesn&#39;t require any special configuration</span>
<span>}</span><span>)</span>

<span>async</span> <span>function</span> <span>demo</span><span>(</span><span>)</span> <span>{</span>
  <span>for</span> <span>await</span> <span>(</span><span>const</span> <span>adult</span> <span>of</span> <span>db</span><span>.</span><span>selectFrom</span><span>(</span><span>&#39;person&#39;</span><span>)</span>
    <span>.</span><span>selectAll</span><span>(</span><span>)</span>
    <span>.</span><span>where</span><span>(</span><span>&#39;age&#39;</span><span>,</span> <span>&#39;&gt;&#39;</span><span>,</span> <span>18</span><span>)</span>
    <span>.</span><span>stream</span><span>(</span><span>)</span>
  <span>)</span> <span>{</span>
    <span>console</span><span>.</span><span>log</span><span>(</span><span>`Hello <span><span>${</span><span>adult</span><span>.</span><span>first_name</span><span>}</span></span>!`</span><span>)</span>

    <span>if</span> <span>(</span><span>adult</span><span>.</span><span>first_name</span> <span>===</span> <span>&#39;John&#39;</span><span>)</span> <span>{</span>
      <span>// After this line the db connection is released and no more</span>
      <span>// rows are streamed from the database to the client</span>
      <span>break</span><span>;</span>
    <span>}</span>
  <span>}</span>
<span>}</span></pre></div>
<h2 dir="auto"><a id="user-content-update-queries" aria-hidden="true" href="#update-queries"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Update queries</h2>
<p dir="auto">See the <a href="https://koskimas.github.io/kysely/classes/UpdateQueryBuilder.html#set" rel="nofollow">set method</a> and the
<a href="https://koskimas.github.io/kysely/classes/Kysely.html#updateTable" rel="nofollow">updateTable method</a>
documentation.</p>
<h2 dir="auto"><a id="user-content-insert-queries" aria-hidden="true" href="#insert-queries"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Insert queries</h2>
<p dir="auto">See the <a href="https://koskimas.github.io/kysely/classes/InsertQueryBuilder.html#values" rel="nofollow">values method</a> and the
<a href="https://koskimas.github.io/kysely/classes/Kysely.html#insertInto" rel="nofollow">insertInto method</a>
documentation.</p>
<h2 dir="auto"><a id="user-content-delete-queries" aria-hidden="true" href="#delete-queries"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Delete queries</h2>
<p dir="auto">See the <a href="https://koskimas.github.io/kysely/classes/Kysely.html#deleteFrom" rel="nofollow">deleteFrom method</a>
documentation.</p>

<p dir="auto">The <a href="https://github.com/koskimas/kysely/tree/master/recipes">recipes</a> folder contains a bunch of small tutorials
or &#34;recipes&#34; for common use cases.</p>
<ul dir="auto">
<li><a href="https://github.com/koskimas/kysely/tree/master/recipes/conditional-selects.md">Conditional selects</a></li>
<li><a href="https://github.com/koskimas/kysely/tree/master/recipes/deduplicate-joins.md">Deduplicate joins</a></li>
<li><a href="https://github.com/koskimas/kysely/tree/master/recipes/extending-kysely.md">Extending kysely</a></li>
<li><a href="https://github.com/koskimas/kysely/tree/master/recipes/raw-sql.md">Raw SQL</a></li>
<li><a href="https://github.com/koskimas/kysely/tree/master/recipes/schemas.md">Schemas</a></li>
<li><a href="https://github.com/koskimas/kysely/tree/master/recipes/excessively-deep-types.md">Dealing with the <code>Type instantiation is excessively deep and possibly infinite</code> error</a></li>
</ul>

<p dir="auto">Migration files should look like this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { Kysely } from &#39;kysely&#39;

export async function up(db: Kysely&lt;any&gt;): Promise&lt;void&gt; {
  // Migration code
}

export async function down(db: Kysely&lt;any&gt;): Promise&lt;void&gt; {
  // Migration code
}"><pre><span>import</span> <span>{</span> <span>Kysely</span> <span>}</span> <span>from</span> <span>&#39;kysely&#39;</span>

<span>export</span> <span>async</span> <span>function</span> <span>up</span><span>(</span><span>db</span>: <span>Kysely</span><span>&lt;</span><span>any</span><span>&gt;</span><span>)</span>: <span>Promise</span><span>&lt;</span><span><span>void</span></span><span>&gt;</span> <span>{</span>
  <span>// Migration code</span>
<span>}</span>

<span>export</span> <span>async</span> <span>function</span> <span>down</span><span>(</span><span>db</span>: <span>Kysely</span><span>&lt;</span><span>any</span><span>&gt;</span><span>)</span>: <span>Promise</span><span>&lt;</span><span><span>void</span></span><span>&gt;</span> <span>{</span>
  <span>// Migration code</span>
<span>}</span></pre></div>
<p dir="auto">The <code>up</code> function is called when you update your database schema to the next version and <code>down</code>
when you go back to previous version. The only argument for the functions is an instance of
<code>Kysely&lt;any&gt;</code>. It&#39;s important to use <code>Kysely&lt;any&gt;</code> and not <code>Kysely&lt;YourDatabase&gt;</code>.</p>
<p dir="auto">Migrations should never depend on the current code of your app because they need to work even when the app
changes. Migrations need to be &#34;frozen in time&#34;.</p>
<p dir="auto">The migrations can use the <a href="https://koskimas.github.io/kysely/classes/SchemaModule.html" rel="nofollow">Kysely.schema</a>
module to modify the schema. Migrations can also run normal queries to modify data.</p>
<p dir="auto">Execution order of the migrations is the alpabetical order of their names. An excellent way to name your
migrations is to prefix them with an ISO 8601 date string. A date prefix works well in large teams
where multiple team members may add migrations at the same time in parallel commits without knowing
about the other migrations.</p>
<p dir="auto">You don&#39;t need to store your migrations as separate files if you don&#39;t want to. You can easily
implement your own <a href="https://koskimas.github.io/kysely/interfaces/MigrationProvider.html" rel="nofollow">MigrationProvider</a>
and give it to the <a href="https://koskimas.github.io/kysely/classes/Migrator.html" rel="nofollow">Migrator</a> class
when you instantiate one.</p>
<h3 dir="auto"><a id="user-content-postgresql-migration-example" aria-hidden="true" href="#postgresql-migration-example"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>PostgreSQL migration example</h3>
<div dir="auto" data-snippet-clipboard-copy-content="import { Kysely, sql } from &#39;kysely&#39;

export async function up(db: Kysely&lt;any&gt;): Promise&lt;void&gt; {
  await db.schema
    .createTable(&#39;person&#39;)
    .addColumn(&#39;id&#39;, &#39;serial&#39;, (col) =&gt; col.primaryKey())
    .addColumn(&#39;first_name&#39;, &#39;varchar&#39;, (col) =&gt; col.notNull())
    .addColumn(&#39;last_name&#39;, &#39;varchar&#39;)
    .addColumn(&#39;gender&#39;, &#39;varchar(50)&#39;, (col) =&gt; col.notNull())
    .addColumn(&#39;created_at&#39;, &#39;timestamp&#39;, (col) =&gt; col.defaultTo(sql`now()`).notNull())
    .execute()

  await db.schema
    .createTable(&#39;pet&#39;)
    .addColumn(&#39;id&#39;, &#39;serial&#39;, (col) =&gt; col.primaryKey())
    .addColumn(&#39;name&#39;, &#39;varchar&#39;, (col) =&gt; col.notNull().unique())
    .addColumn(&#39;owner_id&#39;, &#39;integer&#39;, (col) =&gt;
      col.references(&#39;person.id&#39;).onDelete(&#39;cascade&#39;).notNull()
    )
    .addColumn(&#39;species&#39;, &#39;varchar&#39;, (col) =&gt; col.notNull())
    .execute()

  await db.schema
    .createIndex(&#39;pet_owner_id_index&#39;)
    .on(&#39;pet&#39;)
    .column(&#39;owner_id&#39;)
    .execute()
}

export async function down(db: Kysely&lt;any&gt;): Promise&lt;void&gt; {
  await db.schema.dropTable(&#39;pet&#39;).execute()
  await db.schema.dropTable(&#39;person&#39;).execute()
}"><pre><span>import</span> <span>{</span> <span>Kysely</span><span>,</span> <span>sql</span> <span>}</span> <span>from</span> <span>&#39;kysely&#39;</span>

<span>export</span> <span>async</span> <span>function</span> <span>up</span><span>(</span><span>db</span>: <span>Kysely</span><span>&lt;</span><span>any</span><span>&gt;</span><span>)</span>: <span>Promise</span><span>&lt;</span><span><span>void</span></span><span>&gt;</span> <span>{</span>
  <span>await</span> <span>db</span><span>.</span><span>schema</span>
    <span>.</span><span>createTable</span><span>(</span><span>&#39;person&#39;</span><span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;id&#39;</span><span>,</span> <span>&#39;serial&#39;</span><span>,</span> <span>(</span><span>col</span><span>)</span> <span>=&gt;</span> <span>col</span><span>.</span><span>primaryKey</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;first_name&#39;</span><span>,</span> <span>&#39;varchar&#39;</span><span>,</span> <span>(</span><span>col</span><span>)</span> <span>=&gt;</span> <span>col</span><span>.</span><span>notNull</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;last_name&#39;</span><span>,</span> <span>&#39;varchar&#39;</span><span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;gender&#39;</span><span>,</span> <span>&#39;varchar(50)&#39;</span><span>,</span> <span>(</span><span>col</span><span>)</span> <span>=&gt;</span> <span>col</span><span>.</span><span>notNull</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;created_at&#39;</span><span>,</span> <span>&#39;timestamp&#39;</span><span>,</span> <span>(</span><span>col</span><span>)</span> <span>=&gt;</span> <span>col</span><span>.</span><span>defaultTo</span><span>(</span><span>sql</span><span>`now()`</span><span>)</span><span>.</span><span>notNull</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>execute</span><span>(</span><span>)</span>

  <span>await</span> <span>db</span><span>.</span><span>schema</span>
    <span>.</span><span>createTable</span><span>(</span><span>&#39;pet&#39;</span><span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;id&#39;</span><span>,</span> <span>&#39;serial&#39;</span><span>,</span> <span>(</span><span>col</span><span>)</span> <span>=&gt;</span> <span>col</span><span>.</span><span>primaryKey</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;name&#39;</span><span>,</span> <span>&#39;varchar&#39;</span><span>,</span> <span>(</span><span>col</span><span>)</span> <span>=&gt;</span> <span>col</span><span>.</span><span>notNull</span><span>(</span><span>)</span><span>.</span><span>unique</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;owner_id&#39;</span><span>,</span> <span>&#39;integer&#39;</span><span>,</span> <span>(</span><span>col</span><span>)</span> <span>=&gt;</span>
      <span>col</span><span>.</span><span>references</span><span>(</span><span>&#39;person.id&#39;</span><span>)</span><span>.</span><span>onDelete</span><span>(</span><span>&#39;cascade&#39;</span><span>)</span><span>.</span><span>notNull</span><span>(</span><span>)</span>
    <span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;species&#39;</span><span>,</span> <span>&#39;varchar&#39;</span><span>,</span> <span>(</span><span>col</span><span>)</span> <span>=&gt;</span> <span>col</span><span>.</span><span>notNull</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>execute</span><span>(</span><span>)</span>

  <span>await</span> <span>db</span><span>.</span><span>schema</span>
    <span>.</span><span>createIndex</span><span>(</span><span>&#39;pet_owner_id_index&#39;</span><span>)</span>
    <span>.</span><span>on</span><span>(</span><span>&#39;pet&#39;</span><span>)</span>
    <span>.</span><span>column</span><span>(</span><span>&#39;owner_id&#39;</span><span>)</span>
    <span>.</span><span>execute</span><span>(</span><span>)</span>
<span>}</span>

<span>export</span> <span>async</span> <span>function</span> <span>down</span><span>(</span><span>db</span>: <span>Kysely</span><span>&lt;</span><span>any</span><span>&gt;</span><span>)</span>: <span>Promise</span><span>&lt;</span><span><span>void</span></span><span>&gt;</span> <span>{</span>
  <span>await</span> <span>db</span><span>.</span><span>schema</span><span>.</span><span>dropTable</span><span>(</span><span>&#39;pet&#39;</span><span>)</span><span>.</span><span>execute</span><span>(</span><span>)</span>
  <span>await</span> <span>db</span><span>.</span><span>schema</span><span>.</span><span>dropTable</span><span>(</span><span>&#39;person&#39;</span><span>)</span><span>.</span><span>execute</span><span>(</span><span>)</span>
<span>}</span></pre></div>
<h3 dir="auto"><a id="user-content-mysql-migration-example" aria-hidden="true" href="#mysql-migration-example"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MySQL migration example</h3>
<div dir="auto" data-snippet-clipboard-copy-content="import { Kysely } from &#39;kysely&#39;

export async function up(db: Kysely&lt;any&gt;): Promise&lt;void&gt; {
  await db.schema
    .createTable(&#39;person&#39;)
    .addColumn(&#39;id&#39;, &#39;integer&#39;, (col) =&gt; col.autoIncrement().primaryKey())
    .addColumn(&#39;first_name&#39;, &#39;varchar(255)&#39;, (col) =&gt; col.notNull())
    .addColumn(&#39;last_name&#39;, &#39;varchar(255)&#39;)
    .addColumn(&#39;gender&#39;, &#39;varchar(50)&#39;, (col) =&gt; col.notNull())
    .execute()

  await db.schema
    .createTable(&#39;pet&#39;)
    .addColumn(&#39;id&#39;, &#39;integer&#39;, (col) =&gt; col.autoIncrement().primaryKey())
    .addColumn(&#39;name&#39;, &#39;varchar(255)&#39;, (col) =&gt; col.notNull().unique())
    .addColumn(&#39;owner_id&#39;, &#39;integer&#39;, (col) =&gt; col.notNull())
    .addColumn(&#39;species&#39;, &#39;varchar(255)&#39;, (col) =&gt; col.notNull())
    .addForeignKeyConstraint(
      &#39;pet_owner_id_fk&#39;, [&#39;owner_id&#39;], &#39;person&#39;, [&#39;id&#39;],
      (cb) =&gt; cb.onDelete(&#39;cascade&#39;)
    )
    .execute()

  await db.schema
    .createIndex(&#39;pet_owner_id_index&#39;)
    .on(&#39;pet&#39;)
    .column(&#39;owner_id&#39;)
    .execute()
}

export async function down(db: Kysely&lt;any&gt;): Promise&lt;void&gt; {
  await db.schema.dropTable(&#39;pet&#39;).execute()
  await db.schema.dropTable(&#39;person&#39;).execute()
}"><pre><span>import</span> <span>{</span> <span>Kysely</span> <span>}</span> <span>from</span> <span>&#39;kysely&#39;</span>

<span>export</span> <span>async</span> <span>function</span> <span>up</span><span>(</span><span>db</span>: <span>Kysely</span><span>&lt;</span><span>any</span><span>&gt;</span><span>)</span>: <span>Promise</span><span>&lt;</span><span><span>void</span></span><span>&gt;</span> <span>{</span>
  <span>await</span> <span>db</span><span>.</span><span>schema</span>
    <span>.</span><span>createTable</span><span>(</span><span>&#39;person&#39;</span><span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;id&#39;</span><span>,</span> <span>&#39;integer&#39;</span><span>,</span> <span>(</span><span>col</span><span>)</span> <span>=&gt;</span> <span>col</span><span>.</span><span>autoIncrement</span><span>(</span><span>)</span><span>.</span><span>primaryKey</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;first_name&#39;</span><span>,</span> <span>&#39;varchar(255)&#39;</span><span>,</span> <span>(</span><span>col</span><span>)</span> <span>=&gt;</span> <span>col</span><span>.</span><span>notNull</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;last_name&#39;</span><span>,</span> <span>&#39;varchar(255)&#39;</span><span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;gender&#39;</span><span>,</span> <span>&#39;varchar(50)&#39;</span><span>,</span> <span>(</span><span>col</span><span>)</span> <span>=&gt;</span> <span>col</span><span>.</span><span>notNull</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>execute</span><span>(</span><span>)</span>

  <span>await</span> <span>db</span><span>.</span><span>schema</span>
    <span>.</span><span>createTable</span><span>(</span><span>&#39;pet&#39;</span><span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;id&#39;</span><span>,</span> <span>&#39;integer&#39;</span><span>,</span> <span>(</span><span>col</span><span>)</span> <span>=&gt;</span> <span>col</span><span>.</span><span>autoIncrement</span><span>(</span><span>)</span><span>.</span><span>primaryKey</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;name&#39;</span><span>,</span> <span>&#39;varchar(255)&#39;</span><span>,</span> <span>(</span><span>col</span><span>)</span> <span>=&gt;</span> <span>col</span><span>.</span><span>notNull</span><span>(</span><span>)</span><span>.</span><span>unique</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;owner_id&#39;</span><span>,</span> <span>&#39;integer&#39;</span><span>,</span> <span>(</span><span>col</span><span>)</span> <span>=&gt;</span> <span>col</span><span>.</span><span>notNull</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>addColumn</span><span>(</span><span>&#39;species&#39;</span><span>,</span> <span>&#39;varchar(255)&#39;</span><span>,</span> <span>(</span><span>col</span><span>)</span> <span>=&gt;</span> <span>col</span><span>.</span><span>notNull</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>addForeignKeyConstraint</span><span>(</span>
      <span>&#39;pet_owner_id_fk&#39;</span><span>,</span> <span>[</span><span>&#39;owner_id&#39;</span><span>]</span><span>,</span> <span>&#39;person&#39;</span><span>,</span> <span>[</span><span>&#39;id&#39;</span><span>]</span><span>,</span>
      <span>(</span><span>cb</span><span>)</span> <span>=&gt;</span> <span>cb</span><span>.</span><span>onDelete</span><span>(</span><span>&#39;cascade&#39;</span><span>)</span>
    <span>)</span>
    <span>.</span><span>execute</span><span>(</span><span>)</span>

  <span>await</span> <span>db</span><span>.</span><span>schema</span>
    <span>.</span><span>createIndex</span><span>(</span><span>&#39;pet_owner_id_index&#39;</span><span>)</span>
    <span>.</span><span>on</span><span>(</span><span>&#39;pet&#39;</span><span>)</span>
    <span>.</span><span>column</span><span>(</span><span>&#39;owner_id&#39;</span><span>)</span>
    <span>.</span><span>execute</span><span>(</span><span>)</span>
<span>}</span>

<span>export</span> <span>async</span> <span>function</span> <span>down</span><span>(</span><span>db</span>: <span>Kysely</span><span>&lt;</span><span>any</span><span>&gt;</span><span>)</span>: <span>Promise</span><span>&lt;</span><span><span>void</span></span><span>&gt;</span> <span>{</span>
  <span>await</span> <span>db</span><span>.</span><span>schema</span><span>.</span><span>dropTable</span><span>(</span><span>&#39;pet&#39;</span><span>)</span><span>.</span><span>execute</span><span>(</span><span>)</span>
  <span>await</span> <span>db</span><span>.</span><span>schema</span><span>.</span><span>dropTable</span><span>(</span><span>&#39;person&#39;</span><span>)</span><span>.</span><span>execute</span><span>(</span><span>)</span>
<span>}</span></pre></div>
<p dir="auto">You can then use</p>
<div dir="auto" data-snippet-clipboard-copy-content="const migrator = new Migrator(migratorConfig);
await migrator.migrateToLatest(pathToMigrationsFolder)"><pre><span>const</span> <span>migrator</span> <span>=</span> <span>new</span> <span>Migrator</span><span>(</span><span>migratorConfig</span><span>)</span><span>;</span>
<span>await</span> <span>migrator</span><span>.</span><span>migrateToLatest</span><span>(</span><span>pathToMigrationsFolder</span><span>)</span></pre></div>
<p dir="auto">to run all migrations that have not yet been run. See the
<a href="https://koskimas.github.io/kysely/classes/Migrator.html" rel="nofollow">Migrator</a>
class&#39;s documentation for more info.</p>
<p dir="auto">Kysely doesn&#39;t have a CLI for running migrations and probably never will. This is because Kysely&#39;s
migrations are also written in typescript. To run the migrations, you need to first build the
typescript code into javascript. A CLI would cause confusion over which migrations are being
run, the typescript ones or the javascript ones. If we added support for both, the CLI would
need to depend on a typescript compiler, which most production environments don&#39;t (and shouldn&#39;t)
have. You will probably want to add a simple migration script to your projects like this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import * as path from &#39;path&#39;
import { Pool } from &#39;pg&#39;
import { promises as fs } from &#39;fs&#39;
import {
  Kysely,
  Migrator,
  PostgresDialect,
  FileMigrationProvider
} from &#39;kysely&#39;

async function migrateToLatest() {
  const db = new Kysely&lt;Database&gt;({
    dialect: new PostgresDialect({
      pool: new Pool({
        host: &#39;localhost&#39;,
        database: &#39;kysely_test&#39;,
      })
    }),
  })

  const migrator = new Migrator({
    db,
    provider: new FileMigrationProvider({
      fs,
      path,
      migrationFolder: &#39;some/path/to/migrations&#39;,
    })
  })

  const { error, results } = await migrator.migrateToLatest()

  results?.forEach((it) =&gt; {
    if (it.status === &#39;Success&#39;) {
      console.log(`migration &#34;${it.migrationName}&#34; was executed successfully`)
    } else if (it.status === &#39;Error&#39;) {
      console.error(`failed to execute migration &#34;${it.migrationName}&#34;`)
    }
  })

  if (error) {
    console.error(&#39;failed to migrate&#39;)
    console.error(error)
    process.exit(1)
  }

  await db.destroy()
}

migrateToLatest()"><pre><span>import</span> <span>*</span> <span>as</span> <span>path</span> <span>from</span> <span>&#39;path&#39;</span>
<span>import</span> <span>{</span> <span>Pool</span> <span>}</span> <span>from</span> <span>&#39;pg&#39;</span>
<span>import</span> <span>{</span> <span>promises</span> <span>as</span> <span>fs</span> <span>}</span> <span>from</span> <span>&#39;fs&#39;</span>
<span>import</span> <span>{</span>
  <span>Kysely</span><span>,</span>
  <span>Migrator</span><span>,</span>
  <span>PostgresDialect</span><span>,</span>
  <span>FileMigrationProvider</span>
<span>}</span> <span>from</span> <span>&#39;kysely&#39;</span>

<span>async</span> <span>function</span> <span>migrateToLatest</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>db</span> <span>=</span> <span>new</span> <span>Kysely</span><span>&lt;</span><span>Database</span><span>&gt;</span><span>(</span><span>{</span>
    <span>dialect</span>: <span>new</span> <span>PostgresDialect</span><span>(</span><span>{</span>
      <span>pool</span>: <span>new</span> <span>Pool</span><span>(</span><span>{</span>
        <span>host</span>: <span>&#39;localhost&#39;</span><span>,</span>
        <span>database</span>: <span>&#39;kysely_test&#39;</span><span>,</span>
      <span>}</span><span>)</span>
    <span>}</span><span>)</span><span>,</span>
  <span>}</span><span>)</span>

  <span>const</span> <span>migrator</span> <span>=</span> <span>new</span> <span>Migrator</span><span>(</span><span>{</span>
    db<span>,</span>
    <span>provider</span>: <span>new</span> <span>FileMigrationProvider</span><span>(</span><span>{</span>
      fs<span>,</span>
      path<span>,</span>
      <span>migrationFolder</span>: <span>&#39;some/path/to/migrations&#39;</span><span>,</span>
    <span>}</span><span>)</span>
  <span>}</span><span>)</span>

  <span>const</span> <span>{</span> error<span>,</span> results <span>}</span> <span>=</span> <span>await</span> <span>migrator</span><span>.</span><span>migrateToLatest</span><span>(</span><span>)</span>

  <span>results</span><span>?.</span><span>forEach</span><span>(</span><span>(</span><span>it</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>if</span> <span>(</span><span>it</span><span>.</span><span>status</span> <span>===</span> <span>&#39;Success&#39;</span><span>)</span> <span>{</span>
      <span>console</span><span>.</span><span>log</span><span>(</span><span>`migration &#34;<span><span>${</span><span>it</span><span>.</span><span>migrationName</span><span>}</span></span>&#34; was executed successfully`</span><span>)</span>
    <span>}</span> <span>else</span> <span>if</span> <span>(</span><span>it</span><span>.</span><span>status</span> <span>===</span> <span>&#39;Error&#39;</span><span>)</span> <span>{</span>
      <span>console</span><span>.</span><span>error</span><span>(</span><span>`failed to execute migration &#34;<span><span>${</span><span>it</span><span>.</span><span>migrationName</span><span>}</span></span>&#34;`</span><span>)</span>
    <span>}</span>
  <span>}</span><span>)</span>

  <span>if</span> <span>(</span><span>error</span><span>)</span> <span>{</span>
    <span>console</span><span>.</span><span>error</span><span>(</span><span>&#39;failed to migrate&#39;</span><span>)</span>
    <span>console</span><span>.</span><span>error</span><span>(</span><span>error</span><span>)</span>
    <span>process</span><span>.</span><span>exit</span><span>(</span><span>1</span><span>)</span>
  <span>}</span>

  <span>await</span> <span>db</span><span>.</span><span>destroy</span><span>(</span><span>)</span>
<span>}</span>

<span>migrateToLatest</span><span>(</span><span>)</span></pre></div>
<p dir="auto">The migration methods use a lock on the database level and parallel calls are executed serially.
This means that you can safely call <code>migrateToLatest</code> and other migration methods from multiple
server instances simultaneously and the migrations are guaranteed to only be executed once. The
locks are also automatically released if the migration process crashes or the connection to the
database fails.</p>

<p dir="auto">Kysely doesn&#39;t include drivers for deno, but you can still use Kysely as a query builder
or implement your own driver:</p>
<div dir="auto" data-snippet-clipboard-copy-content="// We use jsdeliver to get Kysely from npm.
import {
  DummyDriver,
  Generated,
  Kysely,
  PostgresAdapter,
  PostgresIntrospector,
  PostgresQueryCompiler,
} from &#39;https://cdn.jsdelivr.net/npm/kysely/dist/esm/index.js&#39;

interface Person {
  id: Generated&lt;number&gt;
  first_name: string
  last_name: string | null
}

interface Database {
  person: Person
}

const db = new Kysely&lt;Database&gt;({
  dialect: {
    createAdapter() {
      return new PostgresAdapter()
    },
    createDriver() {
      // You need a driver to be able to execute queries. In this example
      // we use the dummy driver that never does anything.
      return new DummyDriver()
    },
    createIntrospector(db: Kysely&lt;unknown&gt;) {
      return new PostgresIntrospector(db)
    },
    createQueryCompiler() {
      return new PostgresQueryCompiler()
    },
  },
})

const query = db.selectFrom(&#39;person&#39;).select(&#39;id&#39;)
const sql = query.compile()

console.log(sql.sql)"><pre><span>// We use jsdeliver to get Kysely from npm.</span>
<span>import</span> <span>{</span>
  <span>DummyDriver</span><span>,</span>
  <span>Generated</span><span>,</span>
  <span>Kysely</span><span>,</span>
  <span>PostgresAdapter</span><span>,</span>
  <span>PostgresIntrospector</span><span>,</span>
  <span>PostgresQueryCompiler</span><span>,</span>
<span>}</span> <span>from</span> <span>&#39;https://cdn.jsdelivr.net/npm/kysely/dist/esm/index.js&#39;</span>

<span>interface</span> <span>Person</span> <span>{</span>
  <span>id</span>: <span>Generated</span><span>&lt;</span><span>number</span><span>&gt;</span>
  <span>first_name</span>: <span>string</span>
  <span>last_name</span>: <span>string</span> <span>|</span> <span>null</span>
<span>}</span>

<span>interface</span> <span>Database</span> <span>{</span>
  <span>person</span>: <span>Person</span>
<span>}</span>

<span>const</span> <span>db</span> <span>=</span> <span>new</span> <span>Kysely</span><span>&lt;</span><span>Database</span><span>&gt;</span><span>(</span><span>{</span>
  <span>dialect</span>: <span>{</span>
    <span>createAdapter</span><span>(</span><span>)</span> <span>{</span>
      <span>return</span> <span>new</span> <span>PostgresAdapter</span><span>(</span><span>)</span>
    <span>}</span><span>,</span>
    <span>createDriver</span><span>(</span><span>)</span> <span>{</span>
      <span>// You need a driver to be able to execute queries. In this example</span>
      <span>// we use the dummy driver that never does anything.</span>
      <span>return</span> <span>new</span> <span>DummyDriver</span><span>(</span><span>)</span>
    <span>}</span><span>,</span>
    <span>createIntrospector</span><span>(</span><span>db</span>: <span>Kysely</span><span>&lt;</span><span>unknown</span><span>&gt;</span><span>)</span> <span>{</span>
      <span>return</span> <span>new</span> <span>PostgresIntrospector</span><span>(</span><span>db</span><span>)</span>
    <span>}</span><span>,</span>
    <span>createQueryCompiler</span><span>(</span><span>)</span> <span>{</span>
      <span>return</span> <span>new</span> <span>PostgresQueryCompiler</span><span>(</span><span>)</span>
    <span>}</span><span>,</span>
  <span>}</span><span>,</span>
<span>}</span><span>)</span>

<span>const</span> <span>query</span> <span>=</span> <span>db</span><span>.</span><span>selectFrom</span><span>(</span><span>&#39;person&#39;</span><span>)</span><span>.</span><span>select</span><span>(</span><span>&#39;id&#39;</span><span>)</span>
<span>const</span> <span>sql</span> <span>=</span> <span>query</span><span>.</span><span>compile</span><span>(</span><span>)</span>

<span>console</span><span>.</span><span>log</span><span>(</span><span>sql</span><span>.</span><span>sql</span><span>)</span></pre></div>

<p dir="auto">Kysely also runs in the browser:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import {
  Kysely,
  Generated,
  DummyDriver,
  SqliteAdapter,
  SqliteIntrospector,
  SqliteQueryCompiler,
} from &#39;kysely&#39;

interface Person {
  id: Generated&lt;number&gt;
  first_name: string
  last_name: string | null
}

interface Database {
  person: Person
}

const db = new Kysely&lt;Database&gt;({
  dialect: {
    createAdapter() {
      return new SqliteAdapter()
    },
    createDriver() {
      return new DummyDriver()
    },
    createIntrospector(db: Kysely&lt;unknown&gt;) {
      return new SqliteIntrospector(db)
    },
    createQueryCompiler() {
      return new SqliteQueryCompiler()
    },
  },
})

window.addEventListener(&#39;load&#39;, () =&gt; {
  const sql = db.selectFrom(&#39;person&#39;).select(&#39;id&#39;).compile()

  const result = document.createElement(&#39;span&#39;)
  result.id = &#39;result&#39;
  result.innerHTML = sql.sql

  document.body.appendChild(result)
})"><pre><span>import</span> <span>{</span>
  <span>Kysely</span><span>,</span>
  <span>Generated</span><span>,</span>
  <span>DummyDriver</span><span>,</span>
  <span>SqliteAdapter</span><span>,</span>
  <span>SqliteIntrospector</span><span>,</span>
  <span>SqliteQueryCompiler</span><span>,</span>
<span>}</span> <span>from</span> <span>&#39;kysely&#39;</span>

<span>interface</span> <span>Person</span> <span>{</span>
  <span>id</span>: <span>Generated</span><span>&lt;</span><span>number</span><span>&gt;</span>
  <span>first_name</span>: <span>string</span>
  <span>last_name</span>: <span>string</span> <span>|</span> <span>null</span>
<span>}</span>

<span>interface</span> <span>Database</span> <span>{</span>
  <span>person</span>: <span>Person</span>
<span>}</span>

<span>const</span> <span>db</span> <span>=</span> <span>new</span> <span>Kysely</span><span>&lt;</span><span>Database</span><span>&gt;</span><span>(</span><span>{</span>
  <span>dialect</span>: <span>{</span>
    <span>createAdapter</span><span>(</span><span>)</span> <span>{</span>
      <span>return</span> <span>new</span> <span>SqliteAdapter</span><span>(</span><span>)</span>
    <span>}</span><span>,</span>
    <span>createDriver</span><span>(</span><span>)</span> <span>{</span>
      <span>return</span> <span>new</span> <span>DummyDriver</span><span>(</span><span>)</span>
    <span>}</span><span>,</span>
    <span>createIntrospector</span><span>(</span><span>db</span>: <span>Kysely</span><span>&lt;</span><span>unknown</span><span>&gt;</span><span>)</span> <span>{</span>
      <span>return</span> <span>new</span> <span>SqliteIntrospector</span><span>(</span><span>db</span><span>)</span>
    <span>}</span><span>,</span>
    <span>createQueryCompiler</span><span>(</span><span>)</span> <span>{</span>
      <span>return</span> <span>new</span> <span>SqliteQueryCompiler</span><span>(</span><span>)</span>
    <span>}</span><span>,</span>
  <span>}</span><span>,</span>
<span>}</span><span>)</span>

<span>window</span><span>.</span><span>addEventListener</span><span>(</span><span>&#39;load&#39;</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> <span>sql</span> <span>=</span> <span>db</span><span>.</span><span>selectFrom</span><span>(</span><span>&#39;person&#39;</span><span>)</span><span>.</span><span>select</span><span>(</span><span>&#39;id&#39;</span><span>)</span><span>.</span><span>compile</span><span>(</span><span>)</span>

  <span>const</span> <span>result</span> <span>=</span> <span>document</span><span>.</span><span>createElement</span><span>(</span><span>&#39;span&#39;</span><span>)</span>
  <span>result</span><span>.</span><span>id</span> <span>=</span> <span>&#39;result&#39;</span>
  <span>result</span><span>.</span><span>innerHTML</span> <span>=</span> <span>sql</span><span>.</span><span>sql</span>

  <span>document</span><span>.</span><span>body</span><span>.</span><span>appendChild</span><span>(</span><span>result</span><span>)</span>
<span>}</span><span>)</span></pre></div>

<p dir="auto">Kysely is very similar to knex, but it also attempts to fix things that I personally find not-so-good
in knex. Bringing the type system and the changes to knex would mean very significant breaking changes
that aren&#39;t possible at this point of the project. Knex was also originally written for javascript and
the typescript typings were added afterwards. That always leads to compromises in the types. Designing
a library for typescript from the ground up produces much better and simpler types.</p>

<p dir="auto">See <a href="https://github.com/koskimas/kysely/blob/master/CONTRIBUTING.md">CONTRIBUTING.md</a>.</p>
</article>
          </div></div>
  </body>
</html>
