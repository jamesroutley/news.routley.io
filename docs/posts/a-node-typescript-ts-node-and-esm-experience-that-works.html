<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gist.github.com/khalidx/1c670478427cc0691bda00a80208c8cc">Original</a>
    <h1>A Node, TypeScript, TS-Node and ESM experience that works</h1>
    
    <div id="readability-page-1" class="page"><p>
    A Node + TypeScript + ts-node + ESM experience that works.
  </p><div>
  <div id="file-node-typescript-esm-md">
      
      <div id="file-node-typescript-esm-md-readme">
    <article itemprop="text"><p dir="auto">The experience of using Node.JS with TypeScript, ts-node, and ESM is horrible.</p>
<p dir="auto">There are countless guides of how to integrate them, but none of them seem to work.</p>
<p dir="auto">Here&#39;s what worked for me.</p>
<p dir="auto">Just add the following files and run <code>npm run dev</code>. You&#39;ll be good to go!</p>
<h3 dir="auto"><a id="user-content-packagejson" aria-hidden="true" tabindex="-1" href="#packagejson"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><code>package.json</code></h3>
<div dir="auto"><pre>{
  <span>&#34;private&#34;</span>: <span>true</span>,
  <span>&#34;type&#34;</span>: <span><span>&#34;</span>module<span>&#34;</span></span>,
  <span>&#34;exports&#34;</span>: <span><span>&#34;</span>./dist/index.js<span>&#34;</span></span>,
  <span>&#34;types&#34;</span>: <span><span>&#34;</span>./dist/index.d.ts<span>&#34;</span></span>,
  <span>&#34;sideEffects&#34;</span>: <span>false</span>,
  <span>&#34;files&#34;</span>: [
    <span><span>&#34;</span>./dist/<span>&#34;</span></span>
  ],
  <span>&#34;engines&#34;</span>: {
    <span>&#34;node&#34;</span>: <span><span>&#34;</span>^20.9.0<span>&#34;</span></span>,
    <span>&#34;npm&#34;</span>: <span><span>&#34;</span>^10.1.0<span>&#34;</span></span>
  },
  <span>&#34;scripts&#34;</span>: {
    <span>&#34;dev&#34;</span>: <span><span>&#34;</span>node --no-warnings --enable-source-maps --loader ts-node/esm src/index.ts<span>&#34;</span></span>
  },
  <span>&#34;dependencies&#34;</span>: {},
  <span>&#34;devDependencies&#34;</span>: {
    <span>&#34;@sindresorhus/tsconfig&#34;</span>: <span><span>&#34;</span>^5.0.0<span>&#34;</span></span>,
    <span>&#34;ts-node&#34;</span>: <span><span>&#34;</span>^10.9.1<span>&#34;</span></span>,
    <span>&#34;typescript&#34;</span>: <span><span>&#34;</span>^5.2.2<span>&#34;</span></span>
  }
}</pre></div>
<h3 dir="auto"><a id="user-content-tsconfigjson" aria-hidden="true" tabindex="-1" href="#tsconfigjson"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><code>tsconfig.json</code></h3>
<div dir="auto"><pre>{
  <span>&#34;extends&#34;</span>: <span><span>&#34;</span>@sindresorhus/tsconfig<span>&#34;</span></span>,
  <span>&#34;compilerOptions&#34;</span>: {
    <span>&#34;outDir&#34;</span>: <span><span>&#34;</span>./dist/<span>&#34;</span></span>,                              <span>/* Specify an output folder for all emitted files. */</span>
    <span>&#34;lib&#34;</span>: [<span><span>&#34;</span>ES2022<span>&#34;</span></span>],
    <span>&#34;target&#34;</span>: <span><span>&#34;</span>ES2022<span>&#34;</span></span>,
    <span>&#34;declarationMap&#34;</span>: <span>true</span>,                           <span>/* Create sourcemaps for d.ts files. */</span>
    <span>&#34;sourceMap&#34;</span>: <span>true</span>,                                <span>/* Create source map files for emitted JavaScript files. */</span>
    <span>&#34;importsNotUsedAsValues&#34;</span>: <span><span>&#34;</span>remove<span>&#34;</span></span>,               <span>/* Specify emit/checking behavior for imports that are only used for types. */    </span>
    <span>&#34;isolatedModules&#34;</span>: <span>true</span>,                          <span>/* Ensure that each file can be safely transpiled without relying on other imports. */</span>
    <span>&#34;esModuleInterop&#34;</span>: <span>true</span>
  },
  <span>&#34;include&#34;</span>: [
    <span><span>&#34;</span>./src/**/*.ts<span>&#34;</span></span>
  ],
  <span>&#34;ts-node&#34;</span>: {
    <span>&#34;esm&#34;</span>: <span>true</span>,
    <span>&#34;transpileOnly&#34;</span>: <span>true</span>,
    <span>&#34;files&#34;</span>: <span>true</span>,
    <span>&#34;experimentalResolver&#34;</span>: <span>true</span>
  }
}</pre></div>
<h3 dir="auto"><a id="user-content-srcutilitiesnodets" aria-hidden="true" tabindex="-1" href="#srcutilitiesnodets"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><code>src/utilities/node.ts</code></h3>
<p dir="auto">Some utilities for getting similar behavior as <code>__filename</code>, <code>__dirname</code>, and <code>require.main === module</code> in Node.JS CommonJS.</p>
<p dir="auto">This file is optional.</p>
<div dir="auto"><pre><span>import</span> <span>{</span> <span>fileURLToPath</span> <span>}</span> <span>from</span> <span>&#39;node:url&#39;</span>
<span>import</span> <span>{</span> <span>dirname</span> <span>}</span> <span>from</span> <span>&#39;node:path&#39;</span>
<span>import</span> <span>{</span> <span>argv</span> <span>}</span> <span>from</span> <span>&#39;node:process&#39;</span>
<span>import</span> <span>{</span> <span>createRequire</span> <span>}</span> <span>from</span> <span>&#39;node:module&#39;</span>

<span>/**</span>
<span> * This is an ESM replacement for `__filename`.</span>
<span> * </span>
<span> * Use it like this: `__filename(import.meta)`.</span>
<span> */</span>
<span>export</span> <span>const</span> <span>__filename</span> <span>=</span> <span>(</span><span>meta</span>: <span>ImportMeta</span><span>)</span>: <span>string</span> <span>=&gt;</span> <span>fileURLToPath</span><span>(</span><span>meta</span><span>.</span><span>url</span><span>)</span>

<span>/**</span>
<span> * This is an ESM replacement for `__dirname`.</span>
<span> * </span>
<span> * Use it like this: `__dirname(import.meta)`.</span>
<span> */</span>
<span>export</span> <span>const</span> <span>__dirname</span> <span>=</span> <span>(</span><span>meta</span>: <span>ImportMeta</span><span>)</span>: <span>string</span> <span>=&gt;</span> <span>dirname</span><span>(</span><span>__filename</span><span>(</span><span>meta</span><span>)</span><span>)</span>

<span>/**</span>
<span> * Indicates that the script was run directly.</span>
<span> * This is an ESM replacement for `require.main === module`.</span>
<span> * </span>
<span> * Use it like this: `isMain(import.meta)`.</span>
<span> */</span>
<span>export</span> <span>const</span> <span>isMain</span> <span>=</span> <span>(</span><span>meta</span>: <span>ImportMeta</span><span>)</span>: <span>boolean</span> <span>=&gt;</span> <span>{</span>
  <span>if</span> <span>(</span><span>!</span><span>meta</span> <span>||</span> <span>!</span><span>argv</span><span>[</span><span>1</span><span>]</span><span>)</span> <span>return</span> <span>false</span>
  <span>const</span> <span>require</span> <span>=</span> <span>createRequire</span><span>(</span><span>meta</span><span>.</span><span>url</span><span>)</span>
  <span>const</span> <span>scriptPath</span> <span>=</span> <span>require</span><span>.</span><span>resolve</span><span>(</span><span>argv</span><span>[</span><span>1</span><span>]</span><span>)</span>
  <span>const</span> <span>modulePath</span> <span>=</span> <span>__filename</span><span>(</span><span>meta</span><span>)</span>
  <span>return</span> <span>scriptPath</span> <span>===</span> <span>modulePath</span>
<span>}</span></pre></div>
</article>
  </div>

  </div>
</div></div>
  </body>
</html>
