<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/jart/blink">Original</a>
    <h1>Tiniest x86-64-Linux emulator</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">blink is a virtual machine for running x86-64-linux programs on different
operating systems and hardware architectures. It&#39;s designed to do the
same thing as the <code>qemu-x86_64</code> command, except rather than being a 10mb
binary, blink only has a ~142kb footprint. For further details on the
motivations for this tool, please read <a href="https://justine.lol/ape.html" rel="nofollow">https://justine.lol/ape.html</a>.</p>
<h2 dir="auto"><a id="user-content-getting-started" aria-hidden="true" href="#getting-started"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Getting Started</h2>
<p dir="auto">You can compile blink on x86-64 Linux, Darwin, FreeBSD, NetBSD, OpenBSD,
Apple Silicon, and Raspberry Pi using your operating system&#39;s toolchain.</p>
<div dir="auto" data-snippet-clipboard-copy-content="# for all x86-64 platforms
$ build/bootstrap/make.com -j8 o//blink/blink

# for apple m1 arm silicon
$ build/bootstrap/blink-darwin-arm64 build/bootstrap/make.com -j8 o//blink/blink

# for linux raspberry pi
$ build/bootstrap/blink-linux-aarch64 build/bootstrap/make.com -j8 o//blink/blink

# run actually portable executable in virtual machine
$ o//blink/blink third_party/cosmo/hello.com
hello world

# run static elf binary in virtual machine
$ o//blink/blink third_party/cosmo/tinyhello.elf
hello world"><pre><span><span>#</span> for all x86-64 platforms</span>
$ build/bootstrap/make.com -j8 o//blink/blink

<span><span>#</span> for apple m1 arm silicon</span>
$ build/bootstrap/blink-darwin-arm64 build/bootstrap/make.com -j8 o//blink/blink

<span><span>#</span> for linux raspberry pi</span>
$ build/bootstrap/blink-linux-aarch64 build/bootstrap/make.com -j8 o//blink/blink

<span><span>#</span> run actually portable executable in virtual machine</span>
$ o//blink/blink third_party/cosmo/hello.com
hello world

<span><span>#</span> run static elf binary in virtual machine</span>
$ o//blink/blink third_party/cosmo/tinyhello.elf
hello world</pre></div>
<p dir="auto">There&#39;s a terminal interface for debugging:</p>
<div data-snippet-clipboard-copy-content="$ build/bootstrap/make.com -j8 o///blink/tui
$ o//blink/tui -t third_party/cosmo/tinyhello.elf"><pre><code>$ build/bootstrap/make.com -j8 o///blink/tui
$ o//blink/tui -t third_party/cosmo/tinyhello.elf
</code></pre></div>
<p dir="auto">You can run our test executables to check your local platform build:</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ build/bootstrap/make.com -j8 check"><pre>$ build/bootstrap/make.com -j8 check</pre></div>
<p dir="auto">For maximum performance, use <code>MODE=release</code> or <code>MODE=opt</code>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ build/bootstrap/make.com MODE=opt -j8 check"><pre>$ build/bootstrap/make.com MODE=opt -j8 check</pre></div>
<p dir="auto">For maximum tinyness, use <code>MODE=tiny</code>.</p>
<div data-snippet-clipboard-copy-content="$ build/bootstrap/make.com MODE=tiny -j8 check
$ strip o/tiny/blink/blink
$ ls -hal o/tiny/blink/blink"><pre><code>$ build/bootstrap/make.com MODE=tiny -j8 check
$ strip o/tiny/blink/blink
$ ls -hal o/tiny/blink/blink
</code></pre></div>
<p dir="auto">If you&#39;re building your code on an x86-64 Linux machine, then the
following command will cross-compile blink for i386, arm, m68k, riscv,
mips, s390x. Then it&#39;ll launch all the cross-compiled binaries in qemu
to ensure the test programs above work on all architectures.</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ build/bootstrap/make.com -j8 emulates
$ o/third_party/qemu/qemu-aarch64 o//aarch64/blink/blink third_party/cosmo/hello.com
hello world"><pre>$ build/bootstrap/make.com -j8 emulates
$ o/third_party/qemu/qemu-aarch64 o//aarch64/blink/blink third_party/cosmo/hello.com
hello world</pre></div>
<h2 dir="auto"><a id="user-content-technical-details" aria-hidden="true" href="#technical-details"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Technical Details</h2>
<p dir="auto">blink is an x86-64 interpreter for POSIX platforms that&#39;s written in
ANSI C11 that&#39;s compatible with C++ compilers. Instruction decoding is
done using our trimmed-down version of Intel&#39;s disassembler Xed. Like
Bochs, Blink doesn&#39;t do code generation; the primary focus is having a
smaller binary footprint with a readable codebase. However we&#39;re still
likely to add something like jit in the near future.</p>
<p dir="auto">The prime directive of this project is to act as a virtual machine for
userspace binaries compiled by Cosmopolitan Libc. Much of the surface
area of the Linux SYSCALL ABI is supported, including fork() and
clone(). The SSE2, SSE3, SSSE3, POPCNT, CLMUL, RDTSCP, and RDRND ISAs
are supported. x87 currently only supports double (64-bit) precision.</p>
<p dir="auto">Blink supports 32-bit and 16-bit BIOS programs, plus just enough ring0
instructions to test an operating system bootloader. Plus IBM PC Serial
UART, CGA, and MDA. However these legacy features might get sprung into
a sister project sometime soon.</p>
</article>
          </div></div>
  </body>
</html>
