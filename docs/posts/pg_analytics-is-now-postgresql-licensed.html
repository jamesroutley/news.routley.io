<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/paradedb/pg_analytics">Original</a>
    <h1>Pg_analytics is now PostgreSQL Licensed</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><a href="https://github.com/paradedb/pg_analytics/actions/workflows/publish-pg_analytics.yml"><img src="https://github.com/paradedb/pg_analytics/actions/workflows/publish-pg_analytics.yml/badge.svg" alt="Publish pg_analytics"/></a>
<a href="https://artifacthub.io/packages/search?repo=paradedb" rel="nofollow"><img src="https://camo.githubusercontent.com/d33aa5ca43ef3faaa832a7f379ce9261eabb166e3a5412ad1318f5e9333952ca/68747470733a2f2f696d672e736869656c64732e696f2f656e64706f696e743f75726c3d68747470733a2f2f61727469666163746875622e696f2f62616467652f7265706f7369746f72792f7061726164656462" alt="Artifact Hub" data-canonical-src="https://img.shields.io/endpoint?url=https://artifacthub.io/badge/repository/paradedb"/></a>
<a href="https://hub.docker.com/r/paradedb/paradedb" rel="nofollow"><img src="https://camo.githubusercontent.com/238c08b408f78aa2212fbe603678f155c8564f3a1028fb6e2d7c0def761306e9/68747470733a2f2f696d672e736869656c64732e696f2f646f636b65722f70756c6c732f70617261646564622f7061726164656462" alt="Docker Pulls" data-canonical-src="https://img.shields.io/docker/pulls/paradedb/paradedb"/></a>
<a href="https://github.com/paradedb/pg_analytics?tab=PostgreSQL-1-ov-file#readme"><img src="https://camo.githubusercontent.com/224af2687b24efe9dc1f7538788cb573f11de5bd563205b8017273654e476f2b/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d506f737467726553514c2d626c7565" alt="License" data-canonical-src="https://img.shields.io/badge/License-PostgreSQL-blue"/></a>
<a href="https://join.slack.com/t/paradedbcommunity/shared_invite/zt-2lkzdsetw-OiIgbyFeiibd1DG~6wFgTQ" rel="nofollow"><img src="https://camo.githubusercontent.com/ede8cb6858b5fcc0a7a4f550d289177bc699cde4aa1d4bb71858b5f21dd081bc/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4a6f696e253230536c61636b2d707572706c653f6c6f676f3d736c61636b266c696e6b3d68747470732533412532462532466a6f696e2e736c61636b2e636f6d253246742532467061726164656462636f6d6d756e6974792532467368617265645f696e766974652532467a742d326c6b7a64736574772d4f69496762794665696962643144477e367746675451" alt="Slack URL" data-canonical-src="https://img.shields.io/badge/Join%20Slack-purple?logo=slack&amp;link=https%3A%2F%2Fjoin.slack.com%2Ft%2Fparadedbcommunity%2Fshared_invite%2Fzt-2lkzdsetw-OiIgbyFeiibd1DG~6wFgTQ"/></a>
<a href="https://x.com/paradedb" rel="nofollow"><img src="https://camo.githubusercontent.com/8c885522b8a7230bc73af8952731f9e0518e5c50d09ee4d3b3e9c62d43bf3d06/68747470733a2f2f696d672e736869656c64732e696f2f747769747465722f75726c3f75726c3d6874747073253341253246253246747769747465722e636f6d2532467061726164656462266c6162656c3d466f6c6c6f772532302534307061726164656462" alt="X URL" data-canonical-src="https://img.shields.io/twitter/url?url=https%3A%2F%2Ftwitter.com%2Fparadedb&amp;label=Follow%20%40paradedb"/></a></p>

<p dir="auto"><code>pg_analytics</code> (formerly named <code>pg_lakehouse</code>) puts DuckDB inside Postgres. With <code>pg_analytics</code> installed, Postgres can query foreign object stores like AWS S3 and table formats like Iceberg or Delta Lake. Queries are pushed down to DuckDB, a high performance analytical query engine.</p>
<p dir="auto"><code>pg_analytics</code> uses DuckDB v1.0.0 and is supported on Postgres 13+.</p>

<p dir="auto">Today, a vast amount of non-operational data — events, metrics, historical snapshots, vendor data, etc. — is ingested into data lakes like AWS S3. Querying this data by moving it into a cloud data warehouse or operating a new query engine is expensive and time-consuming. The goal of <code>pg_analytics</code> is to enable this data to be queried directly from Postgres. This eliminates the need for new infrastructure, loss of data freshness, data movement, and non-Postgres dialects of other query engines.</p>
<p dir="auto"><code>pg_analytics</code> uses the foreign data wrapper (FDW) API to connect to any object store or table format and the executor hook API to push queries to DuckDB. While other FDWs like <code>aws_s3</code> have existed in the Postgres extension ecosystem, these FDWs suffer from two limitations:</p>
<ol dir="auto">
<li>Lack of support for most object stores and table formats</li>
<li>Too slow over large datasets to be a viable analytical engine</li>
</ol>
<p dir="auto"><code>pg_analytics</code> differentiates itself by supporting a wide breadth of stores and formats and by being very fast (thanks to DuckDB).</p>

<ul>
<li> Read support for <code>pg_analytics</code></li>
<li> (In progress) Write support for <code>pg_analytics</code></li>
<li> <code>EXPLAIN</code> support</li>
<li> <code>VIEW</code> support</li>
<li> Automatic schema detection</li>
<li> Integration with the catalog providers</li>
</ul>

<ul>
<li> AWS S3</li>
<li> S3-compatible stores (MinIO, R2)</li>
<li> Google Cloud Storage</li>
<li> Azure Blob Storage</li>
<li> Azure Data Lake Storage Gen2</li>
<li> HuggingFace</li>
<li> HTTP server</li>
<li> Local file system</li>
</ul>

<ul>
<li> Parquet</li>
<li> CSV</li>
<li> JSON</li>
<li> Geospatial (<code>.geojson</code>, <code>.xlsx</code>)</li>
<li> Delta Lake</li>
<li> Apache Iceberg</li>
<li> Apache Hudi</li>
</ul>


<p dir="auto">The easiest way to use the extension is to run the ParadeDB Dockerfile:</p>
<div dir="auto" data-snippet-clipboard-copy-content="docker run --name paradedb -e POSTGRES_PASSWORD=password paradedb/paradedb
docker exec -it paradedb psql -U postgres"><pre>docker run --name paradedb -e POSTGRES_PASSWORD=password paradedb/paradedb
docker <span>exec</span> -it paradedb psql -U postgres</pre></div>
<p dir="auto">This will spin up a PostgreSQL 16 instance with <code>pg_analytics</code> preinstalled.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">From Self-Hosted PostgreSQL</h3><a id="user-content-from-self-hosted-postgresql" aria-label="Permalink: From Self-Hosted PostgreSQL" href="#from-self-hosted-postgresql"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Because this extension uses Postgres hooks to intercept and push queries down to DuckDB, it is <strong>very important</strong> that it is added to <code>shared_preload_libraries</code> inside <code>postgresql.conf</code>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="# Inside postgresql.conf
shared_preload_libraries = &#39;pg_analytics&#39;"><pre><span><span>#</span> Inside postgresql.conf</span>
shared_preload_libraries = <span><span>&#39;</span>pg_analytics<span>&#39;</span></span></pre></div>
<p dir="auto">This ensures the best query performance from the extension.</p>

<p dir="auto">We provide prebuilt binaries for Debian, Ubuntu, and Red Hat Enterprise Linux for Postgres 14+. You can download the latest version for your architecture from the <a href="https://github.com/paradedb/paradedb/releases">GitHub Releases page</a>.</p>

<p dir="auto">At this time, we do not provide prebuilt binaries for macOS. If you are running Postgres on macOS and want to install <code>pg_analytics</code>, please follow the <a href="#development">development</a> instructions, replacing <code>cargo pgrx run</code> by <code>cargo pgrx install --release</code>. This will build the extension from source and install it in your macOS Postgres instance (e.g. Homebrew).</p>

<p dir="auto">Windows is not supported. This restriction is <a href="https://github.com/pgcentralfoundation/pgrx?tab=readme-ov-file#caveats--known-issues">inherited from pgrx not supporting Windows</a>.</p>

<p dir="auto">The following example uses <code>pg_analytics</code> to query an example dataset of 3 million NYC taxi trips from January 2024, hosted in a public <code>us-east-1</code> S3 bucket provided by ParadeDB.</p>
<div dir="auto" data-snippet-clipboard-copy-content="CREATE EXTENSION pg_analytics;
CREATE FOREIGN DATA WRAPPER parquet_wrapper HANDLER parquet_fdw_handler VALIDATOR parquet_fdw_validator;

-- Provide S3 credentials
CREATE SERVER parquet_server FOREIGN DATA WRAPPER parquet_wrapper;

-- Create foreign table with auto schema creation
CREATE FOREIGN TABLE trips ()
SERVER parquet_server
OPTIONS (files &#39;s3://paradedb-benchmarks/yellow_tripdata_2024-01.parquet&#39;);

-- Success! Now you can query the remote Parquet file like a regular Postgres table
SELECT COUNT(*) FROM trips;
  count
---------
 2964624
(1 row)"><pre>CREATE EXTENSION pg_analytics;
CREATE FOREIGN DATA WRAPPER parquet_wrapper HANDLER parquet_fdw_handler VALIDATOR parquet_fdw_validator;

<span><span>--</span> Provide S3 credentials</span>
CREATE SERVER parquet_server FOREIGN DATA WRAPPER parquet_wrapper;

<span><span>--</span> Create foreign table with auto schema creation</span>
CREATE FOREIGN TABLE trips ()
SERVER parquet_server
OPTIONS (files <span><span>&#39;</span>s3://paradedb-benchmarks/yellow_tripdata_2024-01.parquet<span>&#39;</span></span>);

<span><span>--</span> Success! Now you can query the remote Parquet file like a regular Postgres table</span>
<span>SELECT</span> <span>COUNT</span>(<span>*</span>) <span>FROM</span> trips;
  count
<span><span>--</span>-------</span>
 <span>2964624</span>
(<span>1</span> row)</pre></div>

<p dir="auto">Complete documentation for <code>pg_analytics</code> can be found under the <a href="https://github.com/paradedb/pg_analytics/blob/dev/docs">docs</a> folder as Markdown files. It covers how to query the various object stores and file and table formats supports, and how to configure and tune the extension.</p>
<p dir="auto">A hosted version of the documentation can be found <a href="https://docs.paradedb.com/integrations/overview" rel="nofollow">here</a>.</p>


<p dir="auto">To develop the extension, first install Rust via <code>rustup</code>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="curl --proto &#39;=https&#39; --tlsv1.2 -sSf https://sh.rustup.rs | sh
rustup install &lt;version&gt;

rustup default &lt;version&gt;"><pre>curl --proto <span><span>&#39;</span>=https<span>&#39;</span></span> --tlsv1.2 -sSf https://sh.rustup.rs <span>|</span> sh
rustup install <span>&lt;</span>version<span>&gt;</span>

rustup default <span>&lt;</span>version<span>&gt;</span></pre></div>
<p dir="auto">Note: While it is possible to install Rust via your package manager, we recommend using <code>rustup</code> as we&#39;ve observed inconsistencies with Homebrew&#39;s Rust installation on macOS.</p>

<p dir="auto">Before compiling the extension, you&#39;ll need to have the following dependencies installed.</p>
<div dir="auto" data-snippet-clipboard-copy-content="# macOS
brew install make gcc pkg-config openssl

# Ubuntu
sudo apt-get install -y make gcc pkg-config libssl-dev libclang-dev

# Arch Linux
sudo pacman -S core/openssl extra/clang"><pre><span><span>#</span> macOS</span>
brew install make gcc pkg-config openssl

<span><span>#</span> Ubuntu</span>
sudo apt-get install -y make gcc pkg-config libssl-dev libclang-dev

<span><span>#</span> Arch Linux</span>
sudo pacman -S core/openssl extra/clang</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="# macOS
brew install postgresql@17

# Ubuntu
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
sudo sh -c &#39;echo &#34;deb http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -cs)-pgdg main&#34; &gt; /etc/apt/sources.list.d/pgdg.list&#39;
sudo apt-get update &amp;&amp; sudo apt-get install -y postgresql-17 postgresql-server-dev-17

# Arch Linux
sudo pacman -S extra/postgresql"><pre><span><span>#</span> macOS</span>
brew install postgresql@17

<span><span>#</span> Ubuntu</span>
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc <span>|</span> sudo apt-key add -
sudo sh -c <span><span>&#39;</span>echo &#34;deb http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -cs)-pgdg main&#34; &gt; /etc/apt/sources.list.d/pgdg.list<span>&#39;</span></span>
sudo apt-get update <span>&amp;&amp;</span> sudo apt-get install -y postgresql-17 postgresql-server-dev-17

<span><span>#</span> Arch Linux</span>
sudo pacman -S extra/postgresql</pre></div>
<p dir="auto">If you are using Postgres.app to manage your macOS PostgreSQL, you&#39;ll need to add the <code>pg_config</code> binary to your path before continuing:</p>
<div dir="auto" data-snippet-clipboard-copy-content="export PATH=&#34;$PATH:/Applications/Postgres.app/Contents/Versions/latest/bin&#34;"><pre><span>export</span> PATH=<span><span>&#34;</span><span>$PATH</span>:/Applications/Postgres.app/Contents/Versions/latest/bin<span>&#34;</span></span></pre></div>

<p dir="auto">Then, install and initialize <code>pgrx</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# Note: Replace --pg17 with your version of Postgres, if different (i.e. --pg16)
cargo install --locked cargo-pgrx --version 0.12.7

# macOS arm64
cargo pgrx init --pg17=/opt/homebrew/opt/postgresql@17/bin/pg_config

# macOS amd64
cargo pgrx init --pg17=/usr/local/opt/postgresql@17/bin/pg_config

# Ubuntu
cargo pgrx init --pg17=/usr/lib/postgresql/17/bin/pg_config

# Arch Linux
cargo pgrx init --pg17=/usr/bin/pg_config"><pre><span><span>#</span> Note: Replace --pg17 with your version of Postgres, if different (i.e. --pg16)</span>
cargo install --locked cargo-pgrx --version 0.12.7

<span><span>#</span> macOS arm64</span>
cargo pgrx init --pg17=/opt/homebrew/opt/postgresql@17/bin/pg_config

<span><span>#</span> macOS amd64</span>
cargo pgrx init --pg17=/usr/local/opt/postgresql@17/bin/pg_config

<span><span>#</span> Ubuntu</span>
cargo pgrx init --pg17=/usr/lib/postgresql/17/bin/pg_config

<span><span>#</span> Arch Linux</span>
cargo pgrx init --pg17=/usr/bin/pg_config</pre></div>
<p dir="auto">If you prefer to use a different version of Postgres, update the <code>--pg</code> flag accordingly.</p>

<p dir="auto">First, start pgrx:</p>

<p dir="auto">This will launch an interactive connection to Postgres. Inside Postgres, create the extension by running:</p>
<div dir="auto" data-snippet-clipboard-copy-content="CREATE EXTENSION pg_analytics;"><pre>CREATE EXTENSION pg_analytics;</pre></div>
<p dir="auto">You now have access to all the extension functions.</p>

<p dir="auto">If you make changes to the extension code, follow these steps to update it:</p>
<ol dir="auto">
<li>Recompile the extension:</li>
</ol>

<ol start="2" dir="auto">
<li>Recreate the extension to load the latest changes:</li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="DROP EXTENSION pg_analytics;
CREATE EXTENSION pg_analytics;"><pre>DROP EXTENSION pg_analytics;
CREATE EXTENSION pg_analytics;</pre></div>

<p dir="auto">We use <code>cargo test</code> as our runner for <code>pg_analytics</code> tests. Tests are conducted using <a href="https://github.com/testcontainers/testcontainers-rs">testcontainers</a> to manage testing containers like <a href="https://hub.docker.com/r/localstack/localstack" rel="nofollow">LocalStack</a>. <code>testcontainers</code> will pull any Docker images that it requires to perform the test.</p>
<p dir="auto">You also need a running Postgres instance to run the tests. The test suite will look for a connection string on the <code>DATABASE_URL</code> environment variable. You can set this variable manually, or use <code>.env</code> file with contents like this:</p>
<div data-snippet-clipboard-copy-content="DATABASE_URL=postgres://&lt;username&gt;@&lt;host&gt;:&lt;port&gt;/&lt;database&gt;"><pre lang="text"><code>DATABASE_URL=postgres://&lt;username&gt;@&lt;host&gt;:&lt;port&gt;/&lt;database&gt;
</code></pre></div>

<p dir="auto"><code>pg_analytics</code> is licensed under the <a href="https://www.postgresql.org/about/licence/" rel="nofollow">PostgreSQL License</a>.</p>
</article></div></div>
  </body>
</html>
