<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://mort.coffee/home/wayland-input-latency/">Original</a>
    <h1>Hard numbers in the Wayland vs. X11 input latency discussion</h1>
    
    <div id="readability-page-1" class="page"><div>

<p>Date: 2025-01-26 </p>
<p>Yesterday, I read this blog post:
<a href="https://gist.github.com/generic-internet-user/e8eec46ce159571032115f6fb064523c">Wayland Cursor Lag: Just give me a break already...</a>,
where a Linux user discusses their frustration with input latency under Wayland.
They detailed their own subjective experience of the problem,
but failed to produce hard evidence.</p>
<p>Even though I&#39;m a very happy user of wayland overall,
I share the blog post&#39;s author&#39;s subjective impression that there&#39;s more
cursor lag under Wayland than under X11.
In my opinion, their experiment was limited by their phone camera&#39;s 90 FPS,
which really doesn&#39;t feel like it&#39;s enough to get conclusive numbers
when we&#39;re talking about differences which are probably on the order of
single screen refresh cycles.</p>
<p>So I thought: hey, I have a phone with a 240 FPS camera mode,
I bet that&#39;s enough to get some conclusive results!</p>
<p>Spoilers: I was right.</p>
<h2>Experimental design</h2>
<p>I simply pointed my phone&#39;s camera at the screen and desk using my left hand,
made sure to get the mouse cursor, the mouse and my right hand in frame,
and recorded myself repeatedly flicking the mouse with my finger.
I recorded myself flicking it 16 times under Wayland,
logged out of the GNOME Wayland session and into a GNOME X11 session,
then did the same there.</p>
<p>I then converted the two resulting video files into a series of JPEGs
using ffmpeg (<code>ffmpeg -i &lt;input file&gt; %04d.jpg</code>),
and counted from the first frame where I could see the mouse move
until the first frame where I could clearly see that the cursor had moved.</p>
<p>I elected to include the start and end frame;
so if I saw the mouse move in frame 1045,
then I saw the cursor move in frame 1047,
I would count that as 3 frames.</p>
<p>Here&#39;s an example which depicts a latency of 3 frames (requires JavaScript):</p>
<div>
<div>
<p><img src="https://mort.coffee/_/imgs/wayland-latency-before-1.jpg" alt="before 1"/></p>
<blockquote>
<p>Here&#39;s a frame from before the mouse has begun moving.</p>
</blockquote>
</div>
<div>
<p><img src="https://mort.coffee/_/imgs/wayland-latency-before-2.jpg" alt="before 2"/></p>
<blockquote>
<p>The mouse still hasn&#39;t moved.</p>
</blockquote>
</div>
<div>
<p><img src="https://mort.coffee/_/imgs/wayland-latency-moved-1.jpg" alt="mouse moving"/></p>
<blockquote>
<p>Here, the mouse has just about started moving,
so I consider this &#34;frame 1&#34;.
The cursor hasn&#39;t moved yet.</p>
</blockquote>
</div>
<div>
<p><img src="https://mort.coffee/_/imgs/wayland-latency-moved-2.jpg" alt="still moving"/></p>
<blockquote>
<p>The mouse moves a bit further, but the cursor still hasn&#39;t moved.
This is &#34;frame 2&#34;.</p>
</blockquote>
</div>
<div>
<p><img src="https://mort.coffee/_/imgs/wayland-latency-cursor.jpg" alt="cursor moved"/></p>
<blockquote>
<p>This is the frame where the cursor starts moving.
This is &#34;frame 3&#34;, so I would note down this sequence
as taking 3 frames.</p>
</blockquote>
</div>
</div>
<p>Hardware details:</p>
<ul>
<li>Distro: Fedora Workstation 41</li>
<li>GNOME version: 47</li>
<li>CPU: AMD Ryzen 9 5950X</li>
<li>GPU: AMD Radeon RX 7900XT</li>
<li>Monitor: Gigabyte M32U (4k IPS @ 144.99, no DPI scaling)</li>
<li>Mouse: Logitech G502 Lightspeed</li>
<li>Camera: iPhone 15 Pro, slo-mo 240 FPS</li>
</ul>
<h2>Limitations</h2>
<p>The main limitations of this experiment are:</p>
<ul>
<li>240 FPS still isn&#39;t <em>that</em> much. With my 144Hz screen, I have less than
two camera frames per screen refresh. This introduces some random variance.</li>
<li>Pixels don&#39;t switch instantly, so there are ambiguous frames where the cursor
is <em>barely</em> starting to become visible in its new location.
I decided to count the cursor as &#34;having moved&#34; when there is a clearly visible
cursor in a new location on the screen, even if the pixels haven&#39;t fully lit up.</li>
<li>For some reason, the video recording from my phone contains some duplicate frames.
I don&#39;t know why this happens. I decided to interpret these duplicate frames
as a representation of a frame&#39;s worth of time passing, so I counted them as normal.</li>
</ul>
<p>All these factors introduce some uncertainty in the results.
However, they <em>should</em> affect Wayland and X11 equally, so with enough data,
it should all even out.</p>
<p><strong>Update:</strong> Another caveat I should clearly point out is that there are
many other Wayland compositors out there than GNOME&#39;s, and I have not tested them.
For that matter, there are other GPU drivers out there than AMD&#39;s.
Other compositors and other GPU drivers may show different results.</p>
<h2>Results</h2>
<p>Here&#39;s the data I captured:</p>

<p>Wayland, on average, has roughly 6.5ms more cursor latency than X11 on my system.
I don&#39;t have the statistics expertise necessary to properly analyze
whether this difference is statistically significant or not,
but to my untrained eye, it looks like there&#39;s a clear and consistent difference.</p>
<p>Interestingly, the difference is very close to 1 full screen refresh.
I don&#39;t know whether or not that&#39;s a coincidence.</p>
<p>Here are the numbers in chart form:</p>
<p><img src="https://mort.coffee/_/imgs/wayland-latency-chart.svg" alt="Latency chart"/></p>
<h2>Conclusion</h2>
<p>In my mind, these results are conclusive proof that there <em>is</em> a difference
in input latency between X11 and Wayland, at least with my hardware,
and that the difference is large enough that it&#39;s plausible for some people to notice.</p>
<p>Further testing on more varied hardware and refresh rates is necessary
to get a clear picture of how wide-spread the problem is and how large it is.
It&#39;s likely that the magnitude of the difference varies based on factors
such as which compositor is used and what the refresh rate of the screen is.</p>
<p>I probably won&#39;t undertake that further testing,
because this is all very time intensive work.
My goal was only to see if I could conclusively measure <em>some</em> difference.</p>
<p><strong>Update:</strong> I want to add a note here about what this testing does <em>not</em> show.
It does not show that there&#39;s higher input latency <em>in general</em>
in Wayland compared to X11 in a way which affects, for example, games.
It is possible that this added latency is entirely cursor-specific
and that Wayland and X11 exhibit the exact same input latency
in graphical applications and games.
It is my understanding that the cursor is handled very differently from
normal graphical applications.
Further testing would be necessary to show whether Wayland has more input latency
<em>in games</em> than X11.</p>
<!--RSS_END-->

	</div></div>
  </body>
</html>
