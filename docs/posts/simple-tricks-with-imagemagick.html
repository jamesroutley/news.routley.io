<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://zck.org/imagemagick-tricks">Original</a>
    <h1>Simple tricks with Imagemagick</h1>
    
    <div id="readability-page-1" class="page"><div><p>May 2023</p>

<div>
    <p><a href="https://imagemagick.org/">Imagemagick</a> is a powerful tool to manipulate images on the command line. It can do things like add a border, crop an image, or convert an image from one format to another. But because it has so many features, it&#39;s difficult to figure out how to do the thing you want to do.</p>

    <p>Here are some things I&#39;ve done with it, for my own reference. Maybe it&#39;s useful to you too.</p>

    <p>Most of these examples use this image for an input. It&#39;s a 400 by 400 pixel version of my logo on a green background.</p>

    <p><img src="https://zck.org/images/imagemagick/logo.png" alt="My logo. This image is used as the starting image for commands on this page."/></p>
</div>

<div>
    <h2>Convert an image between formats</h2>
    <div>
        <p>This is possibly the simplest thing you can do with Imagemagick.</p>

        <p><code>magick logo.png logo.jpeg</code></p>

        <p><img src="https://zck.org/images/imagemagick/logo.jpeg" alt="My logo, but as a jpeg!"/></p>

        <p>This takes the first argument (in this case, a <a href="https://en.wikipedia.org/wiki/PNG">PNG</a>) and outputs it as the second argument (in this case, a <a href="https://en.wikipedia.org/wiki/JPEG">JPEG</a>).</p>
    </div>
</div>
<div>
    <h2>Resize an image</h2>
    <div>
        <p><a href="https://imagemagick.org/script/command-line-options.php#resize">Resize an image</a>! The <code>-resize</code> argument resizes an image – in this example, to 100 by 200 pixels.</p>

        <p><code>magick logo.png -resize 100x200 resized-1.png</code></p>

        <p><img src="https://zck.org/images/imagemagick/resized-1.png" alt="My logo, resized but not to the size I thought it would be."/></p>

        <p>Wait, that isn&#39;t 100 by 200 pixels! The command resized it to 100 by 100 instead. Why is that?</p>

        <p>It turns out the <code>100x200</code> argument is a <a href="https://imagemagick.org/script/command-line-processing.php#geometry">geometry argument</a>. <code>100x200</code> means &#34;Maximum values of height and width given, aspect ratio preserved&#34;. So the width is a maximum of 100 pixels, and since the aspect ratio is kept as 1:1 (the same as the original image) the height also is forced to be 100 pixels.</p>

        <p>To force the resize to the exact size given, pass an <code>100x200!</code> geometry argument:</p>

        <p><code>magick logo.png -resize 100x200! resized-2.png</code></p>

        <p><img src="https://zck.org/images/imagemagick/resized-2.png" alt="My logo, resized to a new aspect ratio."/></p>

        <p>To preserve the aspect ratio, pass only one of the <code>width x height</code> arguments. This results in a 200 by 200 pixel image.</p>

        <p><code>magick logo.png -resize x200 resized-3.png</code></p>

        <p><img src="https://zck.org/images/imagemagick/resized-3.png" alt="My logo, resized with a set width, but keeping the same aspect ratio."/></p>

        <p>Or even make each direction 50% smaller! Because <code>logo.png</code> was 400 by 400 pixels, this also results in a 200 by 200 pixel image.</p>

        <p><code>magick logo.png -resize 50% resized-4.png</code></p>

        <p><img src="https://zck.org/images/imagemagick/resized-4.png" alt="My logo, resized to 50% of the previous size."/></p>

        <p>For more information about specifying the size, read about the <a href="https://imagemagick.org/script/command-line-processing.php#geometry">geometry argument</a>.</p>
    </div>
</div>

<div>
    <h2>Add a border</h2>
    <div>
        <p>In most documents, images look way better <a href="https://imagemagick.org/script/command-line-options.php#border">with a border</a>. For example, a grey 5 pixel border:</p>

        <p><code>magick logo.png -bordercolor grey -border 5 bordered.png</code></p>

        <p><img src="https://zck.org/images/imagemagick/bordered.png" alt="My logo with an added border."/></p>
    </div>
</div>
<div>
    <h2>Crop an image</h2>
    <div>
        <p>There are several options to crop an image, removing from its edges.</p>

        <p><a href="https://imagemagick.org/script/command-line-options.php#crop">Crop</a>, well, crops an image, but in a <s>croppy</s> crappy way. Its arguments are the size of the image you want to save. I almost always find it more intuitive tell how much to <em>remove</em> instead, like &#34;trim 100px off the left&#34;. It seems designed more for editing images down to a specific size.</p>

        <p>To crop to a 100 by 200 pixel image starting at the 10th pixel from the left, 20th pixel down:</p>

        <p><code>magick logo.png -crop 100x200+10+20 cropped-1.png</code></p>

        <p><img src="https://zck.org/images/imagemagick/cropped-1.png" alt="My logo, cropped to an exact size."/></p>

        <p>The frustrating part with this is that to take another pixel off the left, you have to both change the <em>offset</em> (for determining how many pixels on the left to remove), but also the <em>size</em>, because you don&#39;t want to cut less from the right side. To cut one more pixel off the left:</p>

        <p><code>magick logo.png -crop 99x200+11+20 cropped-2.png</code></p>

        <p><img src="https://zck.org/images/imagemagick/cropped-2.png" alt="My logo, cropped one more pixel over from the last one."/></p>

        <p>This is more complicated than it should be to move one pixel over – you have to calculate the new width as well as specify the starting pixel. Instead, <a href="https://imagemagick.org/script/command-line-options.php#shave">shave</a> removes the same size from the top and bottom of an image, and the same size from the left and right. To remove 30 pixels from the left and right, and 100 from the top and bottom:</p>

        <p><code>magick logo.png -shave 30x100 cropped-3.png</code></p>

        <p><img src="https://zck.org/images/imagemagick/cropped-3.png" alt="My logo, cropped with -shave."/></p>

        <p>This, too, isn&#39;t quite what I want. Usually, I want to specify different offsets for the left and right side. Or different offsets for the top and bottom. But, as far as I&#39;m aware, you can&#39;t. I wish you could.</p>

        <p>Also, the geometry argument is somewhat complicated – if you just want to make the image shorter, setting the geometry argument to <code>100x</code> results in <code>width / 100</code> images, each 100 pixels wide. This is not what I would want. Instead, set the geometry to <code>100x+0+0</code>. Why does this work? I have no idea.</p>
    </div>
</div>
<div>
    <h2>A warning about cropping</h2>
    <p>Sometimes, you need to <a href="https://www.imagemagick.org/Usage/crop/#crop_repage">add <code>+repage</code></a> when cropping. I don&#39;t really know when. It&#39;s definitely not always, as the documentation suggests. None of the examples here use it.</p>
</div>
<div>
    <h2>Add a background to a transparent image</h2>
    <div>
        <p>I used this to create the image at the top of this page that&#39;s used as the base for all of these images, starting with a transparent version of my logo.</p>

        <p><img src="https://zck.org/images/imagemagick/logo-transparent.png" alt="My logo, with a transparent background."/></p>

        <p>We&#39;ll use the <a href="https://imagemagick.org/script/command-line-options.php#alpha">-alpha remove</a> option to remove the transparency. This causes the transparent channel of the image to be replaced with the background color, so we previously need to set the background color to what we want.</p>

        <p><code>magick logo-transparent.png -background red -alpha remove with-background.png</code></p>

        <p><img src="https://zck.org/images/imagemagick/with-background.png" alt="My logo, with an added background."/></p>
    </div>
</div>

<div>
    <h2>Move an image around</h2>
    <div>
        <p>Sometimes, we want to shift an image, moving it around. We can do that with the <a href="https://imagemagick.org/script/command-line-options.php#page">-page option</a>. This will move the image as specified by another <a href="https://imagemagick.org/script/command-line-processing.php#geometry">geometry argument</a>. We also have to add <a href="https://imagemagick.org/script/command-line-options.php#layers"><code>-layers flatten</code></a>, as that will use the current background color, create a canvas the size of the image, and crop out anything outside of that canvas. Or something. I won&#39;t pretend to completely understand how it works without flattening, but it&#39;s required.</p>

        <p><code>magick infile.png -page +100 -layers flatten logo-moved.png</code></p>

        <p><img src="https://zck.org/images/imagemagick/logo-moved.png" alt="My logo, moved to the side."/></p>

        <p>I used this method to make a bunch of pngs for the next example.</p>
    </div>
</div>

<div>
    <h2>Animate a gif</h2>
    <div>
        <p>Let&#39;s make an <a href="https://www.imagemagick.org/Usage/anim_basics/">animated gif</a>! Assume we have a folder with a series of <code>png</code> files. We want to combine them into one gif.</p>

        <p><code>magick -delay 10 -loop 0 *.png animated-logo.gif</code></p>

        <p><img src="https://zck.org/images/imagemagick/animated-logo.gif" alt="My animated logo."/></p>

        <p>The <code>-delay</code> argument is in <em>hundredths</em> of a second, not milliseconds. This seems a little silly, but who ever let that stop them? Apparently this follows from the <code>gif</code> spec.</p>

        <p>Passing <code>-loop 0</code> means to loop forever.</p>
    </div>
</div>

<div>
    <h2>Odd different difference between convert, magick, etc</h2>
    <p>Imagemagick has both <code>magick</code> and <code>convert</code> commands, along with <a href="https://imagemagick.org/script/command-line-processing.php">many others</a>. It&#39;s not well-documented, but my understanding is that using the <code>magick</code> version is preferable.</p>
</div>
</div></div>
  </body>
</html>
