<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://cssgridgarden.com/">Original</a>
    <h1>Learn CSS Grid with a virtual garden game</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>I’ve done HTTP stuff with Rust a few times, but far enough apart that I forget which crate is which.
Here’s my notes, for future reference.</p>
<h2 id="the-tokiohttpstokiors-stack">The <a href="https://tokio.rs" target="_blank">tokio</a> stack</h2>
<p>These are the crates that build up the stack recommended at <a href="https://tokio.rs" target="_blank">https://tokio.rs</a>.</p>
<figure>
  <!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="375pt" height="260pt" viewBox="0.00 0.00 374.50 260.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" transform="scale(1 1) rotate(0) translate(4 256)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-256 370.5,-256 370.5,4 -4,4"></polygon>
<!-- axum -->
<g id="node1">
<title>axum</title>
<g id="a_node1"><a xlink:href="https://docs.rs/axum" xlink:title="axum" target="_blank">
<polygon fill="none" stroke="black" points="130.5,-252 74.5,-252 74.5,-216 130.5,-216 130.5,-252"></polygon>
<text text-anchor="middle" x="102.5" y="-230.3" font-family="Times,serif" font-size="14.00">axum</text>
</a>
</g>
</g>
<!-- hyper_util -->
<g id="node4">
<title>hyper_util</title>
<g id="a_node4"><a xlink:href="https://docs.rs/hyper_util" xlink:title="hyper_util" target="_blank">
<polygon fill="none" stroke="black" points="202,-180 113,-180 113,-144 202,-144 202,-180"></polygon>
<text text-anchor="middle" x="157.5" y="-158.3" font-family="Times,serif" font-size="14.00">hyper_util</text>
</a>
</g>
</g>
<!-- axum->hyper_util -->
<g id="edge10">
<title>axum-&gt;hyper_util</title>
<path fill="none" stroke="black" d="M116.1,-215.7C122.62,-207.39 130.57,-197.28 137.75,-188.14"></path>
<polygon fill="black" stroke="black" points="140.63,-190.13 144.06,-180.1 135.13,-185.81 140.63,-190.13"></polygon>
</g>
<!-- tower_http -->
<g id="node7">
<title>tower_http</title>
<g id="a_node7"><a xlink:href="https://docs.rs/tower_http" xlink:title="tower_http" target="_blank">
<polygon fill="none" stroke="black" points="95,-180 0,-180 0,-144 95,-144 95,-180"></polygon>
<text text-anchor="middle" x="47.5" y="-158.3" font-family="Times,serif" font-size="14.00">tower_http</text>
</a>
</g>
</g>
<!-- axum->tower_http -->
<g id="edge9">
<title>axum-&gt;tower_http</title>
<path fill="none" stroke="black" d="M88.9,-215.7C82.38,-207.39 74.43,-197.28 67.25,-188.14"></path>
<polygon fill="black" stroke="black" points="69.87,-185.81 60.94,-180.1 64.37,-190.13 69.87,-185.81"></polygon>
</g>
<!-- http -->
<g id="node2">
<title>http</title>
<g id="a_node2"><a xlink:href="https://docs.rs/http" xlink:title="http" target="_blank">
<polygon fill="none" stroke="black" points="139.5,-36 85.5,-36 85.5,0 139.5,0 139.5,-36"></polygon>
<text text-anchor="middle" x="112.5" y="-14.3" font-family="Times,serif" font-size="14.00">http</text>
</a>
</g>
</g>
<!-- hyper -->
<g id="node3">
<title>hyper</title>
<g id="a_node3"><a xlink:href="https://docs.rs/hyper" xlink:title="hyper" target="_blank">
<polygon fill="none" stroke="black" points="230.5,-108 172.5,-108 172.5,-72 230.5,-72 230.5,-108"></polygon>
<text text-anchor="middle" x="201.5" y="-86.3" font-family="Times,serif" font-size="14.00">hyper</text>
</a>
</g>
</g>
<!-- hyper->http -->
<g id="edge1">
<title>hyper-&gt;http</title>
<path fill="none" stroke="black" d="M179.5,-71.7C168.29,-62.88 154.5,-52.03 142.35,-42.47"></path>
<polygon fill="black" stroke="black" points="144.27,-39.54 134.25,-36.1 139.94,-45.04 144.27,-39.54"></polygon>
</g>
<!-- hyper_util->hyper -->
<g id="edge3">
<title>hyper_util-&gt;hyper</title>
<path fill="none" stroke="black" d="M168.38,-143.7C173.49,-135.56 179.7,-125.69 185.34,-116.7"></path>
<polygon fill="black" stroke="black" points="188.39,-118.43 190.75,-108.1 182.46,-114.71 188.39,-118.43"></polygon>
</g>
<!-- tower -->
<g id="node6">
<title>tower</title>
<g id="a_node6"><a xlink:href="https://docs.rs/tower" xlink:title="tower" target="_blank">
<polygon fill="none" stroke="black" points="154.5,-108 96.5,-108 96.5,-72 154.5,-72 154.5,-108"></polygon>
<text text-anchor="middle" x="125.5" y="-86.3" font-family="Times,serif" font-size="14.00">tower</text>
</a>
</g>
</g>
<!-- hyper_util->tower -->
<g id="edge4">
<title>hyper_util-&gt;tower</title>
<path fill="none" stroke="black" d="M149.59,-143.7C145.95,-135.73 141.55,-126.1 137.51,-117.26"></path>
<polygon fill="black" stroke="black" points="140.66,-115.74 133.32,-108.1 134.29,-118.65 140.66,-115.74"></polygon>
</g>
<!-- reqwest -->
<g id="node5">
<title>reqwest</title>
<g id="a_node5"><a xlink:href="https://docs.rs/reqwest" xlink:title="reqwest" target="_blank">
<polygon fill="none" stroke="black" points="366.5,-180 292.5,-180 292.5,-144 366.5,-144 366.5,-180"></polygon>
<text text-anchor="middle" x="329.5" y="-158.3" font-family="Times,serif" font-size="14.00">reqwest</text>
</a>
</g>
</g>
<!-- reqwest->hyper -->
<g id="edge2">
<title>reqwest-&gt;hyper</title>
<path fill="none" stroke="black" d="M298.19,-143.88C280.51,-134.21 258.27,-122.05 239.59,-111.83"></path>
<polygon fill="black" stroke="black" points="241.19,-108.71 230.73,-106.99 237.83,-114.86 241.19,-108.71"></polygon>
</g>
<!-- tower_service -->
<g id="node8">
<title>tower_service</title>
<g id="a_node8"><a xlink:href="https://docs.rs/tower_service" xlink:title="tower_service" target="_blank">
<polygon fill="none" stroke="black" points="316.5,-36 200.5,-36 200.5,0 316.5,0 316.5,-36"></polygon>
<text text-anchor="middle" x="258.5" y="-14.3" font-family="Times,serif" font-size="14.00">tower_service</text>
</a>
</g>
</g>
<!-- reqwest->tower_service -->
<g id="edge5">
<title>reqwest-&gt;tower_service</title>
<path fill="none" stroke="black" d="M320.94,-143.87C308.68,-119.35 286.02,-74.03 271.63,-45.26"></path>
<polygon fill="black" stroke="black" points="274.7,-43.57 267.09,-36.19 268.44,-46.7 274.7,-43.57"></polygon>
</g>
<!-- tower->tower_service -->
<g id="edge6">
<title>tower-&gt;tower_service</title>
<path fill="none" stroke="black" d="M154.69,-73.64C172.99,-64.01 196.87,-51.44 217.11,-40.79"></path>
<polygon fill="black" stroke="black" points="218.9,-43.8 226.12,-36.04 215.64,-37.6 218.9,-43.8"></polygon>
</g>
<!-- tower_http->http -->
<g id="edge8">
<title>tower_http-&gt;http</title>
<path fill="none" stroke="black" d="M55.08,-143.9C63.05,-125.95 76.02,-96.93 87.5,-72 91.52,-63.27 95.98,-53.77 100,-45.25"></path>
<polygon fill="black" stroke="black" points="103.19,-46.68 104.31,-36.15 96.87,-43.69 103.19,-46.68"></polygon>
</g>
<!-- tower_http->tower -->
<g id="edge7">
<title>tower_http-&gt;tower</title>
<path fill="none" stroke="black" d="M66.78,-143.7C76.42,-135.05 88.23,-124.45 98.73,-115.03"></path>
<polygon fill="black" stroke="black" points="101.34,-117.39 106.44,-108.1 96.66,-112.18 101.34,-117.39"></polygon>
</g>
<!-- warp -->
<g id="node9">
<title>warp</title>
<g id="a_node9"><a xlink:href="https://docs.rs/warp" xlink:title="warp" target="_blank">
<polygon fill="none" stroke="black" points="274.5,-180 220.5,-180 220.5,-144 274.5,-144 274.5,-180"></polygon>
<text text-anchor="middle" x="247.5" y="-158.3" font-family="Times,serif" font-size="14.00">warp</text>
</a>
</g>
</g>
<!-- warp->hyper -->
<g id="edge12">
<title>warp-&gt;hyper</title>
<path fill="none" stroke="black" d="M236.13,-143.7C230.78,-135.56 224.3,-125.69 218.39,-116.7"></path>
<polygon fill="black" stroke="black" points="221.16,-114.54 212.74,-108.1 215.31,-118.38 221.16,-114.54"></polygon>
</g>
<!-- warp->tower_service -->
<g id="edge11">
<title>warp-&gt;tower_service</title>
<path fill="none" stroke="black" d="M248.83,-143.87C250.7,-119.67 254.15,-75.21 256.38,-46.39"></path>
<polygon fill="black" stroke="black" points="259.89,-46.43 257.17,-36.19 252.91,-45.89 259.89,-46.43"></polygon>
</g>
</g>
</svg>

</figure>

<h3 id="http-data-types-no-io"><a href="https://docs.rs/http" target="_blank">http</a>: Data types, no IO</h3>
<p>Rust types for HTTP. Request, response, header, URI.</p>
<p>Doesn’t seem to cover serialization / deserialization (which would be different for HTTP/1,2,3) – just the API-level types.
Kinda the <a href="https://sans-io.readthedocs.io/#" target="_blank">Sans-IO</a> approach, but even moreso.</p>
<p>1.0 release was published 2023-11-15.</p>
<h3 id="hyper-low-level-serverclient"><a href="https://docs.rs/hyper" target="_blank">hyper</a>: Low level server/client</h3>
<p>“Relatively low-level” server (and client) library. HTTP/2 support.</p>
<p><code>Server</code> “serve[s] a single channel”, passing requests to <em>a single</em>
<a href="https://docs.rs/hyper/latest/hyper/service/trait.HttpService.html" target="_blank"><code>Request -&gt; Response</code></a> function.
It doesn’t deal with making the connection, or any details of that
processing function, hence “low-level”.</p>
<h3 id="tower-network-middleware"><a href="https://docs.rs/tower" target="_blank">tower</a>: Network Middleware</h3>
<p>Middleware <a href="https://en.wikipedia.org/wiki/Abstract_data_type" target="_blank">ADT</a> definitions, and some concrete implementations, for request/response things.</p>
<p>Two ADTs:</p>
<ul>
<li>
<p><code>tower_service::Service</code>: The tagline for the crate: <code>async fn(Request) -&gt; Result&lt;Response, Error&gt;</code>.</p>
</li>
<li>
<p><code>tower_layer::Layer</code>: a transformer from <code>Service -&gt; Service</code>, adding a layer of middleware.</p>
</li>
</ul>
<p><code>tower</code> is not HTTP-specific; it doesn’t depend on any of the other libraries here. There’s a <code>hyper-util</code> that <a href="https://docs.rs/hyper-util/latest/hyper_util/service/index.html" target="_blank">bridges</a> Tower services to Hyper services. <a href="https://docs.rs/tower-http" target="_blank"><code>tower-http</code></a> has some additional HTTP-specific middlewares; several other crates offer more middlewares.</p>
<h3 id="axum-the-tokio-http-server"><a href="https://docs.rs/axum" target="_blank">axum</a>: the <a href="https://docs.rs/tokio" target="_blank">tokio</a> HTTP server</h3>
<blockquote>
<p>axum is designed to work with <a href="https://docs.rs/tokio" target="_blank">tokio</a> and <a href="https://docs.rs/hyper" target="_blank">hyper</a>. Runtime and transport layer independence is not a goal, at least for the time being.</p>
</blockquote>
<p>Routes by path. Handlers take “extractors” as arguments, capturing e.g. a query parameter, URL segments,
…and <a href="https://docs.rs/axum/latest/axum/#sharing-state-with-handlers" target="_blank">state</a>, which feels weird to me but
it seems like a common pattern.</p>
<p>From experience: feels highly polymorphic; stuff like extractors are vigorously overloaded.</p>
<h2 id="seanmonstars-server-and-client">@seanmonstar’s server and client</h2>
<p><a href="https://github.com/seanmonstar" target="_blank">Sean McArthur</a> is <a href="https://docs.rs/warp/latest/warp/" target="_blank">listed</a> as the Hyperium <a href="https://hyper.rs/contrib/governance/" target="_blank">project admin</a>,
which is the org that owns <code>http</code> and <code>hyper</code>. Unsurprisingly, these crates wrap <code>hyper</code> and use <code>http</code> types.</p>
<h3 id="warp-server-library"><a href="https://docs.rs/warp" target="_blank">warp</a>: Server library</h3>
<p>Based on composition of filters; filters either reject a request, or produce a response.
Compose filters combinator-style to create a routing table, URL/request/body extractors, …
A filter can be turned into a <code>tower::Service</code>, and then further wrapped in Tower middleware.</p>
<p>Uses <code>tokio::io</code> types, but doesn’t require the runtime; <a href="https://github.com/smol-rs/async-compat" target="_blank">smol-rs</a> has an example of running <code>warp</code> in the <code>smol</code> runtime.</p>
<h3 id="reqwest-client-library"><a href="https://docs.rs/reqwest" target="_blank">reqwest</a>: Client library</h3>
<p>Wrapping the <code>hyper</code> client. Async or blocking.</p>
<p>Interestingly, it uses <a href="https://docs.rs/tower-service/" target="_blank"><code>tower-service</code></a> to express readiness; Tower’s docs note <a href="https://docs.rs/tower/latest/tower/trait.Service.html" target="_blank">the same middleware can be used in either a client or a server</a>.</p>
<h2 id="server-alternatives">Server alternatives</h2>
<h3 id="actix-web"><a href="https://docs.rs/actix-web" target="_blank">actix-web</a></h3>
<p>End-to-end server framework; routing, middleware, request/response…</p>
<p>Uses its <a href="https://docs.rs/actix-rt/latest/actix_rt/" target="_blank">own runtime</a>, which instantiates a single-threaded <code>tokio</code> runtime per thread. No work-stealing.</p>
<p>Has its own <code>actix_http</code> crate, which is at least in part <a href="https://docs.rs/actix-http/3.7.0/src/actix_http/header/mod.rs.html" target="_blank">a re-export of <code>http</code></a>.</p>
<p>An interesting note in their docs:</p>
<blockquote>
<p>Long ago, Actix Web was built on top of the <code>actix</code> actor framework. Now, Actix Web … is built using a different system. Though <code>actix</code> is still maintained, its usefulness as a general tool is diminishing as the futures and async/await ecosystem matures.</p>
</blockquote>
<p>So, build to provide a green-threaded HTTP server before <code>async/await</code> was mature?</p>
<h3 id="rocket"><a href="https://docs.rs/rocket" target="_blank">Rocket</a></h3>
<p>Uses <code>hyper</code> and <code>http</code> under the hood.
Uses a <code>tokio</code> runtime, though it seems they want the entry point to be via <code>rocket::main</code>.</p>
<p>Starting the server requires <code>build</code>, <code>ignite</code>, <code>launch</code> <a href="https://api.rocket.rs/v0.5/rocket/struct.Rocket#" target="_blank">calls</a>,
“attaching fairings”… really leaning into the metaphor.</p>
<h2 id="what-about-http3">What about HTTP/3?</h2>
<p>Doesn’t look like any of these have it yet. That’s a pity; seems like <a href="https://httparchive.org/reports/state-of-the-web#h3" target="_blank">lots of servers do</a>.</p>
<p><code>hyper</code> HTTP/3 support is <a href="https://github.com/hyperium/hyper/issues/1818" target="_blank">in the works</a>; there’s a <a href="https://github.com/hyperium/h3" target="_blank">separate crate available</a> that is “generic over a QUIC implementation”, just providing the HTTP/3 bindings. That “generic” does not cover <code>quiche</code>.</p>
<p><a href="https://docs.rs/quiche" target="_blank">quiche</a> is a QUIC and HTTP/3 implementation. Apparently this is the Actual Cloudflare Implementation, so it’d be bug-for-bug compatible with common clients.
This does not use the <code>http</code> crate, so bridging between it and an h1/h2 service would Not Work Great.</p>

</div></div>
  </body>
</html>
