<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.encrypted.at/android-captive-portal/">Original</a>
    <h1>Changing the Android captive portal page (2020)</h1>
    
    <div id="readability-page-1" class="page"><div id="iriska-content"><div id="iriska-primary">
	<main id="iriska-main">
		<div>
			<div>
				<div>
										<div>
						

<article id="iriska-post-257">
	<section>
					<p><img width="405" height="405" src="https://www.encrypted.at/wp-content/uploads/2020/04/wireless-router.png" alt="Wireless Router" decoding="async" srcset="https://www.encrypted.at/wp-content/uploads/2020/04/wireless-router.png 405w, https://www.encrypted.at/wp-content/uploads/2020/04/wireless-router-300x300.png 300w, https://www.encrypted.at/wp-content/uploads/2020/04/wireless-router-150x150.png 150w" sizes="(max-width: 405px) 100vw, 405px"/>			</p>
		
		<div>
			<div>
				<div>
							<p><span><time datetime="2020-04-21T17:29:44+02:00">April 21, 2020</time></span><span><span>Comments (1)</span></span>		</p>
						</div>
			</div>
			
			<div>
				
<p>If you don’t want your Android phone to always contact a Google server when switching networks, the following article might be useful!</p>



<h2>What is a captive portal?</h2>



<p>Ever been connected to a public or hotel WiFi? Chances are, if you tried to connect to it, your phone notified you that you had to <em>“Sign in to Wi-Fi network”</em> – and that’s what a captive portal is: The page that <strong>has to be accepted</strong> before being able to surf on the net. In some cases like in a hotel, you might have to log in on that page too. You can read more about captive portals on <a href="https://en.wikipedia.org/wiki/Captive_portal">Wikipedia</a>.</p>



<h2>But, why should I change it?</h2>



<p>Well, on Android 6 or higher, every time you switch networks, your phone tries to access the following URL:</p>



<pre><code>http://connectivitycheck.gstatic.com/generate_204</code></pre>



<p>As we can see, gstatic.com – Google’s servers. We might not want Google to know our new IP address or when we switched between networks. So… Why don’t we just self-host it? It’s pretty easy.</p>



<h2>Self-hosting it</h2>



<p>To self-host the page, you just need a web server and some ability to return your own HTTP status code – we’ll need a “204 No Content” here.</p>



<p>Here’s my PHP script:</p>



<pre><code>&lt;?php
header(&#34;HTTP/1.0 204 No Content&#34;);
die();</code></pre>



<p>After that, you can change the URL on your phone.</p>



<h2>Changing the URL</h2>



<p>To change the URL, open up a shell/terminal connection to your phone. You can do this with a Terminal emulator (e.g. Termux) or with adb. In my case, I did it with adb and a USB cable.</p>



<p>To start the adb session, connect your phone to your PC with a USB cable and enter <code>adb shell</code> in your terminal. Accept the dialog on your phone.</p>



<div><figure><img decoding="async" loading="lazy" width="377" height="215" src="https://www.encrypted.at/wp-content/uploads/2020/04/android-debugging.jpg" alt="Allow USB debugging" srcset="https://www.encrypted.at/wp-content/uploads/2020/04/android-debugging.jpg 377w, https://www.encrypted.at/wp-content/uploads/2020/04/android-debugging-300x171.jpg 300w" sizes="(max-width: 377px) 100vw, 377px"/><figcaption>Make sure to allow USB debugging for your PC.</figcaption></figure></div>



<p>You should now be greeted with a shell: <code>PhoneName:/ $</code></p>



<pre><code>settings put global captive_portal_http_url &#34;http://&lt;YOUR-URL&gt;&#34;
settings put global captive_portal_https_url &#34;https://&lt;YOUR-URL&gt;&#34;</code></pre>



<p>Replace <code>&lt;YOUR-URL&gt;</code> with your own link. Ensure that your web server does not forward http:// to https:// because that would mean a 301 status code instead of 204! You should start seeing access entries in your web server log as soon as you reconnect to your wireless network.</p>



<h2>My URLs</h2>



<p>If you want to, you can just use my URLs – logging is disabled here:</p>



<pre><code>settings put global captive_portal_http_url &#34;http://conntest.yxa.at/204.php&#34;
settings put global captive_portal_https_url &#34;https://conntest.yxa.at/204.php?https&#34;</code></pre>



<h2>That’s it!</h2>



<p>You’ve now changed your captive portal link on your Android device.</p>
			</div>
			
		</div>
	</section>

	
	
						
		
			
	
			<section>
			
		</section>
	
	<p><span><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid meet" viewBox="0 0 250 170" width="25" height="17"><path d="M5.95 77.23C5.95 38.17 59.68 6.5 125.95 6.5C192.23 6.5 245.95 38.16 245.95 77.23C245.95 116.29 192.23 147.96 125.96 147.96C109.86 147.96 94.5 146.09 80.47 142.71C77.51 143.96 62.71 150.22 36.06 161.5L42.96 128.31C18.29 107.65 5.95 90.62 5.95 77.23Z" opacity="1" fill-opacity="0" stroke-width="10" stroke-opacity="1"></path><path d="M88.32 76.26C88.32 84.45 81.66 91.11 73.47 91.11C65.27 91.11 58.61 84.45 58.61 76.26C58.61 68.06 65.27 61.41 73.47 61.41C81.66 61.41 88.32 68.06 88.32 76.26Z" opacity="1" fill-opacity="1"></path><path d="M140.85 76.26C140.85 84.45 134.2 91.11 126 91.11C117.8 91.11 111.15 84.45 111.15 76.26C111.15 68.06 117.8 61.41 126 61.41C134.2 61.41 140.85 68.06 140.85 76.26Z" opacity="1" fill-opacity="1"></path><path d="M191.85 76.26C191.85 84.45 185.2 91.11 177 91.11C168.81 91.11 162.15 84.45 162.15 76.26C162.15 68.06 168.81 61.41 177 61.41C185.2 61.41 191.85 68.06 191.85 76.26Z" opacity="1" fill-opacity="1"></path></svg><span>Comments (1)</span></span>	</p>
</article>
					</div>
				</div>
			</div>
		</div><!-- .iriska-wrapper-content -->
	</main><!-- #iriska-main -->
</div><!-- #iriska-primary -->
			</div></div>
  </body>
</html>
