<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://kdy1.dev/posts/2022/1/tsc-go">Original</a>
    <h1>Iâ€™m Porting the TypeScript Type Checker Tsc to Go</h1>
    
    <div id="readability-page-1" class="page"><div id="__next" data-reactroot=""><article>
<p>Iâ€™m porting the TypeScript Type Checker <code>tsc</code> to Go, and not Rust. As the creator of <a href="https://swc.rs/">SWC</a>, an extensible Rust platform, this might sound strange. Let me explain.</p>
<h2>Why port <code>tsc</code>?</h2>
<p>As TypeScript continues to rise in adoption, large projects are facing a dilemma: <strong>type checking is one of the slowest parts of their workflow</strong>. Developers want type safety without the tradeoff of slower iteration cycles.</p>
<p>The TypeScript Compiler, or <code>tsc</code>, checks the validity of your types and compiles your code to JavaScript. The more code you have, the longer it takes to compile. On medium-to-large-sized TypeScript projects, this compilation is <em>extremely slow</em>. While developers can replace the <em>transpilation</em> part of their workflow with SWC, type checking has still been a bottleneck.</p>
<h2>What is a type checker?</h2>
<p>A type checker validates your program before execution and ensures you&#39;ve used correct values for function calls and variable assignments. To prevent you from specifying types everywhere, it also infers variable types whenever possible. Type checking helps you develop with confidence, prevent mistakes, and enables smoother refactoring of large codebases.</p>
<h2>Why not Rust?</h2>
<p>I tried to rewrite <code>tsc</code> in Rust. It started as a side project and was a lot of fun. I started recreating the type checking logic without looking at the <code>tsc</code> source code.</p>
<p>Early tests of my Rust rewrite showed <strong>62x faster type checking than <code>tsc</code></strong>. To measure the compile-time between SWC and <code>tsc</code>, I used the <code>conformance</code> test suite from the official TypeScript compiler. Here were the results (using 8 threads):</p>
<ul>
<li><code>tsc</code>: 133.2 seconds</li>
<li>Rust rewrite: <strong>2.13 seconds</strong> <strong>(62x faster)</strong></li>
</ul>
<p>Eventually, I realized that rewriting a massive project such as <code>tsc</code> would be extremely difficult to continue. But the performance gains were exciting. This led me to try another route: porting instead of a complete rewrite. So, I started looking at the TypeScript source code.</p>
<p><code>tsc</code> uses a lot of shared mutability and many parts depend on <a href="https://en.wikipedia.org/wiki/Garbage_collection_(computer_science)">garbage collection</a>. Even though Iâ€™m an advocate and believer in Rust, it doesnâ€™t feel like the right tool for the job here. Using Rust required me to use <a href="https://doc.rust-lang.org/std/keyword.unsafe.html">unsafe</a> too much for this specific project.</p>
<p><code>tsc</code> depends on shared mutability and has a cyclical mutable reference. Rust is designed to <em>prevent</em> this behavior. Having two references to the same data (shared mutability) is undefined behavior in Rust.</p>
<p>Your language choice should be determined by the task, and not by preference. So even though I love Rust, I started experimenting with Go and Zig for this project and chose to use Go.</p>
<h2>Will it be open-source?</h2>
<p>Vercel is sponsoring and funding the work to port <code>tsc</code> to Go. Weâ€™re planning to open-source this work in the future. Iâ€™ll also be creating a bridge to use this new version of <code>tsc</code> with SWC.</p>
<p>With type checking support, SWC is working to improve the performance of your entire JavaScript / TypeScript toolchain:</p>
<ul>
<li>âœ… Transpilation (replacing Babel)</li>
<li>ðŸš§ Type Checking (replacing <code>tsc</code>)</li>
<li>ðŸš§ Minification (replacing Terser)</li>
<li>ðŸš§ Bundling (replacing webpack)</li>
</ul>
<p>For project updates, <a href="https://twitter.com/kdy1dev">follow me on Twitter</a>.</p><small><time>2022</time> Â© DongYoon Kang.<a href="https://kdy1.dev/feed.xml">RSS</a></small></article></div></div>
  </body>
</html>
