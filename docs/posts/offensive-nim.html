<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/byt3bl33d3r/OffensiveNim">Original</a>
    <h1>Offensive Nim</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><p dir="auto">
    <a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/5151193/98487722-ed729600-21e1-11eb-9d77-a79b0f3634de.png"><img height="300" alt="OffensiveNim" src="https://user-images.githubusercontent.com/5151193/98487722-ed729600-21e1-11eb-9d77-a79b0f3634de.png"/></a>
</p>

<p dir="auto">My experiments in weaponizing <a href="https://nim-lang.org/" rel="nofollow">Nim</a> for implant development and general offensive operations.</p>
<h2 dir="auto"><a id="user-content-table-of-contents" aria-hidden="true" href="#table-of-contents"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Table of Contents</h2>
<ul dir="auto">
<li><a href="#offensivenim">OffensiveNim</a>
<ul dir="auto">
<li><a href="#why-nim">Why Nim?</a></li>
<li><a href="#examples-in-this-repo-that-work">Examples in this repo</a></li>
<li><a href="#compiling-the-examples-in-this-repo">Compiling the examples</a>
<ul dir="auto">
<li><a href="#easy-way-recommended">Easy Way (Recommended)</a></li>
<li><a href="#hard-way-for-the-bold">Hard Way (For the Bold)</a></li>
</ul>
</li>
<li><a href="#cross-compiling">Cross Compiling</a></li>
<li><a href="#interfacing-with-cc">Interfacing with C/C++</a></li>
<li><a href="#creating-windows-dlls-with-an-exported-dllmain">Creating Windows DLLs with an exported DllMain</a></li>
<li><a href="#optimizing-executables-for-size">Optimizing executables for size</a></li>
<li><a href="#reflectively-loading-nim-executables">Reflectively Loading Nim Executables</a></li>
<li><a href="#executable-size-difference-when-using-the-winim-library-vs-without">Executable size difference with the Winim Library</a></li>
<li><a href="#opsec-considerations">Opsec Considirations</a></li>
<li><a href="#converting-c-code-to-nim">Converting C Code to Nim</a></li>
<li><a href="#language-bridges">Language Bridges</a></li>
<li><a href="#debugging">Debugging</a></li>
<li><a href="#setting-up-a-dev-environment">Setting up a dev environment</a></li>
<li><a href="#pitfalls-i-found-myself-falling-into">Pitfalls I found myself falling into</a></li>
<li><a href="#interesting-nim-libraries">Interesting Nim Libraries</a></li>
<li><a href="#nim-for-implant-dev-links">Nim for Implant Dev Links</a></li>
<li><a href="#contributors">Contributors</a></li>
</ul>
</li>
</ul>
<h2 dir="auto"><a id="user-content-why-nim" aria-hidden="true" href="#why-nim"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Why Nim?</h2>
<ul dir="auto">
<li>Compiles <em>directly</em> to C, C++, Objective-C and Javascript.</li>
<li>Since it doesn&#39;t rely on a VM/runtime does not produce what I like to call &#34;T H I C C malwarez&#34; as supposed to other languages (e.g. Golang)</li>
<li>Python inspired syntax, allows rapid native payload creation &amp; prototyping.</li>
<li>Has <strong>extremely</strong> mature <a href="https://nim-lang.org/docs/manual.html#foreign-function-interface" rel="nofollow">FFI</a> (Foreign Function Interface) capabilities.</li>
<li>Avoids making you actually write in C/C++ and subsequently avoids introducing a lot of security issues into your software.</li>
<li>Super easy cross compilation to Windows from *nix/MacOS, only requires you to install the <code>mingw</code> toolchain and passing a single flag to the nim compiler.</li>
<li>The Nim compiler and the generated executables support all major platforms like Windows, Linux, BSD and macOS. Can even compile to Nintendo switch , IOS &amp; Android. See the cross-compilation section in the <a href="https://nim-lang.github.io/Nim/nimc.html#crossminuscompilation" rel="nofollow">Nim compiler usage guide</a></li>
<li>You could <em>technically</em> write your implant and c2 backend both in Nim as you can compile your code directly to Javascript. Even has some <a href="https://forum.nim-lang.org/t/4779" rel="nofollow">initial support for WebAssembly&#39;s</a></li>
</ul>
<h2 dir="auto"><a id="user-content-examples-in-this-repo-that-work" aria-hidden="true" href="#examples-in-this-repo-that-work"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Examples in this repo that work</h2>
<table>
<thead>
<tr>
<th>File</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/pop_bin.nim">pop_bin.nim</a></td>
<td>Call <code>MessageBox</code> WinApi <em>without</em> using the Winim library</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/pop_winim_bin.nim">pop_winim_bin.nim</a></td>
<td>Call <code>MessageBox</code> <em>with</em> the Winim libary</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/pop_winim_lib.nim">pop_winim_lib.nim</a></td>
<td>Example of creating a Windows DLL with an exported <code>DllMain</code></td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/execute_assembly_bin.nim">execute_assembly_bin.nim</a></td>
<td>Hosts the CLR, reflectively executes .NET assemblies from memory</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/clr_host_cpp_embed_bin.nim">clr_host_cpp_embed_bin.nim</a></td>
<td>Hosts the CLR by directly embedding C++ code, executes a .NET assembly from disk</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/scshell_c_embed_bin.nim">scshell_c_embed_bin.nim</a></td>
<td>Shows how to quickly weaponize existing C code by embedding <a href="https://github.com/Mr-Un1k0d3r/SCShell">SCShell</a> (C) directly within Nim</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/fltmc_bin.nim">fltmc_bin.nim</a></td>
<td>Enumerates all Minifilter drivers</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/blockdlls_acg_ppid_spoof_bin.nim">blockdlls_acg_ppid_spoof_bin.nim</a></td>
<td>Creates a suspended process that spoofs its PPID to explorer.exe, also enables BlockDLLs and ACG</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/named_pipe_client_bin.nim">named_pipe_client_bin.nim</a></td>
<td>Named Pipe Client</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/named_pipe_server_bin.nim">named_pipe_server_bin.nim</a></td>
<td>Named Pipe Server</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/embed_rsrc_bin.nim">embed_rsrc_bin.nim</a></td>
<td>Embeds a resource (zip file) at compile time and extracts contents at runtime</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/self_delete_bin.nim">self_delete_bin.nim</a></td>
<td>A way to delete a locked or current running executable on disk. Method discovered by <a href="https://twitter.com/jonasLyk/status/1350401461985955840" rel="nofollow">@jonasLyk</a></td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/encrypt_decrypt_bin.nim">encrypt_decrypt_bin.nim</a></td>
<td>Encryption/Decryption using AES256 (CTR Mode) using the <a href="https://github.com/cheatfate/nimcrypto">Nimcrypto</a> library</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/amsi_patch_bin.nim">amsi_patch_bin.nim</a></td>
<td>Patches AMSI out of the current process</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/amsi_providerpatch_bin.nim">amsi_providerpatch_bin.nim</a></td>
<td>Patches the AMSI Provider DLL (in this case MpOav.dll) to bypass AMSI. Published <a href="https://i.blackhat.com/Asia-22/Friday-Materials/AS-22-Korkos-AMSI-and-Bypass.pdf" rel="nofollow">here</a></td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/etw_patch_bin.nim">etw_patch_bin.nim</a></td>
<td>Patches ETW out of the current process (Contributed by )</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/wmiquery_bin.nim">wmiquery_bin.nim</a></td>
<td>Queries running processes and installed AVs using using WMI</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/out_compressed_dll_bin.nim">out_compressed_dll_bin.nim</a></td>
<td>Compresses, Base-64 encodes and outputs PowerShell code to load a managed dll in memory. Port of the orignal PowerSploit script to Nim.</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/dynamic_shellcode_local_inject_bin.nim">dynamic_shellcode_local_inject_bin.nim</a></td>
<td>POC to locally inject shellcode recovered dynamically instead of hardcoding it in an array.</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/shellcode_callback_bin.nim">shellcode_callback_bin.nim</a></td>
<td>Executes shellcode using Callback functions</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/shellcode_bin.nim">shellcode_bin.nim</a></td>
<td>Creates a suspended process and injects shellcode with <code>VirtualAllocEx</code>/<code>CreateRemoteThread</code>. Also demonstrates the usage of compile time definitions to detect arch, os etc..</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/shellcode_fiber.nim">shellcode_fiber.nim</a></td>
<td>Shellcode execution via fibers</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/shellcode_inline_asm_bin.nim">shellcode_inline_asm_bin.nim</a></td>
<td>Executes shellcode using inline assembly</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/syscalls_bin.nim">syscalls_bin.nim</a></td>
<td>Shows how to make direct system calls</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/execute_powershell_bin.nim">execute_powershell_bin.nim</a></td>
<td>Hosts the CLR &amp; executes PowerShell through an un-managed runspace</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/passfilter_lib.nim">passfilter_lib.nim</a></td>
<td>Log password changes to a file by (ab)using a password complexity filter</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/minidump_bin.nim">minidump_bin.nim</a></td>
<td>Creates a memory dump of lsass using <code>MiniDumpWriteDump</code></td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/http_request_bin.nim">http_request_bin.nim</a></td>
<td>Demonstrates a couple of ways of making HTTP requests</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/execute_sct_bin.nim">execute_sct_bin.nim</a></td>
<td><code>.sct</code> file Execution via <code>GetObject()</code></td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/scriptcontrol_bin.nim">scriptcontrol_bin.nim</a></td>
<td>Dynamically execute VBScript and JScript using the <code>MSScriptControl</code> COM object</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/excel_com_bin.nim">excel_com_bin.nim</a></td>
<td>Injects shellcode using the Excel COM object and Macros</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/keylogger_bin.nim">keylogger_bin.nim</a></td>
<td>Keylogger using <code>SetWindowsHookEx</code></td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/memfd_python_interpreter_bin.nim">memfd_python_interpreter_bin.nim</a></td>
<td>Use <code>memfd_create</code> syscall to load a binary into an anonymous file and execute it with <code>execve</code> syscall.</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/uuid_exec_bin.nim">uuid_exec_bin.nim</a></td>
<td>Plants shellcode from UUID array into heap space and uses <code>EnumSystemLocalesA</code> Callback in order to execute the shellcode.</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/unhookc.nim">unhookc.nim</a></td>
<td>Unhooks ntdll.dll to evade EDR/AV hooks (embeds the C code template from <a href="https://www.ired.team/offensive-security/defense-evasion/how-to-unhook-a-dll-using-c++" rel="nofollow">ired.team</a>)</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/unhook.nim">unhook.nim</a></td>
<td>Unhooks ntdll.dll to evade EDR/AV hooks (pure nim implementation)</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/taskbar_ewmi_bin.nim">taskbar_ewmi_bin.nim</a></td>
<td>Uses Extra Window Memory Injection via Running Application property of TaskBar in order to execute the shellcode.</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/fork_dump_bin.nim">fork_dump_bin.nim</a></td>
<td>(ab)uses Window&#39;s implementation of <code>fork()</code> and acquires a handle to a remote process using the PROCESS_CREATE_PROCESS access right. It then attempts to dump the forked processes memory using <code>MiniDumpWriteDump()</code></td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/ldap_query_bin.nim">ldap_query_bin.nim</a></td>
<td>Perform LDAP queries via COM by using ADO&#39;s ADSI provider</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/sandbox_process_bin.nim">sandbox_process_bin.nim</a></td>
<td>This sandboxes a process by setting it&#39;s integrity level to Untrusted and strips important tokens. This can be used to &#34;silently disable&#34; a PPL process (e.g. AV/EDR)</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/list_remote_shares.nim">list_remote_shares.nim</a></td>
<td>Use NetShareEnum to list the share accessible by the current user</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/chrome_dump_bin.nim">chrome_dump_bin.nim</a></td>
<td>Read and decrypt cookies from Chrome&#39;s sqlite database</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/suspended_thread_injection.nim">suspended_thread_injection.nim</a></td>
<td>Shellcode execution via suspended thread injection</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/dns_exfiltrate.nim">dns_exfiltrate.nim</a></td>
<td>Simple DNS exfiltration via TXT record queries</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/rsrc_section_shellcode.nim">rsrc_section_shellcode.nim</a></td>
<td>Execute shellcode embedded in the .rsrc section of the binary</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/token_steal_cmd.nim">token_steal_cmd.nim</a></td>
<td>Steal a token/impersonate and then run a command</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/anti_analysis_isdebuggerpresent.nim">anti_analysis_isdebuggerpresent.nim</a></td>
<td>Simple anti-analysis that checks for a debugger</td>
</tr>
</tbody>
</table>
<h2 dir="auto"><a id="user-content-examples-that-are-a-wip" aria-hidden="true" href="#examples-that-are-a-wip"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Examples that are a WIP</h2>
<table>
<thead>
<tr>
<th>File</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/wip/amsi_patch_2_bin.nim">amsi_patch_2_bin.nim</a></td>
<td>Patches AMSI out of the current process using a different method (<strong>WIP, help appreciated</strong>)</td>
</tr>
<tr>
<td><a href="https://github.com/byt3bl33d3r/OffensiveNim/blob/master/wip/excel_4_com_bin.nim">excel_4_com_bin.nim</a></td>
<td>Injects shellcode using the Excel COM object and Excel 4 Macros (<strong>WIP</strong>)</td>
</tr>
</tbody>
</table>
<h2 dir="auto"><a id="user-content-compiling-the-examples-in-this-repo" aria-hidden="true" href="#compiling-the-examples-in-this-repo"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Compiling the examples in this repo</h2>
<p dir="auto">This repository does not provide binaries, you&#39;re gonna have to compile them yourself. This repo was setup to cross-compile the example Nim source files to Windows from Linux or MacOS.</p>
<h3 dir="auto"><a id="user-content-easy-way-recommended" aria-hidden="true" href="#easy-way-recommended"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Easy Way (Recommended)</h3>
<p dir="auto">Use <a href="https://code.visualstudio.com/docs/remote/create-dev-container" rel="nofollow">VSCode Devcontainers</a> to automatically setup a development environment for you (See the <a href="#setting-up-a-dev-environment">Setting Up a Dev Environment</a> section). Once that&#39;s done simply run <code>make</code>.</p>
<h3 dir="auto"><a id="user-content-hard-way-for-the-bold" aria-hidden="true" href="#hard-way-for-the-bold"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Hard way (For the bold)</h3>
<p dir="auto"><a href="https://nim-lang.org/install_unix.html" rel="nofollow">Install Nim</a> using your systems package manager (for Windows <a href="https://nim-lang.org/install_windows.html" rel="nofollow">use the installer on the official website</a>)</p>
<ul dir="auto">
<li><code>brew install nim</code></li>
<li><code>apt install nim</code></li>
<li><code>choco install nim</code></li>
</ul>
<p dir="auto">(Nim also provides a <a href="https://hub.docker.com/r/nimlang/nim/" rel="nofollow">docker image on Dockerhub</a>)</p>
<p dir="auto">You should now have the <code>nim</code> &amp; <code>nimble</code> commands available, the former is the Nim compiler and the latter is Nim&#39;s package manager.</p>
<p dir="auto">Install the <code>Mingw</code> toolchain needed for cross-compilation to Windows (Not needed if you&#39;re compiling on Windows):</p>
<ul dir="auto">
<li>*nix: <code>apt-get install mingw-w64</code></li>
<li>MacOS: <code>brew install mingw-w64</code></li>
</ul>
<p dir="auto">Finally, install the magnificent <a href="https://github.com/khchen/winim">Winim</a> library, along with <a href="https://github.com/guzba/zippy/">zippy</a> and <a href="https://github.com/cheatfate/nimcrypto">nimcrypto</a></p>
<ul dir="auto">
<li><code>nimble install winim zippy nimcrypto</code></li>
</ul>
<p dir="auto">Then cd into the root of this repository and run <code>make</code>.</p>
<p dir="auto">You should find the binaries and dlls in the <code>bin/</code> directory</p>
<h2 dir="auto"><a id="user-content-cross-compiling" aria-hidden="true" href="#cross-compiling"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Cross Compiling</h2>
<p dir="auto">See the cross-compilation section in the <a href="https://nim-lang.github.io/Nim/nimc.html#crossminuscompilation" rel="nofollow">Nim compiler usage guide</a>, for a lot more details.</p>
<p dir="auto">Cross compiling to Windows from MacOs/*nix requires the <code>mingw</code> toolchain, usually a matter of just <code>brew install mingw-w64</code> or <code>apt install mingw-w64</code>.</p>
<p dir="auto">You then just have to pass the  <code>-d=mingw</code> flag to the nim compiler.</p>
<p dir="auto">E.g. <code>nim c -d=mingw --app=console --cpu=amd64 source.nim</code></p>
<h2 dir="auto"><a id="user-content-interfacing-with-cc" aria-hidden="true" href="#interfacing-with-cc"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Interfacing with C/C++</h2>
<p dir="auto">See the insane <a href="https://nim-lang.org/docs/manual.html#foreign-function-interface" rel="nofollow">FFI section</a> in the Nim manual.</p>
<p dir="auto">If you&#39;re familiar with csharps P/Invoke it&#39;s essentially the same concept albeit a looks a tad bit uglier:</p>
<p dir="auto">Calling <code>MessageBox</code> example</p>
<div dir="auto" data-snippet-clipboard-copy-content="type
    HANDLE* = int
    HWND* = HANDLE
    UINT* = int32
    LPCSTR* = cstring

proc MessageBox*(hWnd: HWND, lpText: LPCSTR, lpCaption: LPCSTR, uType: UINT): int32 
  {.discardable, stdcall, dynlib: &#34;user32&#34;, importc: &#34;MessageBoxA&#34;.}

MessageBox(0, &#34;Hello, world !&#34;, &#34;Nim is Powerful&#34;, 0)"><pre><span>type</span>
    <span>HANDLE</span>* = <span>int</span>
    <span>HWND</span>* = <span>HANDLE</span>
    <span>UINT</span>* = <span>int32</span>
    <span>LPCSTR</span>* = <span>cstring</span>

<span>proc</span> <span>MessageBox</span><span>*</span>(hWnd: <span>HWND</span>, lpText: <span>LPCSTR</span>, lpCaption: <span>LPCSTR</span>, uType: <span>UINT</span>)<span>:</span> <span>int32</span> 
  {.<span>discardable</span>, <span>stdcall</span>, <span>dynlib</span>: <span>&#34;user32&#34;</span>, <span>importc</span>: <span>&#34;MessageBoxA&#34;</span>.}

<span>MessageBox</span>(<span>0</span>, <span>&#34;Hello, world !&#34;</span>, <span>&#34;Nim is Powerful&#34;</span>, <span>0</span>)</pre></div>
<p dir="auto">For any complex Windows API calls use the <a href="https://github.com/khchen/winim">Winim library</a>, saves an insane amount of time and doesn&#39;t add too much to the executable size (see below) depending on how you import it.</p>
<p dir="auto">Even has COM support!!!</p>
<h2 dir="auto"><a id="user-content-creating-windows-dlls-with-an-exported-dllmain" aria-hidden="true" href="#creating-windows-dlls-with-an-exported-dllmain"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Creating Windows DLLs with an exported <code>DllMain</code></h2>
<p dir="auto">Big thanks to the person who posted <a href="https://forum.nim-lang.org/t/1973" rel="nofollow">this</a> on the Nim forum.</p>
<p dir="auto">The Nim compiler tries to create a <code>DllMain</code> function for you automatically at compile time whenever you tell it to create a windows DLL, however, it doesn&#39;t actually export it for some reason. In order to have an exported <code>DllMain</code> you need to pass <code>--nomain</code> and define a <code>DllMain</code> function yourself with the appropriate pragmas (<code>stdcall, exportc, dynlib</code>).</p>
<p dir="auto">You need to also call <code>NimMain</code> from your <code>DllMain</code> to initialize Nim&#39;s garbage collector. (Very important, otherwise your computer will literally explode).</p>
<p dir="auto">Example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import winim/lean

proc NimMain() {.cdecl, importc.}

proc DllMain(hinstDLL: HINSTANCE, fdwReason: DWORD, lpvReserved: LPVOID) : BOOL {.stdcall, exportc, dynlib.} =
  NimMain()
  
  if fdwReason == DLL_PROCESS_ATTACH:
    MessageBox(0, &#34;Hello, world !&#34;, &#34;Nim is Powerful&#34;, 0)

  return true"><pre><span>import</span> winim/lean

<span>proc</span> <span>NimMain</span>() {.<span>cdecl</span>, <span>importc</span>.}

<span>proc</span> <span>DllMain</span>(hinstDLL: <span>HINSTANCE</span>, fdwReason: <span>DWORD</span>, lpvReserved: <span>LPVOID</span>) <span>:</span> <span>BOOL</span> {.<span>stdcall</span>, <span>exportc</span>, <span>dynlib</span>.} <span>=</span>
  <span>NimMain</span>()
  
  <span>if</span> fdwReason == <span>DLL_PROCESS_ATTACH</span>:
    <span>MessageBox</span>(<span>0</span>, <span>&#34;Hello, world !&#34;</span>, <span>&#34;Nim is Powerful&#34;</span>, <span>0</span>)

  <span>return</span> <span>true</span></pre></div>
<p dir="auto">To compile:</p>
<div data-snippet-clipboard-copy-content="nim c -d=mingw --app=lib --nomain --cpu=amd64 mynim.dll"><pre><code>nim c -d=mingw --app=lib --nomain --cpu=amd64 mynim.dll
</code></pre></div>
<h3 dir="auto"><a id="user-content-creating-xlls" aria-hidden="true" href="#creating-xlls"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Creating XLLs</h3>
<p dir="auto">You can make an XLL (an Excel DLL, imagine that) with an auto open function that can be used for payload delivery. The following code creates a simple for an XLL that has an auto open function and all other boilerplate code needed to compile as a link library. The POC compiles as a DLL, you can then change the extension to .xll and it will open in Excel and run the payload when double clicked:</p>
<div dir="auto" data-snippet-clipboard-copy-content="#[
    Compile:
        nim c -d=mingw --app=lib --nomain --cpu=amd64 nim_xll.nim
        
    Will compile as a DLL, you can then just change the extension to .xll
]#

import winim/lean

proc xlAutoOpen() {.stdcall, exportc, dynlib.} =
    MessageBox(0, &#34;Hello, world !&#34;, &#34;Nim is Powerful&#34;, 0)

proc NimMain() {.cdecl, importc.}

proc DllMain(hinstDLL: HINSTANCE, fdwReason: DWORD, lpvReserved: LPVOID) : BOOL {.stdcall, exportc, dynlib.} =
  NimMain()

  return true"><pre><span>#[</span>
<span>    Compile:</span>
<span>        nim c -d=mingw --app=lib --nomain --cpu=amd64 nim_xll.nim</span>
<span>        </span>
<span>    Will compile as a DLL, you can then just change the extension to .xll</span>
<span>]#</span>

<span>import</span> winim/lean

<span>proc</span> <span>xlAutoOpen</span>() {.<span>stdcall</span>, <span>exportc</span>, <span>dynlib</span>.} <span>=</span>
    <span>MessageBox</span>(<span>0</span>, <span>&#34;Hello, world !&#34;</span>, <span>&#34;Nim is Powerful&#34;</span>, <span>0</span>)

<span>proc</span> <span>NimMain</span>() {.<span>cdecl</span>, <span>importc</span>.}

<span>proc</span> <span>DllMain</span>(hinstDLL: <span>HINSTANCE</span>, fdwReason: <span>DWORD</span>, lpvReserved: <span>LPVOID</span>) <span>:</span> <span>BOOL</span> {.<span>stdcall</span>, <span>exportc</span>, <span>dynlib</span>.} <span>=</span>
  <span>NimMain</span>()

  <span>return</span> <span>true</span></pre></div>
<p dir="auto">There are many other sneaky things that can be done with XLLs. See <a href="https://github.com/Octoberfest7/XLL_Phishing">more examples of XLL tradecraft here</a>.</p>
<h2 dir="auto"><a id="user-content-optimizing-executables-for-size" aria-hidden="true" href="#optimizing-executables-for-size"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Optimizing executables for size</h2>
<p dir="auto">Taken from the <a href="https://nim-lang.org/faq.html" rel="nofollow">Nim&#39;s FAQ page</a></p>
<p dir="auto">For the biggest size decrease use the following flags <code>-d:danger -d:strip --opt:size</code></p>
<p dir="auto">Additionally, I&#39;ve found you can squeeze a few more bytes out by passing <code>--passc=-flto --passl=-flto</code> to the compiler. Also take a look at the <code>Makefile</code> in this repo.</p>
<p dir="auto">These flags decrease sizes <strong>dramatically</strong>: the shellcode injection example goes from 484.3 KB to 46.5 KB when cross-compiled from MacOSX!</p>
<h2 dir="auto"><a id="user-content-reflectively-loading-nim-executables" aria-hidden="true" href="#reflectively-loading-nim-executables"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Reflectively Loading Nim Executables</h2>
<p dir="auto">Huge thanks to <a href="https://twitter.com/ShitSecure" rel="nofollow">@Shitsecure</a> for figuring this out!</p>
<p dir="auto">By default, Nim doesn&#39;t generate PE&#39;s with a relocation table which is needed by most tools that reflectively load EXE&#39;s.</p>
<p dir="auto">To generate a Nim executable <em>with</em> a relocation section you need to pass a few additional flags to the linker.</p>
<p dir="auto">Specifically: <code>--passL:-Wl,--dynamicbase</code></p>
<p dir="auto">Full example command:</p>
<div data-snippet-clipboard-copy-content="nim c --passL:-Wl,--dynamicbase my_awesome_malwarez.nim"><pre><code>nim c --passL:-Wl,--dynamicbase my_awesome_malwarez.nim
</code></pre></div>
<h2 dir="auto"><a id="user-content-executable-size-difference-when-using-the-winim-library-vs-without" aria-hidden="true" href="#executable-size-difference-when-using-the-winim-library-vs-without"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Executable size difference when using the Winim library vs without</h2>
<p dir="auto">Incredibly enough the size difference is pretty negligible. Especially when you apply the size optimizations outlined above.</p>
<p dir="auto">The two examples <code>pop_bin.nim</code> and <code>pop_winim_bin.nim</code> were created for this purpose.</p>
<p dir="auto">The former defines the <code>MessageBox</code> WinAPI call manually and the latter uses the Winim library (specifically <code>winim/lean</code> which is only the core SDK, see <a href="https://github.com/khchen/winim#usage">here</a>), results:</p>
<div data-snippet-clipboard-copy-content="byt3bl33d3r@ecl1ps3 OffensiveNim % ls -lah bin
-rwxr-xr-x  1 byt3bl33d3r  25K Nov 20 18:32 pop_bin_32.exe
-rwxr-xr-x  1 byt3bl33d3r  32K Nov 20 18:32 pop_bin_64.exe
-rwxr-xr-x  1 byt3bl33d3r  26K Nov 20 18:33 pop_winim_bin_32.exe
-rwxr-xr-x  1 byt3bl33d3r  34K Nov 20 18:32 pop_winim_bin_64.exe"><pre><code>byt3bl33d3r@ecl1ps3 OffensiveNim % ls -lah bin
-rwxr-xr-x  1 byt3bl33d3r  25K Nov 20 18:32 pop_bin_32.exe
-rwxr-xr-x  1 byt3bl33d3r  32K Nov 20 18:32 pop_bin_64.exe
-rwxr-xr-x  1 byt3bl33d3r  26K Nov 20 18:33 pop_winim_bin_32.exe
-rwxr-xr-x  1 byt3bl33d3r  34K Nov 20 18:32 pop_winim_bin_64.exe
</code></pre></div>
<p dir="auto">If you import the entire Winim library with <code>import winim/com</code> it adds only around ~20ish KB which considering the amount of functionality it abstracts is 100% worth that extra size:</p>
<div data-snippet-clipboard-copy-content="byt3bl33d3r@ecl1ps3 OffensiveNim % ls -lah bin
-rwxr-xr-x  1 byt3bl33d3r  42K Nov 20 19:20 pop_winim_bin_32.exe
-rwxr-xr-x  1 byt3bl33d3r  53K Nov 20 19:20 pop_winim_bin_64.exe"><pre><code>byt3bl33d3r@ecl1ps3 OffensiveNim % ls -lah bin
-rwxr-xr-x  1 byt3bl33d3r  42K Nov 20 19:20 pop_winim_bin_32.exe
-rwxr-xr-x  1 byt3bl33d3r  53K Nov 20 19:20 pop_winim_bin_64.exe
</code></pre></div>
<h2 dir="auto"><a id="user-content-opsec-considerations" aria-hidden="true" href="#opsec-considerations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Opsec Considerations</h2>
<p dir="auto">Because of how Nim resolves DLLs dynamically using <code>LoadLibrary</code> using it&#39;s FFI none of your external imported functions will actually show up in the executables static imports (see <a href="https://web.archive.org/web/20210117002945/https://secbytes.net/implant-roulette-part-1:-nimplant/" rel="nofollow">this blog post</a> for more on this):</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/5151193/99911179-d0dd6000-2caf-11eb-933a-6a7ada510747.png"><img src="https://user-images.githubusercontent.com/5151193/99911179-d0dd6000-2caf-11eb-933a-6a7ada510747.png" alt=""/></a></p>
<p dir="auto">If you compile Nim source to a DLL, seems like you&#39;ll always have an exported <code>NimMain</code>, no matter if you specify your own <code>DllMain</code> or not (??). This could potentially be used as a signature, don&#39;t know how many shops are actually using Nim in their development stack. Definitely stands out.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/5151193/99911079-4563cf00-2caf-11eb-960d-e500534b56dd.png"><img src="https://user-images.githubusercontent.com/5151193/99911079-4563cf00-2caf-11eb-960d-e500534b56dd.png" alt=""/></a></p>
<h2 dir="auto"><a id="user-content-converting-c-code-to-nim" aria-hidden="true" href="#converting-c-code-to-nim"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Converting C code to Nim</h2>
<p dir="auto"><a href="https://github.com/nim-lang/c2nim">https://github.com/nim-lang/c2nim</a></p>
<p dir="auto">Used it to translate a bunch of small C snippets, haven&#39;t tried anything major.</p>
<h2 dir="auto"><a id="user-content-language-bridges" aria-hidden="true" href="#language-bridges"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Language Bridges</h2>
<ul dir="auto">
<li>
<p dir="auto">Python integration <a href="https://github.com/yglukhov/nimpy">https://github.com/yglukhov/nimpy</a></p>
<ul dir="auto">
<li>This is actually super interesting, <a href="https://github.com/yglukhov/nimpy/blob/master/nimpy/py_lib.nim#L330">especially this part</a>. With some modification could this load the PythonxXX.dll from memory?</li>
</ul>
</li>
<li>
<p dir="auto">Jave VM integration: <a href="https://github.com/yglukhov/jnim">https://github.com/yglukhov/jnim</a></p>
</li>
</ul>
<h2 dir="auto"><a id="user-content-debugging" aria-hidden="true" href="#debugging"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Debugging</h2>
<p dir="auto">Use the <code>repr()</code> function in combination with <code>echo</code>, supports almost all (??) data types, even structs!</p>
<p dir="auto">See <a href="https://nim-lang.org/blog/2017/10/02/documenting-profiling-and-debugging-nim-code.html" rel="nofollow">this blog post for more</a></p>
<h2 dir="auto"><a id="user-content-setting-up-a-dev-environment" aria-hidden="true" href="#setting-up-a-dev-environment"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Setting up a dev environment</h2>
<p dir="auto">This repository supports <a href="https://code.visualstudio.com/docs/remote/create-dev-container" rel="nofollow">VSCode Devcontainers</a> which allows you to develop in a Docker container. This automates setting up a development environment for you.</p>
<ol dir="auto">
<li>Install VSCode and Docker desktop</li>
<li>Clone this repo and open it in VSCode</li>
<li>Install the <code>Visual Studio Code Remote - Containers</code> extension</li>
<li>Open the command pallete and select <code>Remote-Containers: Reopen in Container</code> command</li>
</ol>
<p dir="auto">VScode will now build the Docker image (will take a bit) and put you right into your pre-built Nim dev environment!</p>
<h2 dir="auto"><a id="user-content-pitfalls-i-found-myself-falling-into" aria-hidden="true" href="#pitfalls-i-found-myself-falling-into"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Pitfalls I found myself falling into</h2>
<ul dir="auto">
<li>
<p dir="auto">When calling winapi&#39;s with Winim and trying to pass a null value, make sure you pass the <code>NULL</code> value (defined within the Winim library) as supposed Nim&#39;s builtin <code>nil</code> value. (Ugh)</p>
</li>
<li>
<p dir="auto">To get the OS handle to the created file after calling <code>open()</code> on Windows, you need to call <code>f.getOsFileHandle()</code> <strong>not</strong> <code>f.getFileHandle()</code> cause reasons.</p>
</li>
<li>
<p dir="auto">The Nim compiler does accept arguments in the form <code>-a=value</code> or <code>--arg=value</code> even tho if you look at the usage it only has arguments passed as <code>-a:value</code> or <code>--arg:value</code>. (Important for Makefiles)</p>
</li>
<li>
<p dir="auto">When defining a byte array, you also need to indicate at least in the first value that it&#39;s a byte array, bit weird but ok (<a href="https://forum.nim-lang.org/t/4322" rel="nofollow">https://forum.nim-lang.org/t/4322</a>)</p>
</li>
</ul>
<p dir="auto">Byte array in C#:</p>
<div dir="auto" data-snippet-clipboard-copy-content="byte[] buf = new byte[5] {0xfc,0x48,0x81,0xe4,0xf0,0xff}"><pre><span>byte</span>[] <span>buf</span> <span>=</span> <span>new</span> <span>byte</span>[<span>5</span>] {<span>0x</span><span>fc</span>,<span>0x</span><span>48</span>,<span>0x</span><span>81</span>,<span>0x</span><span>e4</span>,<span>0x</span><span>f0</span>,<span>0x</span><span>ff</span>}</pre></div>
<p dir="auto">Byte array in Nim:</p>
<div dir="auto" data-snippet-clipboard-copy-content="var buf: array[5, byte] = [byte 0xfc,0x48,0x81,0xe4,0xf0,0xff]"><pre><span>var</span> buf: <span>array</span>[<span>5</span>, <span>byte</span>] = [<span>byte</span> <span>0xfc</span>,<span>0x48</span>,<span>0x81</span>,<span>0xe4</span>,<span>0xf0</span>,<span>0xff</span>]</pre></div>
<h2 dir="auto"><a id="user-content-interesting-nim-libraries" aria-hidden="true" href="#interesting-nim-libraries"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Interesting Nim libraries</h2>
<ul dir="auto">
<li><a href="https://github.com/dom96/jester">https://github.com/dom96/jester</a></li>
<li><a href="https://github.com/pragmagic/karax">https://github.com/pragmagic/karax</a></li>
<li><a href="https://github.com/Niminem/Neel">https://github.com/Niminem/Neel</a></li>
<li><a href="https://github.com/status-im/nim-libp2p">https://github.com/status-im/nim-libp2p</a></li>
<li><a href="https://github.com/PMunch/libkeepass">https://github.com/PMunch/libkeepass</a></li>
<li><a href="https://github.com/def-/nim-syscall">https://github.com/def-/nim-syscall</a></li>
<li><a href="https://github.com/tulayang/asyncdocker">https://github.com/tulayang/asyncdocker</a></li>
<li><a href="https://github.com/treeform/ws">https://github.com/treeform/ws</a></li>
<li><a href="https://github.com/guzba/zippy">https://github.com/guzba/zippy</a></li>
<li><a href="https://github.com/rockcavera/nim-iputils">https://github.com/rockcavera/nim-iputils</a></li>
<li><a href="https://github.com/FedericoCeratto/nim-socks5">https://github.com/FedericoCeratto/nim-socks5</a></li>
<li><a href="https://github.com/CORDEA/backoff">https://github.com/CORDEA/backoff</a></li>
<li><a href="https://github.com/treeform/steganography">https://github.com/treeform/steganography</a></li>
<li><a href="https://github.com/miere43/nim-registry">https://github.com/miere43/nim-registry</a></li>
<li><a href="https://github.com/status-im/nim-daemon">https://github.com/status-im/nim-daemon</a></li>
</ul>
<h2 dir="auto"><a id="user-content-nim-for-implant-dev-links" aria-hidden="true" href="#nim-for-implant-dev-links"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Nim for implant dev links</h2>
<ul dir="auto">
<li><a href="https://web.archive.org/web/20210117002945/https://secbytes.net/implant-roulette-part-1:-nimplant/" rel="nofollow">https://web.archive.org/web/20210117002945/https://secbytes.net/implant-roulette-part-1:-nimplant/</a></li>
<li><a href="https://securelist.com/zebrocys-multilanguage-malware-salad/90680/" rel="nofollow">https://securelist.com/zebrocys-multilanguage-malware-salad/90680/</a></li>
<li><a href="https://github.com/MythicAgents/Nimplant">https://github.com/MythicAgents/Nimplant</a></li>
<li><a href="https://github.com/elddy/Nim-SMBExec">https://github.com/elddy/Nim-SMBExec</a></li>
<li><a href="https://github.com/elddy/NimScan">https://github.com/elddy/NimScan</a></li>
</ul>
<h2 dir="auto"><a id="user-content-contributors" aria-hidden="true" href="#contributors"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Contributors</h2>
<p dir="auto">Virtual hug to everyone who contributed <g-emoji alias="heart" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png">❤️</g-emoji></p>
<a href="https://github.com/byt3bl33d3r/OffensiveNim/graphs/contributors">
  <img src="https://camo.githubusercontent.com/6d5d9ff115712f81dca3e4dacb04e23d6d2d9bbf3766c0470d1fc3f2c7ab7fd7/68747470733a2f2f636f6e747269622e726f636b732f696d6167653f7265706f3d62797433626c33336433722f4f6666656e736976654e696d" data-canonical-src="https://contrib.rocks/image?repo=byt3bl33d3r/OffensiveNim"/>
</a>
</article>
          </div></div>
  </body>
</html>
