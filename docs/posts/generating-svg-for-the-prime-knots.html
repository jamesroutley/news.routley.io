<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://prideout.net/blog/svg_knots/">Original</a>
    <h1>Generating SVG for the Prime Knots</h1>
    
    <div id="readability-page-1" class="page"><div>


<p>Soon after I started self-study in <a href="https://en.wikipedia.org/wiki/Knot_theory">Knot Theory</a>, I wanted to design a 24x36 wall poster with knots. I wanted to create it programmatically, starting from nothing but a list of <a href="https://en.wikipedia.org/wiki/Gauss_notation">Gauss Codes</a>. Last weekend I finally found the time. Here’s the result:</p>
<ol type="1">
</ol>
<p><a href="https://prideout.net/blog/svg_knots/knottable_v1.svg"><img src="https://prideout.net/blog/svg_knots/knottable_v1.svg" alt="Knot Theory Wall Poster"/></a></p>
<p>The above image depicts all single-component prime links with 9 or fewer crossings (omitting their mirror images), plus some 10-crossing knots thrown in at the end.</p>
<p>When viewing the SVG image in its own browser tab, you can click any knot to zoom in. You can also redistribute the poster, print it, hack it, whatever; I’m releasing it into the public domain under <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>. You can also download <a href="https://prideout.net/blog/svg_knots/knottable.jpg">this 8192x12288 JPEG</a> (6 MB).</p>
<p>If you print the poster for your classroom or office, consider letting me know. I am <a href="https://twitter.com/prideout">@prideout</a> on twitter. It will make me happy!</p>
<p>SVG is a nice file format for this use case. It’s great at drawing curves, it scales beautifully to any resolution, and doesn’t take much space.</p>
<p>I also love 3D depictions of knots, complete with lighting and specular highlights (<a href="https://prideout.net/knotgl/">see my old WebGL table</a>). However, to a mathematician, knots are more closely related to embeddings of 4-regular planar graphs than they are to real-world knots. For example, Reidemeister moves are one of the first things students learn about, and these moves are defined in the language of 2D knot projections.</p>
<h2 id="how-i-did-it"><a href="#how-i-did-it">How I did it</a></h2>
<p>To create these diagrams, I hacked together a Python pipeline that looks like this:</p>
<p><strong>Gauss Code » Combinatorial Embedding » Half-Edge Structure » Circle Packing » SVG</strong></p>
<p>I obtained the Gauss Codes from <a href="https://knotinfo.math.indiana.edu/">knotinfo</a> at Indiana University. I then added orientation information using a method described by Lou Kauffman in his paper <em>Virtual Knot Theory</em> and created <a href="https://prideout.net/blog/svg_knots/gauss.json">this JSON file with the enhanced Gauss Codes</a>. The result is a list of <em>combinatorial embeddings</em>. At this point in the pipeline, each vertex is associated with a clockwise adjacency list, but actual vertex coordinates have not yet been assigned.</p>
<p>To find the faces in the combinatorial embedding, I found it useful to populate a half-edge data structure. Each face is discovered by winding one step around each 4-degree vertex. <a href="https://prideout.net/blog/svg_knots/combined.json">This JSON file represents the half-edge data structure for each prime knot</a>.</p>
<h2 id="choosing-a-planar-layout"><a href="#choosing-a-planar-layout">Choosing a planar layout</a></h2>
<p>Next, I needed a way to come up with actual vertex coordinates. The classic way to do this is force-based layout. However I had a few interesting requirements:</p>
<ol type="1">
<li>The edges should be represented by continuous curves, not straight lines.</li>
<li>The shadow of the knot (i.e. the 4-regular graph drawing) must have no edge intersections.</li>
<li>Ideally, the layout generator has no random seed or sensitivity to initial conditions, as is often seen in physics-based layout systems.</li>
</ol>
<p>The latter two requirements would be fulfilled with a Tutte Spring Embedding, but the result would not be aesthetically pleasing, nor would it have curved edges.</p>
<p>It turns out that there is a way to generate a nice planar diagram without force-based layout, using a special type of circle packing that preserves the clockwise adjacency list of each vertex. As a bonus, the circle packing is unique to a particular embedding of the knot, making it canonical and easy to reproduce.</p>
<h2 id="circle-packing"><a href="#circle-packing">Circle packing</a></h2>
<p>In William Thurston’s famous <em>Notes</em>, it was proven that any triangulation of a sphere has a corresponding circle packing. Similar results were discovered by E. Andreev and P. Koebe, so this theorem is sometimes referred to as the K-A-T (Koebe-Andreev-Thurston) Theorem. Kenneth Stephenson wrote a nice article about it in the 2003 Notices of the AMS entitled <em>Circle Packing: A Mathematical Tale</em>. In a separate paper, Stephenson and Collins describe an algorithm that consumes a combinatorial embedding of a planar graph and produces a circle packing where the tangency of the circles corresponds perfectly with the graph.</p>
<p>I ended up using Stephenson’s algorithm, but to simplify the rendering, I applied it to the “meta-graph” rather than the original combinatorial embedding. Each face, vertex and edge in the combinatorial embedding becomes a vertex in the meta-graph.</p>
<p>So, applying circle packing in this way produces three types of circles: faces, crossings, and arcs. This is shown below, using the 8<sub>11</sub> knot as an example. Each type of circle is drawn with a different pastel color.</p>
<p><img src="https://prideout.net/blog/svg_knots/hero.svg" alt="The 8 11 Knot with Circles"/><br/>
</p>
<h2 id="details-choosing-the-outer-face"><a href="#details-choosing-the-outer-face">Details: choosing the outer face</a></h2>
<p>The following images are all the 8<sub>11</sub> knot, but with a different face chosen as the outside face. Some of these projections are not ideal because the circles in the outermost layer are much larger than the next-smallest layer. This causes crossings to become lost.</p>
<p><a href="https://prideout.net/blog/svg_knots/8_11a.svg"><img src="https://prideout.net/blog/svg_knots/8_11a.svg" alt="Projection a"/></a> <a href="https://prideout.net/blog/svg_knots/8_11b.svg"><img src="https://prideout.net/blog/svg_knots/8_11b.svg" alt="Projection b"/></a> <a href="https://prideout.net/blog/svg_knots/8_11c.svg"><img src="https://prideout.net/blog/svg_knots/8_11c.svg" alt="Projection c"/></a> <a href="https://prideout.net/blog/svg_knots/8_11d.svg"><img src="https://prideout.net/blog/svg_knots/8_11d.svg" alt="Projection d"/></a> <a href="https://prideout.net/blog/svg_knots/8_11e.svg"><img src="https://prideout.net/blog/svg_knots/8_11e.svg" alt="Projection e"/></a> <a href="https://prideout.net/blog/svg_knots/8_11f.svg"><img src="https://prideout.net/blog/svg_knots/8_11f.svg" alt="Projection f"/></a> <a href="https://prideout.net/blog/svg_knots/8_11g.svg"><img src="https://prideout.net/blog/svg_knots/8_11g.svg" alt="Projection g"/></a> <a href="https://prideout.net/blog/svg_knots/8_11h.svg"><img src="https://prideout.net/blog/svg_knots/8_11h.svg" alt="Projection h"/></a> <a href="https://prideout.net/blog/svg_knots/8_11i.svg"><img src="https://prideout.net/blog/svg_knots/8_11i.svg" alt="Projection i"/></a> <a href="https://prideout.net/blog/svg_knots/8_11j.svg"><img src="https://prideout.net/blog/svg_knots/8_11j.svg" alt="Projection j"/></a></p>
<p>I found that a good heuristic for choosing an outer face is to simply choose a face with a large number of edges.</p>
<h2 id="details-rendering-the-crossings"><a href="#details-rendering-the-crossings">Details: rendering the crossings</a></h2>
<p>2D knot diagrams typically employ a <em>trompe l’oeil</em> effect whereby a gap is used to distinguish an undercrossing from an overcrossing.</p>
<p>To achieve this effect, I did not simply terminate and re-start each cubic Bézier curves at appropriate points near the intersection, because a naive bevel angle does not look great with wide lines. I found it more aesthetically pleasing to render a “whiteout” line on top of the undercrossing and below the overcrossing, as shown below.</p>
<p><a href="https://prideout.net/blog/svg_knots/layers.png"><img src="https://prideout.net/blog/svg_knots/layers.png" alt="Crossing Rendering Layers"/></a></p>
<p>Note that a similar effect could be achieved with SVG’s <code>clipPath</code> facility.</p>
<p>Another detail that you probably noticed is that the thickness varies according to the enclosing circle; this means that I could not merely use SVG strokes, instead I had to convert the strokes into filled areas. To do this I cribbed the offsetting functionality in the <a href="https://github.com/simoncozens/beziers.py">Simon Cozens beziers library</a>.</p>
<p><em>Philip Rideout, 28 July 2020.</em></p>
<h2 id="references"><a href="#references">References</a></h2>
<ol type="1">
<li><p>Bar-Natan, Dror. <em>The Knot Atlas.</em> <a href="http://katlas.org/wiki/Drawing_Planar_Diagrams#How_does_it_work.3F">Drawing Planar Diagrams: How does it work?</a>.</p></li>
<li><p>Collins, Charles R., and Kenneth Stephenson. <em>A circle packing algorithm.</em> Computational Geometry 25.3 (2003): 233-256. <a href="https://prideout.net/blog/svg_knots/circlepack.py">David Eppstein wrote this implementation as part of the PADS library.</a></p></li>
<li><p>Kauffman, Louis H. <em>Virtual knot theory.</em> arXiv preprint math/9811028 (1998). <a href="https://prideout.net/blog/svg_knots/sage_gauss_code.py">Frédéric Chapoton wrote this implementation of the orientation-determination algorithm as part of the SAGE library.</a></p></li>
</ol>

</div></div>
  </body>
</html>
