<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://devblogs.microsoft.com/windows-music-dev/hello-midi-2-0-were-opening-the-repo/">Original</a>
    <h1>Microsoft opens MIDI 2.0 repo</h1>
    
    <div id="readability-page-1" class="page"><div id="featured">

	<div>
                         <p>
            June 19th, 2023</p><!-- .entry-meta -->
        
<p>The updated MIDI 2.0 specifications, which were under MIDI Association and AMEI NDA until a week ago, have been published! This is a huge milestone for the MIDI Association and AMEI, and unlocks a lot of public discussion and work. <strong>Congratulations to all involved!</strong> If I am a bit overzealous with exclamation points in this post, it‚Äôs because I‚Äôve been waiting for and working towards this for a long time. üôÇ</p>
<p><a href="https://midi.org/specifications">Updated MIDI 2.0 Specifications</a></p>
<blockquote>
<p><strong>Why were the specifications under NDA?</strong> Until specifications are fully adopted by the MIDI Association and AMEI, we keep them inside the associations. During the review and approval process, there are always changes, and sometimes those can be small but significant. Keeping them under NDA until the final vote ensures that we don‚Äôt end up with diverging versions of the specification and implementations out in the public and in products. The NDA means that the in-progress specifications can only be shared with voting members of the MIDI Association and AMEI. This really works out in everyone‚Äôs best interest, especially the MIDI user.</p>
</blockquote>
<p><strong>The updated specifications have some important changes.</strong> For example, MIDI-CI protocol negotiation has been deprecated (most other MIDI-CI uses remain), which is a big deal for us because it just didn‚Äôt make sense to handle things that way on a Plug &amp; Play aware OS. There is also the concept of ‚Äúgroupless‚Äù messages (more correctly referred to as ‚Äústream‚Äù messages) for function blocks and other configuration, which fundamentally changes how you might interact with a UMP Endpoint. Lots of goodness in there. Function Blocks are a big section in the specification, and worth the read.</p>
<blockquote>
<p><strong>Function blocks are similar to the USB Group Terminal blocks, but work regardless of transport, and are more flexible overall.</strong> They are discovered within the MIDI protocol rather than through driver or other information. They are not themselves addressable entities, but instead provide context to MIDI groups. In MIDI 1.0 the port (really a virtual cable in the endpoint) is the addressable entity. <strong>In MIDI 2.0, the UMP Endpoint is that addressable entity</strong>, and the groups (conceptually similar to virtual cables) are in the messages as an address on that UMP Endpoint. Function blocks provide useful metadata about the groups and what they support. Prior to the addition of groupless stream messages, one could argue that breaking it all out into ‚Äúports‚Äù, with one port per group per direction, was a reasonable thing to do in MIDI 2.0. The UMP Endpoint addressing approach is something all of us in the working groups have come to agreement on over the past year. <strong>This is important so you know why the API and SDK include UMP Endpoints, but not input/output ports, and why function blocks and group terminal blocks are metadata.</strong> It also helps provide some context to the group&lt;-&gt;port mapping we‚Äôll provide to the legacy MIDI 1.0 APIs, and why those APIs cannot access groupless messages.</p>
</blockquote>
<p><strong>Through the various working groups, we‚Äôve had a lot of input into these specifications, and are really happy with how they‚Äôve ended up.</strong> There were many people involved, but a huge thank you to Mike Kent, Andrew Mee, and of course, Athan Billias for their hard work there. Leading the process of specification authoring and voting, across organizations, is a ton of work ‚Äî not to mention actually writing it all while we nitpick on terms like ‚ÄúUMP Endpoint‚Äù vs ‚ÄúEndpoint‚Äù vs ‚ÄúUSB Endpoint‚Äù üôÇ</p>
<p><strong>Note that the USB MIDI 2.0 specification also needs to be updated in a few areas</strong>, but hasn‚Äôt yet (the USB-IF controls the document, so it has a very different revision process). Instead, the different OS companies and other stakeholders <a href="https://www.midi.org/midi/midi-articles/midi-is-about-collaboration-not-competition">have gotten together</a> in the working groups in the MIDI Association to ensure we‚Äôre all creating compatible devices and drivers. If you are considering creating a USB implementation, I highly encourage you to <a href="https://aka.ms/midiorgjoin">join the MIDI association so you have access to all the discussions and best practices which have evolved</a>.</p>
<p>In the MIDI Association, we‚Äôre also working on a developer guide which contains some guidance above and beyond the specifications. It contains things like how to deal with Group Terminal Blocks and Function Blocks when both are present, how multi-client works on the different operating systems, the <a href="https://devblogs.microsoft.com/windows-music-dev/the-importance-of-including-a-unique-iserialnumber-in-your-usb-midi-devices/">importance of unique identifiers</a>, naming, and much more.</p>
<p>Beyond that, in the MIDI Association, we‚Äôre also quickly converging on a really good Network MIDI 2.0 standard. As ubiquitous as USB MIDI is, I‚Äôm especially excited about Network MIDI 2.0 because it has the potential to move us away from length limitations in USB cables, and is simple for devices to implement. Of course, our implementation of that will also be fully open source, so anyone who wants to refer to it or use it on their devices can do so.</p>
<blockquote>
<p>If you are creating a commercial MIDI 2.0 product of any sort, you should become a corporate member of the MIDI Association. You‚Äôll have access to the corporate member forums, visibility into in-development standards, the ability to shape MIDI 2.0, and if your product qualifies, the right to use the MIDI logo. <a href="https://aka.ms/midiorgjoin">You can apply here</a></p>
</blockquote>
<h2 id="opening-the-repo">Opening the repo</h2>
<p>The first thing the publishing of the specifications allows is opening of our repo to the public. As you can imagine, being an open source project, but with a closed repo, was not a great combination. We had invited AMEI and MIDI Association members to it, but it‚Äôs really the public community of developers we want this to be visible to.</p>
<p>You can find the repo here, but before you click, I encourage you to read on so you know what you‚Äôre looking at/for.</p>
<p><a href="https://aka.ms/midirepo">Microsoft MIDI Github Repo</a></p>
<blockquote>
<p>Before you visit the repo, read on so you know what to look at and have the right expectations about where we are in development.</p>
</blockquote>
<h3 id="what-does-this-mean">What does this mean?</h3>
<p>Opening the repo is the first step in a larger musician community-focused and evergreen implementation of MIDI on Windows. We still have a lot of ground to cover, but by opening the repo, you can join us on the journey, provide feedback, and help us help you.</p>
<h3 id="how-open-is-this-project-really">How open is this project, really?</h3>
<p>Microsoft has gotten so much better with integrating and supporting open source over the years. We have internal guidance that encourages openness while protecting our products. We have groups we can ask questions to, and legal advisors who help us make sure we‚Äôre always doing the right thing. Nevertheless, creating a truly open source project for something which deeply integrates with Windows, which is not open source as you know, has been a small but welcome challenge for all of us.</p>
<p><strong>By default, we are open source for everything which can be</strong>, even going so far as to create clean-room versions of code when there‚Äôs any question about what can or can‚Äôt be OSS (this has happened with some of the code already, and also BLE MIDI 1.0 will be redone in this way). We‚Äôre not open sourcing so that we can dump this on the community (I know that is something the community is always concerned about, and rightly so), but instead <strong>so we can engage the developer community, get feedback, enable deep insight into what‚Äôs happening, and share MIDI 2.0 with the rest of the world in the most useful way possible.</strong></p>
<blockquote>
<p>Of course, we also have signing and HLK/testing/certification requirements which have to happen outside of the repo, but our intent here is to make sure everything in the repo is buildable by you, and if you want to bypass driver signing on your own developer PC, using a supported version of Windows, you can run it all right from the repo.</p>
</blockquote>
<p>This project is not being designed explicitly as a cross-platform project (at the interface layers, it has a lot of ‚ÄúWindows‚Äù in there like COM and WinRT), but <strong>we want to make it as easy as possible to port this</strong> in whole or in part to other operating systems should you want to. So no license blockers there, and the implementation is all in the repo. Finally, we want to be as open as possible here so you can see what‚Äôs actually happening in the code, and provide bug reports, issues, PRs, and suggestions on how we could do things better.</p>
<p><strong>Although our intent is to make it so creating drivers for new transports is a thing of the past,</strong> the USB MIDI 2.0 class driver being OSS will also help companies who do need to create a custom version of the Kernel driver to, for example, synchronize with audio in the same device. If that‚Äôs in your plans, talk to me, so we can best support the work.</p>
<blockquote>
<p>Creating Kernel drivers is a lot of work, and a real skill. Many of the things C++ developers are used to having available in user mode and simply not available in kernel mode (like most of the standard library, for example). It also brings with it high testing, signing, and compatibility requirements. The new transport plugin model (the service abstractions and settings apps plugins) means that this is no longer necessary for MIDI unless you must have direct access to kernel streaming and similar interfaces. So, for example, a Thunderbolt or PCIe device which doesn‚Äôt use the USB class driver may need a custom driver, but virtual, network, Bluetooth, and others can be user-mode and use existing APIs in Windows to communicate with the devices. This makes development a lot easier, especially because the abstractions (service plugin interfaces) can be used during development directly from your test code.</p>
</blockquote>
<h2 id="how-we-are-developing">How we are developing</h2>
<p>There are different teams involved in creation of the full MIDI 2.0 stack, from AMEI and AmeNote, to Windows Silicon, Graphics &amp; Audio (SiGMa), to my APS team in Windows, and the even MIDI Association itself with its open source libraries, and we each have different development styles, preferred tools, etc. Rather than try to enforce one approach across all contributing teams, as we work towards the initial release and all the infrastructure it involves, <strong>we are embracing those tools, processes, and patterns which make us the most productive.</strong> For clarity, here are the major items and how they are developed:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Language</th>
<th>Approach</th>
</tr>
</thead>
<tbody>
<tr>
<td>USB MIDI 2.0 Driver</td>
<td>C/C++ Kernel Code</td>
<td>AmeNote is developing on their own systems and sending snapshots to our repo when they hit milestones. After the intial release, it will be managed within the repo entirely. There will still be signing and validation steps which have to happen outside the repo, so revisions to this will be somewhat slower to get out as signed binaries vs other parts of this project.</td>
</tr>
<tr>
<td>MIDI Service and Abstraction Layers</td>
<td>C++ / COM</td>
<td>The Audio team is working on this using our internal repo and their current tools. This just makes it easier for them to develop and to stay conformant with requirements for shipping in-box in the future. Snapshots are sent to the Github repo. Currently, the structure there reflects the internal branch structure rather than the overall public repo structure, and I‚Äôve encouraged the team to keep it that way for now for efficiency. As we get closer to release (and after release) we will revisit as appropriate to ensure PRs and other community-driven work are best incorporated.</td>
</tr>
<tr>
<td>New MIDI API</td>
<td>C++ / COM + WinRT</td>
<td>Same approach as the MIDI Service and Abstraction layers</td>
</tr>
<tr>
<td>MIDI App SDK</td>
<td>C++ / WinRT</td>
<td>This is developed 100% on Github. The SDK is the friendly app-focused interface into the API. We recommend all apps use this rather than directly talk to the API. The SDK is shipped with applications, not with the OS, so the requirements are a little different. It will also rev more often than the API or service code and be available through popular package managers. The SDK also makes use of some MIT-licensed MIDI Association libraries for message conversion and more. This helps us stay consistent with everyone.</td>
</tr>
<tr>
<td>MIDI Transports Settings Plugins</td>
<td>C# / .NET</td>
<td>This is developed 100% on Github. It provides the client-side code to manage runtime-creatable transports like Virtual and Network, as well as UI for the same. The app SDK includes calls which apps can use to pop up or navigate to these pages in the settings app to allow for configuration while using the DAW or other program.</td>
</tr>
<tr>
<td>MIDI Settings App</td>
<td>C#/.NET (and C#/WinRT)</td>
<td>100% on Github.</td>
</tr>
<tr>
<td>MIDI Command-line Tools</td>
<td>C#/.NET (and C#/WinRT)</td>
<td>Also 100% on Github.</td>
</tr>
<tr>
<td>USB MIDI 2.0 Transport</td>
<td>C++ / COM</td>
<td>Currently this is developed like the service and abstraction layers.</td>
</tr>
<tr>
<td>Other Transports and Plugins</td>
<td>C++ / COM</td>
<td>The other transports and message manipulation plugins do not require kernel model code and testing, and so are developed here on Github</td>
</tr>
<tr>
<td>Prototype Transports</td>
<td>C++ / COM</td>
<td>Prototype work, like Network MIDI 2.0, is covered under NDA with the MIDI Association, and so is not on this repo. Once the transport is published, we move the code here.</td>
</tr>
<tr>
<td>Windows Changes</td>
<td>C / C++</td>
<td>Any changes to Windows (like some USB Stack changes we had to make to support this, and shims for the older APIs) are in our internal code base and shipped with Windows. They are not part of this repo. This is a small amount of critical code for things like loading the correct class driver, using the driver framework, etc.</td>
</tr>
<tr>
<td>Documentation and Samples</td>
<td>Markdown</td>
<td>Developed on Github, some or all of which later be published on Microsoft Learn.</td>
</tr>
</tbody>
</table>
<p>Outside contributions will conform to the style for the project they contribute to.</p>
<p>There‚Äôs more detail on the planned release mechanisms and more on the main README on Github. Of course, we remain flexible and may change approach at any time in order to best meet the requirements of the project, especially after the initial release.</p>
<p>Finally, we‚Äôve been prototyping a LOT over the past months, so if you find something weird in the repo, just let me know. There may be corners we haven‚Äôt yet swept out, but need to.</p>
<h2 id="what-about-pull-requests-issues-discussion">What about Pull Requests? Issues? Discussion?</h2>
<p>Without code you can test, it‚Äôs a little early for PRs and Issues, but we welcome them now and in the future. If you are a developer and find issues, we encourage you to use Github for feedback. For users, and for general discussion, please join our Discord Server here:</p>
<p><a href="https://aka.ms/MidiDiscord">Windows MIDI Services Discord</a></p>
<p>In the future, we‚Äôll also have examples, docs, and tools available in the repo to help you get set up to contribute code.</p>
<h2 id="setting-expectations-whats-there">Setting Expectations ‚Äì What‚Äôs there?</h2>
<p><strong>To date, we‚Äôve spent a lot of time on prototyping and architecture, and have settled on the approaches we‚Äôre using throughout the new Windows MIDI Services.</strong> During that time, some key concepts were also changing (perhaps ‚Äúclarifying‚Äù would be more appropriate) in MIDI 2.0, so we also revisited some of our ideas for things like addressing. We also had a ton of work to do to ensure the MIDI 2.0 Class Driver will work on Windows. (As it turns out, our USB Audio 2 class driver claimed MIDI 2.0 compatibility, accidentally. Oops. And also we have more complications due to our MIDI 1.0 and USB Audio 1.0 class drivers being the same driver file.) So now that we have those sorted in internal branches, we can continue on.</p>
<p>Today, the repo does not yet have anything super interesting for folks looking to actually <strong>try things out</strong>. Lots of stub work, empty calls, etc. I will continue to update everyone as we hit development milestones, especially as we get closer to developer previews this summer and fall, and our first release this year. My latest code is typically in the <code>pete-dev</code> branch, but that <del>will likely</del> may not build. I PR to main when something builds and is worth looking at. We‚Äôre not yet at the point where something in the SDK has to pass unit tests to go to main, but we are doing that with the service. <strong>For now. treat the entire app SDK as though it has [experimental] on everything.</strong></p>
<p>In addition to the root README, here are some other things you may want to look at <strong>(not direct links, just paths on the repo for you to explore as you will)</strong></p>
<ul>
<li>The license and our intent behind it <code>FAQ-License-and-Intent.md</code></li>
<li>App developer sample code: <code>get-started/midi-developers/app-developers/samples/cpp-winrt/sdk-client-basics</code></li>
<li>Programming languages FAQ <code>get-started/midi-developers/FAQ-Programming-Languages.md</code></li>
<li>App SDK ‚Äúshape‚Äù. Happy to field questions on this on Discord. <code>src/app-dev-sdk</code></li>
<li>WIP version of the Windows Service and abstractions. We‚Äôll have a newer version of this on Github soon. <code>src/service</code></li>
<li>WIP version of the USB driver (this is an older rev built for demo use without the service. New version coming soon) <code>src/usb-driver/USB-UMPDriver/USB-UMPDriver</code></li>
</ul>
<p>The items in the repo today are items we intend to deliver. We‚Äôve done a LOT of disposable prototyping work over the past months, and have learned a lot in the process. For example, the early Network MIDI 2.0 transport we had at the NAMM show, and early service, API, and SDK ideation and high-performance buffer testing.</p>
<p><img decoding="async" src="https://devblogs.microsoft.com/windows-music-dev/wp-content/uploads/sites/63/2023/06/namm-settings-prototype-network2-scaled.jpg" alt="Network MIDI 2.0 in the Settings app. MIDI workbench on the left, Windows MIDI Services Settings on the right"/> <em>Demo created for the NAMM Show and prototyping meet-up with Network MIDI 2.0 in the Windows MIDI Services Settings app. The MIDI Association‚Äôs MIDI workbench on the lower left, Windows MIDI Services Settings on the right. Messages communicated across UDP using the Network MIDI 2.0 draft protocol. At the NAMM show we also had the USB MIDI 2.0 driver on display, with MIDI Workbench, communicating to the AmeNote ProtoZOA over USB MIDI 2.0</em></p>
<blockquote>
<p>You can view our Windows MIDI Services feature backlog and milestones in the <a href="https://aka.ms/midiproject">GitHub project here</a>. This is where you‚Äôll find the important milestones and the big features. I don‚Äôt like to micromanage projects, but if there‚Äôs something you‚Äôre especially interested in which doesn‚Äôt show up, let me know through a feature request on GitHub and I will consider adding it to the appropriate milestone.</p>
</blockquote>
<h2 id="repo-practices">Repo Practices</h2>
<p>The repo is vanilla at the moment, not using much of the new hotness in various areas. We will add CI/CD and automated testing as things stabilize. I‚Äôve been speaking to others on my team to learn some of their best practices (the team I‚Äôm on also owns the various Community Toolkit projects and we have a ton of collective OSS experience in my org). But if you see something specific missing that you really think we should do to make the repo more efficient or friendlier to contributors or interested parties, please let me know by opening an issue on GitHub.</p>
<h2 id="what-next">What next?</h2>
<p><strong>The team is continuing to work on the core infrastructure for Windows MIDI Services</strong>, including the Windows service, the RPC calls into the service, the required abstraction layers, kernel streaming integration for drivers, the USB driver itself, and the API which surfaces all that to the SDK and through that to apps. We‚Äôre planning several milestones for developer-focused previews with different features enabled.</p>
<p>We have a huge backlog of features we plan to implement, and this project model enables us to do continue to implement and innovate after our first release. We won‚Äôt get everything done for day 1, and that is part of the plan. Instead, we want to make sure we are well set up to innovate and iterate on this going forward.</p>
<p>Here‚Äôs the current <strong>tentative</strong> schedule</p>
<table>
<thead>
<tr>
<th>Milestone</th>
<th>Tentative date</th>
</tr>
</thead>
<tbody>
<tr>
<td>First developer release</td>
<td>August 2023</td>
</tr>
<tr>
<td>Second developer release</td>
<td>October 2023</td>
</tr>
<tr>
<td>1.0 release</td>
<td>By end of 2023</td>
</tr>
<tr>
<td>1.1 update</td>
<td>Early 2024</td>
</tr>
</tbody>
</table>
<p><strong>Again, those dates are tentative, because we are quality driven on this.</strong> I know many of you who are, but if you are developing a commercial product and need to snap to specific dates and have not reached out to me, <strong>please do so as PM in Discord or through my email pete dot brown at Microsoft dot com.</strong> As we hit a release cadence, I‚Äôll post updates on the repo and on Discord.</p>
<p>Were continuing down the path for a first release this year, covering all the core MIDI 2.0 requirements we have from working with software developers, manufacturers, the MIDI Association, AMEI, and more. <strong>Our primary focus for the first release is around those core capabilities, excellent performance, and reliability.</strong> Backwards compatibility with the existing WinRT and WinMM APIs will follow shortly after the 1.0 release, and the tools will be minimal at first.</p>
<p><strong>Those early releases will be out-of-band shipments until we‚Äôre sure the API is in a state that anything else we need to add won‚Äôt break compatibility or performance.</strong> (We did something similar with WinRT MIDI in the early days where it was a NuGet package until we rolled it into Windows 10.) After that, we‚Äôll start shipping the API and Service in-box with Windows. We expect most of the development will then turn to those pieces which will continue to ship with apps or out of band: the end-user tools, SDK, plugins, etc.</p>
<p><a href="https://aka.ms/midirepo">Microsoft MIDI Github Repo</a></p>
<p><strong>Thanks again to the MIDI Association and to AMEI for their collaboration throughout this project!</strong></p>
<p><strong>And thank you for joining us on this journey.</strong> We know that everything about this from spec approval through to implementation has taken quite a bit longer than planned, but we are committed to having an amazing MIDI 2.0 experience on Windows, and improving everything about MIDI 1.0 at the same time.</p>
<p>A few related blog posts</p>
<ul>
<li><a href="https://devblogs.microsoft.com/windows-music-dev/the-importance-of-including-a-unique-iserialnumber-in-your-usb-midi-devices/">The importance of including a unique iSerialNumber in your USB MIDI Devices</a></li>
<li><a href="https://devblogs.microsoft.com/windows-music-dev/the-new-windows-midi-services-spring-2023-update/">The new Windows MIDI Services ‚Äì Spring 2023 Update</a></li>
<li><a href="https://devblogs.microsoft.com/windows-music-dev/midi-40-and-the-new-windows-midi-services/">MIDI @ 40 and the new Windows MIDI Services</a></li>
</ul>

        

		
        <div>        <div>

            <p><img width="60" height="60" data-src="https://devblogs.microsoft.com/windows-music-dev/wp-content/uploads/sites/63/2021/11/S9jrOKBY_400x400-96x96.jpg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAA1BMVEXW1taWrGEgAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAFElEQVQ4jWNgGAWjYBSMglFATwAABXgAAfmlXscAAAAASUVORK5CYII=" alt="" decoding="async" data-srcset="https://devblogs.microsoft.com/windows-music-dev/wp-content/uploads/sites/63/2021/11/S9jrOKBY_400x400-96x96.jpg 96w, https://devblogs.microsoft.com/windows-music-dev/wp-content/uploads/sites/63/2021/11/S9jrOKBY_400x400-300x300.jpg 300w, https://devblogs.microsoft.com/windows-music-dev/wp-content/uploads/sites/63/2021/11/S9jrOKBY_400x400-150x150.jpg 150w, https://devblogs.microsoft.com/windows-music-dev/wp-content/uploads/sites/63/2021/11/S9jrOKBY_400x400-24x24.jpg 24w, https://devblogs.microsoft.com/windows-music-dev/wp-content/uploads/sites/63/2021/11/S9jrOKBY_400x400-48x48.jpg 48w, https://devblogs.microsoft.com/windows-music-dev/wp-content/uploads/sites/63/2021/11/S9jrOKBY_400x400.jpg 400w" sizes="(max-width: 60px) 100vw, 60px"/></p>
            <h3>
                <a data-bi-id="author follow within post" data-bi-area="" data-bi-name="Pete Brown" aria-label="Pete Brown" href="https://devblogs.microsoft.com/windows-music-dev/author/petebrown">
                    Pete Brown                </a>
                <span>Principal Software Engineer, Windows + Devices (APS)</span>
            </h3>
            
       </div>
        </div>
	</div><!-- .entry-content -->

</div></div>
  </body>
</html>
