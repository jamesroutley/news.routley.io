<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/serpapi/nokolexbor">Original</a>
    <h1>Nokolexbor: Drop-in replacement for Nokogiri. 5.2x faster at parsing HTML</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><a href="https://github.com/serpapi/nokolexbor/actions/workflows/ci.yml"><img src="https://github.com/serpapi/nokolexbor/actions/workflows/ci.yml/badge.svg" alt="CI"/></a></p>
<p dir="auto">Nokolexbor is a drop-in replacement for Nokogiri. It&#39;s 5.2x faster at parsing HTML and up to 997x faster at CSS selectors.</p>
<p dir="auto">It&#39;s a performance-focused HTML5 parser for Ruby based on <a href="https://github.com/lexbor/lexbor/">Lexbor</a>. It supports both CSS selectors and XPath. Nokolexbor&#39;s API is designed to be 1:1 compatible as much as possible with <a href="https://github.com/sparklemotion/nokogiri">Nokogiri&#39;s API</a>.</p>

<p dir="auto">Nokolexbor is shipped with pre-compiled gems on most common platforms:</p>
<ul dir="auto">
<li>Linux: <code>x86_64</code>, with glibc &gt;= 2.17</li>
<li>macOS: <code>x86_64</code> and <code>arm64</code></li>
<li>Windows: <code>ucrt64</code>, <code>mingw32</code> and <code>mingw64</code></li>
</ul>
<p dir="auto">If you are on a supported platform, just jump to the <a href="#installation">Installation</a> section. Otherwise, you need to install CMake to compile C extensions:</p>


<div dir="auto"><h3 tabindex="-1" dir="auto">Linux (Debian, Ubuntu, etc.)</h3><a id="user-content-linux-debian-ubuntu-etc" aria-label="Permalink: Linux (Debian, Ubuntu, etc.)" href="#linux-debian-ubuntu-etc"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div data-snippet-clipboard-copy-content="sudo apt-get install cmake"><pre><code>sudo apt-get install cmake
</code></pre></div>

<p dir="auto">Add to your Gemfile:</p>

<p dir="auto">Then, run <code>bundle install</code>.</p>
<p dir="auto">Or, install the gem directly:</p>


<div dir="auto" data-snippet-clipboard-copy-content="require &#39;nokolexbor&#39;
require &#39;open-uri&#39;

# Parse HTML document
doc = Nokolexbor::HTML(URI.open(&#39;https://github.com/serpapi/nokolexbor&#39;))

# Search for nodes by css
doc.css(&#39;#readme h1&#39;, &#39;article h2&#39;, &#39;p[dir=auto]&#39;).each do |node|
  puts node.content
end

# Search for text nodes by css
doc.css(&#39;#readme p &gt; ::text&#39;).each do |text|
  puts text.content
end

# Search for nodes by xpath
doc.xpath(&#39;//div[@id=&#34;readme&#34;]//h1&#39;, &#39;//article//h2&#39;).each do |node|
  puts node.content
end"><pre><span>require</span> <span>&#39;nokolexbor&#39;</span>
<span>require</span> <span>&#39;open-uri&#39;</span>

<span># Parse HTML document</span>
<span>doc</span> <span>=</span> <span>Nokolexbor</span>::<span>HTML</span><span>(</span><span>URI</span><span>.</span><span>open</span><span>(</span><span>&#39;https://github.com/serpapi/nokolexbor&#39;</span><span>)</span><span>)</span>

<span># Search for nodes by css</span>
<span>doc</span><span>.</span><span>css</span><span>(</span><span>&#39;#readme h1&#39;</span><span>,</span> <span>&#39;article h2&#39;</span><span>,</span> <span>&#39;p[dir=auto]&#39;</span><span>)</span><span>.</span><span>each</span> <span>do</span> |<span>node</span>|
  <span>puts</span> <span>node</span><span>.</span><span>content</span>
<span>end</span>

<span># Search for text nodes by css</span>
<span>doc</span><span>.</span><span>css</span><span>(</span><span>&#39;#readme p &gt; ::text&#39;</span><span>)</span><span>.</span><span>each</span> <span>do</span> |<span>text</span>|
  <span>puts</span> <span>text</span><span>.</span><span>content</span>
<span>end</span>

<span># Search for nodes by xpath</span>
<span>doc</span><span>.</span><span>xpath</span><span>(</span><span>&#39;//div[@id=&#34;readme&#34;]//h1&#39;</span><span>,</span> <span>&#39;//article//h2&#39;</span><span>)</span><span>.</span><span>each</span> <span>do</span> |<span>node</span>|
  <span>puts</span> <span>node</span><span>.</span><span>content</span>
<span>end</span></pre></div>

<ul dir="auto">
<li>Nokogiri-compatible APIs.</li>
<li>High performance HTML parsing, DOM manipulation and CSS selectors engine.</li>
<li>XPath search engine (ported from libxml2).</li>
<li>Text nodes CSS selector support: <code>::text</code>.</li>
</ul>
<div dir="auto"><h2 tabindex="-1" dir="auto">Searching methods overview</h2><a id="user-content-searching-methods-overview" aria-label="Permalink: Searching methods overview" href="#searching-methods-overview"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><code>css</code> and <code>at_css</code>
<ul dir="auto">
<li>Based on Lexbor.</li>
<li>Only accepts CSS selectors, doesn&#39;t support mixed syntax like <code>div#abc /text()</code>.</li>
<li>To select text nodes, use pseudo element <code>::text</code>. e.g. <code>div#abc &gt; ::text</code>.</li>
<li>Performance is much higher than libxml2 based methods.</li>
</ul>
</li>
<li><code>xpath</code> and <code>at_xpath</code>
<ul dir="auto">
<li>Based on libxml2.</li>
<li>Only accepts XPath syntax.</li>
<li>Works in the same way as Nokogiri&#39;s <code>xpath</code> and <code>at_xpath</code>.</li>
</ul>
</li>
<li><code>nokogiri_css</code> and <code>nokogiri_at_css</code> (requires Nokogiri installed)
<ul dir="auto">
<li>Based on libxml2.</li>
<li>Accept mixed syntax like <code>div#abc /text()</code>.</li>
<li>Works in the same way as Nokogiri&#39;s <code>css</code> and <code>at_css</code>.</li>
</ul>
</li>
</ul>
<div dir="auto"><h2 tabindex="-1" dir="auto">Different behaviors from Nokogiri</h2><a id="user-content-different-behaviors-from-nokogiri" aria-label="Permalink: Different behaviors from Nokogiri" href="#different-behaviors-from-nokogiri"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>
<p dir="auto">For selector <code>:nth-of-type(n)</code>, <code>n</code> is not affected by prior filter. For example, if we want to select the 3rd <code>div</code> excluding class <code>a</code> and class <code>b</code>, which will be the last <code>div</code> in the following HTML:</p>
<div data-snippet-clipboard-copy-content="&lt;body&gt;
  &lt;div&gt;&lt;/div&gt;
  &lt;div class=&#34;a&#34;&gt;&lt;/div&gt;
  &lt;div class=&#34;b&#34;&gt;&lt;/div&gt;
  &lt;div&gt;&lt;/div&gt;
  &lt;div&gt;&lt;/div&gt;
&lt;/body&gt;"><pre><code>&lt;body&gt;
  &lt;div&gt;&lt;/div&gt;
  &lt;div class=&#34;a&#34;&gt;&lt;/div&gt;
  &lt;div class=&#34;b&#34;&gt;&lt;/div&gt;
  &lt;div&gt;&lt;/div&gt;
  &lt;div&gt;&lt;/div&gt;
&lt;/body&gt;
</code></pre></div>
<p dir="auto">In Nokogiri, the selector should be <code>div:not(.a):not(.b):nth-of-type(3)</code></p>
<p dir="auto">In Nokolexbor, <code>:not</code> does affect the place of the last <code>div</code> (same in browsers), the selector should be <code>div:not(.a):not(.b):nth-of-type(5)</code>, but this losts the purpose of filtering though.</p>
</li>
</ul>

<p dir="auto">Benchmark parsing google result page (368 KB) and selecting nodes using CSS and XPath. Run on MacBook Pro (2019) 2.3 GHz 8-Core Intel Core i9.</p>
<p dir="auto">Run with: <code>ruby bench/bench.rb</code></p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th></th>
<th>Nokolexbor (iters/s)</th>
<th>Nokogiri (iters/s)</th>
<th>Diff</th>
</tr>
</thead>
<tbody>
<tr>
<td>parsing</td>
<td>487.6</td>
<td>93.5</td>
<td>5.22x faster</td>
</tr>
<tr>
<td>at_css</td>
<td>50798.8</td>
<td>50.9</td>
<td>997.87x faster</td>
</tr>
<tr>
<td>css</td>
<td>7437.6</td>
<td>52.3</td>
<td>142.11x faster</td>
</tr>
<tr>
<td>at_xpath</td>
<td>57.077</td>
<td>53.176</td>
<td>same-ish</td>
</tr>
<tr>
<td>xpath</td>
<td>51.523</td>
<td>58.438</td>
<td>same-ish</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<details>
<summary>Raw data</summary>
<div data-snippet-clipboard-copy-content="Warming up --------------------------------------
    Nokolexbor parse    56.000  i/100ms
      Nokogiri parse     8.000  i/100ms
Calculating -------------------------------------
    Nokolexbor parse    487.564  (±10.9%) i/s -      9.688k in  20.117173s
      Nokogiri parse     93.470  (±21.4%) i/s -      1.736k in  20.024163s

Comparison:
    Nokolexbor parse:      487.6 i/s
      Nokogiri parse:       93.5 i/s - 5.22x  (± 0.00) slower

Warming up --------------------------------------
   Nokolexbor at_css     5.548k i/100ms
     Nokogiri at_css     6.000  i/100ms
Calculating -------------------------------------
   Nokolexbor at_css     50.799k (±13.8%) i/s -    987.544k in  20.018481s
     Nokogiri at_css     50.907  (±35.4%) i/s -    828.000  in  20.666258s

Comparison:
   Nokolexbor at_css:    50798.8 i/s
     Nokogiri at_css:       50.9 i/s - 997.87x  (± 0.00) slower

Warming up --------------------------------------
      Nokolexbor css   709.000  i/100ms
        Nokogiri css     4.000  i/100ms
Calculating -------------------------------------
      Nokolexbor css      7.438k (±14.7%) i/s -    145.345k in  20.083833s
        Nokogiri css     52.338  (±36.3%) i/s -    816.000  in  20.042053s

Comparison:
      Nokolexbor css:     7437.6 i/s
        Nokogiri css:       52.3 i/s - 142.11x  (± 0.00) slower

Warming up --------------------------------------
 Nokolexbor at_xpath     2.000  i/100ms
   Nokogiri at_xpath     4.000  i/100ms
Calculating -------------------------------------
 Nokolexbor at_xpath     57.077  (±31.5%) i/s -    920.000  in  20.156393s
   Nokogiri at_xpath     53.176  (±35.7%) i/s -    876.000  in  20.036717s

Comparison:
 Nokolexbor at_xpath:       57.1 i/s
   Nokogiri at_xpath:       53.2 i/s - same-ish: difference falls within error

Warming up --------------------------------------
    Nokolexbor xpath     3.000  i/100ms
      Nokogiri xpath     3.000  i/100ms
Calculating -------------------------------------
    Nokolexbor xpath     51.523  (±31.1%) i/s -    903.000  in  20.102568s
      Nokogiri xpath     58.438  (±35.9%) i/s -    852.000  in  20.001408s

Comparison:
      Nokogiri xpath:       58.4 i/s
    Nokolexbor xpath:       51.5 i/s - same-ish: difference falls within error"><pre><code>Warming up --------------------------------------
    Nokolexbor parse    56.000  i/100ms
      Nokogiri parse     8.000  i/100ms
Calculating -------------------------------------
    Nokolexbor parse    487.564  (±10.9%) i/s -      9.688k in  20.117173s
      Nokogiri parse     93.470  (±21.4%) i/s -      1.736k in  20.024163s

Comparison:
    Nokolexbor parse:      487.6 i/s
      Nokogiri parse:       93.5 i/s - 5.22x  (± 0.00) slower

Warming up --------------------------------------
   Nokolexbor at_css     5.548k i/100ms
     Nokogiri at_css     6.000  i/100ms
Calculating -------------------------------------
   Nokolexbor at_css     50.799k (±13.8%) i/s -    987.544k in  20.018481s
     Nokogiri at_css     50.907  (±35.4%) i/s -    828.000  in  20.666258s

Comparison:
   Nokolexbor at_css:    50798.8 i/s
     Nokogiri at_css:       50.9 i/s - 997.87x  (± 0.00) slower

Warming up --------------------------------------
      Nokolexbor css   709.000  i/100ms
        Nokogiri css     4.000  i/100ms
Calculating -------------------------------------
      Nokolexbor css      7.438k (±14.7%) i/s -    145.345k in  20.083833s
        Nokogiri css     52.338  (±36.3%) i/s -    816.000  in  20.042053s

Comparison:
      Nokolexbor css:     7437.6 i/s
        Nokogiri css:       52.3 i/s - 142.11x  (± 0.00) slower

Warming up --------------------------------------
 Nokolexbor at_xpath     2.000  i/100ms
   Nokogiri at_xpath     4.000  i/100ms
Calculating -------------------------------------
 Nokolexbor at_xpath     57.077  (±31.5%) i/s -    920.000  in  20.156393s
   Nokogiri at_xpath     53.176  (±35.7%) i/s -    876.000  in  20.036717s

Comparison:
 Nokolexbor at_xpath:       57.1 i/s
   Nokogiri at_xpath:       53.2 i/s - same-ish: difference falls within error

Warming up --------------------------------------
    Nokolexbor xpath     3.000  i/100ms
      Nokogiri xpath     3.000  i/100ms
Calculating -------------------------------------
    Nokolexbor xpath     51.523  (±31.1%) i/s -    903.000  in  20.102568s
      Nokogiri xpath     58.438  (±35.9%) i/s -    852.000  in  20.001408s

Comparison:
      Nokogiri xpath:       58.4 i/s
    Nokolexbor xpath:       51.5 i/s - same-ish: difference falls within error
</code></pre></div>
</details>
</article></div></div>
  </body>
</html>
