<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://vimota.me/writing/gpt3-klaviyo-automation">Original</a>
    <h1>Using GPT3, Supabase and Pinecone to automate a personalized marketing campaign</h1>
    
    <div id="readability-page-1" class="page"><article><div><p><strong>tldr;</strong> With GPT-3, Supabase, Pinecone, and Klaviyo, I built a semantic embeddings search that saved hundreds of hours of manual work for my girlfriends skincare brand (<a href="http://olivercare.co">Oliver Care</a>).</p>
<p>It actually worked way better than I expected - this is how I did it:</p>
<p>First some context. My girlfriend, <a href="https://twitter.com/mariaaacasa">Maria</a>, started Oliver Care with the goal of creating a brand that educates people on the risks of Endocrine Disrupting Chemicals (EDCs) in every day items and sells EDC-free products.</p>
<p>As one of her marketing campaigns, she had the idea of doing a personalized EDC report where anyone could send in their daily routines and she&#39;d look at each item and identify which contained EDCs and make suggestions.</p>
<p>At first she&#39;d get a couple a day, from <a href="https://www.tiktok.com/@olivercareco">her TikTok following</a>, but that quickly grew to thousands ðŸ˜³</p>
<p><img src="https://vimota.me/static/edcreport1.jpg" alt="EDC report form"/></p>
<p>At that point, we realized she&#39;d have to automate it somehow. I quickly pulled all the data together, and started writing up a python script.</p>
<p>We had all the email addresses and their submitted routines in Klaviyo which I exported to Supabase. I got her to put down the most popular products she had already seen and her response to each and loaded as well.</p>
<p><img src="https://vimota.me/static/edcreport2.jpg" alt="Common products and their EDC content"/></p>
<p>I was hoping I&#39;d be able to write a quick script to do some regex parsing and use the <code>pg_trgm</code> extension on Supabase to look up each product in a person&#39;s routine and match it to a product responses she&#39;d filled in.</p>
<p>That worked exactly as expected - text search is actually super easy with Postgres.</p>
<p>... But text search isn&#39;t really enough. People would send in product names formatted in all types of ways. And there&#39;s multiple names for the same product. Text search isn&#39;t really well suited to that.</p>
<p>Next I thought, maybe GPT-3 could automate this completely.</p>
<p><img src="https://vimota.me/static/gpt3-1.png" alt="GPT-3 correctly identifying a match"/>
<img src="https://vimota.me/static/gpt3-2.png" alt="GPT-3 correctly identifying no nmatches"/></p>
<p>And it pretty much worked! Using prompts to find matches is not really ideal, but we want to use GPT&#39;s semantic understanding.</p>
<p>That&#39;s where Embeddings come in.</p>
<p><img src="https://vimota.me/static/embeddings.jpg" alt="Visual representation of embeddings"/></p>
<p>Embeddings are the dense vector representation of an input encoded by the model, how the model represents a concept.</p>
<p>Since embeddings are just vectors, you can calculate distances between them which represent how conceptually similar they are from each other.</p>
<p>OpenAI exposes embeddings calculation for each of their GPT-3 models as an API - but you still need to do the vector distance calculation yourself. You can do it in code, iterating through all the potential matches and calculating the cosine distance, or you can use a vector DB.</p>
<p>For that I gave Pinecone a try, which is built for this exact purpose. My script read through each of the products we had responses for, called OpenAI&#39;s embedding api and loaded it into Pinecone - with a reference to the Supabase response entry.</p>
<p>Once the response lookups were loaded into Pinecone, the script could query it for the most similar match for each item in someone&#39;s routine and pre-populate the response for their submission.</p>
<p>From there we just had to run it for the thousands of submissions, export the results as a custom property of each Klaviyo user profile and kick off a campaign to email them their results.</p>
<p>Just like that, 100s of human hours saved using GPT-3 and Pinecone ðŸ”¥</p>
<h3>Lessons</h3>
<p>People normally focus on GPT-3&#39;s generative ability to produce content, but using it for this made me realize how many use cases could take advantage of it&#39;s semantic understanding of concepts.</p>
<p>One thing I&#39;d love to play around with is extracting dimensions of an embedding, ie. for &#34;cerave moisturizer&#34;, being able to calculate the &#34;product&#34; (moisturizer) distance to something vs the &#34;brand&#34; (cerave) distance.</p>
</div></article></div>
  </body>
</html>
