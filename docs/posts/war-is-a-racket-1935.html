<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://archive.org/details/WarIsARacket">Original</a>
    <h1>War Is a Racket (1935)</h1>
    
    <div id="readability-page-1" class="page"><div>
     

<p>Hello! Today we’re releasing a new playground called “memory spy”. It lets you run C programs
and see how their variables are represented in memory. It’s designed to be
accessible to folks who don’t know C – it comes with bunch of extremely simple
example C programs that you can poke at. Here’s the link:</p>



<p>This is a companion to the “how integers and floats work” <a href="https://wizardzines.com">zine</a> we’ve been
working on, so the goal is mostly to look at how number types (integers and
floats) are represented.</p>

<h3 id="why-spy-on-memory">why spy on memory?</h3>

<p>How computers actually represent variables can seem kind of abstract, so  I
wanted to make it easy for folks to see how a real computer actually represents
variables in memory.</p>

<h3 id="why-is-it-useful-to-look-at-c">why is it useful to look at C?</h3>

<p>You might be wondering – I don’t write C! Why should I care how C programs
represent variables in memory?</p>

<p>In this playground I’m mostly interested in showing people how integers and
floats are represented. And low-level languages generally all represent
integers and floats in the same way – a 32-bit unsigned int is going to be the
same in C, C++, Rust, Go, Swift, etc. The exact name of the type is different,
but the representation is the same.</p>

<p>In higher-level languages like Python it’s a little different, but under the
hood a <code>float</code> in Python contains a C <code>double</code>, so the C representation is
still pretty relevant.</p>

<h3 id="you-don-t-have-to-know-c">you don’t have to know C</h3>

<p>It uses C because C is the language where it’s the most straightforward to map
between “the code in your program” and “what’s in your computer’s memory”.</p>

<p>But if you’re not comfortable with C, this playground is still for you! We put
together a bunch of example programs where you can run them and look at each
variable’s value.</p>

<p>None of the example programs use any fancy features of C – a lot of the code
is extremely simple, like <code>char byte = &#39;a&#39;;</code>. So you should be mostly
able to understand what’s going on even if you don’t know C at all.</p>

<h3 id="how-does-it-work">how does it work?</h3>

<p>Behind the scenes, there’s a server that:</p>

<ul>
<li>compiles the program with <code>clang</code></li>
<li>runs the program with the C debugger <code>lldb</code> (using a Python lldb script)</li>
<li>returns a JSON file with the values of the variable on every line, as an array of bytes</li>
</ul>

<p>Then the frontend formats the array of bytes so you can look at it. The display
logic isn’t very fancy – ultimately it’s a pretty thin wrapper around lldb.</p>

<h3 id="some-limitations">some limitations</h3>

<p>The two main limitations I can think of right now are:</p>

<ul>
<li>there’s no support for loops (it’ll run them, but it’ll only tell you the value of the variable the first time through the loop)</li>
<li>it only supports defining one variable per line</li>
</ul>

<p>There are probably more, it’s a very simple project.</p>

<h3 id="the-inspiration">the inspiration</h3>

<p><a href="https://pythontutor.com/">Python Tutor</a> by Philip Guo was a huge inspiration. It has a different focus – it also lets you step through programs in a
debugger, but it’s more focused on helping the user build a mental model for
how variables and control flow work.</p>

<h3 id="what-about-security">what about security?</h3>

<p>In general my approach to running arbitrary untrusted code is 20% sandboxing
and 80% making sure that it’s an extremely low value attack target so it’s not
worth trying to break in.</p>

<p>Programs are terminated after 1 second of runtime, they run in a container with
no network access, and the machine they’re running on has no sensitive data on
it and a very small CPU.</p>

<h3 id="some-notes-on-the-tech-stack">some notes on the tech stack</h3>

<p>The backend is in Go, plus a Python script to script the interactions with
lldb. (here’s <a href="https://gist.github.com/jvns/7f1eff7cdda26412cc8df280a1641fd4">the source for the lldb script</a> and <a href="https://gist.github.com/jvns/14b8f65537004a56013260d9219ef36f">the source for the Go server right now</a>). I’m
using <a href="https://jvns.ca/blog/2022/06/28/some-notes-on-bubblewrap/">bubblewrap</a>
to sandbox lldb.</p>

<p>As always the frontend is using Vue. You can see the frontend source with “view
source” if you want.</p>

<p>The main fancy thing that happens on the frontend is that I use <a href="https://tree-sitter.github.io/tree-sitter/">tree sitter</a> to figure out which lines
of the code have variables defined on them.</p>

<h3 id="some-design-notes">some design notes</h3>

<p>As usual these days, I built this project with <a href="https://marieflanagan.com/">Marie Claire LeBlanc Flanagan</a>. I think the
design decision I’m the happiest with is how we handled navigating the program you’re running.
Instead of using next/previous arrows to step through the code one line at a
time, you can just click on a line to view its variables.</p>

<p>This “click on a line” design wouldn’t make sense in a normal debugger context
because usually you have loops and a line might be run more than once. But our
focus here isn’t on control flow, and none of the example programs have loops.</p>

<p>The other thing I’m happy with is the decision to use regular links like (<code>&lt;a href=&#34;#example=hexadecimal&#34;&gt;</code>) for all the navigation. There’s an
<code>onhashchange</code> Javascript event that takes care of making sure we update the
page to match the new URL.</p>

<p>I think there were more design struggles but I forget what they were right now.</p>

<h3 id="that-s-all">that’s all!</h3>

<p>Here’s the link again:</p>



<p>Let me know on Twitter or Mastodon if you notice any problems.</p>

</div></div>
  </body>
</html>
