<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://muffinman.io/blog/invaders/">Original</a>
    <h1>How to Draw a Space Invader</h1>
    
    <div id="readability-page-1" class="page"><div><article>

<p>I recently made the <a href="https://muffinman.io/invaders/">Space Invader Generator</a> for Creative Coding Amsterdam <a href="https://cca.codes/invaders">code challenge</a>. I made it for fun of course... and galactic domination too! You can see how it looks below and in this post I&#39;ll show you how it works using an interactive animation.</p>
<a href="https://muffinman.io/invaders/"><figure><img src="https://corinfaife.co/posts/ui.png" alt="" width="2490" height="1696"/></figure></a>
<p>Here are a few invaders it can generate:</p>

<p>While showing friends how it works, I realized the process would look great animated. So I decided to write another interactive blog post. I&#39;ll give you some background first, but if you are eager to see the process, feel free to jump straight to the <a href="#building-the-invader">interactive part</a>.</p>
<h2 id="how-it-started">How it started <a href="#how-it-started">#</a></h2>
<p>I was working on a new version of <a href="https://corinfaife.co/blog/sneak-peek-of-rayven/">Rayven</a>, my vector 3D renderer. Sometimes I get stuck working on tools - they turn into never-ending projects and I never actually use them to create something. At some point I became aware of this pattern, and I think I&#39;ve gotten better at wrapping projects up, releasing them in one form or another, and moving on.</p>
<p>So I thought it would be cool to do a few plots using Rayven instead of endlessly tweaking the renderer itself. I wanted something simple that I could whip up quickly. It would be a meaningful milestone, even if I didn&#39;t finish everything I planned for Rayven.</p>
<p>Then I thought of Space Invaders. They are small, easy to render with 3D blocks, and instantly recognizable as part of video game history.</p>

<p>I did a few renders of the classic space invader and started thinking that it would be fun to generate random ones and create a series of plots. That sounded like a good idea to share as a code challenge.</p>
<h2 id="the-code-challenge">The code challenge <a href="#the-code-challenge">#</a></h2>
<p>I was pleasantly surprised that people liked the idea. We drafted some rules and the <a href="https://cca.codes/invaders">Space Invaders code challenge</a> was on! At the time of writing, the challenge is still ongoing, but once it wraps up, I&#39;ll link to all the submissions. I&#39;ve already seen some works in progress and there is some really cool stuff coming - stay tuned!</p>
<h2 id="from-doodles-to-pixels">From doodles to pixels <a href="#from-doodles-to-pixels">#</a></h2>
<p>I often bore people by saying you should step back and solve the problem before diving into code. This time it was no different. I literally had no idea how to generate space invaders, so I started with some research. I doodled on paper, but pixel art felt like it deserved digital tools.</p>
<p>So I fired up Aseprite and got to work:</p>
<figure><img src="https://corinfaife.co/posts/invaders.png" alt="" width="1050" height="1200"/></figure>
<p>These are the 38 invaders I drew. They all fit in a 15x15 pixel grid, a bit larger than the originals, but I really liked how they turned out. I enjoyed drawing them a lot. Still, I had no clue how to generate them. I had some over-engineered ideas, but with such a small canvas I worried they would end up as unrecognizable splats of pixels.</p>
<p>Looking at the drawings, a pattern started to emerge. And it was the best kind of pattern - one based on geometry and vector graphics, both things I enjoy and am good at. I chose to play to my strengths and try generating a vector invader. I&#39;m glad to say it worked - what I implemented can generate most of the invaders I drew by hand.</p>
<p>Before we dive into the process, a small disclaimer: I won&#39;t go into every little detail, but I&#39;ll walk you through the core steps and make digressions about stuff I find interesting. If you want to see implementation details, you can check out the code on <a href="https://github.com/Stanko/invaders">GitHub</a>.</p>
<p>One last note: I use the terms &#39;generate&#39; and &#39;randomly select&#39; a lot. Usually that means I use randomness (with some constraints) to calculate a point in 2D space.</p>
<div><h2 id="building-the-invader">Building the invader <a href="#building-the-invader">#</a></h2><p>Here&#39;s our grid. It will stay in the viewport and we&#39;ll draw an invader on it as we scroll down.</p><p>We should probably start with the body. If you look at my sketches above, you might notice the same pattern I did - almost all of the bodies resemble a low-resolution polygon. The plan is to generate a vector polygon. The low resolution of the grid will help hide our (vector) crimes.</p><h3 id="finding-the-center">Finding the center <a href="#finding-the-center">#</a></h3><p>Having a central point for the body will help us draw the rest of it. Think of it as an anchor. Since we&#39;ll generate tentacles in the bottom part, it makes sense to shift the body slightly upward.</p><p>The original space invaders are symmetrical around the vertical axis, and we can use that to our advantage. It&#39;s enough to generate one side of the body and then mirror it.</p><h3 id="defining-top-and-bottom">Defining top and bottom <a href="#defining-top-and-bottom">#</a></h3><p>To generate one side of the body, we start with top and bottom points. Both sit on the vertical axis of symmetry and are randomly selected.</p><h3 id="drawing-the-left-side">Drawing the left side <a href="#drawing-the-left-side">#</a></h3><p>We only need to generate one side and then mirror it. On the left side, we&#39;ll randomly pick between one and five points.</p><p>At first I limited it to two or three points with a convex shape. Later I allowed more points and dropped the convex rule, which unlocked more interesting results. Lines sometimes overlap, but once pixelized, those imperfections disappear.</p><h3 id="mirroring-it-to-the-right">Mirroring it to the right <a href="#mirroring-it-to-the-right">#</a></h3><p>Once the left side vertices are generated, we mirror them to the right.</p><h3 id="connect-the-dots">Connect the dots <a href="#connect-the-dots">#</a></h3><p>Now we connect the points into a polygon. Side points are connected according to their vertical position.</p><p>That gives our invader a body! Now let&#39;s add some extremities.</p><h2 id="adding-limbs">Adding limbs <a href="#adding-limbs">#</a></h2><p>In code, limbs generated on the bottom side are called tentacles, and the ones on the top are horns. They are generated the same way, just with different parameters.</p><p>Let&#39;s see how to generate one tentacle, and then we&#39;ll reuse the same technique for others.</p><h3 id="finding-the-root">Finding the root <a href="#finding-the-root">#</a></h3><p>Since tentacles grow from the bottom, we start with the lowest side point of the body polygon. As usual, we do the left side first and mirror later.</p><h3 id="sketching-the-mid-line">Sketching the mid-line <a href="#sketching-the-mid-line">#</a></h3><p>From the lowest point, we generate a few random points to form a polyline. Its length is random, and it serves as a mid-line for the tentacle.</p><h3 id="fattening-the-line">Fattening the line <a href="#fattening-the-line">#</a></h3><p>On its own, the line is too thin. To turn it into a tentacle we need to give it width. The trick is to calculate points on both sides of the bisector line and connect them together. I like this technique and use it often for my drawings.</p><p>It feels natural that the tentacle is wider where it connects to the body and shrinks further away. To achieve this, we reduce the bisector length as we move outward.</p><p>Two notes on this &#34;fat line&#34; algorithm:</p><ul>
<li>Because the mid-line is random, we often get sharp corners, which create weird overlaps. To soften them we scale down the line width relative to how sharp the angle is.</li>
<li>In the generator, you&#39;ll see an easing parameter for the width. Probably overkill, but it lets me fine tune the width along the tentacle and occasionally fill a missing pixel. I liked the control, so I kept it.</li>
</ul><h3 id="our-first-tentacle">Our first tentacle <a href="#our-first-tentacle">#</a></h3><p>Connecting the bisector endpoints gives us our first fat line, or rather, our first tentacle.</p><p>Now we&#39;re ready to generate more tentacles and horns the same way.</p><h3 id="growing-more-tentacles">Growing more tentacles <a href="#growing-more-tentacles">#</a></h3><p>First we mirror the tentacle we just drew. Some invaders also have a middle tentacle. Let&#39;s <span tabindex="0" role="button">randomly decide</span><span><span><span>If the invader you are looking at hasn&#39;t grown a middle tentacle, refresh the page to get a new one.</span></span></span> if we should draw one.</p><p>For the middle tentacle we start from the bottom point of the body polygon. We draw a line just like before, but with one change - if we get close to a side tentacle we stop. This avoids overlaps that often create a blob of pixels.</p><p>To keep the middle tentacle symmetrical, we&#39;ll take the lazy route - draw it randomly and then mirror it.</p><h3 id="adding-horns">Adding horns <a href="#adding-horns">#</a></h3><p>We draw horns the same way, except we start from the central point and shoot diagonally upward. Horns use a slightly narrower angle range to avoid overlaps. As usual, draw the left one and then mirror it.</p><p>At this stage we have a very <del>crappy</del> rough vector invader. With this rough outline in place, the next challenge is turning it into the pixelated look we all know and love.</p><h2 id="turning-vectors-into-pixels">Turning vectors into pixels <a href="#turning-vectors-into-pixels">#</a></h2><p>By pixelization, I mean painting pixels on the grid based on the vector invader. My first idea was to calculate how much of each pixel lies inside the vector shape and paint it if it&#39;s over 50%. That would be the most accurate, but it felt over-engineered for such a tiny grid.</p><h3 id="pixelizing-the-body">Pixelizing the body <a href="#pixelizing-the-body">#</a></h3><p>Instead, we&#39;ll keep it simple - check if the center of a pixel is inside the polygon. If it is, paint it.</p><p>This method isn&#39;t perfectly accurate, but it&#39;s easy and more than good enough. We&#39;re drawing tiny fictional space invaders, not building a universal rasterizer.</p><h3 id="pixelizing-the-limbs">Pixelizing the limbs <a href="#pixelizing-the-limbs">#</a></h3><p>Tentacles can get thin, so often the center of a pixel won&#39;t fall inside them. That leaves only a few pixels painted. To improve this, we check if the center of a pixel is close to one of the tentacle points. If so, we paint it.</p><p>But if the points are far apart, that still leaves gaps. To improve it, I added a <code>line splitting</code> parameter that subdivides the mid-line into more segments. More points mean a higher chance that a pixel center will be near one. It is not essential, but it helps fine tune invaders you like.</p><p>Now it really looks like an invader - but it&#39;s still blind. Let&#39;s slap some eyes on it!</p><h2 id="adding-eyes">Adding eyes <a href="#adding-eyes">#</a></h2><p>We could get clever with eyes, but a few predefined sets work just fine. I already drew some, so we just select one set. We&#39;ll place the eyes near the central point, since the body is built around it.</p><p>To keep eyes from ending up on the edge, I padded the predefined sets with a few extra pixels. To <span tabindex="0" role="button">make it easier to see</span><span><span><span>Pun intended!</span></span></span>, these extra pixels are shown lighter in the animation. Finally, if eye pixels overlap with body pixels, we remove them to create holes.</p><h2 id="coloring-the-invader">Coloring the invader <a href="#coloring-the-invader">#</a></h2><p>Finally, we can apply some color and there is our invader! Let&#39;s talk about color a little.</p><p>To generate colors, I used the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/color_value/oklch">OKLCH color space</a>. It&#39;s similar to HSL, but unlike HSL it has predictable lightness. That means if we keep the lightness parameter fixed and randomly generate the other two, all generated colors share the same lightness. This is practical for many reasons, but in our case it helps us create colors of similar vibrancy for each invader.</p><p>The code looks like this:</p><pre><code><span><span>const</span> l <span>=</span> <span>random</span><span>(</span><span>0.55</span><span>,</span> <span>0.8</span><span>,</span> rng<span>,</span> <span>2</span><span>)</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span>
</span><span><span>const</span> c <span>=</span> <span>random</span><span>(</span><span>0.2</span><span>,</span> <span>0.5</span><span>,</span> rng<span>,</span> <span>2</span><span>)</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span>
</span><span><span>const</span> h <span>=</span> <span>(</span><span>random</span><span>(</span><span>120</span><span>,</span> <span>420</span><span>,</span> rng<span>,</span> <span>0</span><span>)</span> <span>%</span> <span>360</span><span>)</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span> 
</span><span>
</span><span><span>document</span><span>.</span><span>documentElement</span><span>.</span><span>style</span><span>.</span><span>setProperty</span><span>(</span><span>&#39;--theme-l&#39;</span><span>,</span> l<span>)</span><span>;</span>
</span><span><span>document</span><span>.</span><span>documentElement</span><span>.</span><span>style</span><span>.</span><span>setProperty</span><span>(</span><span>&#39;--theme-c&#39;</span><span>,</span> c<span>)</span><span>;</span>
</span><span><span>document</span><span>.</span><span>documentElement</span><span>.</span><span>style</span><span>.</span><span>setProperty</span><span>(</span><span>&#39;--theme-h&#39;</span><span>,</span> h<span>)</span><span>;</span>
</span></code></pre><p>Notice that for the hue I skip the range between 60 and 120 - yellow-brownish tones I didn&#39;t like.</p><h3 id="color-tweaks-with-css">Color tweaks with CSS <a href="#color-tweaks-with-css">#</a></h3><p>One cool thing is that we can keep <code>l</code>, <code>c</code> and <code>h</code> as separate CSS variables. That makes it easy to mix and match or manipulate them with CSS <code>calc</code> method.</p><p>For example, I use this to fix lightness for controls in the generator so they always have enough contrast:</p><pre><code><span><span><span>.controls</span></span> <span>{</span>
</span><span>  <span>--controls-main</span><span>:</span> <span>oklch</span><span>(</span><span>0.6</span> <span>var</span><span>(</span><span>--theme-c</span><span>)</span> <span>var</span><span>(</span><span>--theme-h</span><span>)</span><span>)</span><span>;</span>
</span><span>  <span>--controls-main-light</span><span>:</span> <span>oklch</span><span>(</span><span>0.75</span> <span>var</span><span>(</span><span>--theme-c</span><span>)</span> <span>var</span><span>(</span><span>--theme-h</span><span>)</span><span>)</span><span>;</span>
</span><span><span>}</span>
</span></code></pre><p>I also use it in debug mode to make tentacle and horn pixels darker and less saturated:</p><pre><code><span><span><span>.invader--debug</span> <span>.invader-pixel--l</span></span> <span>{</span>
</span><span>  <span>fill</span><span>:</span> <span>oklch</span><span>(</span><span>calc</span><span>(</span><span>var</span><span>(</span><span>--theme-l</span><span>)</span> <span>*</span> <span>0.8</span><span>)</span> <span>calc</span><span>(</span><span>var</span><span>(</span><span>--theme-c</span><span>)</span> <span>*</span> <span>0.6</span><span>)</span> <span>var</span><span>(</span><span>--theme-h</span><span>)</span><span>)</span><span>;</span>
</span><span><span>}</span>
</span></code></pre></div>
<h2 id="bringing-it-to-life">Bringing it to life <a href="#bringing-it-to-life">#</a></h2>
<p>For the animation, we&#39;ll try to mimic the original video game. The original invaders have very simple two-frame animations with tentacles and horns moving.</p>
<p>To move tentacles and horns, we clone their mid-lines and randomly shift a few end points. This gives us a variation for each tentacle and horn. Then we redraw the fat lines around them, pixelize it again, and get the second frame. To top it off and add a bit more life, we also move the eyes by one pixel.</p>
<p>Here is how it looks in action:</p>

<p>The pink lines are alternate mid-lines for tentacles and horns. In the generator, you can see this debug view by turning on both <code>animate</code> and <code>debug</code> options.</p>
<h2 id="size">Size <a href="#size">#</a></h2>
<p>I love how increasing the grid size makes the invader feel like itâ€™s evolving or growing. The same algorithm runs, but on a larger area, which allows for more details.</p>

<p>But if we increase the size too much, the vector shape becomes more prominent and it usually doesn&#39;t look good. Occasionally you&#39;ll get something that looks like a final boss, but most of the time you end up with ridiculous crappy ones:</p>

<p>That&#39;s why I capped the size in the generator&#39;s interface to 31x31 pixels. But there is a way to increase it a bit more. If you change the URL directly you can push it up to a maximum of <a href="https://muffinman.io/invaders/#/size:25/">51x51 pixels</a>. I left this hidden feature in to show how increasing the size breaks the illusion.</p>
<h2 id="conclusion">Conclusion <a href="#conclusion">#</a></h2>
<p>We made it!</p>
<p>Thank you for sticking with me until the end. We built a generator that can create an infinite number of little colorful invaders. I&#39;m super happy with how they turned out, and I hope you like them too.</p>
<p>Making the generator and writing the post was a lot of fun. There are still things to add and improve, but like I said earlier - I learned how to publish a project even when my TODO list isn&#39;t empty. I might add a few more things to the generator, but I&#39;ve got other projects lined up, so we&#39;ll see.</p>
<p>I honestly hope you enjoyed reading the post and generating our little colorful intergalactic friends. And don&#39;t forget to <a href="https://muffinman.io/invaders/">generate your own fleet</a>.</p>
<h2 id="making-of-the-post">Making of the post <a href="#making-of-the-post">#</a></h2>
<p>I usually keep all of the JavaScript in my posts unminified so people can read the code and hack around. But in this case, the invader generator and the animation use several external dependencies, so it was easier to add a build step.</p>
<p>The animation is made with <a href="https://animejs.com/">Anime.js</a> and its code lives in the <a href="https://github.com/Stanko/invaders/blob/dev/src/drawing/step-by-step.ts">generator repository</a>. The TypeScript gets compiled and copied to my blog repo. Finally, there is a <a href="https://github.com/Stanko/Stanko.github.io/blob/brz/site/public/js/posts/invaders/index.js">small script</a> that coordinates the animation and connects it to the page scroll.</p>
<p>The animation is also available in the generator itself. If you add the <code>step</code> parameter and toggle debug mode you&#39;ll be able to <a href="https://muffinman.io/invaders/?step#/debug:true">play with it</a> there as well.</p>
<h2 id="bonus---the-rope-post">Bonus - The rope post <a href="#bonus---the-rope-post">#</a></h2>
<p>If you liked this post, check out my earlier interactive one - <a href="https://corinfaife.co/blog/draw-svg-rope-using-javascript/">Draw SVG rope using JavaScript</a>. I think you&#39;ll enjoy it.</p>
</article></div></div>
  </body>
</html>
