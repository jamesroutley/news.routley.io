<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://undeadly.org/cgi?action=article;sid=20230714121907">Original</a>
    <h1>OpenBSD: Mandatory enforcement of indirect branch targets</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>Contributed by
<a href="https://www.openbsdfoundation.org/donations.html">rueda</a>
on <time datetime="2023-07-14T04:40:43Z">2023-07-14</time>
from the targeted-protection dept.</p>
<p>Theo de Raadt (<code>deraadt@</code>)
has updated
<a href="https://www.openbsd.org/innovations.html"><code>innovations.html</code></a>
to include an item regarding the work which has been done
to enforce indirect branch target restriction
(on the
<a href="https://www.openbsd.org/amd64.html"><code>amd64</code></a>
[Intel]
and
<a href="https://www.openbsd.org/arm64.html"><code>arm64</code></a>
platforms).</p>

<p>The
<a href="https://marc.info/?l=openbsd-cvs&amp;m=168925685303781&amp;w=2">commit message</a>
provides some detail:</p>

<blockquote>
<pre>CVSROOT:	/cvs
Module name:	www
Changes by:	deraadt@cvs.openbsd.org	2023/07/13 08:02:00

Modified files:
	.              : innovations.html 

Log message:
Over the last 6 months we&#39;ve worked on adding arm64 <abbr title="Branch Target Identification">BTI</abbr> &amp; Intel <abbr title="Indirect Branch Tracking">IBT</abbr> support
in the kernels and all userland binaries.  We have been fixing all the
applications along the way. Many developers were involved.
</pre>
</blockquote>

<blockquote>
<pre>There is an innovative and substantial difference in our approach compared
to how Linux is doing it:
- On <a href="https://www.openbsd.org/">OpenBSD</a>, <abbr title="Indirect Branch Tracking">IBT</abbr>/<abbr title="Branch Target Identification">BTI</abbr> enforcement is on by default (meaning mandatory),
unless a binary is linked to request opt-out (using -Wl,-z,<a href="https://man.openbsd.org/ld.1#nobtcfi">nobtcfi</a>). After all
our fixes, very few application binaries need that, and that count is expected
to shrink quickly as we (or upstreams) fix the outstanding issues.
- On Linux they are rehashing the same design as their executable-stack mechanism:
if a single .o file in a resulting binary isn&#39;t marked as <abbr title="Indirect Branch Tracking">IBT</abbr>/<abbr title="Branch Target Identification">BTI</abbr> enforcement,
the system will (silently) execute the program without enforcement and noone
knows this is happening.  So for an issue from around 2001, today Linux binaries
with executable stack exist and work unsafely.  I expect that 20 years from
now Linux binaries without <abbr title="Indirect Branch Tracking">IBT</abbr>/<abbr title="Branch Target Identification">BTI</abbr> enforcement will also exist and work unsafely..</pre>
</blockquote>
<p>
For a little background information, see <a href="https://www.arm.com">ARM Inc</a>&#39;s <a href="https://developer.arm.com/documentation/100076/0100/A64-Instruction-Set-Reference/A64-General-Instructions/BTI?lang=en">Reference documentation</a>.
</p><p>
The main commits that enabled the protection were <a href="https://marc.info/?l=openbsd-cvs&amp;m=168895985612066&amp;w=2">this</a> and <a href="https://marc.info/?l=openbsd-cvs&amp;m=168895986512067&amp;w=2">this</a>, after extensive testing in snapshots that turned up various problems that needed fixing in <a href="https://marc.info/?l=openbsd-ports&amp;m=168899645126958&amp;w=2">developer tools</a> as well as <a href="https://marc.info/?l=openbsd-bugs&amp;m=168657419814697&amp;w=2">several</a> different <a href="https://marc.info/?l=openbsd-bugs&amp;m=168677579032042&amp;w=2">applications</a>.
</p></div></div>
  </body>
</html>
