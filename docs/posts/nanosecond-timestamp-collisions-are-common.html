<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.evanjones.ca/nanosecond-collisions.html">Original</a>
    <h1>Nanosecond timestamp collisions are common</h1>
    
    <div id="readability-page-1" class="page"><div>

<h3>[ 2023-July-20 17:39 ]</h3>
<p>I was wondering: how often do nanosecond timestamps collide on modern systems? The answer is: very often, like 5% of all samples, when reading the clock on all 4 physical cores at the same time. As a result, I think it is unsafe to assume that a raw nanosecond timestamp is a unique identifier.</p>

<p>I wrote a <a href="https://github.com/evanj/nanocollision">small test program</a> to test this. I used Go, which records both the &#34;absolute&#34; time and the &#34;monotonic clock&#34; relative time on each call to time.Now(), so I compared both the relative difference between consecutive timestamps, as well as just the absolute timestamps. As expected, the behavior depends on the system, so I observe very different results on Mac OS X and Linux. On Linux, within a single thread, both the absolute and monotonic times always increase. On my system, the minimum increment was 32 ns. Between threads, approximately 5% of the absolute times were exactly the same as other threads. Even with 2 threads on a 4 core system, approximately 2% of timestamps collided. On Mac OS X: the absolute time has microsecond resolution, so there are an astronomical number of collisions when I repeat this same test. Even within a thread I often observe the monotonic clock not increment.</p>

<p>See the <a href="https://github.com/evanj/nanocollision">test program on Github</a> if you are curious.</p>

</div></div>
  </body>
</html>
