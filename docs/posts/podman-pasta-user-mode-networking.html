<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/containers/podman/pull/16141">Original</a>
    <h1>Podman: Pasta User-Mode Networking</h1>
    
    <div id="readability-page-1" class="page"><div>
        <div>
  
  <task-lists disabled="" sortable="">
    <div>
      <h3 dir="auto">Description</h3>
<p dir="auto">This introduces a new user-mode networking option using <a href="https://passt.top/passt/about/#pasta-pack-a-subtle-tap-abstraction" rel="nofollow"><code>pasta(1)</code></a>.</p>
<p dir="auto"><em>pasta</em> implements a translation layer between a Layer-2 network interface (a tap device inside a network namespace) and native Layer-4 sockets (TCP, UDP, ICMP/ICMPv6 echo) on a host. It doesn&#39;t require any capabilities or privileges, and it can be used as a <strong>simple, purpose-written, high performance replacement</strong> for <a href="https://github.com/rootless-containers/slirp4netns"><code>slirp4netns(1)</code></a>.</p>
<p dir="auto">Similarly to slirp4netns, there&#39;s no need to create further interfaces on the host. This approach doesn&#39;t require any capabilities or privileges.</p>
<p dir="auto"><em>pasta</em> also implements a <em>tap bypass path</em> for local connections <strong>only</strong>: packets with a local destination address can be moved directly between Layer-4 sockets, avoiding Layer-2 translations, using the <code>splice(2)</code> and <code>recvmmsg(2)</code>/<code>sendmmsg(2)</code> system calls for TCP and UDP, respectively.</p>
<p dir="auto">A few notable differences compared to <code>slirp4netns(1)</code>:</p>
<ul dir="auto">
<li>
<p dir="auto"><em>pasta</em> forks to background once networking is configured in the namespace and quits on its own once the namespace is deleted: file descriptor synchronisation and PID tracking are not needed</p>
</li>
<li>
<p dir="auto">port forwarding is configured via command line options at start-up, instead of an API socket: this is taken care of right away as we&#39;re about to start <em>pasta</em></p>
</li>
<li>
<p dir="auto">there&#39;s no need for further selection of port forwarding modes: pasta behaves similarly to <a href="https://github.com/rootless-containers/rootlesskit/tree/master/pkg/port">containers-rootlessport</a> for local binds (<code>splice()</code> instead of <code>read()</code>/<code>write()</code> pairs, without L2-L4 translation), and keeps the original source address for non-local connections like slirp4netns does</p>
</li>
<li>
<p dir="auto">IPv6 is not an experimental feature. <strong>IPv6 port forwarding is supported</strong></p>
</li>
<li>
<p dir="auto">by default, addresses and routes are copied from the host, that is, container users will see the same IP address and routes as if they were in the <em>init</em> namespace context. The interface name is also sourced from the host upstream interface with the first default route in the routing table. This is also configurable as documented</p>
</li>
<li>
<p dir="auto">by default, the host is reachable using the gateway address from the container, unless the <code>--no-map-gw</code> option is passed</p>
</li>
<li>
<p dir="auto"><strong>sandboxing</strong> and <strong><code>seccomp(2)</code></strong> policies cannot be disabled</p>
</li>
</ul>
<p dir="auto">See also this <a href="https://passt.top/passt/about/#pasta_2" rel="nofollow">demo</a> showing pasta operation with Podman. Throughput and latency <a href="https://passt.top#perf_27" rel="nofollow">figures</a> for TCP and UDP, over IPv4 and IPv6, are regularly obtained by CI runs.</p>
<h3 dir="auto">Availability</h3>
<p dir="auto">I&#39;m submitting this now after originally <a href="https://lists.podman.io/archives/list/podman@lists.podman.io/thread/PHIFAJLUNI3UKNIIF5HFIQNTNGQ5PUZE/" rel="nofollow">proposing</a> this a few months ago given that packages for some distributions (<a href="https://src.fedoraproject.org/rpms/passt" rel="nofollow">Fedora</a>, <a href="https://build.opensuse.org/package/show/home:dfaggioli:devel/passt" rel="nofollow">openSUSE</a>) are now available.</p>
<p dir="auto">I maintain <strong>unofficial</strong> packages for other RPM-based distributions (CentOS Stream, EPEL, Mageia) on my Fedora Copr <a href="https://copr.fedorainfracloud.org/coprs/sbrivio/passt/" rel="nofollow">repository</a>.</p>
<p dir="auto"><strong>Unofficial</strong> x86_64 <a href="https://passt.top/builds/latest/x86_64/" rel="nofollow">packages</a> for Debian and Debian-based distributions are currently derived from static builds, and there&#39;s an open <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1010498" rel="nofollow">RFP</a> for Debian.</p>
<p dir="auto">Static build <a href="https://passt.top/builds/latest/x86_64/" rel="nofollow">packages</a> are also available for other RPM-based distributions.</p>
<h3 dir="auto">Tests</h3>
<p dir="auto">This pull request introduces a number of tests, <strong>some of which will fail</strong> with the current upstream version of pasta, because I just found a few issues while writing those. Patches are on their <a href="https://archives.passt.top/" rel="nofollow">way</a>, and they should be available in packages within a few days, but I thought I would submit this early for review anyway.</p>
<h3 dir="auto">Additional notes</h3>
<p dir="auto">This also introduces support for <a data-error-text="Failed to load title" data-id="1253160689" data-permission-text="Title is private" data-url="https://github.com/containers/podman/issues/14425" data-hovercard-type="issue" data-hovercard-url="/containers/podman/issues/14425/hovercard" href="https://github.com/containers/podman/issues/14425">#14425</a>, not via native Podman options at the moment, as commented on that issue itself: binding addresses to specific interfaces can only be done by passing <em>opaque options</em> to pasta, as documented.</p>
<p dir="auto">It should also address <a data-error-text="Failed to load title" data-id="1137619898" data-permission-text="Title is private" data-url="https://github.com/containers/podman/issues/13229" data-hovercard-type="issue" data-hovercard-url="/containers/podman/issues/13229/hovercard" href="https://github.com/containers/podman/issues/13229">#13229</a> and related issues.</p>
<p dir="auto"><a data-hovercard-type="user" data-hovercard-url="/users/Luap99/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/Luap99">@Luap99</a> <a data-hovercard-type="user" data-hovercard-url="/users/giuseppe/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/giuseppe">@giuseppe</a> <a data-hovercard-type="user" data-hovercard-url="/users/dgibson/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/dgibson">@dgibson</a> <a data-hovercard-type="user" data-hovercard-url="/users/vivier/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/vivier">@vivier</a> <a data-hovercard-type="user" data-hovercard-url="/users/dfaggioli/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/dfaggioli">@dfaggioli</a> <a data-hovercard-type="user" data-hovercard-url="/users/eriksjolund/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/eriksjolund">@eriksjolund</a> <a data-hovercard-type="user" data-hovercard-url="/users/cpach/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/cpach">@cpach</a> <a data-hovercard-type="user" data-hovercard-url="/users/baude/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/baude">@baude</a> <a data-hovercard-type="user" data-hovercard-url="/users/PhrozenByte/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/PhrozenByte">@PhrozenByte</a></p>
<h3 dir="auto">Does this PR introduce a user-facing change?</h3>
<div data-snippet-clipboard-copy-content="This pull request introduces a new networking option, that can be enabled with the `--net=pasta` option. Detailed usage is described in the documentation."><pre lang="release-note"><code>This pull request introduces a new networking option, that can be enabled with the `--net=pasta` option. Detailed usage is described in the documentation.
</code></pre></div>
    </div>
  </task-lists>
  
</div>

      </div></div>
  </body>
</html>
