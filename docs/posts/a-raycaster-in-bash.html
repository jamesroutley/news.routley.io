<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/izabera/pseudo3d">Original</a>
    <h1>A Raycaster in Bash</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<details open="">
  <summary>
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M16 3.75v8.5a.75.75 0 0 1-1.136.643L11 10.575v.675A1.75 1.75 0 0 1 9.25 13h-7.5A1.75 1.75 0 0 1 0 11.25v-6.5C0 3.784.784 3 1.75 3h7.5c.966 0 1.75.784 1.75 1.75v.675l3.864-2.318A.75.75 0 0 1 16 3.75Zm-6.5 1a.25.25 0 0 0-.25-.25h-7.5a.25.25 0 0 0-.25.25v6.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-6.5ZM11 8.825l3.5 2.1v-5.85l-3.5 2.1Z"></path>
</svg>
    <span aria-label="Video description wolfenstein-in-bash.mp4">wolfenstein-in-bash.mp4</span>
    <span></span>
  </summary>

  <video src="https://private-user-images.githubusercontent.com/1572859/397868206-addb77f3-f309-48ab-8609-a8ea3082c952.mp4?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzQ3Njk0NjMsIm5iZiI6MTczNDc2OTE2MywicGF0aCI6Ii8xNTcyODU5LzM5Nzg2ODIwNi1hZGRiNzdmMy1mMzA5LTQ4YWItODYwOS1hOGVhMzA4MmM5NTIubXA0P1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MTIyMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDEyMjFUMDgxOTIzWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9MmM0NjgzMWU5YTc3MDY5ZjMxNjUxM2RkMWVhMWExYjcxNDM4MzIxMGI2MjZiNDIwZmE2MDQ1ZDY1YjU3ZWVmOSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.u0CGoqYsIjte31evtAsk_GmSaTp18vh-zJlnSPhw_hk" data-canonical-src="https://private-user-images.githubusercontent.com/1572859/397868206-addb77f3-f309-48ab-8609-a8ea3082c952.mp4?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzQ3Njk0NjMsIm5iZiI6MTczNDc2OTE2MywicGF0aCI6Ii8xNTcyODU5LzM5Nzg2ODIwNi1hZGRiNzdmMy1mMzA5LTQ4YWItODYwOS1hOGVhMzA4MmM5NTIubXA0P1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MTIyMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDEyMjFUMDgxOTIzWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9MmM0NjgzMWU5YTc3MDY5ZjMxNjUxM2RkMWVhMWExYjcxNDM4MzIxMGI2MjZiNDIwZmE2MDQ1ZDY1YjU3ZWVmOSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.u0CGoqYsIjte31evtAsk_GmSaTp18vh-zJlnSPhw_hk" controls="controls" muted="muted">

  </video>
</details>

<p dir="auto">more screenshots/vidoes at <a href="https://imgur.com/a/izas-wolfenstein-bash-journey-bAy5zhp" rel="nofollow">https://imgur.com/a/izas-wolfenstein-bash-journey-bAy5zhp</a></p>
<p dir="auto">largely a port of <a href="https://lodev.org/cgtutor/raycasting.html" rel="nofollow">https://lodev.org/cgtutor/raycasting.html</a></p>
<p dir="auto">use the arrow keys to rotate and move around, and q to quit</p>

<ul dir="auto">
<li>
<p dir="auto">bash is slow.  this is by far the biggest issue.  it&#39;s so slow that you
cannot possibly achieve an acceptable frame rate if you have to execute even
a single command per pixel.  this implies that you also cannot keep the state
of the screen in memory, neither as an array of colours (did you know that
accessing a random element in an array takes linear time?) nor as a single
long string (did you know that accessing the nth character in a string takes
linear time even in LANG=C?), because literally just reading this
representation to dump it to the screen will take longer than a frame</p>
</li>
<li>
<p dir="auto">bash has no floating point support nor access to a library of maths
functions. all the maths is done on integers, scaled up by 100000</p>
</li>
<li>
<p dir="auto">terminals are ugly if you use a full character to represent each pixel, so
this uses unicode half blocks with different foreground and background
colours, which effectively doubles the vertical resolution.  there is
unfortunately no way to update only one of the two colours in a cell, nor any
way to query the current colours of a cell (besides, it would be too slow for
bash), so every time we write a pixel we need to know the colour of an
adjacent pixel.  it would be really convenient if bash could store the state
somehow but alas it cannot</p>
</li>
<li>
<p dir="auto">various misc annoyances:</p>
<ul dir="auto">
<li>
<p dir="auto">making sure all the terminal is updated at once is not trivial with a
slow language like bash</p>
</li>
<li>
<p dir="auto">most terminals are not designed to play video games in (shockingly), so
you cannot test if a key is currently pressed.  instead you can only get
a single key that&#39;s being held down, usually really slowly debounced and
with a low limit for continued presses, so you probably get like 5-6
characters a second.  you cannot even get multiple keys pressed at the
same time unless some are modifiers.  the kitty keyboard protocol 100%
fixes all this, and i&#39;m sure it will become a widely implemented standard
by the year 2100</p>
</li>
<li>
<p dir="auto">turns out that filling a terminal with colours takes a lot of data.  at
my normal font size this does ~10mb of i/o per second, which isn&#39;t very
much in the grand scheme of things, but, you know, it&#39;s bash</p>
</li>
<li>
<p dir="auto">bash will never use a single syscall to print a string with more than one
newline, regardless of the type of file you&#39;re writing to.  this is
pointless and dumb, and it&#39;s the reason why this never prints \n and
always moves the cursor in other ways.  ultimately this ended up printing
more data than the size your terminal is likely getting in each read, so
it might not matter too much, but it still bothered me</p>
</li>
<li>
<p dir="auto">ecma48/vt100/vt200/xterm... were all designed by insane people who hated
me specifically</p>
</li>
<li>
<p dir="auto">holy shit i&#39;m bad at maths, i went to uni for this what the fuck</p>
</li>
</ul>
</li>
</ul>

<ul dir="auto">
<li>
<p dir="auto">q: it fucks things up when i resize the window/it&#39;s a flickery mess/it
generally looks like shite on my terminal</p>
</li>
<li>
<p dir="auto">a: open an issue please</p>
</li>
<li>
<p dir="auto">q: my cpu heats up like crazy/my computer from 2005 slows down to a crawl</p>
</li>
<li>
<p dir="auto">a: try to set the env variable FPS to something less than 30</p>
</li>
<li>
<p dir="auto">q: it doesn&#39;t work on my bash &lt; 5</p>
</li>
<li>
<p dir="auto">a: yep</p>
</li>
<li>
<p dir="auto">q: is this code all pure bash?</p>
</li>
<li>
<p dir="auto">a: no.  it also calls stty once at startup to disable echo, and once at exit
to re enable it</p>
</li>
</ul>
</article></div></div>
  </body>
</html>
