<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/CrystallineCore/Biscuit">Original</a>
    <h1>Biscuit is a specialized PostgreSQL index for fast pattern matching LIKE queries</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><a href="https://opensource.org/licenses/MIT" rel="nofollow"><img src="https://camo.githubusercontent.com/fdf2982b9f5d7489dcf44570e714e3a15fce6253e0cc6b5aa61a075aac2ff71b/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d4d49542d79656c6c6f772e737667" alt="License: MIT" data-canonical-src="https://img.shields.io/badge/License-MIT-yellow.svg"/></a>
<a href="https://www.postgresql.org/" rel="nofollow"><img src="https://camo.githubusercontent.com/404f7746b25606b6ea020d5fb097d8bc96a6ec2f30e277478fa8fbfaa73f46e2/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f506f737467726553514c2d31362532422d626c75652e737667" alt="PostgreSQL: 12+" data-canonical-src="https://img.shields.io/badge/PostgreSQL-16%2B-blue.svg"/></a>
<a href="https://biscuit.readthedocs.io/" rel="nofollow"><img src="https://camo.githubusercontent.com/b3f1b802484456bdac1c084b0c36cfecce9194cba60d51d7cbf0e4b9e5aa708f/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f52656164253230746865253230446f63732d3843413141463f6c6f676f3d72656164746865646f6373266c6f676f436f6c6f723d666666" alt="Read the Docs" data-canonical-src="https://img.shields.io/badge/Read%20the%20Docs-8CA1AF?logo=readthedocs&amp;logoColor=fff"/></a></p>
<p dir="auto"><strong>Biscuit</strong> is a specialized PostgreSQL index access method (IAM) designed for blazing-fast pattern matching on <code>LIKE</code> and <code>ILIKE</code> queries, with native support for multi-column searches. It eliminates the recheck overhead of trigram indexes while delivering significant performance improvements on wildcard-heavy queries. It stands for <em>Bitmap Indexed Searching with Comprehensive Union and Intersection Techniques</em>.</p>
<hr/>

<div dir="auto"><h3 tabindex="-1" dir="auto">üõ†Ô∏è Build &amp; Packaging</h3><a id="user-content-Ô∏è-build--packaging" aria-label="Permalink: üõ†Ô∏è Build &amp; Packaging" href="#Ô∏è-build--packaging"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>Improved Makefile detection logic for CRoaring bitmap support by checking multiple common installation paths, increasing portability across systems and build environments.</li>
</ul>

<div dir="auto"><h4 tabindex="-1" dir="auto">Build and configuration introspection</h4><a id="user-content-build-and-configuration-introspection" aria-label="Permalink: Build and configuration introspection" href="#build-and-configuration-introspection"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Added SQL functions to inspect Biscuit build-time configuration, useful for debugging,
reproducibility, and deployment verification.</p>
<ul dir="auto">
<li><strong><code>biscuit_version() ‚Üí text</code></strong></li>
</ul>
<p dir="auto">Returns the Biscuit extension version string.</p>
<ul dir="auto">
<li><strong><code>biscuit_build_info() ‚Üí table</code></strong></li>
</ul>
<p dir="auto">Returns detailed build-time configuration information.</p>
<ul dir="auto">
<li><strong><code>biscuit_build_info_json() ‚Üí text</code></strong></li>
</ul>
<p dir="auto">Returns build configuration as a JSON string for automation and scripting.</p>
<div dir="auto"><h4 tabindex="-1" dir="auto">Roaring Bitmap support introspection</h4><a id="user-content-roaring-bitmap-support-introspection" aria-label="Permalink: Roaring Bitmap support introspection" href="#roaring-bitmap-support-introspection"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Added built-in SQL functions to inspect CRoaring bitmap support in Biscuit.</p>
<ul dir="auto">
<li><strong><code>biscuit_has_roaring() ‚Üí boolean</code></strong></li>
</ul>
<p dir="auto">Checks whether the extension was compiled with CRoaring bitmap support.</p>
<ul dir="auto">
<li><strong><code>biscuit_roaring_version() ‚Üí text</code></strong></li>
</ul>
<p dir="auto">Returns the CRoaring library version if available.</p>

<p dir="auto">Added a built-in diagnostic view for quick inspection of Biscuit status
and configuration.</p>
<ul dir="auto">
<li><strong><code>biscuit_status</code></strong></li>
</ul>
<hr/>


<ul dir="auto">
<li>Build tools: <code>gcc</code>, <code>make</code>, <code>pg_config</code></li>
<li>Optional: CRoaring library for enhanced performance</li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="# Clone repository
git clone https://github.com/Crystallinecore/biscuit.git
cd biscuit

# Build and install
make
sudo make install

# Enable in PostgreSQL
psql -d your_database -c &#34;CREATE EXTENSION biscuit;&#34;"><pre><span><span>#</span> Clone repository</span>
git clone https://github.com/Crystallinecore/biscuit.git
<span>cd</span> biscuit

<span><span>#</span> Build and install</span>
make
sudo make install

<span><span>#</span> Enable in PostgreSQL</span>
psql -d your_database -c <span><span>&#34;</span>CREATE EXTENSION biscuit;<span>&#34;</span></span></pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="pgxn install biscuit
psql -d your_database -c &#34;CREATE EXTENSION biscuit;&#34;"><pre>pgxn install biscuit
psql -d your_database -c <span><span>&#34;</span>CREATE EXTENSION biscuit;<span>&#34;</span></span></pre></div>
<hr/>


<div dir="auto" data-snippet-clipboard-copy-content="-- Create a Biscuit index
CREATE INDEX idx_users_name ON users USING biscuit(name);

-- Query with wildcard patterns
SELECT * FROM users WHERE name LIKE &#39;%john%&#39;;
SELECT * FROM users WHERE name NOT LIKE &#39;a%b%c&#39;;
SELECT COUNT(*) FROM users WHERE name LIKE &#39;%test%&#39;;"><pre><span><span>--</span> Create a Biscuit index</span>
<span>CREATE</span> <span>INDEX</span> <span>idx_users_name</span> <span>ON</span> users USING biscuit(name);

<span><span>--</span> Query with wildcard patterns</span>
<span>SELECT</span> <span>*</span> <span>FROM</span> users <span>WHERE</span> name <span>LIKE</span> <span><span>&#39;</span>%john%<span>&#39;</span></span>;
<span>SELECT</span> <span>*</span> <span>FROM</span> users <span>WHERE</span> name NOT <span>LIKE</span> <span><span>&#39;</span>a%b%c<span>&#39;</span></span>;
<span>SELECT</span> <span>COUNT</span>(<span>*</span>) <span>FROM</span> users <span>WHERE</span> name <span>LIKE</span> <span><span>&#39;</span>%test%<span>&#39;</span></span>;</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="-- Create multi-column index
CREATE INDEX idx_products_search 
ON products USING biscuit(name, description, category);

-- Multi-column query (optimized automatically)
SELECT * FROM products 
WHERE name LIKE &#39;%widget%&#39; 
  AND description LIKE &#39;%blue%&#39;
  AND category LIKE &#39;electronics%&#39;
ORDER BY score DESC 
LIMIT 10;"><pre><span><span>--</span> Create multi-column index</span>
<span>CREATE</span> <span>INDEX</span> <span>idx_products_search</span> 
<span>ON</span> products USING biscuit(name, description, category);

<span><span>--</span> Multi-column query (optimized automatically)</span>
<span>SELECT</span> <span>*</span> <span>FROM</span> products 
<span>WHERE</span> name <span>LIKE</span> <span><span>&#39;</span>%widget%<span>&#39;</span></span> 
  <span>AND</span> description <span>LIKE</span> <span><span>&#39;</span>%blue%<span>&#39;</span></span>
  <span>AND</span> category <span>LIKE</span> <span><span>&#39;</span>electronics%<span>&#39;</span></span>
<span>ORDER BY</span> score <span>DESC</span> 
<span>LIMIT</span> <span>10</span>;</pre></div>

<p dir="auto">Biscuit automatically converts various types to searchable text:</p>
<div dir="auto" data-snippet-clipboard-copy-content="-- Text types (native)
CREATE INDEX ON logs USING biscuit(message);

-- Numeric types (converted to sortable strings)
CREATE INDEX ON events USING biscuit(user_id, event_code);

-- Date/Time types (converted to sortable timestamps)
CREATE INDEX ON orders USING biscuit(order_date, customer_name);

-- Boolean (converted to &#39;t&#39;/&#39;f&#39;)
CREATE INDEX ON flags USING biscuit(is_active, status);"><pre><span><span>--</span> Text types (native)</span>
<span>CREATE</span> <span>INDEX</span> <span>ON</span> logs USING biscuit(message);

<span><span>--</span> Numeric types (converted to sortable strings)</span>
<span>CREATE</span> <span>INDEX</span> <span>ON</span> events USING biscuit(user_id, event_code);

<span><span>--</span> Date/Time types (converted to sortable timestamps)</span>
<span>CREATE</span> <span>INDEX</span> <span>ON</span> orders USING biscuit(order_date, customer_name);

<span><span>--</span> Boolean (converted to &#39;t&#39;/&#39;f&#39;)</span>
<span>CREATE</span> <span>INDEX</span> <span>ON</span> flags USING biscuit(is_active, status);</pre></div>
<hr/>

<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>Core Concept: Bitmap Position Indices</strong></h3><a id="user-content-core-concept-bitmap-position-indices" aria-label="Permalink: Core Concept: Bitmap Position Indices" href="#core-concept-bitmap-position-indices"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Biscuit builds <strong>two types of character-position bitmaps</strong> for every string:</p>
<div dir="auto"><h4 tabindex="-1" dir="auto"><strong>1. Positive Indices (Forward)</strong></h4><a id="user-content-1-positive-indices-forward" aria-label="Permalink: 1. Positive Indices (Forward)" href="#1-positive-indices-forward"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Tracks which records have character <code>c</code> at position <code>p</code>:</p>
<div data-snippet-clipboard-copy-content="String: &#34;Hello&#34;
Bitmaps:
  H@0 ‚Üí {record_ids...}
  e@1 ‚Üí {record_ids...}
  l@2 ‚Üí {record_ids...}
  l@3 ‚Üí {record_ids...}
  o@4 ‚Üí {record_ids...}"><pre><code>String: &#34;Hello&#34;
Bitmaps:
  H@0 ‚Üí {record_ids...}
  e@1 ‚Üí {record_ids...}
  l@2 ‚Üí {record_ids...}
  l@3 ‚Üí {record_ids...}
  o@4 ‚Üí {record_ids...}
</code></pre></div>
<div dir="auto"><h4 tabindex="-1" dir="auto"><strong>2. Negative Indices (Backward)</strong></h4><a id="user-content-2-negative-indices-backward" aria-label="Permalink: 2. Negative Indices (Backward)" href="#2-negative-indices-backward"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Tracks which records have character <code>c</code> at position <code>-p</code> from the end:</p>
<div data-snippet-clipboard-copy-content="String: &#34;Hello&#34;
Bitmaps:
  o@-1 ‚Üí {record_ids...}  (last char)
  l@-2 ‚Üí {record_ids...}  (second to last)
  l@-3 ‚Üí {record_ids...}
  e@-4 ‚Üí {record_ids...}
  H@-5 ‚Üí {record_ids...}"><pre><code>String: &#34;Hello&#34;
Bitmaps:
  o@-1 ‚Üí {record_ids...}  (last char)
  l@-2 ‚Üí {record_ids...}  (second to last)
  l@-3 ‚Üí {record_ids...}
  e@-4 ‚Üí {record_ids...}
  H@-5 ‚Üí {record_ids...}
</code></pre></div>
<div dir="auto"><h4 tabindex="-1" dir="auto"><strong>3. Positive Indices (Case-insensitive)</strong></h4><a id="user-content-3-positive-indices-case-insensitive" aria-label="Permalink: 3. Positive Indices (Case-insensitive)" href="#3-positive-indices-case-insensitive"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Tracks which records have character <code>c</code> at position <code>p</code>:</p>
<div data-snippet-clipboard-copy-content="String: &#34;Hello&#34;
Bitmaps:
  h@0 ‚Üí {record_ids...}
  e@1 ‚Üí {record_ids...}
  l@2 ‚Üí {record_ids...}
  l@3 ‚Üí {record_ids...}
  o@4 ‚Üí {record_ids...}"><pre><code>String: &#34;Hello&#34;
Bitmaps:
  h@0 ‚Üí {record_ids...}
  e@1 ‚Üí {record_ids...}
  l@2 ‚Üí {record_ids...}
  l@3 ‚Üí {record_ids...}
  o@4 ‚Üí {record_ids...}
</code></pre></div>
<div dir="auto"><h4 tabindex="-1" dir="auto"><strong>4. Negative Indices (Case-insensitive)</strong></h4><a id="user-content-4-negative-indices-case-insensitive" aria-label="Permalink: 4. Negative Indices (Case-insensitive)" href="#4-negative-indices-case-insensitive"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Tracks which records have character <code>c</code> at position <code>-p</code> from the end:</p>
<div data-snippet-clipboard-copy-content="String: &#34;Hello&#34;
Bitmaps:
  o@-1 ‚Üí {record_ids...}  (last char)
  l@-2 ‚Üí {record_ids...}  (second to last)
  l@-3 ‚Üí {record_ids...}
  e@-4 ‚Üí {record_ids...}
  h@-5 ‚Üí {record_ids...}"><pre><code>String: &#34;Hello&#34;
Bitmaps:
  o@-1 ‚Üí {record_ids...}  (last char)
  l@-2 ‚Üí {record_ids...}  (second to last)
  l@-3 ‚Üí {record_ids...}
  e@-4 ‚Üí {record_ids...}
  h@-5 ‚Üí {record_ids...}
</code></pre></div>

<p dir="auto">Two types for fast length filtering:</p>
<ul dir="auto">
<li><strong>Exact length</strong>: <code>length[5]</code> ‚Üí all 5-character strings</li>
<li><strong>Minimum length</strong>: <code>length_ge[3]</code> ‚Üí all strings ‚â• 3 characters</li>
</ul>
<hr/>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>Pattern Matching Algorithm</strong></h3><a id="user-content-pattern-matching-algorithm" aria-label="Permalink: Pattern Matching Algorithm" href="#pattern-matching-algorithm"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>

<p dir="auto"><strong>Step 1: Parse pattern into parts</strong></p>
<div data-snippet-clipboard-copy-content="Parts: [&#34;abc&#34;, &#34;def&#34;]
Starts with %: YES
Ends with %: NO"><pre><code>Parts: [&#34;abc&#34;, &#34;def&#34;]
Starts with %: YES
Ends with %: NO
</code></pre></div>
<p dir="auto"><strong>Step 2: Match first part as prefix</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="-- &#34;abc&#34; must start at position 0
Candidates = pos[a@0] ‚à© pos[b@1] ‚à© pos[c@2]"><pre><span><span>--</span> &#34;abc&#34; must start at position 0</span>
Candidates <span>=</span> pos[a@<span>0</span>] ‚à© pos[b@<span>1</span>] ‚à© pos[c@<span>2</span>]</pre></div>
<p dir="auto"><strong>Step 3: Match last part at end (negative indexing)</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="-- &#34;def&#34; must end at string end
Candidates = Candidates ‚à© neg[f@-1] ‚à© neg[e@-2] ‚à© neg[d@-3]"><pre><span><span>--</span> &#34;def&#34; must end at string end</span>
Candidates <span>=</span> Candidates ‚à© neg[f@<span>-</span><span>1</span>] ‚à© neg[e@<span>-</span><span>2</span>] ‚à© neg[d@<span>-</span><span>3</span>]</pre></div>
<p dir="auto"><strong>Step 4: Apply length constraint</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="-- String must be at least 6 chars (abc + def)
Candidates = Candidates ‚à© length_ge[6]"><pre><span><span>--</span> String must be at least 6 chars (abc + def)</span>
Candidates <span>=</span> Candidates ‚à© length_ge[<span>6</span>]</pre></div>
<p dir="auto"><strong>Result: Exact matches, zero false positives</strong></p>
<hr/>

<div dir="auto"><h4 tabindex="-1" dir="auto"><strong>1. Pure Bitmap Operations</strong></h4><a id="user-content-1-pure-bitmap-operations" aria-label="Permalink: 1. Pure Bitmap Operations" href="#1-pure-bitmap-operations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="// Traditional approach (pg_trgm)
for each trigram in pattern:
    candidates = scan_trigram_index(trigram)
    for each candidate:
        if !heap_fetch_and_recheck(candidate):  // SLOW: Random I/O
            remove candidate

// Biscuit approach
for each character at position:
    candidates &amp;= bitmap[char][pos]  // FAST: In-memory AND
// No recheck needed!"><pre><span>// Traditional approach (pg_trgm)</span>
<span>for</span> <span>each</span> <span>trigram</span> <span>in</span> <span>pattern</span>:
    <span>candidates</span> <span>=</span> <span>scan_trigram_index</span>(<span>trigram</span>)
    <span>for</span> <span>each</span> <span>candidate</span>:
        <span>if</span> !<span>heap_fetch_and_recheck</span>(<span>candidate</span>):  <span>// SLOW: Random I/O</span>
            <span>remove</span> <span>candidate</span>

<span>// Biscuit approach</span>
<span>for</span> <span>each</span> <span>character</span> <span>at</span> <span>position</span>:
    <span>candidates</span> &amp;= <span>bitmap</span>[<span>char</span>][<span>pos</span>]  <span>// FAST: In-memory AND</span>
<span>// No recheck needed!</span></pre></div>

<p dir="auto">Compressed bitmap representation:</p>
<ul dir="auto">
<li>Sparse data: array of integers</li>
<li>Dense data: bitset</li>
<li>Automatic conversion for optimal memory</li>
</ul>
<div dir="auto"><h4 tabindex="-1" dir="auto"><strong>3. Negative Indexing Optimization</strong></h4><a id="user-content-3-negative-indexing-optimization" aria-label="Permalink: 3. Negative Indexing Optimization" href="#3-negative-indexing-optimization"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="-- Pattern: &#39;%xyz&#39;
-- Traditional: Scan all strings, check suffix
-- Biscuit: Direct lookup in neg[z@-1] ‚à© neg[y@-2] ‚à© neg[x@-3]"><pre><span><span>--</span> Pattern: &#39;%xyz&#39;</span>
<span><span>--</span> Traditional: Scan all strings, check suffix</span>
<span><span>--</span> Biscuit: Direct lookup in neg[z@-1] ‚à© neg[y@-2] ‚à© neg[x@-3]</span></pre></div>
<hr/>
<div dir="auto"><h2 tabindex="-1" dir="auto"><strong>12 Performance Optimizations</strong></h2><a id="user-content-12-performance-optimizations" aria-label="Permalink: 12 Performance Optimizations" href="#12-performance-optimizations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>1. Skip Wildcard Intersections</strong></h3><a id="user-content-1-skip-wildcard-intersections" aria-label="Permalink: 1. Skip Wildcard Intersections" href="#1-skip-wildcard-intersections"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="// Pattern: &#34;a_c&#34; (underscore = any char)
// OLD: Intersect all 256 chars at position 1
// NEW: Skip position 1 entirely, only check a@0 and c@2"><pre><span>// Pattern: &#34;a_c&#34; (underscore = any char)</span>
<span>// OLD: Intersect all 256 chars at position 1</span>
<span>// NEW: Skip position 1 entirely, only check a@0 and c@2</span></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>2. Early Termination on Empty</strong></h3><a id="user-content-2-early-termination-on-empty" aria-label="Permalink: 2. Early Termination on Empty" href="#2-early-termination-on-empty"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="result = bitmap[a][0];
result &amp;= bitmap[b][1];
if (result.empty()) return empty;  // Don&#39;t process remaining chars"><pre><span>result</span> <span>=</span> <span>bitmap</span>[<span>a</span>][<span>0</span>];
<span>result</span> &amp;= <span>bitmap</span>[<span>b</span>][<span>1</span>];
<span>if</span> (<span>result</span>.<span>empty</span>()) <span>return</span> <span>empty</span>;  <span>// Don&#39;t process remaining chars</span></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>3. Avoid Redundant Bitmap Copies</strong></h3><a id="user-content-3-avoid-redundant-bitmap-copies" aria-label="Permalink: 3. Avoid Redundant Bitmap Copies" href="#3-avoid-redundant-bitmap-copies"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="// OLD: Copy bitmap for every operation
// NEW: Operate in-place, copy only when branching"><pre><span>// OLD: Copy bitmap for every operation</span>
<span>// NEW: Operate in-place, copy only when branching</span></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>4. Optimized Single-Part Patterns</strong></h3><a id="user-content-4-optimized-single-part-patterns" aria-label="Permalink: 4. Optimized Single-Part Patterns" href="#4-optimized-single-part-patterns"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Fast paths for common cases:</p>
<ul dir="auto">
<li><strong>Exact</strong>: <code>&#39;abc&#39;</code> ‚Üí Check position 0-2 and length = 3</li>
<li><strong>Prefix</strong>: <code>&#39;abc%&#39;</code> ‚Üí Check position 0-2 and length ‚â• 3</li>
<li><strong>Suffix</strong>: <code>&#39;%xyz&#39;</code> ‚Üí Check negative positions -3 to -1</li>
<li><strong>Substring</strong>: <code>&#39;%abc%&#39;</code> ‚Üí Check all positions, OR results</li>
</ul>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>5. Skip Unnecessary Length Operations</strong></h3><a id="user-content-5-skip-unnecessary-length-operations" aria-label="Permalink: 5. Skip Unnecessary Length Operations" href="#5-skip-unnecessary-length-operations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="// Pure wildcard patterns
if (pattern == &#34;%%%___%%&#34;)  // 3 underscores
    return length_ge[3];     // No character checks needed!"><pre><span>// Pure wildcard patterns</span>
<span>if</span> (<span>pattern</span> <span>==</span> <span>&#34;%%%___%%&#34;</span>)  <span>// 3 underscores</span>
    <span>return</span> <span>length_ge</span>[<span>3</span>];     <span>// No character checks needed!</span></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>6. TID Sorting for Sequential Heap Access</strong></h3><a id="user-content-6-tid-sorting-for-sequential-heap-access" aria-label="Permalink: 6. TID Sorting for Sequential Heap Access" href="#6-tid-sorting-for-sequential-heap-access"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="// Sort TIDs by (block_number, offset) before returning
// Converts random I/O into sequential I/O
// Uses radix sort for &gt;5000 TIDs, quicksort for smaller sets"><pre><span>// Sort TIDs by (block_number, offset) before returning</span>
<span>// Converts random I/O into sequential I/O</span>
<span>// Uses radix sort for &gt;5000 TIDs, quicksort for smaller sets</span></pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="// For bitmap scans, insert TIDs in chunks
for (i = 0; i &lt; num_results; i += 10000) {
    tbm_add_tuples(tbm, &amp;tids[i], batch_size, false);
}"><pre><span>// For bitmap scans, insert TIDs in chunks</span>
<span>for</span> (<span>i</span> <span>=</span> <span>0</span>; <span>i</span> <span>&lt;</span> <span>num_results</span>; <span>i</span> <span>+=</span> <span>10000</span>) {
    <span>tbm_add_tuples</span>(<span>tbm</span>, <span>&amp;</span><span>tids</span>[<span>i</span>], <span>batch_size</span>, false);
}</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>8. Direct Roaring Iteration</strong></h3><a id="user-content-8-direct-roaring-iteration" aria-label="Permalink: 8. Direct Roaring Iteration" href="#8-direct-roaring-iteration"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="// OLD: Convert bitmap to array, then iterate
// NEW: Direct iterator, no intermediate allocation
roaring_uint32_iterator_t *iter = roaring_create_iterator(bitmap);
while (iter-&gt;has_value) {
    process(iter-&gt;current_value);
    roaring_advance_uint32_iterator(iter);
}"><pre><span>// OLD: Convert bitmap to array, then iterate</span>
<span>// NEW: Direct iterator, no intermediate allocation</span>
<span>roaring_uint32_iterator_t</span> <span>*</span><span>iter</span> <span>=</span> <span>roaring_create_iterator</span>(<span>bitmap</span>);
<span>while</span> (<span>iter</span><span>-&gt;</span><span>has_value</span>) {
    <span>process</span>(<span>iter</span><span>-&gt;</span><span>current_value</span>);
    <span>roaring_advance_uint32_iterator</span>(<span>iter</span>);
}</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>9. Batch Cleanup on Threshold</strong></h3><a id="user-content-9-batch-cleanup-on-threshold" aria-label="Permalink: 9. Batch Cleanup on Threshold" href="#9-batch-cleanup-on-threshold"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="// After 1000 deletes, clean tombstones from all bitmaps
if (tombstone_count &gt;= 1000) {
    for each bitmap:
        bitmap &amp;= ~tombstones;  // Batch operation
    tombstones.clear();
}"><pre><span>// After 1000 deletes, clean tombstones from all bitmaps</span>
<span>if</span> (<span>tombstone_count</span> &gt;= <span>1000</span>) {
    <span>for</span> <span>each</span> <span>bitmap</span>:
        <span>bitmap</span> &amp;= ~<span>tombstones</span>;  <span>// Batch operation</span>
    <span>tombstones</span>.<span>clear</span>();
}</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>10. Aggregate Query Detection</strong></h3><a id="user-content-10-aggregate-query-detection" aria-label="Permalink: 10. Aggregate Query Detection" href="#10-aggregate-query-detection"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="// COUNT(*), EXISTS, etc. don&#39;t need sorted TIDs
if (!scan-&gt;xs_want_itup) {
    skip_sorting = true;  // Save sorting time
}"><pre><span>// COUNT(*), EXISTS, etc. don&#39;t need sorted TIDs</span>
<span>if</span> (!<span>scan</span><span>-&gt;</span><span>xs_want_itup</span>) {
    <span>skip_sorting</span> <span>=</span> true;  <span>// Save sorting time</span>
}</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>11. LIMIT-Aware TID Collection</strong></h3><a id="user-content-11-limit-aware-tid-collection" aria-label="Permalink: 11. LIMIT-Aware TID Collection" href="#11-limit-aware-tid-collection"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="// If LIMIT 10 in query, don&#39;t collect more than needed
if (limit_hint &gt; 0 &amp;&amp; collected &gt;= limit_hint)
    break;  // Early termination"><pre><span>// If LIMIT 10 in query, don&#39;t collect more than needed</span>
<span>if</span> (<span>limit_hint</span> <span>&gt;</span> <span>0</span> <span>&amp;&amp;</span> <span>collected</span> &gt;= <span>limit_hint</span>)
    <span>break</span>;  <span>// Early termination</span></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>12. Multi-Column Query Optimization</strong></h3><a id="user-content-12-multi-column-query-optimization" aria-label="Permalink: 12. Multi-Column Query Optimization" href="#12-multi-column-query-optimization"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>

<p dir="auto">Analyzes each column&#39;s pattern and executes in order of selectivity:</p>
<div dir="auto" data-snippet-clipboard-copy-content="-- Query:
WHERE name LIKE &#39;%common%&#39;           -- Low selectivity
  AND sku LIKE &#39;PROD-2024-%&#39;         -- High selectivity (prefix)
  AND description LIKE &#39;%rare_word%&#39; -- Medium selectivity

-- Execution order (Biscuit automatically reorders):
1. sku LIKE &#39;PROD-2024-%&#39;         (PREFIX, priority=20, selectivity=0.02)
2. description LIKE &#39;%rare_word%&#39; (SUBSTRING, priority=35, selectivity=0.15)
3. name LIKE &#39;%common%&#39;           (SUBSTRING, priority=55, selectivity=0.60)"><pre><span><span>--</span> Query:</span>
<span>WHERE</span> name <span>LIKE</span> <span><span>&#39;</span>%common%<span>&#39;</span></span>           <span><span>--</span> Low selectivity</span>
  <span>AND</span> sku <span>LIKE</span> <span><span>&#39;</span>PROD-2024-%<span>&#39;</span></span>         <span><span>--</span> High selectivity (prefix)</span>
  <span>AND</span> description <span>LIKE</span> <span><span>&#39;</span>%rare_word%<span>&#39;</span></span> <span><span>--</span> Medium selectivity</span>

<span><span>--</span> Execution order (Biscuit automatically reorders):</span>
<span>1</span>. sku <span>LIKE</span> <span><span>&#39;</span>PROD-2024-%<span>&#39;</span></span>         (PREFIX, priority<span>=</span><span>20</span>, selectivity<span>=</span><span>0</span>.<span>02</span>)
<span>2</span>. description <span>LIKE</span> <span><span>&#39;</span>%rare_word%<span>&#39;</span></span> (<span>SUBSTRING</span>, priority<span>=</span><span>35</span>, selectivity<span>=</span><span>0</span>.<span>15</span>)
<span>3</span>. name <span>LIKE</span> <span><span>&#39;</span>%common%<span>&#39;</span></span>           (<span>SUBSTRING</span>, priority<span>=</span><span>55</span>, selectivity<span>=</span><span>0</span>.<span>60</span>)</pre></div>
<p dir="auto"><strong>Selectivity scoring formula:</strong></p>
<div data-snippet-clipboard-copy-content="score = 1.0 / (concrete_chars + 1)
      - (underscore_count √ó 0.05)
      + (partition_count √ó 0.15)
      - (anchor_strength / 200)"><pre><code>score = 1.0 / (concrete_chars + 1)
      - (underscore_count √ó 0.05)
      + (partition_count √ó 0.15)
      - (anchor_strength / 200)
</code></pre></div>
<p dir="auto"><strong>Priority tiers:</strong></p>
<ol dir="auto">
<li><strong>0-10</strong>: Exact matches, many underscores</li>
<li><strong>10-20</strong>: Non-% patterns with underscores</li>
<li><strong>20-30</strong>: Strong anchored patterns (prefix/suffix)</li>
<li><strong>30-40</strong>: Weak anchored patterns</li>
<li><strong>40-50</strong>: Multi-partition patterns</li>
<li><strong>50-60</strong>: Substring patterns (lowest priority)</li>
</ol>
<hr/>


<div dir="auto" data-snippet-clipboard-copy-content="-- Create 1M row test table
CREATE TABLE benchmark (
    id SERIAL PRIMARY KEY,
    name TEXT,
    description TEXT,
    category TEXT,
    score FLOAT
);

INSERT INTO benchmark (name, description, category, score)
SELECT 
    &#39;Name_&#39; || md5(random()::text),
    &#39;Description_&#39; || md5(random()::text),
    &#39;Category_&#39; || (random() * 100)::int,
    random() * 1000
FROM generate_series(1, 1000000);

-- Create indexes
CREATE INDEX idx_trgm ON benchmark 
    USING gin(name gin_trgm_ops, description gin_trgm_ops);

CREATE INDEX idx_biscuit ON benchmark 
    USING biscuit(name, description, category);

ANALYZE benchmark;"><pre><span><span>--</span> Create 1M row test table</span>
<span>CREATE</span> <span>TABLE</span> <span>benchmark</span> (
    id <span>SERIAL</span> <span>PRIMARY KEY</span>,
    name <span>TEXT</span>,
    description <span>TEXT</span>,
    category <span>TEXT</span>,
    score FLOAT
);

<span>INSERT INTO</span> benchmark (name, description, category, score)
<span>SELECT</span> 
    <span><span>&#39;</span>Name_<span>&#39;</span></span> <span>||</span> md5(random()::<span>text</span>),
    <span><span>&#39;</span>Description_<span>&#39;</span></span> <span>||</span> md5(random()::<span>text</span>),
    <span><span>&#39;</span>Category_<span>&#39;</span></span> <span>||</span> (random() <span>*</span> <span>100</span>)::<span>int</span>,
    random() <span>*</span> <span>1000</span>
<span>FROM</span> generate_series(<span>1</span>, <span>1000000</span>);

<span><span>--</span> Create indexes</span>
<span>CREATE</span> <span>INDEX</span> <span>idx_trgm</span> <span>ON</span> benchmark 
    USING gin(name gin_trgm_ops, description gin_trgm_ops);

<span>CREATE</span> <span>INDEX</span> <span>idx_biscuit</span> <span>ON</span> benchmark 
    USING biscuit(name, description, category);

ANALYZE benchmark;</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="-- Single column, simple pattern
EXPLAIN ANALYZE
SELECT * FROM benchmark WHERE name LIKE &#39;%abc%&#39; LIMIT 100;

-- Multi-column, complex pattern
EXPLAIN ANALYZE
SELECT * FROM benchmark 
WHERE name LIKE &#39;%a%b&#39; 
  AND description LIKE &#39;%bc%cd%&#39;
ORDER BY score DESC 
LIMIT 10;

-- Aggregate query (COUNT)
EXPLAIN ANALYZE
SELECT COUNT(*) FROM benchmark 
WHERE name LIKE &#39;a%l%&#39; 
  AND category LIKE &#39;f%d&#39;;

-- Complex multi-part pattern
EXPLAIN ANALYZE
SELECT * FROM benchmark 
WHERE description LIKE &#39;u%dc%x&#39;
LIMIT 50;"><pre><span><span>--</span> Single column, simple pattern</span>
EXPLAIN ANALYZE
<span>SELECT</span> <span>*</span> <span>FROM</span> benchmark <span>WHERE</span> name <span>LIKE</span> <span><span>&#39;</span>%abc%<span>&#39;</span></span> <span>LIMIT</span> <span>100</span>;

<span><span>--</span> Multi-column, complex pattern</span>
EXPLAIN ANALYZE
<span>SELECT</span> <span>*</span> <span>FROM</span> benchmark 
<span>WHERE</span> name <span>LIKE</span> <span><span>&#39;</span>%a%b<span>&#39;</span></span> 
  <span>AND</span> description <span>LIKE</span> <span><span>&#39;</span>%bc%cd%<span>&#39;</span></span>
<span>ORDER BY</span> score <span>DESC</span> 
<span>LIMIT</span> <span>10</span>;

<span><span>--</span> Aggregate query (COUNT)</span>
EXPLAIN ANALYZE
<span>SELECT</span> <span>COUNT</span>(<span>*</span>) <span>FROM</span> benchmark 
<span>WHERE</span> name <span>LIKE</span> <span><span>&#39;</span>a%l%<span>&#39;</span></span> 
  <span>AND</span> category <span>LIKE</span> <span><span>&#39;</span>f%d<span>&#39;</span></span>;

<span><span>--</span> Complex multi-part pattern</span>
EXPLAIN ANALYZE
<span>SELECT</span> <span>*</span> <span>FROM</span> benchmark 
<span>WHERE</span> description <span>LIKE</span> <span><span>&#39;</span>u%dc%x<span>&#39;</span></span>
<span>LIMIT</span> <span>50</span>;</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="-- Show internal statistics
SELECT biscuit_index_stats(&#39;idx_biscuit&#39;::regclass);"><pre><span><span>--</span> Show internal statistics</span>
<span>SELECT</span> biscuit_index_stats(<span><span>&#39;</span>idx_biscuit<span>&#39;</span></span>::regclass);</pre></div>
<p dir="auto"><strong>Output:</strong></p>
<div data-snippet-clipboard-copy-content="----------------------------------------------------
 Biscuit Index Statistics (FULLY OPTIMIZED)        +
 ==========================================        +
 Index: idx_biscuit                                +
 Active records: 1000002                           +
 Total slots: 1000002                              +
 Free slots: 0                                     +
 Tombstones: 0                                     +
 Max length: 44                                    +
 ------------------------                          +
 CRUD Statistics:                                  +
   Inserts: 0                                      +
   Updates: 0                                      +
   Deletes: 0                                      +
 ------------------------                          +
 Active Optimizations:                             +
   ‚úì 1. Skip wildcard intersections                +
   ‚úì 2. Early termination on empty                 +
   ‚úì 3. Avoid redundant copies                     +
   ‚úì 4. Optimized single-part patterns             +
   ‚úì 5. Skip unnecessary length ops                +
   ‚úì 6. TID sorting for sequential I/O             +
   ‚úì 7. Batch TID insertion                        +
   ‚úì 8. Direct bitmap iteration                    +
   ‚úì 9. Parallel bitmap scan support               +
   ‚úì 10. Batch cleanup on threshold                +
   ‚úì 11. Skip sorting for bitmap scans (aggregates)+
   ‚úì 12. LIMIT-aware TID collection                +"><pre><code>----------------------------------------------------
 Biscuit Index Statistics (FULLY OPTIMIZED)        +
 ==========================================        +
 Index: idx_biscuit                                +
 Active records: 1000002                           +
 Total slots: 1000002                              +
 Free slots: 0                                     +
 Tombstones: 0                                     +
 Max length: 44                                    +
 ------------------------                          +
 CRUD Statistics:                                  +
   Inserts: 0                                      +
   Updates: 0                                      +
   Deletes: 0                                      +
 ------------------------                          +
 Active Optimizations:                             +
   ‚úì 1. Skip wildcard intersections                +
   ‚úì 2. Early termination on empty                 +
   ‚úì 3. Avoid redundant copies                     +
   ‚úì 4. Optimized single-part patterns             +
   ‚úì 5. Skip unnecessary length ops                +
   ‚úì 6. TID sorting for sequential I/O             +
   ‚úì 7. Batch TID insertion                        +
   ‚úì 8. Direct bitmap iteration                    +
   ‚úì 9. Parallel bitmap scan support               +
   ‚úì 10. Batch cleanup on threshold                +
   ‚úì 11. Skip sorting for bitmap scans (aggregates)+
   ‚úì 12. LIMIT-aware TID collection                +
</code></pre></div>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Index</th>
<th>Command</th>
<th>Build Time</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>pg_trgm</strong></td>
<td><code>CREATE INDEX idx_trgm ...</code></td>
<td><strong>20,358.655 ms</strong></td>
</tr>
<tr>
<td><strong>biscuit</strong></td>
<td><code>CREATE INDEX idx_biscuit ...</code></td>
<td><strong>2,734.310 ms</strong></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<hr/>

<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>1. Full-Text Search Applications</strong></h3><a id="user-content-1-full-text-search-applications" aria-label="Permalink: 1. Full-Text Search Applications" href="#1-full-text-search-applications"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="-- E-commerce product search
CREATE INDEX idx_products ON products 
    USING biscuit(name, brand, description);

SELECT * FROM products 
WHERE name LIKE &#39;%laptop%&#39; 
  AND brand LIKE &#39;ABC%&#39;
  AND description LIKE &#39;%gaming%&#39;
ORDER BY price DESC 
LIMIT 20;"><pre><span><span>--</span> E-commerce product search</span>
<span>CREATE</span> <span>INDEX</span> <span>idx_products</span> <span>ON</span> products 
    USING biscuit(name, brand, description);

<span>SELECT</span> <span>*</span> <span>FROM</span> products 
<span>WHERE</span> name <span>LIKE</span> <span><span>&#39;</span>%laptop%<span>&#39;</span></span> 
  <span>AND</span> brand <span>LIKE</span> <span><span>&#39;</span>ABC%<span>&#39;</span></span>
  <span>AND</span> description <span>LIKE</span> <span><span>&#39;</span>%gaming%<span>&#39;</span></span>
<span>ORDER BY</span> price <span>DESC</span> 
<span>LIMIT</span> <span>20</span>;</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="-- Search error logs
CREATE INDEX idx_logs ON logs 
    USING biscuit(message, source, level);

SELECT * FROM logs 
WHERE message LIKE &#39;%ERROR%connection%timeout%&#39;
  AND source LIKE &#39;api.%&#39;
  AND timestamp &gt; NOW() - INTERVAL &#39;1 hour&#39;
LIMIT 100;"><pre><span><span>--</span> Search error logs</span>
<span>CREATE</span> <span>INDEX</span> <span>idx_logs</span> <span>ON</span> logs 
    USING biscuit(message, source, level);

<span>SELECT</span> <span>*</span> <span>FROM</span> logs 
<span>WHERE</span> message <span>LIKE</span> <span><span>&#39;</span>%ERROR%connection%timeout%<span>&#39;</span></span>
  <span>AND</span> source <span>LIKE</span> <span><span>&#39;</span>api.%<span>&#39;</span></span>
  <span>AND</span> <span>timestamp</span> <span>&gt;</span> NOW() <span>-</span> INTERVAL <span><span>&#39;</span>1 hour<span>&#39;</span></span>
<span>LIMIT</span> <span>100</span>;</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>3. Customer Support / CRM</strong></h3><a id="user-content-3-customer-support--crm" aria-label="Permalink: 3. Customer Support / CRM" href="#3-customer-support--crm"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="-- Search tickets by multiple fields
CREATE INDEX idx_tickets ON tickets 
    USING biscuit(subject, description, customer_name);

SELECT * FROM tickets 
WHERE subject LIKE &#39;%refund%&#39;
  AND customer_name LIKE &#39;John%&#39;
  AND status = &#39;open&#39;
ORDER BY created_at DESC;"><pre><span><span>--</span> Search tickets by multiple fields</span>
<span>CREATE</span> <span>INDEX</span> <span>idx_tickets</span> <span>ON</span> tickets 
    USING biscuit(subject, description, customer_name);

<span>SELECT</span> <span>*</span> <span>FROM</span> tickets 
<span>WHERE</span> subject <span>LIKE</span> <span><span>&#39;</span>%refund%<span>&#39;</span></span>
  <span>AND</span> customer_name <span>LIKE</span> <span><span>&#39;</span>John%<span>&#39;</span></span>
  <span>AND</span> status <span>=</span> <span><span>&#39;</span>open<span>&#39;</span></span>
<span>ORDER BY</span> created_at <span>DESC</span>;</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>4. Code Search / Documentation</strong></h3><a id="user-content-4-code-search--documentation" aria-label="Permalink: 4. Code Search / Documentation" href="#4-code-search--documentation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="-- Search code repositories
CREATE INDEX idx_files ON code_files 
    USING biscuit(filename, content, author);

SELECT * FROM code_files 
WHERE filename LIKE &#39;%.py&#39;
  AND content LIKE &#39;%def%parse%json%&#39;
  AND author LIKE &#39;team-%&#39;;"><pre><span><span>--</span> Search code repositories</span>
<span>CREATE</span> <span>INDEX</span> <span>idx_files</span> <span>ON</span> code_files 
    USING biscuit(filename, content, author);

<span>SELECT</span> <span>*</span> <span>FROM</span> code_files 
<span>WHERE</span> filename <span>LIKE</span> <span><span>&#39;</span>%.py<span>&#39;</span></span>
  <span>AND</span> content <span>LIKE</span> <span><span>&#39;</span>%def%parse%json%<span>&#39;</span></span>
  <span>AND</span> author <span>LIKE</span> <span><span>&#39;</span>team-%<span>&#39;</span></span>;</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>5. Analytics with Aggregates</strong></h3><a id="user-content-5-analytics-with-aggregates" aria-label="Permalink: 5. Analytics with Aggregates" href="#5-analytics-with-aggregates"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="-- Fast COUNT queries (no sorting overhead)
CREATE INDEX idx_events ON events 
    USING biscuit(event_type, user_agent, referrer);

SELECT COUNT(*) FROM events 
WHERE event_type LIKE &#39;click%&#39;
  AND user_agent LIKE &#39;%Mobile%&#39;
  AND referrer LIKE &#39;%google%&#39;;"><pre><span><span>--</span> Fast COUNT queries (no sorting overhead)</span>
<span>CREATE</span> <span>INDEX</span> <span>idx_events</span> <span>ON</span> events 
    USING biscuit(event_type, user_agent, referrer);

<span>SELECT</span> <span>COUNT</span>(<span>*</span>) <span>FROM</span> events 
<span>WHERE</span> event_type <span>LIKE</span> <span><span>&#39;</span>click%<span>&#39;</span></span>
  <span>AND</span> user_agent <span>LIKE</span> <span><span>&#39;</span>%Mobile%<span>&#39;</span></span>
  <span>AND</span> referrer <span>LIKE</span> <span><span>&#39;</span>%google%<span>&#39;</span></span>;</pre></div>
<hr/>


<p dir="auto">Enable CRoaring for better performance:</p>

<p dir="auto">Currently, Biscuit doesn&#39;t expose tunable options. All optimizations are automatic.</p>
<hr/>
<div dir="auto"><h2 tabindex="-1" dir="auto"><strong>Limitations and Trade-offs</strong></h2><a id="user-content-limitations-and-trade-offs" aria-label="Permalink: Limitations and Trade-offs" href="#limitations-and-trade-offs"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>What Biscuit Does NOT Support</strong></h3><a id="user-content-what-biscuit-does-not-support" aria-label="Permalink: What Biscuit Does NOT Support" href="#what-biscuit-does-not-support"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ol dir="auto">
<li><strong>Regular expressions</strong> - Only <code>LIKE</code> / <code>ILIKE</code> patterns with <code>%</code> and <code>_</code></li>
<li><strong>Locale-specific collations</strong> - String comparisons are byte-based</li>
<li><strong>Amcanorder = false</strong> - Cannot provide ordered scans directly (but see below)</li>
</ol>
<div dir="auto"><h3 tabindex="-1" dir="auto"><strong>ORDER BY + LIMIT Behavior</strong></h3><a id="user-content-order-by--limit-behavior" aria-label="Permalink: ORDER BY + LIMIT Behavior" href="#order-by--limit-behavior"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Biscuit doesn&#39;t support ordered index scans (<code>amcanorder = false</code>), BUT:</p>
<p dir="auto"><strong>PostgreSQL&#39;s planner handles this efficiently:</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="SELECT * FROM table WHERE col LIKE &#39;%pattern%&#39; ORDER BY score LIMIT 10;"><pre><span>SELECT</span> <span>*</span> <span>FROM</span> table <span>WHERE</span> col <span>LIKE</span> <span><span>&#39;</span>%pattern%<span>&#39;</span></span> <span>ORDER BY</span> score <span>LIMIT</span> <span>10</span>;</pre></div>
<p dir="auto"><strong>Execution plan:</strong></p>
<div data-snippet-clipboard-copy-content="Limit
  -&gt; Sort (cheap, small result set)
    -&gt; Biscuit Index Scan (fast filtering)"><pre><code>Limit
  -&gt; Sort (cheap, small result set)
    -&gt; Biscuit Index Scan (fast filtering)
</code></pre></div>
<p dir="auto"><strong>Why this works:</strong></p>
<ul dir="auto">
<li>Biscuit filters candidates extremely fast</li>
<li>Result set is small after filtering</li>
<li>Sorting 100-1000 rows in memory is negligible (&lt;1ms)</li>
<li><strong>Net result</strong>: Still much faster than pg_trgm with recheck overhead</li>
</ul>

<p dir="auto">Biscuit stores bitmaps in memory:</p>
<ul dir="auto">
<li>Use <code>REINDEX</code> to rebuild if index grows too large</li>
</ul>

<ul dir="auto">
<li><strong>INSERT</strong>: Similar to B-tree (must update bitmaps)</li>
<li><strong>UPDATE</strong>: Two operations (remove old, insert new)</li>
<li><strong>DELETE</strong>: Marks as tombstone, batch cleanup at threshold</li>
</ul>
<hr/>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Feature</th>
<th>Biscuit</th>
<th>pg_trgm (GIN)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Wildcard patterns</strong></td>
<td>‚úî Native, exact</td>
<td>‚úî Approximate</td>
</tr>
<tr>
<td><strong>Recheck overhead</strong></td>
<td>‚úî None (deterministic)</td>
<td>‚úó Always required</td>
</tr>
<tr>
<td><strong>Multi-column</strong></td>
<td>‚úî Optimized</td>
<td><g-emoji alias="warning">‚ö†Ô∏è</g-emoji> Via btree_gist</td>
</tr>
<tr>
<td><strong>Aggregate queries</strong></td>
<td>‚úî Optimized</td>
<td>‚úó Same cost</td>
</tr>
<tr>
<td><strong>ORDER BY + LIMIT</strong></td>
<td>‚úî Works well</td>
<td>‚úî Ordered scans</td>
</tr>
<tr>
<td><strong>Regex support</strong></td>
<td>‚úó No</td>
<td>‚úî Yes</td>
</tr>
<tr>
<td><strong>Similarity search</strong></td>
<td>‚úó No</td>
<td>‚úî Yes</td>
</tr>
<tr>
<td><strong>ILIKE support</strong></td>
<td>‚úî Full</td>
<td>‚úî Native</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><strong>When to use Biscuit:</strong></p>
<ul dir="auto">
<li>Wildcard-heavy <code>LIKE</code> / <code>ILIKE</code> queries (<code>%</code>, <code>_</code>)</li>
<li>Multi-column pattern matching</li>
<li>Need exact results (no false positives)</li>
<li><code>COUNT(*)</code> / aggregate queries</li>
<li>High query volume, can afford memory</li>
</ul>
<p dir="auto"><strong>When to use pg_trgm:</strong></p>
<ul dir="auto">
<li>Fuzzy/similarity search (<code>word &lt;-&gt; pattern</code>)</li>
<li>Regular expressions</li>
<li>Memory-constrained environments</li>
<li>Write-heavy workloads</li>
</ul>
<hr/>


<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/Crystallinecore/biscuit.git
cd biscuit

# Development build with debug symbols
make clean
CFLAGS=&#34;-g -O0 -DDEBUG&#34; make

# Run tests
make installcheck

# Install
sudo make install"><pre>git clone https://github.com/Crystallinecore/biscuit.git
<span>cd</span> biscuit

<span><span>#</span> Development build with debug symbols</span>
make clean
CFLAGS=<span><span>&#34;</span>-g -O0 -DDEBUG<span>&#34;</span></span> make

<span><span>#</span> Run tests</span>
make installcheck

<span><span>#</span> Install</span>
sudo make install</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="# Unit tests
make installcheck

# Manual testing
psql -d testdb

CREATE EXTENSION biscuit;

-- Create test table
CREATE TABLE test (id SERIAL, name TEXT);
INSERT INTO test (name) VALUES (&#39;hello&#39;), (&#39;world&#39;), (&#39;test&#39;);

-- Create index
CREATE INDEX idx_test ON test USING biscuit(name);

-- Test queries
EXPLAIN ANALYZE SELECT * FROM test WHERE name LIKE &#39;%ell%&#39;;"><pre><span><span>#</span> Unit tests</span>
make installcheck

<span><span>#</span> Manual testing</span>
psql -d testdb

CREATE EXTENSION biscuit<span>;</span>

-- Create <span>test</span> table
CREATE TABLE <span>test</span> (id SERIAL, name TEXT)<span>;</span>
INSERT INTO <span>test</span> (name) VALUES (<span><span>&#39;</span>hello<span>&#39;</span></span>), (<span><span>&#39;</span>world<span>&#39;</span></span>), (<span><span>&#39;</span>test<span>&#39;</span></span>)<span>;</span>

-- Create index
CREATE INDEX idx_test ON <span>test</span> USING biscuit(name)<span>;</span>

-- Test queries
EXPLAIN ANALYZE SELECT <span>*</span> FROM <span>test</span> WHERE name LIKE <span><span>&#39;</span>%ell%<span>&#39;</span></span><span>;</span></pre></div>

<p dir="auto">Enable PostgreSQL debug logging:</p>
<div dir="auto" data-snippet-clipboard-copy-content="SET client_min_messages = DEBUG1;
SET log_min_messages = DEBUG1;

-- Now run queries to see Biscuit&#39;s internal logs
SELECT * FROM test WHERE name LIKE &#39;%pattern%&#39;;"><pre><span>SET</span> client_min_messages <span>=</span> DEBUG1;
<span>SET</span> log_min_messages <span>=</span> DEBUG1;

<span><span>--</span> Now run queries to see Biscuit&#39;s internal logs</span>
<span>SELECT</span> <span>*</span> <span>FROM</span> test <span>WHERE</span> name <span>LIKE</span> <span><span>&#39;</span>%pattern%<span>&#39;</span></span>;</pre></div>
<hr/>


<div data-snippet-clipboard-copy-content="BiscuitIndex
‚îú‚îÄ‚îÄ num_columns: int
‚îú‚îÄ‚îÄ column_indices[]: ColumnIndex[]
‚îÇ   ‚îú‚îÄ‚îÄ pos_idx[256]: CharIndex    // Forward position bitmaps
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ entries[]: PosEntry[]
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ pos: int
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ bitmap: RoaringBitmap
‚îÇ   ‚îú‚îÄ‚îÄ neg_idx[256]: CharIndex    // Backward position bitmaps
‚îÇ   ‚îú‚îÄ‚îÄ char_cache[256]: RoaringBitmap  // Character existence
‚îÇ   ‚îú‚îÄ‚îÄ length_bitmaps[]: RoaringBitmap[]  // Exact lengths
‚îÇ   ‚îî‚îÄ‚îÄ length_ge_bitmaps[]: RoaringBitmap[]  // Min lengths
‚îú‚îÄ‚îÄ insensitive_column_indices[]: ColumnIndex[]
‚îÇ   ‚îú‚îÄ‚îÄ insensitive_pos_idx[256]: CharIndex    // Forward position bitmaps
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ entries[]: PosEntry[]
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ pos: int
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ bitmap: RoaringBitmap
‚îÇ   ‚îú‚îÄ‚îÄ insensitive_neg_idx[256]: CharIndex    // Backward position bitmaps
‚îÇ   ‚îî‚îÄ‚îÄ insensitive_char_cache[256]: RoaringBitmap  // Character existence
‚îú‚îÄ‚îÄ tids[]: ItemPointerData[]      // Record TIDs
‚îú‚îÄ‚îÄ column_data_cache[][]: char**  // Cached string data
‚îî‚îÄ‚îÄ tombstones: RoaringBitmap      // Deleted records"><pre><code>BiscuitIndex
‚îú‚îÄ‚îÄ num_columns: int
‚îú‚îÄ‚îÄ column_indices[]: ColumnIndex[]
‚îÇ   ‚îú‚îÄ‚îÄ pos_idx[256]: CharIndex    // Forward position bitmaps
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ entries[]: PosEntry[]
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ pos: int
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ bitmap: RoaringBitmap
‚îÇ   ‚îú‚îÄ‚îÄ neg_idx[256]: CharIndex    // Backward position bitmaps
‚îÇ   ‚îú‚îÄ‚îÄ char_cache[256]: RoaringBitmap  // Character existence
‚îÇ   ‚îú‚îÄ‚îÄ length_bitmaps[]: RoaringBitmap[]  // Exact lengths
‚îÇ   ‚îî‚îÄ‚îÄ length_ge_bitmaps[]: RoaringBitmap[]  // Min lengths
‚îú‚îÄ‚îÄ insensitive_column_indices[]: ColumnIndex[]
‚îÇ   ‚îú‚îÄ‚îÄ insensitive_pos_idx[256]: CharIndex    // Forward position bitmaps
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ entries[]: PosEntry[]
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ pos: int
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ bitmap: RoaringBitmap
‚îÇ   ‚îú‚îÄ‚îÄ insensitive_neg_idx[256]: CharIndex    // Backward position bitmaps
‚îÇ   ‚îî‚îÄ‚îÄ insensitive_char_cache[256]: RoaringBitmap  // Character existence
‚îú‚îÄ‚îÄ tids[]: ItemPointerData[]      // Record TIDs
‚îú‚îÄ‚îÄ column_data_cache[][]: char**  // Cached string data
‚îî‚îÄ‚îÄ tombstones: RoaringBitmap      // Deleted records
</code></pre></div>

<div data-snippet-clipboard-copy-content="1. biscuit_rescan()
   ‚îú‚îÄ&gt; Parse LIKE pattern into parts
   ‚îú‚îÄ&gt; Analyze pattern selectivity (multi-column)
   ‚îú‚îÄ&gt; Reorder predicates by priority
   ‚îî‚îÄ&gt; For each predicate:
       ‚îú‚îÄ&gt; biscuit_query_column_pattern()
       ‚îÇ   ‚îú‚îÄ&gt; Check fast paths (empty, %, pure wildcards)
       ‚îÇ   ‚îú‚îÄ&gt; Match pattern parts using bitmaps
       ‚îÇ   ‚îî‚îÄ&gt; Return candidate bitmap
       ‚îî‚îÄ&gt; Intersect with previous candidates

2. biscuit_collect_tids_optimized()
   ‚îú‚îÄ&gt; Detect aggregate vs. regular query
   ‚îú‚îÄ&gt; Estimate LIMIT hint
   ‚îú‚îÄ&gt; Collect TIDs from final bitmap
   ‚îú‚îÄ&gt; Sort if needed (skip for aggregates)
   ‚îî‚îÄ&gt; Apply LIMIT early termination

3. biscuit_gettuple() or biscuit_getbitmap()
   ‚îî‚îÄ&gt; Return results to PostgreSQL executor"><pre><code>1. biscuit_rescan()
   ‚îú‚îÄ&gt; Parse LIKE pattern into parts
   ‚îú‚îÄ&gt; Analyze pattern selectivity (multi-column)
   ‚îú‚îÄ&gt; Reorder predicates by priority
   ‚îî‚îÄ&gt; For each predicate:
       ‚îú‚îÄ&gt; biscuit_query_column_pattern()
       ‚îÇ   ‚îú‚îÄ&gt; Check fast paths (empty, %, pure wildcards)
       ‚îÇ   ‚îú‚îÄ&gt; Match pattern parts using bitmaps
       ‚îÇ   ‚îî‚îÄ&gt; Return candidate bitmap
       ‚îî‚îÄ&gt; Intersect with previous candidates

2. biscuit_collect_tids_optimized()
   ‚îú‚îÄ&gt; Detect aggregate vs. regular query
   ‚îú‚îÄ&gt; Estimate LIMIT hint
   ‚îú‚îÄ&gt; Collect TIDs from final bitmap
   ‚îú‚îÄ&gt; Sort if needed (skip for aggregates)
   ‚îî‚îÄ&gt; Apply LIMIT early termination

3. biscuit_gettuple() or biscuit_getbitmap()
   ‚îî‚îÄ&gt; Return results to PostgreSQL executor
</code></pre></div>
<hr/>

<p dir="auto">Contributions are welcome! Please:</p>
<ol dir="auto">
<li>Fork the repository</li>
<li>Create a feature branch (<code>git checkout -b feature/amazing</code>)</li>
<li>Make your changes with tests</li>
<li>Submit a pull request</li>
</ol>

<ul>
<li> Implement <code>amcanorder</code> for native sorted scans</li>
<li> Add statistics collection for better cost estimation</li>
<li> Support for more data types (JSON, arrays)</li>
<li> Parallel index build</li>
<li> Index compression options</li>
</ul>
<hr/>

<p dir="auto">MIT License - See LICENSE file for details.</p>
<hr/>

<p dir="auto">Sivaprasad Murali</p>
<ul dir="auto">
<li>Email: <a href="mailto:sivaprasad.off@gmail.com">sivaprasad.off@gmail.com</a></li>
<li>GitHub: <a href="https://github.com/Crystallinecore">@Crystallinecore</a></li>
</ul>
<hr/>

<ul dir="auto">
<li>PostgreSQL community for the extensible index AM framework</li>
<li>CRoaring library for efficient bitmap operations</li>
<li>Inspired by the need for faster LIKE query performance in production systems</li>
</ul>
<hr/>

<ul dir="auto">
<li><strong>Issues</strong>: <a href="https://github.com/Crystallinecore/biscuit/issues">GitHub Issues</a></li>
<li><strong>Discussions</strong>: <a href="https://github.com/Crystallinecore/biscuit/discussions">GitHub Discussions</a></li>
<li><strong>Documentation</strong>: <a href="https://biscuit.readthedocs.io/" rel="nofollow">ReadTheDocs Page</a></li>
</ul>
<hr/>
<p dir="auto"><strong>Happy pattern matching! Grab a biscuit üç™ when pg_trgm feels half-baked!</strong></p>
<hr/>
</article></div></div>
  </body>
</html>
