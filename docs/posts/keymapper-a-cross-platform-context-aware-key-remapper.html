<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/houmain/keymapper">Original</a>
    <h1>Keymapper: A cross-platform context-aware key remapper</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">
<a href="https://github.com/houmain/keymapper/actions/workflows/build.yml">
<img alt="Build" src="https://github.com/houmain/keymapper/actions/workflows/build.yml/badge.svg"/></a>
<a href="https://github.com/houmain/keymapper/issues">
<img alt="Issues" src="https://camo.githubusercontent.com/ff7294170d24f32ceb5f129a5fc9873d15e2ea4f9e64365d3c3c4f2032ce39ca/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6973737565732d7261772f686f756d61696e2f6b65796d61707065722e737667" data-canonical-src="https://img.shields.io/github/issues-raw/houmain/keymapper.svg"/></a>
</p><p dir="auto"><a href="#configuration">Configuration</a> |
<a href="#example-configuration">Example</a> |
<a href="#functional-principle">Functional principle</a> |
<a href="#keymapperctl">keymapperctl</a> |
<a href="#installation">Installation</a> |
<a href="#building">Building</a> |
<a href="https://github.com/houmain/keymapper/releases">Changelog</a></p>

<p dir="auto">A cross-platform context-aware key remapper. It allows to:</p>
<ul dir="auto">
<li>Redefine your keyboard layout and shortcuts systemwide or per application.</li>
<li>Manage all your keyboard shortcuts in a single configuration file.</li>
<li>Change shortcuts for similar actions in different applications at once.</li>
<li>Share configuration files between multiple systems (GNU/Linux, Windows, MacOS).</li>
<li>Specify input and output as <a href="#character-typing">characters</a> instead of the keys required to type them.</li>
<li>Bind keyboard shortcuts to <a href="#application-launching">launch applications</a>.</li>
<li>Control the state from external applications using <a href="#keymapperctl">keymapperctl</a>.</li>
<li>Use <a href="#key-names">mouse buttons and wheel</a> in your mappings.</li>
</ul>

<p dir="auto">Configuration files are easily written by hand and mostly consist of lines with <a href="#input-expressions">input expressions</a> and corresponding <a href="#output-expressions">output expressions</a> separated by <code>&gt;&gt;</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# comments start with # and continue until the end of a line
CapsLock &gt;&gt; Backspace
Z &gt;&gt; Y
Y &gt;&gt; Z
Control{Q} &gt;&gt; Alt{F4}"><pre><span><span>#</span> comments start with # and continue until the end of a line</span>
CapsLock <span>&gt;&gt;</span> Backspace
Z <span>&gt;&gt;</span> Y
Y <span>&gt;&gt;</span> Z
Control{Q} <span>&gt;&gt;</span> Alt{F4}</pre></div>
<p dir="auto">Unless overridden using the command line argument <code>-c</code>, the configuration is read from <code>keymapper.conf</code>, which is looked for in the common places:</p>
<ul dir="auto">
<li>on all systems in <code>$XDG_CONFIG_HOME</code> and <code>$HOME/.config</code>,</li>
<li>on Linux and MacOS also in <code>/etc</code>,</li>
<li>on Windows also in the user&#39;s profile, <code>AppData\Local</code> and <code>AppData\Roaming</code> folders,</li>
</ul>
<p dir="auto">each with an optional <code>keymapper</code> subdirectory and finally in the working directory.</p>
<p dir="auto">The command line argument <code>-u</code> causes the configuration to be automatically reloaded whenever the configuration file changes.</p>
<p dir="auto"><g-emoji alias="warning">⚠️</g-emoji> <strong>In case of emergency:</strong> You can always press the special key combination <kbd>Shift</kbd>+<kbd>Escape</kbd>+<kbd>K</kbd> to terminate <code>keymapperd</code>.</p>

<p dir="auto">The keys are named after their scan codes and are not affected by the present keyboard layout.
The names have been chosen to match on what the <a href="https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/code/code_values" rel="nofollow">web browsers</a> have agreed upon, so this <a href="http://keycode.info/" rel="nofollow">handy website</a> can be used to get a key&#39;s name.
For convenience the letter and digits keys are also named <code>A</code> to <code>Z</code> and <code>0</code> to <code>9</code>. The logical keys <code>Shift</code>, <code>Control</code>, <code>Alt</code> and <code>Meta</code> are also defined (each matches the left and right modifier keys). There are also <a href="#virtual-keys">virtual keys</a> for state switching, an <a href="#any-key">Any key</a> and a <a href="#no-key">No key</a>.</p>
<p dir="auto">The mouse buttons are named <code>ButtonLeft</code>, <code>ButtonRight</code>, <code>ButtonMiddle</code>, <code>ButtonBack</code> and <code>ButtonForward</code>, the wheel is named <code>WheelUp</code>, <code>WheelDown</code>, <code>WheelLeft</code> and <code>WheelRight</code>.</p>
<p dir="auto">It is also possible to directly provide the scan code instead of the key name in decimal or hex notation (e.g. <code>159</code>, <code>0x9F</code>).</p>
<p dir="auto"><g-emoji alias="warning">⚠️</g-emoji> Beware that the configuration file is <strong>case sensitive</strong>.</p>

<p dir="auto">Input expressions consist of one or more key names separated by spaces or parenthesis, which give them different meaning:</p>
<ul dir="auto">
<li><code>A B</code> means that keys have to be pressed successively (released in any order).</li>
<li><code>(A B)</code> means that keys have to be pressed simultaneously in any order.</li>
<li><code>A{B}</code> means that a key has to be held while another is pressed.</li>
<li><code>!A</code> means that a key must not be pressed.</li>
<li>Groups and modifiers can also be nested like <code>A{B{C}}</code> or <code>(A B){C}</code>.</li>
<li><code>&#34;...&#34;</code> string literals match when the enclosed <a href="#character-typing">characters are typed</a>.</li>
<li>With an initial <code>?</code> the mapping gets skipped as long as it only partially matches.</li>
</ul>

<p dir="auto">The output expression format is analogous to the input expression format:</p>
<ul dir="auto">
<li><code>A B</code> means that keys are pressed successively.</li>
<li><code>(A B)</code> means that both keys are pressed simultaneously.</li>
<li><code>A{B}</code> means that a key is held while another is pressed.</li>
<li><code>!A</code> means that the (potentially pressed) key should be released before the rest of the expression is applied. This also works for virtual keys.</li>
<li><code>^</code> splits the output in two parts, one which is applied when the input key is pressed and one when the <a href="#output-on-key-release">key is released</a>.</li>
<li><code>&#34;...&#34;</code> string literals allow to specify <a href="#character-typing">characters to type</a>.</li>
<li><code>$()</code> can be used for <a href="#application-launching">launching applications</a>.</li>
<li>An empty expression can be used to suppress any output.</li>
</ul>

<p dir="auto">Mappings are applied in consecutive order until a match is found, therefore their order is of importance. While the following outputs <code>A</code> as soon as <code>Meta</code> is pressed:</p>

<p dir="auto">The other way round, nothing is output when <code>Meta</code> is pressed alone because depending on whether an <code>X</code> follows, either <code>B</code> or <code>A</code> is output:</p>

<p dir="auto"><g-emoji alias="warning">⚠️</g-emoji> You may want to add a <code>@forward-modifiers</code> <a href="#directives">directive</a> to your configuration, which ensures that the common mouse-modifiers are never held back:</p>
<div dir="auto" data-snippet-clipboard-copy-content="@forward-modifiers Shift Control Alt"><pre>@<span>forward</span><span>-</span><span>modifiers</span> <span>Shift</span> <span>Control</span> <span>Alt</span></pre></div>
<p dir="auto">For a detailed description of how the mapping is applied, see the <a href="#functional-principle">Functional principle</a> section.</p>

<p dir="auto">Context blocks allow to enable mappings only in specific contexts. A context can be defined by <code>system</code>, the focused window <code>title</code>, window <code>class</code>, process <code>path</code> or the input <code>device</code>/<code>device-id</code> an event originates from.</p>
<div dir="auto" data-snippet-clipboard-copy-content="[default]

[title = &#34;Visual Studio&#34;]

[system = &#34;Linux&#34;, class != &#34;qtcreator&#34;] # &#39;!=&#39; inverses a condition

[device = &#34;Some Device Name&#34;] # consecutive blocks share mappings
[device = &#34;Some Other Device&#34;]

[system = &#34;Windows&#34; path = &#34;notepad.exe&#34;] # comma separator is optional"><pre>[default]

[title <span>=</span> <span><span>&#34;</span>Visual Studio<span>&#34;</span></span>]

[system <span>=</span> <span><span>&#34;</span>Linux<span>&#34;</span></span>, class <span>!=</span> <span><span>&#34;</span>qtcreator<span>&#34;</span></span>] <span><span>#</span> &#39;!=&#39; inverses a condition</span>

[device <span>=</span> <span><span>&#34;</span>Some Device Name<span>&#34;</span></span>] <span><span>#</span> consecutive blocks share mappings</span>
[device <span>=</span> <span><span>&#34;</span>Some Other Device<span>&#34;</span></span>]

[system <span>=</span> <span><span>&#34;</span>Windows<span>&#34;</span></span> path <span>=</span> <span><span>&#34;</span>notepad.exe<span>&#34;</span></span>] <span><span>#</span> comma separator is optional</span></pre></div>
<p dir="auto"><g-emoji alias="warning">⚠️</g-emoji> The <code>device</code>/<code>device-id</code> filters on Windows require the installation of a <a href="#virtual-device-driver">virtual device driver</a>. The process <code>path</code> may not be available on Wayland and for processes with higher privileges. The window <code>title</code> is not available on MacOS.</p>
<p dir="auto">The values of a context can be easily obtained using the <em>Next Key Info</em> function of the tray icon or <a href="#keymapperctl">keymapperctl</a>.</p>
<p dir="auto">Class and device filters match contexts with the <em>exact</em> same string, others match contexts <em>containing</em> the string.
For finer control <a href="https://en.wikipedia.org/wiki/Regular_expression" rel="nofollow">regular expressions</a> can be used. These have to be delimited with slashes. Optionally <code>i</code> can be appended to make the comparison case insensitive:</p>
<div dir="auto" data-snippet-clipboard-copy-content="[title = /Visual Studio Code|Code OSS/i]"><pre><span>[</span><span>title</span> <span>=</span> <span><span>/</span><span>V</span><span>i</span><span>s</span><span>u</span><span>a</span><span>l</span><span> </span><span>S</span><span>t</span><span>u</span><span>d</span><span>i</span><span>o</span><span> </span><span>C</span><span>o</span><span>d</span><span>e</span><span>|</span><span>C</span><span>o</span><span>d</span><span>e</span><span> </span><span>O</span><span>S</span><span>S</span><span>/</span>i</span><span>]</span></pre></div>
<p dir="auto">Additionally a <code>modifier</code> filter allows to activate blocks depending on the state of one or more keys:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# active when Virtual1 is down and Virtual2 is not
[modifier = &#34;Virtual1 !Virtual2&#34;]"><pre><span><span>#</span> active when Virtual1 is down and Virtual2 is not</span>
[modifier <span>=</span> <span><span>&#34;</span>Virtual1 !Virtual2<span>&#34;</span></span>]</pre></div>

<p dir="auto">To simplify mapping of one input expression to different output expressions, it can be mapped to an abstract command first. The command name can be chosen arbitrarily but must not be a key name. The configuration is case sensitive and all key names start with a capital letter, so it is advisable to begin command names with a lowercase letter:</p>

<p dir="auto">Subsequently this command can be mapped to one output expression per context. The last active mapping overrides the previous ones:</p>
<div dir="auto" data-snippet-clipboard-copy-content="build &gt;&gt; Control{B}

[title=&#34;Visual Studio&#34;]
build &gt;&gt; (Shift Control){B}"><pre>build <span>&gt;&gt;</span> Control{B}

[title<span>=</span><span><span>&#34;</span>Visual Studio<span>&#34;</span></span>]
build <span>&gt;&gt;</span> (Shift Control){B}</pre></div>

<p dir="auto">By inserting <code>[stage]</code> a configuration can be split into stages, which are evaluated separately. The output of a stage is the input of the following stage, where it can be mapped further:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# adjust keyboard layout
Z &gt;&gt; Y
Y &gt;&gt; Z

# map keys output by previous stage
[stage]
Control{Z} &gt;&gt; undo"><pre><span><span>#</span> adjust keyboard layout</span>
Z <span>&gt;&gt;</span> Y
Y <span>&gt;&gt;</span> Z

<span><span>#</span> map keys output by previous stage</span>
[stage]
Control{Z} <span>&gt;&gt;</span> undo</pre></div>

<p dir="auto">When an output expression contains <code>^</code>, it is only applied up to this point, when the input key is pressed. The part after the <code>^</code> is not applied until the input is released. Both parts can be empty:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# type &#34;cmd&#34; after the Windows run dialog appeared
Meta{C} &gt;&gt; Meta{R} ^ &#34;cmd&#34; Enter

# prevent key repeat
A &gt;&gt; B^

# output B when A is released
A &gt;&gt; ^B"><pre><span><span>#</span> type &#34;cmd&#34; after the Windows run dialog appeared</span>
Meta{C} <span>&gt;&gt;</span> Meta{R} ^ <span><span>&#34;</span>cmd<span>&#34;</span></span> Enter

<span><span>#</span> prevent key repeat</span>
A <span>&gt;&gt;</span> B^

<span><span>#</span> output B when A is released</span>
A <span>&gt;&gt;</span> ^B</pre></div>

<p dir="auto"><code>Virtual0</code> to <code>Virtual255</code> are virtual keys, which can be used as state switches. They are toggled when used in output expressions and can be used as modifiers in input expressions:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# Virtual1 is toggled whenever ScrollLock is pressed
ScrollLock &gt;&gt; Virtual1

# map A to B when Virtual1 is down
Virtual1{A} &gt;&gt; B

# map E to F when Virtual1 is NOT down
!Virtual1 E &gt;&gt; F

# keep G held as long as Virtual1 is down
Virtual1 &gt;&gt; G"><pre><span><span>#</span> Virtual1 is toggled whenever ScrollLock is pressed</span>
ScrollLock <span>&gt;&gt;</span> Virtual1

<span><span>#</span> map A to B when Virtual1 is down</span>
Virtual1{A} <span>&gt;&gt;</span> B

<span><span>#</span> map E to F when Virtual1 is NOT down</span>
<span>!</span>Virtual1 E <span>&gt;&gt;</span> F

<span><span>#</span> keep G held as long as Virtual1 is down</span>
Virtual1 <span>&gt;&gt;</span> G</pre></div>
<p dir="auto"><code>ContextActive</code> exists separately for each context and is toggled when the context becomes active/inactive:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# toggle Virtual1 when entering and when leaving context
[title=&#34;Firefox&#34;]
ContextActive &gt;&gt; Virtual1 ^ Virtual1"><pre><span><span>#</span> toggle Virtual1 when entering and when leaving context</span>
[title<span>=</span><span><span>&#34;</span>Firefox<span>&#34;</span></span>]
ContextActive <span>&gt;&gt;</span> Virtual1 ^ Virtual1</pre></div>

<p dir="auto"><code>Any</code> can be used in input and output expressions.
In input expressions it matches any key and in output expressions it outputs the matched input.</p>
<div dir="auto" data-snippet-clipboard-copy-content="# swap Control and Shift
Control{Any} &gt;&gt; Shift{Any}
Shift{Any} &gt;&gt; Control{Any}"><pre><span><span>#</span> swap Control and Shift</span>
Control{Any} <span>&gt;&gt;</span> Shift{Any}
Shift{Any} <span>&gt;&gt;</span> Control{Any}</pre></div>
<p dir="auto">To exclude an application from any mapping this can be added to the top of the configuration:</p>
<div dir="auto" data-snippet-clipboard-copy-content="[title=&#34;Remote Desktop&#34;]
Any &gt;&gt; Any

[default]"><pre>[title<span>=</span><span><span>&#34;</span>Remote Desktop<span>&#34;</span></span>]
Any <span>&gt;&gt;</span> Any

[default]</pre></div>
<p dir="auto">On the output side it can also be used to release previously pressed modifiers first:</p>


<p dir="auto">Input expressions can contain timeouts in milliseconds e.g. <code>500ms</code>, to specify a time in which no key is pressed:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# output Escape when CapsLock is held for a while
CapsLock{500ms} &gt;&gt; Escape

# output Escape when Control is pressed and released quickly
Control{!250ms} &gt;&gt; Escape

# output C when B quickly follows an A
A !250ms B &gt;&gt; C"><pre><span><span>#</span> output Escape when CapsLock is held for a while</span>
CapsLock{500ms} <span>&gt;&gt;</span> Escape

<span><span>#</span> output Escape when Control is pressed and released quickly</span>
Control{<span>!</span>250ms} <span>&gt;&gt;</span> Escape

<span><span>#</span> output C when B quickly follows an A</span>
A <span>!</span>250ms B <span>&gt;&gt;</span> C</pre></div>
<p dir="auto">In output expressions it can be used to delay output or keep a key held for a while. e.g:</p>


<p dir="auto">Output expressions can contain string literals with characters to type. The typeable characters depend on your keyboard layout. e.g:</p>
<div dir="auto" data-snippet-clipboard-copy-content="AltRight{A} &gt;&gt; &#39;@&#39;

# long lines can be split using &#39;\&#39;
Meta{A} K &gt;&gt; \
  &#34;Kind regards,\n&#34; \
  &#34;Douglas Quaid&#34;"><pre>AltRight{A} <span>&gt;&gt;</span> <span><span>&#39;</span>@<span>&#39;</span></span>

<span><span>#</span> long lines can be split using &#39;\&#39;</span>
Meta{A} K <span>&gt;&gt;</span> \
  <span><span>&#34;</span>Kind regards,\n<span>&#34;</span></span> \
  <span><span>&#34;</span>Douglas Quaid<span>&#34;</span></span></pre></div>
<p dir="auto">They can also be used in input expressions to match when the character are typed. e.g.:</p>
<div dir="auto" data-snippet-clipboard-copy-content="? &#39;Abc&#39; &gt;&gt; Backspace Backspace &#34;Matched!&#34;"><pre><span>?</span> <span><span>&#39;</span>Abc<span>&#39;</span></span> <span>&gt;&gt;</span> Backspace Backspace <span><span>&#34;</span>Matched!<span>&#34;</span></span></pre></div>
<p dir="auto"><g-emoji alias="warning">⚠️</g-emoji> The keyboard layout is evaluated when the configuration is loaded, switching is not yet supported.</p>

<p dir="auto">For convenience aliases for keys and even sequences can be defined. e.g.:</p>
<div dir="auto" data-snippet-clipboard-copy-content="Win = Meta
Boss = Virtual1
Alt = AltLeft | AltRight  # defines a logical key
proceed = Tab Tab Enter
greet = &#34;Hello&#34;"><pre>Win = Meta
Boss = Virtual1
Alt = AltLeft <span>|</span> AltRight  <span><span>#</span> defines a logical key</span>
proceed = Tab Tab Enter
greet = <span><span>&#34;</span>Hello<span>&#34;</span></span></pre></div>
<p dir="auto">In strings, regular expressions and terminal commands aliases can be inserted using <code>${Var}</code> or <code>$Var</code>. e.g.:</p>

<p dir="auto">An alias can also be parameterized to create a macro. The arguments are provided in square brackets and referenced by <code>$0</code>, <code>$1</code>... e.g.:</p>
<div dir="auto" data-snippet-clipboard-copy-content="print = $(echo $0 $1 &gt;&gt; ~/keymapper.txt)
F1 &gt;&gt; print[&#34;pressed the key&#34;, F1]"><pre>print = <span><span>$(</span>echo <span>$0</span> <span>$1</span> <span>&gt;&gt;</span> <span>~</span>/keymapper.txt<span>)</span></span>
F1 <span>&gt;&gt;</span> print[<span><span>&#34;</span>pressed the key<span>&#34;</span></span>, F1]</pre></div>
<p dir="auto">There are a few builtin macros <code>repeat[EXPR, N]</code>, <code>length[STR]</code>, <code>default[A, B]</code>, <code>apply[EXPR, ARGS...]</code>, <code>add/sub/mul/div/mod/min/max[A, B]</code> which allow to generate mappings and define some more advanced macros. e.g:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# when last character of string is typed, undo using backspace and output new string
substitute = ? &#34;$0&#34; &gt;&gt; repeat[Backspace, sub[length[&#34;$0&#34;], 1]] &#34;$1&#34;

# generate the string to output with an external program
substituteExec = ? &#34;$0&#34; &gt;&gt; \
  repeat[Backspace, sub[length[&#34;$0&#34;], 1]] \
  $(keymapperctl --type &#34;$($1)&#34;)

substitute[&#34;Cat&#34;, &#34;Dog&#34;]
substituteExec[&#34;:whoami&#34;, &#34;whoami&#34;]

# add a `FN &gt;&gt; Meta{N}` mapping for each function key
apply[F$0 &gt;&gt; Meta{$0}, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]"><pre><span><span>#</span> when last character of string is typed, undo using backspace and output new string</span>
substitute = <span>?</span> <span><span>&#34;</span><span>$0</span><span>&#34;</span></span> <span>&gt;&gt;</span> repeat[Backspace, sub[length[<span><span>&#34;</span><span>$0</span><span>&#34;</span></span>], 1]] <span><span>&#34;</span><span>$1</span><span>&#34;</span></span>

<span><span>#</span> generate the string to output with an external program</span>
substituteExec <span>=</span> <span>?</span> <span><span>&#34;</span><span>$0</span><span>&#34;</span></span> <span>&gt;&gt;</span> \
  repeat[Backspace, sub[length[<span><span>&#34;</span><span>$0</span><span>&#34;</span></span>], 1]] \
  <span><span>$(</span>keymapperctl --type <span><span>&#34;</span><span><span>$(</span><span>$1</span><span>)</span></span><span>&#34;</span></span><span>)</span></span>

substitute[<span><span>&#34;</span>Cat<span>&#34;</span></span>, <span><span>&#34;</span>Dog<span>&#34;</span></span>]
substituteExec[<span><span>&#34;</span>:whoami<span>&#34;</span></span>, <span><span>&#34;</span>whoami<span>&#34;</span></span>]

<span><span>#</span> add a `FN &gt;&gt; Meta{N}` mapping for each function key</span>
apply[F<span>$0</span> <span>&gt;&gt;</span> Meta{<span>$0</span>}, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]</pre></div>
<p dir="auto"><code>$$</code> is substituted with the actual parameter count, which allows to add overloads:</p>
<div dir="auto" data-snippet-clipboard-copy-content="log1 = $(echo &#34;$0&#34; &gt;&gt; $LOG_FILE)
log2 = $(echo &#34;[$1]&#34; &#34;$0&#34; &gt;&gt; $LOG_FILE)

# switch builds log1 or log2, which is then called with the second argument list
switch = $0$1
log = switch[&#34;log&#34;, $$][$0, $1]

F1 &gt;&gt; log[&#34;info message&#34;]
F2 &gt;&gt; log[&#34;error message&#34;, &#34;state&#34;]"><pre>log1 = <span><span>$(</span>echo <span><span>&#34;</span><span>$0</span><span>&#34;</span></span> <span>&gt;&gt;</span> <span>$LOG_FILE</span><span>)</span></span>
log2 = <span><span>$(</span>echo <span><span>&#34;</span>[<span>$1</span>]<span>&#34;</span></span> <span><span>&#34;</span><span>$0</span><span>&#34;</span></span> <span>&gt;&gt;</span> <span>$LOG_FILE</span><span>)</span></span>

<span><span>#</span> switch builds log1 or log2, which is then called with the second argument list</span>
switch = <span>$0</span><span>$1</span>
log = switch[<span><span>&#34;</span>log<span>&#34;</span></span>, <span>$$</span>][<span>$0</span>, <span>$1</span>]

F1 <span>&gt;&gt;</span> log[<span><span>&#34;</span>info message<span>&#34;</span></span>]
F2 <span>&gt;&gt;</span> log[<span><span>&#34;</span>error message<span>&#34;</span></span>, <span><span>&#34;</span>state<span>&#34;</span></span>]</pre></div>

<p dir="auto"><code>$()</code> can be used to embed terminal commands in output expressions, which should be executed when triggered. e.g.:</p>
<div dir="auto" data-snippet-clipboard-copy-content="Meta{C} &gt;&gt; $(C:\windows\system32\calc.exe) ^
Meta{W} &gt;&gt; $(exo-open --launch WebBrowser) ^

# on Windows console applications are revealed by prepending &#39;start&#39;
Meta{C} &gt;&gt; $(start powershell) ^"><pre>Meta{C} <span>&gt;&gt;</span> <span><span>$(</span>C:<span>\w</span>indows<span>\s</span>ystem32<span>\c</span>alc.exe<span>)</span></span> ^
Meta{W} <span>&gt;&gt;</span> <span><span>$(</span>exo-open --launch WebBrowser<span>)</span></span> ^

<span><span>#</span> on Windows console applications are revealed by prepending &#39;start&#39;</span>
Meta{C} <span>&gt;&gt;</span> <span><span>$(</span>start powershell<span>)</span></span> ^</pre></div>
<p dir="auto"><g-emoji alias="warning">⚠️</g-emoji> You may want to append <code>^</code> to ensure that the command is not executed repeatedly as long as the input is kept held.</p>

<p dir="auto">The following directives, which are lines starting with an <code>@</code>, can be inserted in the configuration file:</p>
<ul dir="auto">
<li>
<p dir="auto"><code>forward-modifiers</code> allows to set a list of keys which should never be <a href="#order-of-mappings">held back</a>. e.g.:</p>
<div dir="auto" data-snippet-clipboard-copy-content="@forward-modifiers Shift Control Alt"><pre>@<span>forward</span><span>-</span><span>modifiers</span> <span>Shift</span> <span>Control</span> <span>Alt</span></pre></div>
<p dir="auto">It effectively forwards these keys in each <a href="#multiple-stages">stage</a> immediately, like:</p>
<div dir="auto" data-snippet-clipboard-copy-content="Shift   &gt;&gt; Shift
Control &gt;&gt; Control
Alt     &gt;&gt; Alt"><pre>Shift   <span>&gt;&gt;</span> Shift
Control <span>&gt;&gt;</span> Control
Alt     <span>&gt;&gt;</span> Alt</pre></div>
<p dir="auto">and automatically suppresses the forwarded keys in the output:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# implicitly turned into &#39;Control{A} &gt;&gt; !Control Shift{B}&#39;
Control{A} &gt;&gt; Shift{B}"><pre><span><span>#</span> implicitly turned into &#39;Control{A} &gt;&gt; !Control Shift{B}&#39;</span>
Control{A} <span>&gt;&gt;</span> Shift{B}</pre></div>
</li>
<li>
<p dir="auto"><code>allow-unmapped-commands</code> and <code>enforce-lowercase-commands</code> change the way <a href="#abstract-commands">commands</a> are validated. When used, then best together, so typing errors in key names are still detected. e.g.:</p>
<div dir="auto" data-snippet-clipboard-copy-content="@allow-unmapped-commands
@enforce-lowercase-commands
A &gt;&gt; command1   # OK, even though &#39;command1&#39; has no output mapped
command2 &gt;&gt; B   # OK, even though no input maps to &#39;command2&#39;
C &gt;&gt; Command3   # error: invalid key &#39;Command3&#39;
Command4 &gt;&gt; D   # error: invalid key &#39;Command4&#39;"><pre><span>@<span>allow</span><span>-</span><span>unmapped</span><span>-</span><span>commands</span></span>
<span>@<span>enforce</span><span>-</span><span>lowercase</span><span>-</span><span>commands</span></span>
<span>A</span> <span>&gt;&gt;</span> <span>command1</span>   <span># OK, even though &#39;command1&#39; has no output mapped</span>
<span>command2</span> <span>&gt;&gt;</span> <span>B</span>   <span># OK, even though no input maps to &#39;command2&#39;</span>
<span>C</span> <span>&gt;&gt;</span> <span>Command3</span>   <span># error: invalid key &#39;Command3&#39;</span>
<span>Command4</span> <span>&gt;&gt;</span> <span>D</span>   <span># error: invalid key &#39;Command4&#39;</span></pre></div>
</li>
<li>
<p dir="auto"><code>grab-device</code>, <code>skip-device</code>, <code>grab-device-id</code>, <code>skip-device-id</code> allow to explicitly specify the devices which <code>keymapperd</code> should grab. By default all keyboard devices are grabbed and mice only when mouse buttons or wheels were mapped.
The filters work like the <a href="#context-awareness">context filters</a>. e.g.:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# do not grab anything but this one keyboard
@skip-device /.*/
@grab-device &#34;Some Device Name&#34;"><pre><span># do not grab anything but this one keyboard</span>
<span>@<span>skip</span><span>-</span><span>device</span> <span>/</span>.<span>*</span><span>/</span></span>
<span>@<span>grab</span><span>-</span><span>device</span> <span>&#34;Some Device Name&#34;</span></span></pre></div>
</li>
<li>
<p dir="auto"><code>include</code> can be used to include a file in the configuration. e.g.:</p>

</li>
<li>
<p dir="auto"><code>done</code> stops parsing configuration file.</p>
</li>
</ul>

<p dir="auto">The <a href="https://github.com/houmain/keymapper/blob/main/keymapper.conf">author&#39;s personal configuration</a> may serve as an inspiration (which itself took some inspiration from <a href="https://dreymar.colemak.org/layers-extend.html" rel="nofollow">DreymaR&#39;s Big Bag Of Keyboard Tricks</a>).</p>
<p dir="auto">To get an impression of what a very advanced configuration can look like, check out a <a href="https://github.com/ristomatti/keymapper-config/blob/main/keymapper.conf">power-user&#39;s configuration</a>.</p>

<p dir="auto">For advanced application it is good to know how the mapping is applied:</p>
<ul dir="auto">
<li>All key strokes are intercepted and appended to a key sequence.</li>
<li>On every key stroke the key sequence is matched with all input expressions in consecutive order, until an expression matches or might match (when more strokes follow). Mappings in inactive contexts are skipped.</li>
<li>When the key sequence can no longer match any input expression (because more strokes followed), the longest exact match is looked for (by ignoring the last strokes). As long as still nothing can match, the first strokes are removed and forwarded as output.</li>
<li>When an input expression matches, the keys are removed from the sequence and the mapped expression is output.</li>
<li>Keys which already matched but are still physically pressed participate in expression matching as an optional prefix to the key sequence.</li>
</ul>

<p dir="auto">The application <code>keymapperctl</code> allows to control the running <code>keymapper</code> process from external applications.</p>
<p dir="auto">It can be run arbitrarily often with one or more of the following arguments:</p>
<div data-snippet-clipboard-copy-content="--input &lt;sequence&gt;    injects an input key sequence.
--output &lt;sequence&gt;   injects an output key sequence.
--type &#34;string&#34;       types a string of characters.
--next-key-info       outputs information about the next key press.
--set-config &#34;file&#34;   sets a new configuration.
--is-pressed &lt;key&gt;    sets the result code 0 when a virtual key is down.
--is-released &lt;key&gt;   sets the result code 0 when a virtual key is up.
--press &lt;key&gt;         presses a virtual key.
--release &lt;key&gt;       releases a virtual key.
--toggle &lt;key&gt;        toggles a virtual key.
--wait-pressed &lt;key&gt;  waits until a virtual key is pressed.
--wait-released &lt;key&gt; waits until a virtual key is released.
--wait-toggled &lt;key&gt;  waits until a virtual key is toggled.
--timeout &lt;millisecs&gt; sets a timeout for the following operation.
--wait &lt;millisecs&gt;    unconditionally waits a given amount of time.
--instance &lt;id&gt;       replaces another keymapperctl process with the same id.
--restart             starts processing the first operation again.
--stdout              outputs the result code."><pre><code>--input &lt;sequence&gt;    injects an input key sequence.
--output &lt;sequence&gt;   injects an output key sequence.
--type &#34;string&#34;       types a string of characters.
--next-key-info       outputs information about the next key press.
--set-config &#34;file&#34;   sets a new configuration.
--is-pressed &lt;key&gt;    sets the result code 0 when a virtual key is down.
--is-released &lt;key&gt;   sets the result code 0 when a virtual key is up.
--press &lt;key&gt;         presses a virtual key.
--release &lt;key&gt;       releases a virtual key.
--toggle &lt;key&gt;        toggles a virtual key.
--wait-pressed &lt;key&gt;  waits until a virtual key is pressed.
--wait-released &lt;key&gt; waits until a virtual key is released.
--wait-toggled &lt;key&gt;  waits until a virtual key is toggled.
--timeout &lt;millisecs&gt; sets a timeout for the following operation.
--wait &lt;millisecs&gt;    unconditionally waits a given amount of time.
--instance &lt;id&gt;       replaces another keymapperctl process with the same id.
--restart             starts processing the first operation again.
--stdout              outputs the result code.
</code></pre></div>

<p dir="auto">The program is split into two parts:</p>
<ul dir="auto">
<li><code>keymapperd</code> is the service which needs to be given the permissions to grab the keyboard devices and inject keys.</li>
<li><code>keymapper</code> should be run as normal user in a graphical environment. It loads the configuration, informs the service about it and the active context and also executes mapped terminal commands.</li>
</ul>
<p dir="auto">For security and efficiency reasons, the communication between the two parts is kept as minimal as possible.</p>
<p dir="auto">The command line argument <code>-v</code> can be passed to both processes to output verbose logging information to the console.</p>

<p dir="auto">Pre-built packages can be downloaded from the <a href="https://github.com/houmain/keymapper/releases/latest">latest release</a> page. Arch Linux users can install an up to date build from the <a href="https://aur.archlinux.org/packages/?K=keymapper" rel="nofollow">AUR</a>.</p>
<p dir="auto">After installation you can try it out by creating a <a href="#configuration">configuration</a> file and starting it using:</p>
<div dir="auto" data-snippet-clipboard-copy-content="sudo systemctl start keymapperd
keymapper -u"><pre>sudo systemctl start keymapperd
keymapper -u</pre></div>
<p dir="auto">To install permanently, add <code>keymapper</code> to the desktop environment&#39;s auto-started applications and enable the <code>keymapperd</code> service:</p>
<div dir="auto" data-snippet-clipboard-copy-content="sudo systemctl enable keymapperd"><pre>sudo systemctl <span>enable</span> keymapperd</pre></div>
<p dir="auto">To make context awareness work under Wayland, the compositor has to inform <code>keymapper</code> about the focused window. For <a href="https://wiki.archlinux.org/title/Wayland#Compositors" rel="nofollow">wlroots-based</a> compositors this works out of the box, other compositors need to send the information using the <a href="https://freedesktop.org/wiki/Software/dbus/" rel="nofollow">D-Bus</a> interface. A <a href="https://github.com/houmain/keymapper/tree/main/extra/share/gnome-shell/extensions/keymapper%40houmain.github.com">GNOME Shell extension</a> and a <a href="https://github.com/houmain/keymapper/tree/main/extra/share/kwin/scripts/keymapper">KWin script</a> are provided doing this.</p>
<p dir="auto">The values for the <code>device-id</code> context filters are obtained by looking for symlinks in <code>/dev/input/by-id</code>.</p>

<p dir="auto">The MacOS build depends on <a href="https://karabiner-elements.pqrs.org" rel="nofollow">Karabiner-Element&#39;s</a> virtual device driver.
One can install it either directly from <a href="https://github.com/pqrs-org/Karabiner-DriverKit-VirtualHIDDevice/releases">Karabiner-DriverKit-VirtualHIDDevice</a> (version 5.x.x) or along with <a href="https://github.com/pqrs-org/Karabiner-Elements/releases">Karabiner Elements</a> (version 15.x.x).</p>
<p dir="auto">A <a href="https://brew.sh" rel="nofollow">Homebrew</a> formula is provided for building and installing keymapper:</p>
<div dir="auto" data-snippet-clipboard-copy-content="brew tap houmain/tap
brew install --HEAD keymapper"><pre>brew tap houmain/tap
brew install --HEAD keymapper</pre></div>
<p dir="auto">Finally <code>keymapperd</code> and <code>keymapper</code> can be added to the <code>launchd</code> daemons/agents by calling:</p>
<div dir="auto" data-snippet-clipboard-copy-content="sudo keymapper-launchd add"><pre>sudo keymapper-launchd add</pre></div>
<p dir="auto">There is no tray icon on MacOS yet. The <a href="#configuration">configuration</a> file can be created and opened using:</p>
<div dir="auto" data-snippet-clipboard-copy-content="touch $HOME/.config/keymapper.conf
open -e $HOME/.config/keymapper.conf"><pre>touch <span>$HOME</span>/.config/keymapper.conf
open -e <span>$HOME</span>/.config/keymapper.conf</pre></div>

<p dir="auto">An installer and a portable build can be downloaded from the <a href="https://github.com/houmain/keymapper/releases/latest">latest release</a> page.</p>
<p dir="auto">Most conveniently but possibly not always the very latest version can be installed using a package manager:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# install using winget
winget install keymapper

# install using Chocolatey
choco install keymapper"><pre><span><span>#</span> install using winget</span>
winget install keymapper

<span><span>#</span> install using Chocolatey</span>
choco install keymapper</pre></div>
<p dir="auto">The installer configures the Windows task scheduler to start <code>keymapper.exe</code> and <code>keymapperd.exe</code> at logon.</p>
<p dir="auto">After installation you can open the <a href="#configuration">configuration</a> file by clicking the &#34;Configuration&#34; entry in the tray icon menu.</p>
<p dir="auto">To use the portable build, simply start both <code>keymapper.exe</code> and <code>keymapperd.exe</code>. It is advisable to start <code>keymapperd.exe</code> with elevated privileges. Doing not so has a few limitations. Foremost the Windows key cannot be mapped reliably and applications which are running as administrator (like the task manager) resist any mapping.</p>

<p dir="auto">The <a href="#context-awareness">device</a> filter requires the installation of a virtual device driver. The only known freely available is <a href="https://github.com/oblitum/Interception">Interception</a>, which unfortunately has a <a href="https://github.com/oblitum/Interception/issues/25" data-hovercard-type="issue" data-hovercard-url="/oblitum/Interception/issues/25/hovercard">severe bug</a>, that makes devices stop working after being dis-connected too often. Until this is fixed it not advisable to use it and it should only be installed when filtering by device is absolutely required. The <code>interception.dll</code> needs to be placed next to the <code>keymapperd.exe</code>.</p>

<p dir="auto">A C++17 conforming compiler is required. A script for the
<a href="https://cmake.org" rel="nofollow">CMake</a> build system is provided.</p>
<p dir="auto"><strong>Installing dependencies on Debian Linux and derivatives:</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="sudo apt install build-essential git cmake libudev-dev libusb-1.0-0-dev libx11-dev libdbus-1-dev libwayland-dev libxkbcommon-dev libgtk-3-dev libayatana-appindicator3-dev"><pre>sudo apt install build-essential git cmake libudev-dev libusb-1.0-0-dev libx11-dev libdbus-1-dev libwayland-dev libxkbcommon-dev libgtk-3-dev libayatana-appindicator3-dev</pre></div>
<p dir="auto"><strong>Checking out the source:</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/houmain/keymapper"><pre>git clone https://github.com/houmain/keymapper</pre></div>
<p dir="auto"><strong>Building:</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="cd keymapper
cmake -B build
cmake --build build"><pre><span>cd</span> keymapper
cmake -B build
cmake --build build</pre></div>
<p dir="auto"><strong>Testing:</strong></p>
<p dir="auto">To try it out, simply create a <a href="#configuration">configuration</a> file and start it using:</p>

<p dir="auto">and</p>


<p dir="auto">It is released under the GNU GPLv3. It comes with absolutely no warranty. Please see <code>LICENSE</code> for license details.</p>
</article></div></div>
  </body>
</html>
