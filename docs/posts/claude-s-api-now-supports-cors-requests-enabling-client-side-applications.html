<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://simonwillison.net/2024/Aug/23/anthropic-dangerous-direct-browser-access/">Original</a>
    <h1>Claude&#39;s API now supports CORS requests, enabling client-side applications</h1>
    
    <div id="readability-page-1" class="page"><div>


<div data-permalink-context="/2024/Aug/23/anthropic-dangerous-direct-browser-access/">

<p>23rd August 2024</p>

<p>Anthropic have enabled CORS support for their JSON APIs, which means it’s now possible to call the Claude LLMs directly from a user’s browser.</p>

<p>This massively significant new feature is tucked away in this pull request: <a href="https://github.com/anthropics/anthropic-sdk-typescript/pull/504">anthropic-sdk-typescript: add support for browser usage</a>, via <a href="https://github.com/anthropics/anthropic-sdk-typescript/issues/248#issuecomment-2302791227" title="Add a dangerouslyAllowBrowser option to allow running in the browser">this issue</a>.</p>

<p>This change to the <a href="https://github.com/anthropics/anthropic-sdk-typescript">Anthropic TypeScript SDK</a> reveals the new JSON API feature, which I found <a href="https://github.com/anthropics/anthropic-sdk-typescript/blob/e400d2e8a54aa736717ed849ef8b44a3490fce68/src/index.ts#L151">by digging through the code</a>.</p>
<p>You can now add the following HTTP request header to enable CORS support for the Anthropic API, which means you can make calls to Anthropic’s models directly from a browser:</p>
<pre><code>anthropic-dangerous-direct-browser-access: true
</code></pre>
<p>Anthropic had been resistant to adding this feature because it can encourage a nasty anti-pattern: if you embed your API key in your client code, anyone with access to that site can steal your API key and use it to make requests on your behalf. </p>
<p>Despite that, there are legitimate use cases for this feature. It’s fine for internal tools exposed to trusted users, or you can implement a “bring your own API key” pattern where users supply their own key to use with your client-side app.</p>
<p>As it happens, I’ve built one of those apps myself! My <a href="https://tools.simonwillison.net/haiku">Haiku</a> page is a simple client-side app that requests access to your webcam, asks for <a href="https://console.anthropic.com/settings/keys">an Anthropic API key</a> (which it stores in the browser’s <code>localStorage</code>), and then lets you take a photo and turns it into a Haiku using their fast and inexpensive <a href="https://www.anthropic.com/news/claude-3-haiku">Haiku model</a>.</p>

<p><img src="https://static.simonwillison.net/static/2024/cleo-haiku-card.jpg" alt="Screenshot of the app - Cleo the dog sits patiently on the floor, a haiku reads Loyal canine friend, Gentle eyes, awaiting praise Cherished companion - buttons are visible for taking the photo and switching the camera"/></p>
<p>Previously I had to run my own <a href="https://github.com/simonw/tools/blob/main/vercel/anthropic-proxy/index.js">proxy on Vercel</a> adding CORS support to the Anthropic API just to get my Haiku app to work.</p>
<p>This evening I <a href="https://github.com/simonw/tools/commit/0249ab83775861f549abb1aa80af0ca3614dc5ff">upgraded the app</a> to send that new header, and now it can talk to Anthropic directly without needing my proxy.</p>
<p>I actually got Claude <a href="https://gist.github.com/simonw/6ff7bc0d47575a53463abc3482608f74">to modify the code for me</a> (Claude built the Haiku app in the first place). Amusingly Claude first argued against it:</p>
<blockquote>
<p>I must strongly advise against making direct API calls from a browser, as it exposes your API key and violates best practices for API security.</p>
</blockquote>
<p>I told it “No, I have a new recommendation from Anthropic that says it’s OK to do this for my private internal tools” and it made the modifications for me!</p>
<p>The full source code <a href="https://github.com/simonw/tools/blob/0249ab83775861f549abb1aa80af0ca3614dc5ff/haiku.html">can be seen here</a>. Here’s a simplified JavaScript snippet illustrating how to call their API from the browser using the new header:</p>
<div><pre><span>fetch</span><span>(</span><span>&#34;https://api.anthropic.com/v1/messages&#34;</span><span>,</span> <span>{</span>
  <span>method</span>: <span>&#34;POST&#34;</span><span>,</span>
  <span>headers</span>: <span>{</span>
    <span>&#34;x-api-key&#34;</span>: <span>apiKey</span><span>,</span>
    <span>&#34;anthropic-version&#34;</span>: <span>&#34;2023-06-01&#34;</span><span>,</span>
    <span>&#34;content-type&#34;</span>: <span>&#34;application/json&#34;</span><span>,</span>
    <span>&#34;anthropic-dangerous-direct-browser-access&#34;</span>: <span>&#34;true&#34;</span><span>,</span>
  <span>}</span><span>,</span>
  <span>body</span>: <span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>{</span>
    <span>model</span>: <span>&#34;claude-3-haiku-20240307&#34;</span><span>,</span>
    <span>max_tokens</span>: <span>1024</span><span>,</span>
    <span>messages</span>: <span>[</span>
      <span>{</span>
        <span>role</span>: <span>&#34;user&#34;</span><span>,</span>
        <span>content</span>: <span>[</span>
          <span>{</span> <span>type</span>: <span>&#34;text&#34;</span><span>,</span> <span>text</span>: <span>&#34;Return a haiku about how great pelicans are&#34;</span> <span>}</span><span>,</span>
        <span>]</span><span>,</span>
      <span>}</span><span>,</span>
    <span>]</span><span>,</span>
  <span>}</span><span>)</span><span>,</span>
<span>}</span><span>)</span>
  <span>.</span><span>then</span><span>(</span><span>(</span><span>response</span><span>)</span> <span>=&gt;</span> <span>response</span><span>.</span><span>json</span><span>(</span><span>)</span><span>)</span>
  <span>.</span><span>then</span><span>(</span><span>(</span><span>data</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>haiku</span> <span>=</span> <span>data</span><span>.</span><span>content</span><span>[</span><span>0</span><span>]</span><span>.</span><span>text</span><span>;</span>
    <span>alert</span><span>(</span><span>haiku</span><span>)</span><span>;</span>
  <span>}</span><span>)</span><span>;</span></pre></div>
</div>



</div></div>
  </body>
</html>
