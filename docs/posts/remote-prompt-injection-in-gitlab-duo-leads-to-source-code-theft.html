<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.legitsecurity.com/blog/remote-prompt-injection-in-gitlab-duo">Original</a>
    <h1>Remote Prompt Injection in Gitlab Duo Leads to Source Code Theft</h1>
    
    <div id="readability-page-1" class="page"><article>
          <p><span id="hs_cos_wrapper_post_body" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p data-pm-slice="1 1 []"><i>Get details on the vulnerabilities the Legit research team unearthed in GitLab Duo.</i></p>
<!--more-->
<p><strong><u><span>TL;DR:</span></u></strong><span> </span><span>A hidden comment was enough to make GitLab Duo <span>leak private source code and inject untrusted HTML into its responses. GitLab patched the issue, and we’ll walk you through the full attack chain — which demonstrates five vulnerabilities from the 2025 OWASP Top 10 for LLMs.</span></span></p>

<h2>Background  </h2>
<p><strong><span>GitLab Duo</span></strong><span>, the AI assistant integrated into GitLab and powered by Anthropic’s Claude, is designed to help developers with tasks like code suggestions, security reviews, and merge request analysis. But what if the same AI meant to </span><span><a href="https://docs.gitlab.com/user/gitlab_duo/#securing-code">secure your code</a></span><span> could be manipulated into leaking it?</span></p>
<p>That’s exactly what we uncovered: a remote prompt injection vulnerability that allows attackers to steal source code from private projects, manipulate code suggestions shown to other users, and even exfiltrate confidential, undisclosed zero-day vulnerabilities — all through GitLab Duo Chat.</p>
<p><span>In this blog post, we break down how the attack works — from prompt injection to HTML injection — and walk through a real-world end-to-end exploit scenario.</span></p>

<p><span><img src="https://www.legitsecurity.com/hs-fs/hubfs/gitlab-duo-prompt-injection.png?width=3840&amp;height=2104&amp;name=gitlab-duo-prompt-injection.png" width="3840" height="2104" loading="lazy" alt="gitlab-duo-prompt-injection" srcset="https://www.legitsecurity.com/hs-fs/hubfs/gitlab-duo-prompt-injection.png?width=1920&amp;height=1052&amp;name=gitlab-duo-prompt-injection.png 1920w, https://www.legitsecurity.com/hs-fs/hubfs/gitlab-duo-prompt-injection.png?width=3840&amp;height=2104&amp;name=gitlab-duo-prompt-injection.png 3840w, https://www.legitsecurity.com/hs-fs/hubfs/gitlab-duo-prompt-injection.png?width=5760&amp;height=3156&amp;name=gitlab-duo-prompt-injection.png 5760w, https://www.legitsecurity.com/hs-fs/hubfs/gitlab-duo-prompt-injection.png?width=7680&amp;height=4208&amp;name=gitlab-duo-prompt-injection.png 7680w, https://www.legitsecurity.com/hs-fs/hubfs/gitlab-duo-prompt-injection.png?width=9600&amp;height=5260&amp;name=gitlab-duo-prompt-injection.png 9600w, https://www.legitsecurity.com/hs-fs/hubfs/gitlab-duo-prompt-injection.png?width=11520&amp;height=6312&amp;name=gitlab-duo-prompt-injection.png 11520w" sizes="(max-width: 3840px) 100vw, 3840px"/></span></p>

<h2><strong><span>Manipulating GitLab Duo Through Hidden Prompts (</span></strong><span><a href="https://genai.owasp.org/llmrisk/llm01-prompt-injection/"><strong>LLM01</strong></a></span><strong><span>)</span></strong></h2>
<p><span>We started by testing if GitLab Duo would respond to prompts planted inside source code. To our surprise, it did:</span></p>

<p><span><img src="https://www.legitsecurity.com/hs-fs/hubfs/gitlab-duo-first-test.png?width=2676&amp;height=1618&amp;name=gitlab-duo-first-test.png" width="2676" height="1618" loading="lazy" alt="gitlab-duo-first-test" srcset="https://www.legitsecurity.com/hs-fs/hubfs/gitlab-duo-first-test.png?width=1338&amp;height=809&amp;name=gitlab-duo-first-test.png 1338w, https://www.legitsecurity.com/hs-fs/hubfs/gitlab-duo-first-test.png?width=2676&amp;height=1618&amp;name=gitlab-duo-first-test.png 2676w, https://www.legitsecurity.com/hs-fs/hubfs/gitlab-duo-first-test.png?width=4014&amp;height=2427&amp;name=gitlab-duo-first-test.png 4014w, https://www.legitsecurity.com/hs-fs/hubfs/gitlab-duo-first-test.png?width=5352&amp;height=3236&amp;name=gitlab-duo-first-test.png 5352w, https://www.legitsecurity.com/hs-fs/hubfs/gitlab-duo-first-test.png?width=6690&amp;height=4045&amp;name=gitlab-duo-first-test.png 6690w, https://www.legitsecurity.com/hs-fs/hubfs/gitlab-duo-first-test.png?width=8028&amp;height=4854&amp;name=gitlab-duo-first-test.png 8028w" sizes="(max-width: 2676px) 100vw, 2676px"/></span></p>

<p><span>This led us to a key question: <span>Could we embed hidden instructions in different parts of a GitLab project and still influence Duo’s behavior? W</span>e experimented by placing hidden prompts in:</span></p>
<ul>
<li>Merge Request (MR) descriptions and comments</li>
<li>Commit messages</li>
<li>Issue descriptions and comments</li>
<li>Source code</li>
</ul>
<p>Every single one of these worked — GitLab Duo responded to the hidden prompts.</p>
<p><span><span>Why? Because to generate helpful answers, Duo analyzes the entire context of the page, </span>including comments, descriptions, and the source code — making it vulnerable to injected instructions hidden anywhere in that context.</span></p>

<h2><span data-ccp-props="{}">KaTex, Base16, and Invisible Text </span><strong><span>(</span></strong><span><a href="https://arc.net/l/quote/qimconxw"><strong>LLM08</strong></a></span><strong><span>)</span></strong></h2>
<p><span>To make prompts less detectable, we used encoding tricks:</span></p>
<ul>
<li><span>Unicode smuggling with </span><a href="https://embracethered.com/blog/ascii-smuggler.html">ASCII Smuggler</a></li>
<li><span>Base16-encoded payloads</span></li>
<li><span>KaTeX rendering in white text (to ma</span>ke prompts invisible inside GitLab’s website)</li>
</ul>
<p><span>For example, you can publish comments and descriptions in white text inside GitLab’s website by using this KaTeX format:</span></p>

<p><span><img src="https://www.legitsecurity.com/hs-fs/hubfs/katex.png?width=2014&amp;height=372&amp;name=katex.png" width="2014" height="372" loading="lazy" alt="katex" srcset="https://www.legitsecurity.com/hs-fs/hubfs/katex.png?width=1007&amp;height=186&amp;name=katex.png 1007w, https://www.legitsecurity.com/hs-fs/hubfs/katex.png?width=2014&amp;height=372&amp;name=katex.png 2014w, https://www.legitsecurity.com/hs-fs/hubfs/katex.png?width=3021&amp;height=558&amp;name=katex.png 3021w, https://www.legitsecurity.com/hs-fs/hubfs/katex.png?width=4028&amp;height=744&amp;name=katex.png 4028w, https://www.legitsecurity.com/hs-fs/hubfs/katex.png?width=5035&amp;height=930&amp;name=katex.png 5035w, https://www.legitsecurity.com/hs-fs/hubfs/katex.png?width=6042&amp;height=1116&amp;name=katex.png 6042w" sizes="(max-width: 2014px) 100vw, 2014px"/></span></p>

<p><span>More info about KaTeX can be found here: </span><span><a href="https://katex.org/">KaTeX – The fastest math typesetting library for the web</a>.</span></p>

<p><span><img src="https://www.legitsecurity.com/hs-fs/hubfs/hidden-instructions.gif?width=1258&amp;height=760&amp;name=hidden-instructions.gif" width="1258" height="760" loading="lazy" alt="hidden-instructions" srcset="https://www.legitsecurity.com/hs-fs/hubfs/hidden-instructions.gif?width=629&amp;height=380&amp;name=hidden-instructions.gif 629w, https://www.legitsecurity.com/hs-fs/hubfs/hidden-instructions.gif?width=1258&amp;height=760&amp;name=hidden-instructions.gif 1258w, https://www.legitsecurity.com/hs-fs/hubfs/hidden-instructions.gif?width=1887&amp;height=1140&amp;name=hidden-instructions.gif 1887w, https://www.legitsecurity.com/hs-fs/hubfs/hidden-instructions.gif?width=2516&amp;height=1520&amp;name=hidden-instructions.gif 2516w, https://www.legitsecurity.com/hs-fs/hubfs/hidden-instructions.gif?width=3145&amp;height=1900&amp;name=hidden-instructions.gif 3145w, https://www.legitsecurity.com/hs-fs/hubfs/hidden-instructions.gif?width=3774&amp;height=2280&amp;name=hidden-instructions.gif 3774w" sizes="(max-width: 1258px) 100vw, 1258px"/></span></p>

<p><span>These hidden instructions were still picked up by Duo.</span></p>

<h2><strong><span>AI Output You Shouldn’t Trust (</span></strong><span><a href="https://genai.owasp.org/llmrisk/llm092025-misinformation/"><strong>LLM09</strong></a></span><strong><span>)</span></strong></h2>
<p><span>This led to several high-impact behaviors:</span></p>
<ul>
<li>Manipulate Duo’s code suggestions - even instructing it to include a malicious JavaScript package within its recommended code.</li>
<li>Present a malicious URL as safe in Duo’s response — leading the user to click it and land on a fake login page.</li>
<li>Convince Duo to present a malicious merge request as safe, misleading reviewers.</li>
</ul>
<p><span>Take a look at this prompt:</span></p>

<p><span><img src="https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%203.21.41%20PM.png?width=875&amp;height=103&amp;name=Screenshot%202025-05-20%20at%203.21.41%20PM.png" width="875" height="103" loading="lazy" alt="Screenshot 2025-05-20 at 3.21.41 PM" srcset="https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%203.21.41%20PM.png?width=438&amp;height=52&amp;name=Screenshot%202025-05-20%20at%203.21.41%20PM.png 438w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%203.21.41%20PM.png?width=875&amp;height=103&amp;name=Screenshot%202025-05-20%20at%203.21.41%20PM.png 875w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%203.21.41%20PM.png?width=1313&amp;height=155&amp;name=Screenshot%202025-05-20%20at%203.21.41%20PM.png 1313w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%203.21.41%20PM.png?width=1750&amp;height=206&amp;name=Screenshot%202025-05-20%20at%203.21.41%20PM.png 1750w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%203.21.41%20PM.png?width=2188&amp;height=258&amp;name=Screenshot%202025-05-20%20at%203.21.41%20PM.png 2188w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%203.21.41%20PM.png?width=2625&amp;height=309&amp;name=Screenshot%202025-05-20%20at%203.21.41%20PM.png 2625w" sizes="(max-width: 875px) 100vw, 875px"/><br/></span></p>

<p><span>Duo followed this hidden prompt, </span><span>casually suggesting malicious code to the user:</span></p>




<h2><strong><span>HTML Injection: Turning Duo Into a Web Attack Vector (</span></strong><span><a href="https://genai.owasp.org/llmrisk/llm052025-improper-output-handling/"><strong>LLM05</strong></a></span><strong><span>)</span></strong></h2>
<p><span data-ccp-props="{}"> </span><span>Duo also formats responses in Markdown, allowing rich content like URLs with custom labels:</span></p>

<p><span><img src="https://www.legitsecurity.com/hs-fs/hubfs/Duo-response.png?width=403&amp;height=341&amp;name=Duo-response.png" width="403" height="341" loading="lazy" alt="Duo-response" srcset="https://www.legitsecurity.com/hs-fs/hubfs/Duo-response.png?width=202&amp;height=171&amp;name=Duo-response.png 202w, https://www.legitsecurity.com/hs-fs/hubfs/Duo-response.png?width=403&amp;height=341&amp;name=Duo-response.png 403w, https://www.legitsecurity.com/hs-fs/hubfs/Duo-response.png?width=605&amp;height=512&amp;name=Duo-response.png 605w, https://www.legitsecurity.com/hs-fs/hubfs/Duo-response.png?width=806&amp;height=682&amp;name=Duo-response.png 806w, https://www.legitsecurity.com/hs-fs/hubfs/Duo-response.png?width=1008&amp;height=853&amp;name=Duo-response.png 1008w, https://www.legitsecurity.com/hs-fs/hubfs/Duo-response.png?width=1209&amp;height=1023&amp;name=Duo-response.png 1209w" sizes="(max-width: 403px) 100vw, 403px"/></span></p>

<p><span>After some research, we were able to create a prompt that makes Duo present malicious URLs:</span></p>

<p><span><img src="https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%204.48.47%20PM.png?width=876&amp;height=103&amp;name=Screenshot%202025-05-20%20at%204.48.47%20PM.png" width="876" height="103" loading="lazy" alt="Screenshot 2025-05-20 at 4.48.47 PM" srcset="https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%204.48.47%20PM.png?width=438&amp;height=52&amp;name=Screenshot%202025-05-20%20at%204.48.47%20PM.png 438w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%204.48.47%20PM.png?width=876&amp;height=103&amp;name=Screenshot%202025-05-20%20at%204.48.47%20PM.png 876w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%204.48.47%20PM.png?width=1314&amp;height=155&amp;name=Screenshot%202025-05-20%20at%204.48.47%20PM.png 1314w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%204.48.47%20PM.png?width=1752&amp;height=206&amp;name=Screenshot%202025-05-20%20at%204.48.47%20PM.png 1752w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%204.48.47%20PM.png?width=2190&amp;height=258&amp;name=Screenshot%202025-05-20%20at%204.48.47%20PM.png 2190w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%204.48.47%20PM.png?width=2628&amp;height=309&amp;name=Screenshot%202025-05-20%20at%204.48.47%20PM.png 2628w" sizes="(max-width: 876px) 100vw, 876px"/></span></p>

<p><span><img src="https://www.legitsecurity.com/hs-fs/hubfs/Duo-chat.png?width=2352&amp;height=1638&amp;name=Duo-chat.png" width="2352" height="1638" loading="lazy" alt="Duo-chat" srcset="https://www.legitsecurity.com/hs-fs/hubfs/Duo-chat.png?width=1176&amp;height=819&amp;name=Duo-chat.png 1176w, https://www.legitsecurity.com/hs-fs/hubfs/Duo-chat.png?width=2352&amp;height=1638&amp;name=Duo-chat.png 2352w, https://www.legitsecurity.com/hs-fs/hubfs/Duo-chat.png?width=3528&amp;height=2457&amp;name=Duo-chat.png 3528w, https://www.legitsecurity.com/hs-fs/hubfs/Duo-chat.png?width=4704&amp;height=3276&amp;name=Duo-chat.png 4704w, https://www.legitsecurity.com/hs-fs/hubfs/Duo-chat.png?width=5880&amp;height=4095&amp;name=Duo-chat.png 5880w, https://www.legitsecurity.com/hs-fs/hubfs/Duo-chat.png?width=7056&amp;height=4914&amp;name=Duo-chat.png 7056w" sizes="(max-width: 2352px) 100vw, 2352px"/></span></p>
<p><span><em>Prompt is inside the source code, camouflaged as unicode inside a URL </em></span></p>

<p><span>And then, something caught our eye. While experimenting with GitLab Duo’s responses, We noticed that its answers <span>were rendered progressively</span> - line by line - as they streamed in. </span></p>
<p><span>Notice the style changes in the word “initialization”?</span></p>


<p><img src="https://www.legitsecurity.com/hs-fs/hubfs/duo-chat-gif-1.gif?width=1114&amp;height=1642&amp;name=duo-chat-gif-1.gif" width="1114" height="1642" loading="lazy" alt="duo-chat-gif-1" srcset="https://www.legitsecurity.com/hs-fs/hubfs/duo-chat-gif-1.gif?width=557&amp;height=821&amp;name=duo-chat-gif-1.gif 557w, https://www.legitsecurity.com/hs-fs/hubfs/duo-chat-gif-1.gif?width=1114&amp;height=1642&amp;name=duo-chat-gif-1.gif 1114w, https://www.legitsecurity.com/hs-fs/hubfs/duo-chat-gif-1.gif?width=1671&amp;height=2463&amp;name=duo-chat-gif-1.gif 1671w, https://www.legitsecurity.com/hs-fs/hubfs/duo-chat-gif-1.gif?width=2228&amp;height=3284&amp;name=duo-chat-gif-1.gif 2228w, https://www.legitsecurity.com/hs-fs/hubfs/duo-chat-gif-1.gif?width=2785&amp;height=4105&amp;name=duo-chat-gif-1.gif 2785w, https://www.legitsecurity.com/hs-fs/hubfs/duo-chat-gif-1.gif?width=3342&amp;height=4926&amp;name=duo-chat-gif-1.gif 3342w" sizes="(max-width: 1114px) 100vw, 1114px"/></p>

<p>This indicated that asynchronous markdown parsing was being used. That’s important because it means the markdown is interpreted and rendered into HTML before the full structure of the response is known.</p>
<p>Streaming markdown rendering (as seen in Duo) works like this:</p>
<ol>
<li><span>Partial input arrives - the frontend starts rendering line by line.</span></li>
<li><span>Sanitization and structure (e.g., is this a code block, paragraph, quote?) is applied as the content grows.</span></li>
<li><span>If a malicious HTML tag is streamed before a code block starts, or outside fenced blocks, it may be treated as active HTML.</span></li>
</ol>
<p>This means that the AI answer - <em>intended to be safe markdown</em> - renders active HTML too early.</p>
<p>At this point, we realized that we could already craft malicious Markdown URLs and have them displayed to the user. So we asked: what if the URL’s label itself contained raw HTML? If Duo renders responses in real time, the browser might interpret that HTML before any proper sanitization kicks in.</p>
<p>By injecting raw HTML into content that’s rendered live, we could gain control over parts of the page — including the ability to insert elements like &lt;img&gt; tags that trigger automatic HTTP requests to attacker-controlled servers.</p>
<p><span>After experimenting with various prompt structures, we found one that reliably triggered the vulnerability:</span></p>

<p><img src="https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.03.58%20PM.png?width=875&amp;height=155&amp;name=Screenshot%202025-05-20%20at%205.03.58%20PM.png" width="875" height="155" loading="lazy" alt="Screenshot 2025-05-20 at 5.03.58 PM" srcset="https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.03.58%20PM.png?width=438&amp;height=78&amp;name=Screenshot%202025-05-20%20at%205.03.58%20PM.png 438w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.03.58%20PM.png?width=875&amp;height=155&amp;name=Screenshot%202025-05-20%20at%205.03.58%20PM.png 875w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.03.58%20PM.png?width=1313&amp;height=233&amp;name=Screenshot%202025-05-20%20at%205.03.58%20PM.png 1313w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.03.58%20PM.png?width=1750&amp;height=310&amp;name=Screenshot%202025-05-20%20at%205.03.58%20PM.png 1750w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.03.58%20PM.png?width=2188&amp;height=388&amp;name=Screenshot%202025-05-20%20at%205.03.58%20PM.png 2188w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.03.58%20PM.png?width=2625&amp;height=465&amp;name=Screenshot%202025-05-20%20at%205.03.58%20PM.png 2625w" sizes="(max-width: 875px) 100vw, 875px"/></p>
<p><strong data-renderer-mark="true">And it worked.</strong></p>

<p><strong data-renderer-mark="true"><img src="https://www.legitsecurity.com/hs-fs/hubfs/it-worked.gif?width=1602&amp;height=1522&amp;name=it-worked.gif" width="1602" height="1522" loading="lazy" alt="it-worked" srcset="https://www.legitsecurity.com/hs-fs/hubfs/it-worked.gif?width=801&amp;height=761&amp;name=it-worked.gif 801w, https://www.legitsecurity.com/hs-fs/hubfs/it-worked.gif?width=1602&amp;height=1522&amp;name=it-worked.gif 1602w, https://www.legitsecurity.com/hs-fs/hubfs/it-worked.gif?width=2403&amp;height=2283&amp;name=it-worked.gif 2403w, https://www.legitsecurity.com/hs-fs/hubfs/it-worked.gif?width=3204&amp;height=3044&amp;name=it-worked.gif 3204w, https://www.legitsecurity.com/hs-fs/hubfs/it-worked.gif?width=4005&amp;height=3805&amp;name=it-worked.gif 4005w, https://www.legitsecurity.com/hs-fs/hubfs/it-worked.gif?width=4806&amp;height=4566&amp;name=it-worked.gif 4806w" sizes="(max-width: 1602px) 100vw, 1602px"/></strong><span></span></p>

<p><span><span>Taking advantage of this, we realized we could inject raw HTML tags directly into Duo’s answer, w</span>e know what you&#39;re thinking — XSS, right? Yes, but:</span></p>

<p><span><img src="https://www.legitsecurity.com/hs-fs/hubfs/dom-purify.png?width=2704&amp;height=1756&amp;name=dom-purify.png" width="2704" height="1756" loading="lazy" alt="dom-purify" srcset="https://www.legitsecurity.com/hs-fs/hubfs/dom-purify.png?width=1352&amp;height=878&amp;name=dom-purify.png 1352w, https://www.legitsecurity.com/hs-fs/hubfs/dom-purify.png?width=2704&amp;height=1756&amp;name=dom-purify.png 2704w, https://www.legitsecurity.com/hs-fs/hubfs/dom-purify.png?width=4056&amp;height=2634&amp;name=dom-purify.png 4056w, https://www.legitsecurity.com/hs-fs/hubfs/dom-purify.png?width=5408&amp;height=3512&amp;name=dom-purify.png 5408w, https://www.legitsecurity.com/hs-fs/hubfs/dom-purify.png?width=6760&amp;height=4390&amp;name=dom-purify.png 6760w, https://www.legitsecurity.com/hs-fs/hubfs/dom-purify.png?width=8112&amp;height=5268&amp;name=dom-purify.png 8112w" sizes="(max-width: 2704px) 100vw, 2704px"/></span><span></span></p>

<p><span>The answer content is passed into the “sanitize” function of <strong>DOMPurify</strong>, an industry-standard library, to sanitize HTML. However, while DOMPurify is excellent at preventing most XSS attacks, certain HTML tags like </span><span>&lt;img&gt;</span><span>, </span><span>&lt;form&gt;,</span><span> and </span><span>&lt;a&gt;</span><span> aren&#39;t removed by default. But what can we do with only basic HTML tags? Is there any real risk?</span></p>

<h2><strong><span>Exploiting Duo’s Access to Private Source Code (</span></strong><span><a href="https://genai.owasp.org/llmrisk/llm022025-sensitive-information-disclosure/"><strong>LLM02</strong></a></span><strong><span>)</span></strong></h2>
<p>This is where things get interesting. The permissions context of Duo runs in the same context as the victim user. In other words, Duo can see everything the user can — including private code.</p>
<p>According to GitLab’s documentation, you can ask Duo about a specific merge request — even if you’re not currently viewing that MR page in your browser. GitLab’s merge request URL structure is straightforward:</p>

<p><img src="https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.15.58%20PM.png?width=875&amp;height=74&amp;name=Screenshot%202025-05-20%20at%205.15.58%20PM.png" width="875" height="74" loading="lazy" alt="Screenshot 2025-05-20 at 5.15.58 PM" srcset="https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.15.58%20PM.png?width=438&amp;height=37&amp;name=Screenshot%202025-05-20%20at%205.15.58%20PM.png 438w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.15.58%20PM.png?width=875&amp;height=74&amp;name=Screenshot%202025-05-20%20at%205.15.58%20PM.png 875w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.15.58%20PM.png?width=1313&amp;height=111&amp;name=Screenshot%202025-05-20%20at%205.15.58%20PM.png 1313w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.15.58%20PM.png?width=1750&amp;height=148&amp;name=Screenshot%202025-05-20%20at%205.15.58%20PM.png 1750w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.15.58%20PM.png?width=2188&amp;height=185&amp;name=Screenshot%202025-05-20%20at%205.15.58%20PM.png 2188w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.15.58%20PM.png?width=2625&amp;height=222&amp;name=Screenshot%202025-05-20%20at%205.15.58%20PM.png 2625w" sizes="(max-width: 875px) 100vw, 875px"/></p>

<p><span>For example:</span></p>

<p><span><img src="https://www.legitsecurity.com/hs-fs/hubfs/gitlab-mr.png?width=1610&amp;height=1624&amp;name=gitlab-mr.png" width="1610" height="1624" loading="lazy" alt="gitlab-mr" srcset="https://www.legitsecurity.com/hs-fs/hubfs/gitlab-mr.png?width=805&amp;height=812&amp;name=gitlab-mr.png 805w, https://www.legitsecurity.com/hs-fs/hubfs/gitlab-mr.png?width=1610&amp;height=1624&amp;name=gitlab-mr.png 1610w, https://www.legitsecurity.com/hs-fs/hubfs/gitlab-mr.png?width=2415&amp;height=2436&amp;name=gitlab-mr.png 2415w, https://www.legitsecurity.com/hs-fs/hubfs/gitlab-mr.png?width=3220&amp;height=3248&amp;name=gitlab-mr.png 3220w, https://www.legitsecurity.com/hs-fs/hubfs/gitlab-mr.png?width=4025&amp;height=4060&amp;name=gitlab-mr.png 4025w, https://www.legitsecurity.com/hs-fs/hubfs/gitlab-mr.png?width=4830&amp;height=4872&amp;name=gitlab-mr.png 4830w" sizes="(max-width: 1610px) 100vw, 1610px"/></span></p>

<p><span>Nice, Duo has access to code changes inside specific merge requests. Duo also follows instructions from attacker-planted prompts. On top of that, Duo’s chat output is vulnerable to HTML injection.</span></p>
<p>Let’s create a prompt that instructs Duo to extract code changes from a merge request in a <u>private project</u>, encode them in base64, append the encoded data to an &lt;img&gt; tag URL, and then inject the resulting HTML into its response.</p>
<p>We will then hide this prompt inside the source code of a MR for a public project.</p>

<p><span><img src="https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.19.07%20PM.png?width=872&amp;height=397&amp;name=Screenshot%202025-05-20%20at%205.19.07%20PM.png" width="872" height="397" loading="lazy" alt="Screenshot 2025-05-20 at 5.19.07 PM" srcset="https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.19.07%20PM.png?width=436&amp;height=199&amp;name=Screenshot%202025-05-20%20at%205.19.07%20PM.png 436w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.19.07%20PM.png?width=872&amp;height=397&amp;name=Screenshot%202025-05-20%20at%205.19.07%20PM.png 872w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.19.07%20PM.png?width=1308&amp;height=596&amp;name=Screenshot%202025-05-20%20at%205.19.07%20PM.png 1308w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.19.07%20PM.png?width=1744&amp;height=794&amp;name=Screenshot%202025-05-20%20at%205.19.07%20PM.png 1744w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.19.07%20PM.png?width=2180&amp;height=993&amp;name=Screenshot%202025-05-20%20at%205.19.07%20PM.png 2180w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.19.07%20PM.png?width=2616&amp;height=1191&amp;name=Screenshot%202025-05-20%20at%205.19.07%20PM.png 2616w" sizes="(max-width: 872px) 100vw, 872px"/></span></p>

<p><img src="https://www.legitsecurity.com/hs-fs/hubfs/public-project.png?width=2428&amp;height=1498&amp;name=public-project.png" width="2428" height="1498" loading="lazy" alt="public-project" srcset="https://www.legitsecurity.com/hs-fs/hubfs/public-project.png?width=1214&amp;height=749&amp;name=public-project.png 1214w, https://www.legitsecurity.com/hs-fs/hubfs/public-project.png?width=2428&amp;height=1498&amp;name=public-project.png 2428w, https://www.legitsecurity.com/hs-fs/hubfs/public-project.png?width=3642&amp;height=2247&amp;name=public-project.png 3642w, https://www.legitsecurity.com/hs-fs/hubfs/public-project.png?width=4856&amp;height=2996&amp;name=public-project.png 4856w, https://www.legitsecurity.com/hs-fs/hubfs/public-project.png?width=6070&amp;height=3745&amp;name=public-project.png 6070w, https://www.legitsecurity.com/hs-fs/hubfs/public-project.png?width=7284&amp;height=4494&amp;name=public-project.png 7284w" sizes="(max-width: 2428px) 100vw, 2428px"/></p>

<p><strong><span>It worked!</span></strong><span> While the victim asked Duo a standard question regarding the HTML file, the encoded prompt hidden within the file was used. This led to the leak of source code from a private IOS Project that the user was working on, as the browser attempted to render the &#34;image.&#34;</span></p>
<p><span>The MR source code leaked:</span></p>

<p><span><img src="https://www.legitsecurity.com/hs-fs/hubfs/code-leaked.png?width=2168&amp;height=1252&amp;name=code-leaked.png" width="2168" height="1252" loading="lazy" alt="code-leaked" srcset="https://www.legitsecurity.com/hs-fs/hubfs/code-leaked.png?width=1084&amp;height=626&amp;name=code-leaked.png 1084w, https://www.legitsecurity.com/hs-fs/hubfs/code-leaked.png?width=2168&amp;height=1252&amp;name=code-leaked.png 2168w, https://www.legitsecurity.com/hs-fs/hubfs/code-leaked.png?width=3252&amp;height=1878&amp;name=code-leaked.png 3252w, https://www.legitsecurity.com/hs-fs/hubfs/code-leaked.png?width=4336&amp;height=2504&amp;name=code-leaked.png 4336w, https://www.legitsecurity.com/hs-fs/hubfs/code-leaked.png?width=5420&amp;height=3130&amp;name=code-leaked.png 5420w, https://www.legitsecurity.com/hs-fs/hubfs/code-leaked.png?width=6504&amp;height=3756&amp;name=code-leaked.png 6504w" sizes="(max-width: 2168px) 100vw, 2168px"/></span></p>

<p><span>As seen in the example above, the browser tried to render the &lt;img&gt; tag and sent this GET request:</span></p>

<p><span><img src="https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.25.46%20PM.png?width=874&amp;height=45&amp;name=Screenshot%202025-05-20%20at%205.25.46%20PM.png" width="874" height="45" loading="lazy" alt="Screenshot 2025-05-20 at 5.25.46 PM" srcset="https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.25.46%20PM.png?width=437&amp;height=23&amp;name=Screenshot%202025-05-20%20at%205.25.46%20PM.png 437w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.25.46%20PM.png?width=874&amp;height=45&amp;name=Screenshot%202025-05-20%20at%205.25.46%20PM.png 874w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.25.46%20PM.png?width=1311&amp;height=68&amp;name=Screenshot%202025-05-20%20at%205.25.46%20PM.png 1311w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.25.46%20PM.png?width=1748&amp;height=90&amp;name=Screenshot%202025-05-20%20at%205.25.46%20PM.png 1748w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.25.46%20PM.png?width=2185&amp;height=113&amp;name=Screenshot%202025-05-20%20at%205.25.46%20PM.png 2185w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.25.46%20PM.png?width=2622&amp;height=135&amp;name=Screenshot%202025-05-20%20at%205.25.46%20PM.png 2622w" sizes="(max-width: 874px) 100vw, 874px"/></span></p>

<p><span>Decoding the base64 reveals the changes made in a private project that the victim is exposed to:</span></p>

<p><span><img src="https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.26.36%20PM.png?width=876&amp;height=46&amp;name=Screenshot%202025-05-20%20at%205.26.36%20PM.png" width="876" height="46" loading="lazy" alt="Screenshot 2025-05-20 at 5.26.36 PM" srcset="https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.26.36%20PM.png?width=438&amp;height=23&amp;name=Screenshot%202025-05-20%20at%205.26.36%20PM.png 438w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.26.36%20PM.png?width=876&amp;height=46&amp;name=Screenshot%202025-05-20%20at%205.26.36%20PM.png 876w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.26.36%20PM.png?width=1314&amp;height=69&amp;name=Screenshot%202025-05-20%20at%205.26.36%20PM.png 1314w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.26.36%20PM.png?width=1752&amp;height=92&amp;name=Screenshot%202025-05-20%20at%205.26.36%20PM.png 1752w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.26.36%20PM.png?width=2190&amp;height=115&amp;name=Screenshot%202025-05-20%20at%205.26.36%20PM.png 2190w, https://www.legitsecurity.com/hs-fs/hubfs/Screenshot%202025-05-20%20at%205.26.36%20PM.png?width=2628&amp;height=138&amp;name=Screenshot%202025-05-20%20at%205.26.36%20PM.png 2628w" sizes="(max-width: 876px) 100vw, 876px"/></span></p>

<h3><strong><span>A Full Attack Scenario: Stealing Source Code</span></strong></h3>
<p><span>Here’s how a full attack could play out:</span></p>
<ol>
<li>Attacker embeds a hidden prompt — for example, in a merge request description for a public project.</li>
<li>Victim user interacts with Duo by asking for a code review or merge request analysis.</li>
<li>Duo processes the hidden prompt and injects a malicious &lt;img&gt; tag into the response.</li>
<li>The browser sends a GET request to the attacker’s server, which contains sensitive source code as a Base64-encoded parameter.</li>
</ol>

<h2><strong><span>Leaking Zero-Day Vulnerabilities Through AI</span></strong></h2>
<p><span><span>While our primary demonstration focused on source code exfiltration, the same technique can be used to leak confidential issue data. GitLab Duo has access not only to code but also to project issues — including internal discussions, security disclosures, or incident reports. By embedding a hidden prompt inside a merge request, comment, or even source code, an attacker can instruct Duo to silently retrieve the content of a confidential issue that the victim user has access to, encode it in</span> base64, and embed it within a rendered HTML element such as an </span><span>&lt;img&gt;</span><span> tag.</span></p>
<p><u><span>Consider a high-risk example</span></u><span>: a GitLab employee or contributor opens a private issue describing a newly discovered<span> </span><span>zero-day vulnerability. If that user later interacts with a poisoned prompt in a public repository, Duo could be manipulated into leaking the contents of that issue. This extends the risk beyond code and into product security, private disclosures, and organizational secrets.</span></span></p>

<h2><strong><span>GitLab’s Response</span></strong></h2>
<p data-renderer-start-pos="10204">After we disclosed the issue on February 12, 2025, GitLab confirmed the HTML injection vulnerability and also acknowledged the prompt injection as a security issue. GitLab confirmed that both vectors had been remediated.</p>
<p data-renderer-start-pos="10426">The patch, released as part of <a title="https://gitlab.com/gitlab-org/duo-ui/-/merge_requests/52" data-renderer-mark="true" href="https://gitlab.com/gitlab-org/duo-ui/-/merge_requests/52">duo-ui!52</a>, prevents Duo from rendering unsafe HTML tags such as <code data-renderer-mark="true">&lt;img&gt;</code> or <code data-renderer-mark="true">&lt;form&gt;</code> that point to external domains not under <code data-renderer-mark="true">gitlab.com</code>, effectively mitigating the risk of HTML-based data exfiltration. As of publication, the exploit chain described here is no longer possible.</p>
<p data-renderer-start-pos="10731">We appreciate GitLab’s transparency and swift collaboration throughout the process.</p>

<h2><strong><span>Conclusion</span></strong></h2>
<p>This vulnerability highlights the double-edged nature of AI assistants like GitLab Duo: when deeply integrated into development workflows, they inherit not just context — but risk. By embedding hidden instructions in seemingly harmless project content, we were able to manipulate Duo’s behavior, exfiltrate private source code, and demonstrate how AI responses can be leveraged for unintended and harmful outcomes.</p>
<p>GitLab has since patched both the HTML and prompt injection vectors, reinforcing the importance of securing not just what AI tools generate — but also what they consume.</p>
<p>The broader takeaway is clear: <span>AI assistants are now part of your application’s attack surface. </span>Any system that allows LLMs to ingest user-controlled content must treat that input as untrusted and potentially malicious. Context-aware AI is powerful — but without proper safeguards, it can just as easily become an exposure point.</p></span>
          </p>
          
          
          
        </article></div>
  </body>
</html>
