<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://steven-giesel.com/blogPost/2f70d926-ec92-4dfe-b278-18f78078253d">Original</a>
    <h1>The combined power of F# and C#</h1>
    
    <div id="readability-page-1" class="page"><div b-gj8cwnhyng=""><p>Where C# is the most dominant language in the .NET world, other languages are built on top of the Framework that deserves their respective place. F# is strong when it comes down to functional programming! In this blog post, we will leverage the power of F# and C# to showcase where both excel!</p>
<h2 id="why-does-it-work">Why does it work?</h2>
<p>Before I go into the details of the code, I want to explain why this works. Why can we use F# code in C# and vice versa? The answer is simple: the .NET Framework is a runtime that can execute code written in different languages. The runtime is responsible for compiling the code to an intermediate language (IL) that the runtime can execute. If your code is dependent on other libraries, you are not relying on the source code but the IL code of that library. I already had a whole blog post about that: <a href="https://steven-giesel.com/blogPost/aa23a1c9-8ab2-4b05-9bd2-52624af7b684">&#34;<em>What is the difference between C#, .NET, IL and JIT?</em>&#34;</a>. Have a read here if you are interested in more details.</p>
<p><img src="https://linkdotnetblog.azureedge.net/blog/20220612_CSharpDotNetJit/Dotnet.webp" alt=".NET"/></p>
<h2 id="f">F#</h2>
<p>Here is a very brief introduction: F# is a functional-first programming language in the .NET ecosystem. It is designed to provide the expressive power of functional programming alongside the robustness of object-oriented paradigms. It enjoys all of the benefits of the .NET Framework itself: open-source, platform-independent, and strongly typed.</p>
<pre><code>let rec factorial n =
    if n = 0 then 1 else n * factorial (n - 1)

printfn &#34;Factorial of 5 is %d&#34; (factorial 5)
</code></pre>
<p>F# also has some distinct features C# does not offer, the most prominent: <a href="https://learn.microsoft.com/en-us/dotnet/fsharp/language-reference/discriminated-unions">Discriminated unions</a>.</p>
<h2 id="the-use-case">The use case</h2>
<p>I want to showcase where F# excels - and oftentimes, that can be the domain layer of your application. Especially then when you have a lot of calculations (basically where functional programming excels in the first place). Let&#39;s create a small domain project that is written in F# and see how it could look like in C#. I will create a &#34;small online&#34; shop that can take orders and calculate a discount (a percentage or a fixed amount). Before we go into F#, have a look at the C# code:</p>
<pre><code>
public class Product 
{
    public string Name { get; set; }
    public decimal Price { get; set; }
}

public class OrderLine 
{
    public Product Product { get; set; }
    public int Quantity { get; set; }
}

public enum DiscountType { Percentage, FixedAmount }

public class Discount 
{
    public DiscountType Type { get; set; }
    public decimal Value { get; set; }
}

public record Order(List&lt;OrderLine&gt; OrderLines, Discount Discount)
{
    public decimal CalculateTotalPrice() 
    {
        decimal subtotal = OrderLines.Sum(ol =&gt; ol.Product.Price * ol.Quantity);
        decimal totalDiscount = 0M;

        if (Discount != null) {
            totalDiscount = Discount.Type == DiscountType.Percentage 
                                ? subtotal * Discount.Value / 100M 
                                : Discount.Value;
        }

        return subtotal - totalDiscount;
    }
}
</code></pre>
<p>Now for the sake of simplicity, I left out a lot of validation and error handling. I hope you get the idea anyway. Now let&#39;s see how this would look like in F#:</p>
<pre><code>type Product = { Name: string; Price: decimal }
type OrderLine = { Product: Product; Quantity: int }

type Discount = 
    | Percentage of float
    | FixedAmount of decimal

type Order(orderLines: OrderLine list, discount: Discount option) =
    member this.CalculateTotalPrice() =
        let subtotal = List.sumBy (fun ol -&gt; ol.Product.Price * (decimal ol.Quantity)) orderLines
        let totalDiscount =
            discount
            |&gt; Option.map (fun d -&gt; 
                match d with
                | Percentage p -&gt; subtotal * (decimal p / 100M)
                | FixedAmount f -&gt; f)
            |&gt; Option.defaultValue 0M
        subtotal - totalDiscount
</code></pre>
<p>Wow - that is really slim. Let&#39;s go through the code step by step. First, we have the <code>Product</code> and <code>OrderLine</code> types. They are just simple records that hold the data. Then we have the <code>Discount</code> type. This is a discriminated union that can either be a <code>Percentage</code> or a <code>FixedAmount</code>. The <code>Order</code> type class takes a list of <code>OrderLine</code> and an optional <code>Discount</code>. The <code>CalculateTotalPrice</code> method is the same as in the C# example. The only difference is that we use the <code>Option</code> type to handle the <code>null</code> case. The <code>Option</code> type is a discriminated union that can either be <code>Some</code> or <code>None</code>. We can use pattern matching to handle both cases. In this case we use the <code>Option.map</code> function to map the <code>Discount</code> to a <code>decimal</code> value. If the <code>Discount</code> is <code>None</code> we use the <code>Option.defaultValue</code> function to return <code>0M</code>.</p>
<p>Now we can easily integrate that to a controller:</p>
<pre><code>[ApiController]
[Route(&#34;api/orders&#34;)]
public class OrderController : ControllerBase
{
    private static readonly List&lt;Order&gt; Orders = new();

    [HttpPost]
    public ActionResult&lt;Order&gt; CreateOrder([FromBody] List&lt;OrderLine&gt; orderLines, [FromBody] Discount discount)
    {
        var fsharpOrderLines = ListModule.OfSeq(orderLines);
        var order = new Order(fsharpOrderLines, discount);
        Orders.Add(order);
        return CreatedAtAction(nameof(GetOrderById), new { id = Orders.Count - 1 }, order);
    }

    [HttpGet(&#34;{id:int}&#34;)]
    public ActionResult&lt;Order&gt; GetOrderById(int id)
    {
        if (id &lt; 0 || id &gt;= Orders.Count)
        {
            return NotFound();
        }

        return Orders[id];
    }

    [HttpGet(&#34;{id:int}/total&#34;)]
    public ActionResult&lt;decimal&gt; GetOrderTotalPrice(int id)
    {
        if (id &lt; 0 || id &gt;= Orders.Count)
        {
            return NotFound();
        }

        return Orders[id].CalculateTotalPrice();
    }

    [HttpGet]
    public ActionResult&lt;IEnumerable&lt;Order&gt;&gt; GetAllOrders()
    {
        return Orders;
    }
}
</code></pre>
<p>There might be a very special line here that needs some clarification:</p>
<pre><code>var fsharpOrderLines = ListModule.OfSeq(orderLines);
</code></pre>
<p>The <code>ListModule.OfSeq</code> function is a helper function that converts a <code>List&lt;T&gt;</code> to a <code>seq&lt;T&gt;</code>. The <code>seq&lt;T&gt;</code> type is a sequence of elements. It is a lazy collection that is only evaluated when needed. This is a very powerful concept that is used a lot in F#. You can read more about it <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/sequences">here</a>. In this case we need to convert the <code>List&lt;T&gt;</code> to a <code>seq&lt;T&gt;</code> because the <code>Order</code> type expects a <code>seq&lt;T&gt;</code> as input.</p>
<h2 id="conclusion">Conclusion</h2>
<p>I hope this blog post gave you a good overview of how you can use F# and C# together. It can be a very powerful tool, and F# has some unique strengths that can make your life easier!</p>
<h2 id="resources">Resources</h2>
<ul>
<li>Source code to this blog post: <a href="https://github.com/linkdotnet/BlogExamples/tree/main/FSharpCombined">here</a></li>
<li>All my sample code is hosted in this repository: <a href="https://github.com/linkdotnet/BlogExamples">here</a></li>
</ul>
</div></div>
  </body>
</html>
