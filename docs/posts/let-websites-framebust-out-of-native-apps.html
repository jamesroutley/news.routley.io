<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.holovaty.com/writing/framebust-native-apps/">Original</a>
    <h1>Let websites framebust out of native apps</h1>
    
    <div id="readability-page-1" class="page"><div id="article"><p>Back in 1996, the website TotalNews.com had a brilliantly evil idea. Why not make a <em>single website</em> that itself contained all the top American news websites, directly embedded within?</p>

<p>After all, why should people go to the trouble of visiting the Washington Post or New York Times websites directly? On TotalNews.com, the websites would be available in one place, with easy navigation.</p>

<p>Using a new technology called the <a href="https://en.wikipedia.org/wiki/Frame_(World_Wide_Web)">HTML &lt;frame&gt; element</a>, TotalNews embedded the top American news sites — content, design and everything! — in such a way that the news was always fresh. (Because, well, it was <em>literally those other websites</em>.)</p>

<p>Naturally, TotalNews added advertising around the news as well. It was only fair for them to be compensated with ad revenue for providing this incredible convenience.</p>

<hr/>

<p>Yeah, it was the early, wild west days of the web — but you have to admire their chutzpah. My own web browsing at the time was spent on Pearl Jam fan sites, so I never saw TotalNews firsthand, but <a href="https://web.archive.org/web/19961226204224/http://www.totalnews.com:80/">this Archive.org snapshot from December 1996</a> provides a vague picture.</p>

<p>Somehow news sites didn’t appreciate TotalNews misappropriating and profiting from their content. So in February 1997, a group of them sued.</p>

<p>The case, <i>The Washington Post, et als. v. TotalNews, Inc., et als.</i>, <a href="https://web.archive.org/web/20130601195312/http://www.netlitigation.com/netlitigation/cases/post.htm">was settled out of court</a>, and TotalNews <a href="https://web.archive.org/web/20010213201830/http://www.publaw.com/framing.html">was prohibited from embedding the sites</a> going forward. This established a precedent, if not legally then at least culturally: Framing without permission was not OK.</p>

<p>But the shady practice continued. So much, in fact, that “framebuster” scripts became popular. This is the technique of putting some JavaScript in your site to check whether it’s currently being framed — and “breaking out of” the frame as needed. (See <a href="https://elie.net/static/files/busting-frame-busting-a-study-of-clickjacking-vulnerabilities-on-popular-sites/busting-frame-busting-a-study-of-clickjacking-vulnerabilities-on-popular-sites-paper.pdf">this excellent 2010 review of framebusting techniques</a> and <a href="https://elie.net/static/files/busting-frame-busting-a-study-of-clickjacking-vulnerabilities-on-popular-sites/busting-frame-busting-a-study-of-clickjacking-vulnerabilities-on-popular-sites-slides.pdf">its accompanying slide deck</a> for a technical overview.) This is essentially website self-defense.</p>

<p>Over time, web developers and security researchers realized there’s a more serious reason a website would want to protect against framing: <a href="https://en.wikipedia.org/wiki/Clickjacking">clickjacking</a>. That’s when, for example, a website frames your site, then hijacks user input such that users are fooled into thinking they’re interacting with your site while they’re actually providing data to the (evil) containing site. Imagine typing your bank credentials into (what you think is) your bank website, whereas it’s in fact an evil site logging everything you’ve typed.</p>

<p>These days, framebuster scripts are no longer necessary, because websites can use a special HTTP header, <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options"><code>X-Frame-Options</code></a>, to block framing in an elegant and effective way. And <a href="https://docs.djangoproject.com/en/4.1/ref/clickjacking/">lovely web frameworks such as Django</a> provide protection, via that header, out of the box. Framebusting is more or less a solved problem.</p>

<p>Except in one major case.</p>

<hr/>

<p>If you click a web link in the native Facebook, Instagram, Reddit or Twitter apps on your smartphone, you won’t be taken to your phone’s web browser. Instead, the app embeds the web page directly, so you don’t leave their environment.</p>

<p>For example, here’s what I got in the Twitter iOS app when I clicked the link in one of Simon Willison’s recent tweets:</p>

<p><img src="https://s3.amazonaws.com/media.holovaty.com/images/2022-08-10-browser.png" alt="Screenshot of in-app browser"/></p>

<p>To the untrained eye, this appears to be my phone’s web browser. It doesn’t identify itself as Twitter anywhere, and it looks, well, pretty plain.</p>

<p>But in fact, this is something entirely different — a more ephemeral thing called a “webview” or “in-app browser.” This is a way for a native app to embed a mini web browser, while asserting control over the user experience and attaching UI, functionality and other cruft. It looks like a separate browser, but in fact it’s still the Twitter app in disguise.</p>

<p>Seem familiar? <i>This is framing, merely in app form</i>. But this time, the framed website has no way to framebust.</p>

<p>It’s TotalNews — but for the 2020s, and much worse. These native apps aren’t (for the most part) putting advertising around websites — but they’re maintaining control over the user’s browsing experience, sometimes spying on users, and providing various problems for the framed websites, with zero recourse available for the users or website owners.</p>

<p>Somewhere along the way, despite a reasonably strong anti-framing culture, framing moved from being a huge no-no to a huge shrug. In a web context, it’s maligned; in a native app context, it’s totally ignored.</p>

<p>Why, precisely, is this bad? Here are four reasons. Each has a specific example, and in almost each case I have direct experience in my work running <a href="https://www.soundslice.com/">Soundslice</a>.</p>

<h2>Misappropriation</h2>

<p>A native app can make misleading claims about the websites that it frames. And due to the seamless way webviews are implemented, a nontechnical user would have no way of knowing that they’re actually viewing a <em>completely unaffiliated</em> website in context of the native app.</p>

<p>For example, a few years ago we got word that an Android app was embedding Soundslice’s <a href="https://www.soundslice.com/musicxml-viewer/">free MusicXML file viewer</a>. The app was offering this as a “feature” to their users.</p>

<p>We didn’t find out about it until they had the nerve to contact us to report a bug regarding file upload within webviews.</p>

<p>We were doing everything right — our website already sends out the <code>X-Frame-Options: Deny</code> header, meaning we don’t allow framing. Yet native apps (and their mobile operating systems) ignore this header, which is a gaping loophole.</p>

<h2>Poor user experience</h2>

<p>If a native app opens a third-party website in a webview, that third-party site will begin a new session, without existing cookies. It’s effectively like using a web browser’s private (aka “incognito”) mode.</p>

<p>This means: If you’re logged into a website in your phone’s browser, but you click a link to that site from a native app’s webview, your logged-in state will not be honored. You’ll need to log in all over again.</p>

<p>At best, this is irritating. At worst, it gives people the false impression that the website is broken or logged them out.</p>

<p>A specific example is Soundslice’s <a href="https://www.instagram.com/soundslice_music/">Instagram account</a>, where we highlight stuff people have created on our platform. If you see something on our Instagram and want to <a href="https://www.soundslice.com/help/en/player/practice-lists/281/creating-practice-lists/">add it to a practice list</a> in your Soundslice account, you quickly run into friction when opening the link within the Instagram app. Even if you’re logged into Soundslice in your phone’s browser, the Instagram app doesn’t honor your Soundslice login.</p>

<p>[Instagram is a particularly heinous example, because it doesn’t even let you add a link to a post. If you enter a URL in an Instagram post, it will not turn into a clickable link. Only <em>one</em> link, the one in your channel bio, is clickable. An <a href="https://duckduckgo.com/?t=ffab&amp;q=link+in+bio+tool&amp;ia=web">entire cottage industry</a> has formed around this “link in bio” madness.]</p>

<p>Yes, you can copy-and-paste the URL (if the webview displays it), or you can choose an “Open in web browser” option (if the webview provides it). But either case requires nontrivial technical sophistication. Most users would just say “Aw, man, I’ve somehow been logged out of Soundslice” and assign the blame to <em>us</em>.</p>

<p>Proponents of native apps would likely argue “But it’s a better user experience from the perspective of the native app! Because the user doesn’t have to context-switch into a different environment, aka the web browser.” There was indeed a time when this argument made sense: the years before 2015, which is when iOS 9 <a href="https://www.iphonelife.com/content/tip-day-how-use-back-button-return-previous-app">introduced a global Back button</a> conveniently solving the problem. And of course Android has its global Back button. These days this argument holds no water.</p>

<p>Proponents of native apps would also likely say: “If you had your own native app, this problem would be solved, because you can register a link handler that will automatically open all soundslice.com URLs in your native app.” iOS calls this <a href="https://developer.apple.com/documentation/xcode/allowing-apps-and-websites-to-link-to-your-content">Universal Links</a>; Android calls it <a href="https://developer.android.com/training/app-links/">App Links</a>. This is true. It’s also an unreasonable, disproportionate demand. I shouldn’t have to develop a native app simply to wrangle control over how my website’s links are treated.</p>

<h2>Weird, non-standard browsers</h2>

<p>Popular apps such as Instagram and Facebook don’t just use vanilla webviews. They use customized ones, with their own quirks.</p>

<p>This means: If you click a link in the Facebook app and it opens in Facebook’s webview, the website might be slightly broken. In my experience, page dimensions/layout can be affected, and the website is provided incorrect information about its environment.</p>

<p>I highly recommend reading Alex Russell’s piece <a href="https://infrequently.org/2021/07/hobsons-browser/">Hobson’s Browser</a>, full of technical details on the deficiencies of in-app browsers.</p>

<p>A specific example is yet again Soundslice. Our main content type — the thing we usually link to — is a piece of interactive sheet music, which is <a href="https://www.soundslice.com/help/en/player/basic/100/resizing-the-player/">dynamically sized to your screen</a>. We’ve specifically had problems with the Instagram webview not properly communicating its screen size — leading our site to apply incorrect dimensions to the sheet music. Again, it’s a situation where <em>we look bad</em> due to an obscure technical detail outside our control.</p>

<p>Hilariously, a few years ago <a href="https://twitter.com/patmeenan/status/1202646663124402177">a Facebook employee announced</a> they added a way to debug your website when it’s viewed in context of the Facebook in-app browser. After <a href="https://twitter.com/adrianholovaty/status/1202666399862337537">I replied it’d be easier if Facebook just opened links in the default browser in the first place</a>, the employee rationalized the webview by saying it <a href="https://twitter.com/patmeenan/status/1202667956280397824">helps protect people</a>. Which brings us to:</p>

<h2>Security</h2>

<p>This is the most important problem, though fortunately it’s the only one I haven’t directly experienced in my own work.</p>

<p>When a native app embeds a website via a webview, <em>the native app has control over that page</em>. Yes, even if it’s on a domain that the native app doesn’t control (!). This means the native app can inject whatever JavaScript it likes into <em>any</em> website that’s viewed in the webview.</p>

<p>Today I read <a href="https://krausefx.com/blog/ios-privacy-instagram-and-facebook-can-track-anything-you-do-on-any-website-in-their-in-app-browser">an astounding exposé by Felix Krause</a>, in which he discovered the Facebook and Instagram iOS apps inject JavaScript into all web pages that are viewed in their webviews. You should read and process this.</p>

<p>Facebook has a sterling reputation to uphold, so I’m sure they wouldn’t do anything horrible here. But more nefarious apps could <a href="https://arstechnica.com/gadgets/2021/07/google-boots-google-play-apps-for-stealing-users-facebook-passwords/">steal passwords</a> or <a href="https://surface.syr.edu/cgi/viewcontent.cgi?article=1081&amp;context=etd">perform other types of attacks</a>.</p>

<p>The more I think about it, the more I cannot believe <em>webviews with unfettered JavaScript access to third-party websites</em> ever became a legitimate, accepted technology. It’s bad for users, and it’s bad for websites.</p>

<p>But fortunately, I think something can be done about all this.</p>

<h2>A proposed solution</h2>

<p>Fundamentally this is about power. It’s a struggle between four participants:</p>

<ul>
    <li><b>The user</b> wants to click a link to a website, retaining any useful state, with the ability to freely jump between apps/sites.</li>
    <li><b>The website</b> wants the user to have a smooth experience.</li>
    <li><b>The native app</b> wants to keep the user within its app (aka lock-in). In some cases, such as Facebook, the app wants to collect detailed information about the user’s browsing behavior.</li>
    <li><b>The mobile operating system</b> (iOS and Android) wants developers to build native apps on its platform. The web is a bit of an afterthought, a lower priority.
</li></ul>

<p>At the moment, the power is squarely in the hands of the last two. I believe it should be more balanced, giving website owners a way to opt out of this behavior — in old-school terms, a way to framebust.</p>

<p>So my proposal is this: Apple and Google should honor the existing <code>X-Frame-Options</code> HTTP header in webviews. If a website is loaded into a webview, and the website includes the appropriate <code>X-Frame-Options</code> header, the mobile OS should immediately stop loading the webview and open the URL in the user’s preferred web browser.</p>

<p>This elegantly uses an existing technology and gives websites a much-needed opt out.</p>

<p>Unfortunately, the only way for this to happen would be to convince Apple and Google to do it. I can’t imagine a general opt-out solution that doesn’t involve iOS and Android providing hooks at the OS level. And, as Co-Monopolists Of The World Of Native Phone Apps, Apple and Google have zero incentive to make such a change.</p>

<p>It <em>could</em> in theory be implemented by individual apps, but I wouldn’t trust Facebook to do this because of conflict of interest. And the sad precedent of the <a href="https://en.wikipedia.org/wiki/Do_Not_Track">Do Not Track header</a> is instructive.</p>

<p>Our best bet is regulatory intervention, along the lines of what <a href="https://open-web-advocacy.org/">Open Web Advocacy</a> is doing. In collecting my thoughts here, I hope to start this conversation. The modern version of TotalNews must be reined in.</p></div></div>
  </body>
</html>
