<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://commoncog.com/blog/how-to-hunt-useful-research/">Original</a>
    <h1>How To Hunt For Useful Self Improvement Research</h1>
    
    <div id="readability-page-1" class="page"><div>
						
<p>Let’s see how to configure webpack to manage general assets, for example, text and pdf files. We’ll see how to configure webpack to dynamically generate URLs for these files. As an application, we’ll show how to add download links to these resources.</p>



<h2>Project structure and setup</h2>



<p>Our project will have the following folder structure:</p>



<pre data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">.
├── build
├── index.html
├── package.json
├── package-lock.json
├── src
│   ├── assets
│   │   ├── file.pdf
│   │   └── file.txt
│   └── index.js
└── webpack.config.js</pre>



<p>First, we initialize an npm project. From the project root folder:</p>



<pre data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">$ npm init -y</pre>



<p>Then, we add the dependencies we’ll need:</p>



<pre data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">$ npm install -D webpack webpack-cli html-webpack-plugin</pre>



<p><code>index.html</code> will be our main HTML page. Its <em>body</em> tag content will consist of the following <em>anchor</em> tags:</p>



<pre data-enlighter-language="html" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">&lt;!-- index.html --&gt;
&lt;body&gt;
  &lt;a id=&#34;pdf-file&#34; target=&#34;_blank&#34;&gt;Download PDF&lt;/a&gt;
  &lt;br /&gt;
  &lt;a id=&#34;txt-file&#34; target=&#34;_blank&#34;&gt;Download TXT&lt;/a&gt;
&lt;/body&gt;</pre>



<p>These will be used as links to download <code>file.pdf</code> and <code>file.txt</code>.</p>



<p>Next, let’s see the required webpack configuration to add links to these files to the HTML file.</p>



<h2>Basic webpack configuration</h2>



<p>Webpack takes its configuration from <code>webpack.config.js</code>. Let’s add the minimal configuration to process HTML files and asset files (pdf, txt, etc).</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">const path = require(&#34;path&#34;);
const HtmlWebpackPlugin = require(&#34;html-webpack-plugin&#34;);

module.exports = {
  entry: {
    index: &#34;./src/index.js&#34;,
  },
  output: {
    filename: &#34;[name].js&#34;,
    path: path.resolve(__dirname, &#34;build&#34;),
    assetModuleFilename: &#34;assets/[name][ext]&#34;,
    clean: true,
  },
  mode: &#34;development&#34;,
  plugins: [
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, &#34;index.html&#34;),
      filename: &#34;index.html&#34;,
      chunks: [&#34;index&#34;],
    }),
  ],
  module: {
    rules: [
      {
        test: /\.(pdf|txt)$/,
        include: path.resolve(__dirname, &#34;src&#34;),
        type: &#34;asset/resource&#34;,
        generator: {
          filename: &#34;assets/[name][ext]&#34;,
        },
      },
    ],
  },
};</pre>



<p>With this configuration, we area defining a single entry point (<code>src/index.js</code>), which is in turn linked to <code>index.html</code> using the <a href="https://webpack.js.org/plugins/html-webpack-plugin/#root">webpack-html-plugin</a> (see webpack configuration for <a href="https://onestepcode.com/webpack-configuration-multiple-entry-points/">multiple entry points</a>). </p>



<p>Besides HTML and JavaScript files, we define special rules for <code>pdf</code> and <code>txt</code> files. These will be all loaded with webpack’s built-in <a href="https://webpack.js.org/guides/asset-modules/">asset modules</a>, in particular with <code>asset/resource</code>. Note that these modules are present only in webpack 5.</p>



<p>Let’s study the configuration options that are specific to assets.</p>



<p>First, we set a directory to store these files. This is done with the <code>output.assetModuleFilenames</code> property. Note that this path is relative to our main output path (<code>build/</code>, in this case).</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">assetModuleFilename: &#34;assets/[name][ext]&#34;</pre>



<p>The special <code>[name]</code> and <code>[ext]</code> <a href="https://webpack.js.org/configuration/output/#template-strings">placeholders</a> will be replaced by the name and extension of each file. For example, loading <code>file1.txt</code> to our project will copy it to <code>build/assets/file1.txt</code>.  The resulting URL address once uploaded to a server would be: <code>mywebsite.com/assets/file1.txt</code>.</p>



<p>Processing these files is done by the <code>asset/resource</code> module following this rule:</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">module: {
  rules: [
    {
      test: /\.(pdf|txt)$/,
      include: path.resolve(__dirname, &#34;src&#34;),
      type: &#34;asset/resource&#34;,
    },
  ],
}</pre>



<p>Both <code>pdf</code> and <code>txt</code> files (we could add other file extensions, too) will match and be processed by <code>asset/resource</code>. It will copy the matching files to the specified output and replace all references to these files in our source code with their corresponding relative URL path.</p>



<p>With this configuration, let’s see how to add references to our assets.</p>



<h2>Adding asset files using scripts</h2>



<p>First, let’s add assets using JavaScript.</p>



<p>Remember that we configured <code>index.js</code> to be linked to <code>index.html</code>.</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">// index.js
import PDF from &#34;./assets/file.pdf&#34;;
import TXT from &#34;./assets/file.txt&#34;;
// const PDF = require(&#34;./assets/file.pdf&#34;);
// const TXT = require(&#34;./assets/file.txt&#34;);

document.getElementById(&#34;pdf-file&#34;).href = PDF;
document.getElementById(&#34;txt-file&#34;).href = TXT;</pre>



<p>See that this script imports the assets from <code>src/assets</code> just like any other JavaScript module. We can use these import references as we would with any variable. Once webpack processes our source code, it will replace these references with the correct relative URLs, following our specified configuration.</p>



<p>We can test this by bundling the files. Either define an npm script that runs <code>webpack</code> or run the following:</p>



<pre data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">$ npx webpack</pre>



<p>It will write the output files to <code>build/</code>. First, we notice that the assets have been copied to <code>build/assets</code>.</p>



<pre data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">build/
├── assets
│   ├── file.pdf
│   └── file.txt
├── index.html
└── index.js</pre>



<p>If we open <code>build/index.html</code> with a web browser, we’ll see the anchor tag references have been changed to the corresponding URL paths of the assets!</p>



<h2>Adding asset files directly to HTML files</h2>



<p>Using scripts to load assets is completely functional and it’s the approach we would use with frameworks like React. However, we can also load assets dynamically without using scripts at all. To do so, we’ll need an HTML processor. We’ll use <a href="https://pugjs.org/">pug</a> for this demo, but any processor would do.</p>



<p>First, we need to configure webpack to process pug files. We’ll use <code><a href="https://github.com/Spence-S/simple-pug-loader">simple-pug-loader</a></code>, which works better with webpack 5.</p>



<p>We install the module.</p>



<pre data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">$ npm i -D simple-pug-loader</pre>



<p>And then we a add the following configuration to <code>webpack.config.js</code>: </p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">// webpack.config.js
...
module.exports = {
  ...
  plugins: [
    ...
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, &#34;pugindex.pug&#34;),
      filename: &#34;pugindex.html&#34;,
    }),
  ],
 module: {
    rules: [
      ...
      {
        test: /\.pug$/,
        include: path.resolve(__dirname),
        use: [
          {
            loader: &#34;simple-pug-loader&#34;,
          },
        ],
      },
    ],
  },
};</pre>



<p>The two single changes were: 1) configuring the <code>html-webpack-plugin</code> to process <code>pugindex.pug</code> and generate <code>pugindex.html</code>, 2) adding a new rule to process all <code>.pug</code> files with <code>simple-pug-loader</code>.</p>



<p>With this new configuration, let’s create <code>pugindex.pug</code> at the root folder:</p>



<pre data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">// pugindex.pug
doctype html
html(lang=&#34;en&#34;)
  head
    meta(charset=&#34;UTF-8&#34;)
    meta(http-equiv=&#34;X-UA-Compatible&#34;, content=&#34;IE=edge&#34;)
    meta(name=&#34;viewport&#34;, content=&#34;width=device-width, initial-scale=1.0&#34;)
    title Webpack Files
  body
    p Hello world!</pre>



<p>Let’s build the files to see it all works.</p>



<h2>Adding dynamic file references to pug</h2>



<p>Finally, we can add references in pug to asset files as follows:</p>



<pre data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">// pugindex.pug
...
body
  a(href=require(&#34;./src/assets/file.pdf&#34;) target=&#34;_blank&#34;) Download pdf
  br
  a(href=require(&#34;./src/assets/file.txt&#34;) target=&#34;_blank&#34;) Download txt </pre>



<p>We add the references with the NodeJS <code>require</code> keyword used to load modules. We pass to it the path of the asset relative to the pug file. With the webpack configuration of the previous sections, these references will be processed to add relative URLs to the locations these files will be copied to after bundling by wepback! </p>



<p>One of the advantages of this method is that we don’t need to manually keep track of the assets and copy them to our public folder. We can load assets from any path and webpack will process all of these references to the desired folder structure for our webpage. </p>
					</div></div>
  </body>
</html>
