<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://determinate.systems/posts/determinate-nix-installer">Original</a>
    <h1>The Determinate Nix Installer</h1>
    
    <div id="readability-page-1" class="page"><div data-block-type="2" id="block-a1a3df26d5c9154ced59"><p>We at Determinate Systems are extremely excited to announce the release of the <a href="https://github.com/DeterminateSystems/nix-installer" target="_blank">Determinate Nix Installer</a>, a brand-new installer for <a href="https://nixos.org/" target="_blank">Nix</a>. You can run the installer on a <a href="https://github.com/determinateSystems/nix-installer#the-determinate-nix-installer" target="_blank">variety of systems</a>, including macOS, Linux, Windows via WSL2, and more, with this command:</p></div><div data-block-type="2" id="block-yui_3_17_2_1_1677507611471_3261"><div>

<p>Check out the <a href="https://zero-to-nix.com/start/install" target="_blank">Zero to Nix quick start</a> for a more in-depth look. In this post, we’ll cover how our new installer improves on the current official installer, why and how we built it, and how we envision its future.</p><h3>Why installing Nix is a complex problem</h3><p>Sometimes, installing software is straightforward. You fetch a binary from a URL, you copy it to a directory on your <code>PATH</code>, and you’re good to go. But sometimes things aren’t nearly so simple. <a href="https://nixos.org">Nix</a>, as powerful and transformative as it is, falls firmly in the “not nearly so simple” camp. Far from just a static binary that you can fetch, copy, and call it a day, Nix requires a broad set of changes to your system, from creating new users to installing and running a <a href="https://nixos.org/manual/nix/stable/command-ref/new-cli/nix3-daemon.html">daemon</a> to creating a <a href="https://zero-to-nix.com/concepts/nix-store">root volume</a> and beyond. Nix installation is a non-trivial problem—and one that by definition can’t be solved by Nix itself.</p><p>Currently, the <a href="https://nixos.org/download.html">official installer</a> for Nix is a Bash script that does the job. It’s been used with success many thousands of times in various settings. Some of our team members have even worked on the official installation script. It’s widely used because it <strong><em>works</em></strong>. But for reasons that we’ll lay out here, we’ve felt for some time that the official installer has shortcomings that make Nix onboarding more challenging than it needs to be.</p><h3>A fresh start</h3><p>From our perspective, the current official installer has three main problems:</p><ul data-rte-list="default"><li><p>It’s written in Bash. We love Bash here at Determinate Systems, but we think it’s unsuitable for something as fine-grained as installing Nix. Different Bash implementations have subtle differences that make it hard to eliminate inconsistencies and edge cases—and it’s hard to discover those in the first place because Bash is all but untestable.</p></li><li><p>It can leave your system in an awkward “in-between” state, with some installation actions successful and others not. The installer may, for example, successfully create a root volume but then fail to create the appropriate system users. But awkward or broken state is something that Nix is <em>supposed to free you from</em>.</p></li><li><p>Relatedly, it offers no built-in way to uninstall Nix, leaving people to seek out help on <a href="https://github.com/NixOS/nix/issues/1402#issuecomment-312496360">GitHub</a> and <a href="https://stackoverflow.com/questions/51929461/how-to-uninstall-nix">Stack Overflow</a>. But we suspect it would help to spur Nix adoption if users could install Nix with complete confidence that they could undo all system changes required by the installation process with a single command: <code>/nix/nix-installer uninstall</code> (the installer removes itself when you uninstall).</p></li></ul><p>We didn’t think that “improve the existing Bash script” was a sufficiently radical approach, so we began discussing a vision for a new installer internally. Later, we saw the <a href="https://discourse.nixos.org/t/nix-installer-workgroup/21495">installer discussion</a> on the <a href="https://discourse.nixos.org">NixOS Discourse</a> and enthusiastically joined the installer working group. In that group, we’ve kept group members apprised of our progress and discussed what the Determinate Nix Installer would need to provide to be broadly adoptable by the Nix community. We think it’s well on the way to being that, but we hope that this release prompts many rounds of community feedback.</p><h3>Core differentiators</h3><p>We believe that the Determinate Nix Installer offers two main advances:</p><ul data-rte-list="default"><li><p>We wrote it in <strong>Rust</strong> instead of Bash. The chief advantage of Rust here is that it deftly sidesteps any conceivable problems with differing Bash implementations, and because Rust supports a wide range of build targets, the Determinate Nix Installer can support a wide range of systems, including systems without Bash installed. Beyond that, Rust offers robust error handling, a fantastic type system, and great libraries like <a href="https://clap.rs">clap</a> for building CLIs and <a href="https://tokio.rs">Tokio</a> for asynchronous programming. The installer was and will remain a joy to develop, something that can rarely be said of Bash scripts.</p></li><li><p>We introduced the concept of an installation <strong>receipt</strong>. This is a JSON file that indicates what has already been accomplished by the installer—and what hasn’t. It’s stored under <code>/nix</code> and keeps all the information the installer needs to <em>uninstall</em> Nix seamlessly. That means deleting all of the volumes, directories, files, users, and groups that the installer created as well as surgically undoing changes to files you need to keep around (like <code>bashrc</code>).</p></li></ul><h3>A flexible installer</h3><p>Above all, we want our installer to work seamlessly in any environment where Nix can work its magic:</p><ul data-rte-list="default"><li><p>On your desktop, laptop, or server, whether manually or using automated approaches like mobile device management (MDM).</p></li><li><p>In continuous integration and continuous deployment environments. We provide a <a href="https://github.com/DeterminateSystems/nix-installer-action">GitHub Action</a> for the Determinate Nix Installer, but it should be adaptable to any CI system.</p></li><li><p>In virtual machines and <a href="https://opencontainers.org">OCI</a> containers.</p></li></ul><p>To that end, we’ve provided an opinionated default experience configurable enough to meet more specific requirements. The opinionated part is that the Determinate Nix Installer installs Nix with <a href="https://zero-to-nix.com/concepts/flakes">Nix flakes</a> and the <a href="https://zero-to-nix.com/concepts/nix#unified-cli">unified CLI</a> enabled. Although flakes and the unified CLI remain experimental features of Nix, we’re confident that new users should adopt them now and that more seasoned Nix users should <a href="https://zero-to-nix.com/concepts/flakes">make the transition ASAP</a>.</p><p>In terms of configurability, the Determinate Nix Installer provides a range of CLI flags that you can use to customize the experience. To give some examples, running <code>nix-installer install --no-confirm</code> disables the default manual confirmation step (good for things like setup scripts), <code>nix-installer install --init none</code> installs Nix without needing an init system like <a href="https://systemd.io/">systemd</a> (good for things like Docker containers), and <code>nix-installer install --extra-config</code> enables you to supply extra Nix configuration to be written directly to your <code><a href="https://nixos.org/manual/nix/stable/command-ref/conf-file.html">nix.conf</a></code> file. Over time, we’ll likely add more configuration options in response to community feedback. Feel free to file an <a href="https://github.com/DeterminateSystems/nix-installer/issues">issue</a> if you run into any issues.</p><h3>The future of the installer</h3><p>As a company, we’re open to a wide variety of possible trajectories for the Determinate Nix Installer. We’ve <a href="https://github.com/DeterminateSystems/nix-installer/blob/main/LICENSE">licensed it</a> under the highly permissive <a href="https://www.gnu.org/licenses/old-licenses/lgpl-2.1.en.html">GNU Lesser General Public License v2.1</a>—under which Nix itself is licensed—which should provide little obstruction to eventually making it the official installer if that’s what the community desires. We’ve also released it <a href="https://docs.rs/nix-installer/0.3.0/nix_installer/">as a Rust library</a> that anyone can make use of, including a potential reimagined official installer that borrows logic from the Determinate Nix Installer but provides a different set of defaults.</p><p>The initial feedback for the Determinate Nix Installer has been uniformly positive, and we’re thrilled to finally release it to the community after months of hard work. We know that it needs to prove itself in a wide variety of situations and that it will need several rounds of feedback and bug fixes. We’re eager to undergo that process in conjunction with the Nix community.</p><p>We take the core tenets of Nix very seriously. True to our name, we want to make software systems as <strong><em>determinate</em></strong> as they can conceivably be. Making Nix installation robust, seamless, and trivially reversible is a major step in that direction.</p>


</div></div></div>
  </body>
</html>
