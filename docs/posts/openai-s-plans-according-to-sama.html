<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://humanloop.com/blog/open_ai_talk">Original</a>
    <h1>OpenAI&#39;s plans according to sama</h1>
    
    <div id="readability-page-1" class="page"><div>
<div><p>If you’re new to Rust and playing around with <code>println()</code> as a way of trying to understand ownership, this post could be useful for you.</p>
<p>The key takeaway is short, sweet and in <a href="#tl-dr">TL;DR</a>. The journey I took to get there makes up the rest of this post:</p>
<ol>
<li><a href="#trying-to-break-my-code-with-an-ownership-error-and-failing">Trying to break my code with an ownership error (and failing)</a></li>
<li><a href="#investigating">Investigating</a></li>
<li><a href="#understanding">Understanding</a></li>
<li><a href="#trying-to-break-my-code-with-an-ownership-error-and-succeeding">Trying to break my code with an ownership error (and succeeding)</a></li>
<li><a href="#takeaways">Takeaways</a></li>
<li><a href="#tl-dr">TL;DR</a></li>
</ol>
<h2 id="trying-to-break-my-code-with-an-ownership-error-and-failing">Trying to break my code with an ownership error (and failing)</h2>
<p>I <a href="https://joaoabbottgribben.bearblog.dev/maze-making-in-rust-part-2/#ownership-post-script">ended</a> my last post confused about why my code was compiling - according to my understanding of Rust’s ownership model, the code I wrote should have produced an ownership error.</p>
<p>This was how the code looked before I tried to break it:</p>
<div><pre><span></span><span>fn</span> <span>main</span><span>(){</span>
<span>    </span><span>let</span><span> </span><span>cell_one</span>: <span>Cell</span><span> </span><span>=</span><span> </span><span>Cell</span><span> </span><span>{</span>
<span>        </span><span>row</span>: <span>1</span><span>,</span>
<span>        </span><span>column</span>: <span>1</span><span>,</span>
<span>        </span><span>north</span>:  <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>east</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>south</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>west</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span>
<span>    </span><span>};</span>
<span>    </span><span>println!</span><span>(</span><span>&#34; cell_one </span><span>\n</span><span> {:#?}&#34;</span><span>,</span><span> </span><span>&amp;</span><span>cell_one</span><span>);</span><span> </span><span>// &lt;- reference, &amp;cell_one</span>

<span>     </span><span>let</span><span> </span><span>cell_two</span>: <span>Cell</span><span> </span><span>=</span><span> </span><span>Cell</span><span>{</span>
<span>        </span><span>row</span>: <span>0</span><span>,</span>
<span>        </span><span>column</span>: <span>0</span><span>,</span>
<span>        </span><span>north</span>: <span>Some</span><span>(</span><span>Box</span>::<span>new</span><span>(</span><span>cell_one</span><span>)),</span><span> </span><span>// &lt;- use directly, cell_one</span>
<span>        </span><span>east</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>south</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>west</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span>
<span>    </span><span>};</span>

<span>    </span><span>println!</span><span>(</span><span>&#34; cell_two </span><span>\n</span><span> {:#?}&#34;</span><span>,</span><span> </span><span>cell_two</span><span>);</span>
<span>}</span>
</pre></div>
<p>This compiles successfully and on execution you get to see the two cells output to the terminal.</p>
<p>You can see that I’m passing a reference to <code>cell_one</code> into <code>println()</code>, using the <code>&amp;cell_one</code> syntax. I had thought that this was necessary because otherwise <code>cell_two</code> couldn’t use <code>cell_one</code> as one of its fields, because <code>println()</code> would have taken ownership.</p>
<p>To test this understanding, I thought I could break the above working code and produce an ownership error by giving <code>println()</code> the actual <code>cell_one</code>, not just a reference.</p>
<p>Here’s what that looked like:</p>
<div><pre><span></span><span>fn</span> <span>main</span><span>(){</span>
<span>    </span><span>let</span><span> </span><span>cell_one</span>: <span>Cell</span><span> </span><span>=</span><span> </span><span>Cell</span><span> </span><span>{</span>
<span>        </span><span>row</span>: <span>1</span><span>,</span>
<span>        </span><span>column</span>: <span>1</span><span>,</span>
<span>        </span><span>north</span>:  <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>east</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>south</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>west</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span>
<span>    </span><span>};</span>
<span>    </span><span>println!</span><span>(</span><span>&#34; cell_one </span><span>\n</span><span> {:#?}&#34;</span><span>,</span><span> </span><span>cell_one</span><span>);</span><span> </span><span>// &lt;- use directly, give ownership of cell_one to println!()</span>

<span>     </span><span>let</span><span> </span><span>cell_two</span>: <span>Cell</span><span> </span><span>=</span><span> </span><span>Cell</span><span>{</span>
<span>        </span><span>row</span>: <span>0</span><span>,</span>
<span>        </span><span>column</span>: <span>0</span><span>,</span>
<span>        </span><span>north</span>: <span>Some</span><span>(</span><span>Box</span>::<span>new</span><span>(</span><span>cell_one</span><span>)),</span><span> </span><span>// &lt;- meaning it&#39;s unavailable here?</span>
<span>        </span><span>east</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>south</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>west</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span>
<span>    </span><span>};</span>

<span>    </span><span>println!</span><span>(</span><span>&#34; cell_two </span><span>\n</span><span> {:#?}&#34;</span><span>,</span><span> </span><span>cell_two</span><span>);</span>
<span>}</span>
</pre></div>
<p>But, the code still compiled, I didn’t get the ownership error I wanted : (</p>
<p>To recap, I thought that it would not compile because…</p>
<ul>
<li>ownership of <code>cell_one</code> would be transferred to <code>println()</code></li>
<li><code>cell_two</code> would try to use <code>cell_one</code> for its <code>north</code> field</li>
<li>but it would be unable to, because <code>cell_one</code> would be owned by <code>println()</code></li>
</ul>
<h2 id="investigating">Investigating</h2>
<p>So, what was wrong about my understanding?</p>
<p>But before I dug into that, I thought it best to re-establish the basics of ownership. I re-read the introductory documentation, focusing on how <a href="https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html#ownership-and-functions">functions take ownership of what is passed into them</a>. This confirmed my initial understanding: if you pass a variable directly (without referencing or copying etc.) into a function, that function will take ownership.</p>
<p>On realising that my mental model was broadly correct, and <code>println()</code> was an exception, I pulled on that thread, putting all my hours of art and art history writing into crafting the search term ‘Rust does println take ownership?’.</p>
<h2 id="understanding">Understanding</h2>
<p>To summarise, the code that I didn’t want to compile was compiling because…</p>
<ul>
<li>the ownership of <code>cell_one</code> was <em>not</em> transferred to <code>println!()</code></li>
<li><code>cell_two</code> would try to use <code>cell_one</code> for its <code>north</code> field</li>
<li>and it would be able to, because <code>println!()</code> only ever took a <em>reference</em> of <code>cell_one</code></li>
</ul>
<p>(As an aside, with this new knowledge the use of <code>&amp;</code> when feeding <code>&amp;cell_one</code> to <code>println()</code> in the first code snippet was redundant).</p>
<h2 id="trying-to-break-my-code-with-an-ownership-error-and-succeeding">Trying to break my code with an ownership error (and succeeding)</h2>
<p>Knowing <code>println()</code> couldn’t give me the error message I wanted, I had to look elsewhere - <code>dbg()</code> seemed like it would do the trick:</p>
<div><pre><span></span><span>fn</span> <span>main</span><span>(){</span>
<span>    </span><span>let</span><span> </span><span>cell_one</span>: <span>Cell</span><span> </span><span>=</span><span> </span><span>Cell</span><span> </span><span>{</span>
<span>        </span><span>row</span>: <span>1</span><span>,</span>
<span>        </span><span>column</span>: <span>1</span><span>,</span>
<span>        </span><span>north</span>:  <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>east</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>south</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>west</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span>
<span>    </span><span>};</span>
<span>    </span><span>dbg!</span><span>(</span><span>&#34;cell_one </span><span>\n</span><span> {:#?}&#34;</span><span>,</span><span> </span><span>cell_one</span><span>);</span><span> </span><span>//ownership actually transferred</span>

<span>    </span><span>let</span><span> </span><span>cell_two</span>: <span>Cell</span><span> </span><span>=</span><span> </span><span>Cell</span><span>{</span>
<span>        </span><span>row</span>: <span>0</span><span>,</span>
<span>        </span><span>column</span>: <span>0</span><span>,</span>
<span>        </span><span>north</span>: <span>Some</span><span>(</span><span>Box</span>::<span>new</span><span>(</span><span>cell_one</span><span>)),</span>
<span>        </span><span>east</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>south</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>west</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span>
<span>    </span><span>};</span>
<span>    </span><span>println!</span><span>(</span><span>&#34; cell_two </span><span>\n</span><span> {:#?}&#34;</span><span>,</span><span> </span><span>cell_two</span><span>);</span>
<span>}</span>
</pre></div>
<p>Yes!</p>
<p><code>dbg!()</code> has delivered the goods, giving me all the E0382 ownership error I could have ever dreamed of:</p>
<div><pre><span></span>error<span>[</span>E0382<span>]</span>:<span> </span>use<span> </span>of<span> </span>moved<span> </span>value:<span> </span><span>`</span>cell_one<span>`</span>
<span>  </span>--&gt;<span> </span>src/cell.rs:25:30
<span>   </span><span>|</span>
<span>12</span><span> </span><span>|</span><span>     </span><span>let</span><span> </span>cell_one:<span> </span><span>Cell</span><span> </span><span>=</span><span> </span>Cell<span> </span><span>{</span>
<span>   </span><span>|</span><span>         </span>--------<span> </span>move<span> </span>occurs<span> </span>because<span> </span><span>`</span>cell_one<span>`</span><span> </span>has<span> </span><span>type</span><span> </span><span>`</span>Cell<span>`</span>,<span> </span>which<span> </span>does<span> </span>not<span> </span>implement<span> </span>the<span> </span><span>`</span>Copy<span>`</span><span> </span>trait
...
<span>20</span><span> </span><span>|</span><span>     </span>dbg!<span>(</span><span>&#34;cell_one \n {:#?}&#34;</span>,<span> </span>cell_one<span>)</span><span>;</span>
<span>   </span><span>|</span><span>     </span>-----------------------------------<span> </span>value<span> </span>moved<span> </span>here
...
<span>25</span><span> </span><span>|</span><span>         </span>north:<span> </span>Some<span>(</span>Box::new<span>(</span>cell_one<span>))</span>,
<span>   </span><span>|</span><span>                              </span>^^^^^^^^<span> </span>value<span> </span>used<span> </span>here<span> </span>after<span> </span>move
</pre></div>
<h2 id="takeaways">Takeaways</h2>
<ul>
<li>Always read the error message and the documentation thoroughly first.</li>
<li>Then re-read them.</li>
<li>Maybe do that again, just to be sure.</li>
<li>Odds are on that the issue you’re facing has been faced by others before and is probably something simple.</li>
<li>Just because you’re ignorant and fearful of something, don’t jump to conclusions that it’s the cause of whatever issues you’re having.</li>
<li>Ownership is challenging but also very intriguing and for some reason quite rewarding.</li>
</ul>
<h2 id="tl-dr">TL;DR</h2>
<p>Keep an eye out for using <code>println()</code> when you&#39;re learning about ownership as it doesn’t take ownership of variables that are passed into it, it only ever uses a reference to them.</p>
</div>
</div></div>
  </body>
</html>
