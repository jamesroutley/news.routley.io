<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/CZ-NIC/pz">Original</a>
    <h1>Easily handle CLI operation via Python instead of regular Bash programs</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
          <article itemprop="text">
<p dir="auto"><a href="https://travis-ci.org/CZ-NIC/pz" rel="nofollow"><img src="https://camo.githubusercontent.com/ac793506f7a829d2c7fa1f66472dd9b2aae3681f0ae1a143a63d97162f4ab8d5/68747470733a2f2f7472617669732d63692e6f72672f435a2d4e49432f707a2e7376673f6272616e63683d6d61696e" alt="Build Status" data-canonical-src="https://travis-ci.org/CZ-NIC/pz.svg?branch=main"/></a>
<a href="https://pepy.tech/project/pz" rel="nofollow"><img src="https://camo.githubusercontent.com/cb3d72b30d2c315daa1a075c6c0c3c244e65dc3c41bc5e59783a173baac91a55/68747470733a2f2f706570792e746563682f62616467652f707a" alt="Downloads" data-canonical-src="https://pepy.tech/badge/pz"/></a></p>
<p dir="auto">Ever wished to use Python in Bash? Would you choose the Python syntax over <code>sed</code>, <code>awk</code>, ...? Should you exactly know what command would you use in Python, but you end up querying <code>man</code> again and again, read further. The utility allows you to <em>pythonize</em> the shell: to pipe arbitrary contents through <code>pz</code>, loaded with your tiny Python script.</p>
<p dir="auto"><strong>How? Simply meddle with the <code>s</code> variable.</strong> Example: appending &#39;.com&#39; to every line.</p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;example\nwikipedia&#34; | pz &#39;s += &#34;.com&#34;&#39;
example.com
wikipedia.com"><pre>$ <span>echo</span> -e <span><span>&#34;</span>example\nwikipedia<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>s += &#34;.com&#34;<span>&#39;</span></span>
example.com
wikipedia.com</pre></div>
<ul dir="auto">
<li><a href="#installation">Installation</a></li>
<li><a href="#examples">Examples</a>
<ul dir="auto">
<li><a href="#extract-a-substring">Extract a substring</a></li>
<li><a href="#prepend-to-every-line-in-a-stream">Prepend to every line in a stream</a></li>
<li><a href="#converting-to-uppercase">Converting to uppercase</a></li>
<li><a href="#parsing-numbers">Parsing numbers</a></li>
<li><a href="#find-out-all-urls-in-a-text">Find out all URLs in a text</a></li>
<li><a href="#sum-numbers">Sum numbers</a></li>
<li><a href="#keep-unique-lines">Keep unique lines</a></li>
<li><a href="#counting-words">Counting words</a></li>
<li><a href="#fetching-web-content">Fetching web content</a></li>
<li><a href="#handling-nested-quotes">Handling nested quotes</a></li>
<li><a href="#computing-factorial">Computing factorial</a></li>
<li><a href="#read-csv">Read CSV</a></li>
<li><a href="#generate-random-number">Generate random number</a></li>
<li><a href="#average-a-stream-value">Average a stream value</a></li>
<li><a href="#multiline-statements">Multiline statements</a></li>
<li><a href="#simple-progress-bar">Simple progress bar</a></li>
</ul>
</li>
<li><a href="#docs">Docs</a>
<ul dir="auto">
<li><a href="#scope-variables">Scope variables</a>
<ul dir="auto">
<li><a href="#s--current-line"><code>s</code> – current line</a></li>
<li><a href="#n--current-line-converted-to-an-int-or-float-if-possible"><code>n</code> – current line converted to an <code>int</code> (or <code>float</code>) if possible</a></li>
<li><a href="#b--current-line-as-a-byte-string"><code>b</code> – current line as a byte-string</a></li>
<li><a href="#count--current-line-number"><code>count</code> – current line number</a></li>
<li><a href="#text--whole-text-all-lines-together"><code>text</code> – whole text, all lines together</a></li>
<li><a href="#lines--list-of-lines-so-far-processed"><code>lines</code> – list of lines so far processed</a></li>
<li><a href="#numbers--list-of-numbers-so-far-processed"><code>numbers</code> – list of numbers so far processed</a></li>
<li><a href="#skip-line"><code>skip</code> line</a></li>
<li><a href="#i-s-l-d-c--other-global-variables"><code>i</code>, <code>S</code>, <code>L</code>, <code>D</code>, <code>C</code> – other global variables</a></li>
</ul>
</li>
<li><a href="#auto-import">Auto-import</a></li>
<li><a href="#output">Output</a></li>
<li><a href="#cli-flags">CLI flags</a>
<ul dir="auto">
<li><a href="#command-clauses">Command clauses</a></li>
<li><a href="#input--output">Input / output</a></li>
<li><a href="#regular-expressions-shortcuts">Regular expressions shortcuts</a></li>
<li><a href="#bash-completion">Bash completion</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<p dir="auto">Install with a single command from <a href="https://pypi.org/project/pz/" rel="nofollow">PyPi</a>.</p>

<p dir="auto">Or download and launch the <a href="https://raw.githubusercontent.com/CZ-NIC/pz/main/pz" rel="nofollow"><code>pz</code></a> file from here.</p>

<p dir="auto">How does your data look when pythonized via <code>pz</code>? Which Bash programs may the utility substitute?</p>
<h2 dir="auto"><a id="user-content-extract-a-substring" aria-hidden="true" href="#extract-a-substring"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Extract a substring</h2>
<p dir="auto">Just use the <code>[:]</code> notation.</p>
<div data-snippet-clipboard-copy-content="echo &#34;hello world&#34; | pz s[6:]  # world"><pre><span>echo</span> <span><span>&#34;</span>hello world<span>&#34;</span></span> <span>|</span> pz s[6:]  <span><span>#</span> world</span></pre></div>
<p dir="auto"><sub>Note that suppressing quotes around the argument may not work (Zsh) or lead to an unexpected behaviour: <code>touch s1 &amp;&amp; echo &#34;hello&#34; | pz s[1]</code> → <code>Exception: &lt;class &#39;NameError&#39;&gt;</code>. Use <code>echo &#34;hello&#34; | pz &#39;s[1]&#39;</code> instead.</sub></p>
<h2 dir="auto"><a id="user-content-prepend-to-every-line-in-a-stream" aria-hidden="true" href="#prepend-to-every-line-in-a-stream"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Prepend to every line in a stream</h2>
<p dir="auto">We prepend the length of the line.</p>
<div data-snippet-clipboard-copy-content="# let&#39;s use the f-string `--format` flag
tail -f /var/log/syslog | pz -f &#39;{len(s)}: {s}&#39; 

# or do it the long way, explicitly setting the `s` variable
tail -f /var/log/syslog | pz &#39;s = str(len(s)) + &#34;: &#34; + s&#39;"><pre><span><span>#</span> let&#39;s use the f-string `--format` flag</span>
tail -f /var/log/syslog <span>|</span> pz -f <span><span>&#39;</span>{len(s)}: {s}<span>&#39;</span></span> 

<span><span>#</span> or do it the long way, explicitly setting the `s` variable</span>
tail -f /var/log/syslog <span>|</span> pz <span><span>&#39;</span>s = str(len(s)) + &#34;: &#34; + s<span>&#39;</span></span></pre></div>
<h2 dir="auto"><a id="user-content-converting-to-uppercase" aria-hidden="true" href="#converting-to-uppercase"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Converting to uppercase</h2>
<p dir="auto">Replacing <code>| tr &#39;[:upper:]&#39; &#39;[:lower:]&#39;</code>.</p>
<div data-snippet-clipboard-copy-content="echo &#34;HELLO&#34; | pz s.lower  # &#34;hello&#34;"><pre><span>echo</span> <span><span>&#34;</span>HELLO<span>&#34;</span></span> <span>|</span> pz s.lower  <span><span>#</span> &#34;hello&#34;</span></pre></div>
<h2 dir="auto"><a id="user-content-parsing-numbers" aria-hidden="true" href="#parsing-numbers"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Parsing numbers</h2>
<p dir="auto">Replacing <code>cut</code>. Note you can chain multiple <code>pz</code> calls. Split by a comma &#39;<code>,</code>&#39;, then use <code>n</code> to access the line converted to a number.</p>
<div data-snippet-clipboard-copy-content="echo &#34;hello,5&#34; | pz &#39;s.split(&#34;,&#34;)[1]&#39; | pz n+7  # 12"><pre><span>echo</span> <span><span>&#34;</span>hello,5<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>s.split(&#34;,&#34;)[1]<span>&#39;</span></span> <span>|</span> pz n+7  <span><span>#</span> 12</span></pre></div>
<h2 dir="auto"><a id="user-content-find-out-all-urls-in-a-text" aria-hidden="true" href="#find-out-all-urls-in-a-text"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Find out all URLs in a text</h2>
<p dir="auto">Replacing <code>sed</code>. We know that all functions from the <code>re</code> library are already included, ex: &#34;findall&#34;.</p>
<div data-snippet-clipboard-copy-content="# either use the `--findall` flag
pz --findall &#34;(https?://[^\s]+)&#34; &lt; file.log

# or expand the full command to which is the `--findall` flag equivalent
pz &#34;findall(r&#39;(https?://[^\s]+)&#39;, s)&#34; &lt; file.log"><pre><span><span>#</span> either use the `--findall` flag</span>
pz --findall <span><span>&#34;</span>(https?://[^\s]+)<span>&#34;</span></span> <span>&lt;</span> file.log

<span><span>#</span> or expand the full command to which is the `--findall` flag equivalent</span>
pz <span><span>&#34;</span>findall(r&#39;(https?://[^\s]+)&#39;, s)<span>&#34;</span></span> <span>&lt;</span> file.log</pre></div>
<p dir="auto">If chained, you can open all the URLs in the current web browser. Note that the function <code>webbrowser.open</code> gets auto-imported from the standard library.</p>
<div data-snippet-clipboard-copy-content="pz --findall &#34;(https?://[^\s]+)&#34; &lt; file.log | pz webbrowser.open"><pre>pz --findall <span><span>&#34;</span>(https?://[^\s]+)<span>&#34;</span></span> <span>&lt;</span> file.log <span>|</span> pz webbrowser.open</pre></div>
<h2 dir="auto"><a id="user-content-sum-numbers" aria-hidden="true" href="#sum-numbers"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Sum numbers</h2>
<p dir="auto">Replacing <code>| awk &#39;{count+=$1} END{print count}&#39;</code> or <code>| paste -sd+ | bc</code>. Just use <code>sum</code> in the <code>--end</code> clause.</p>
<div data-snippet-clipboard-copy-content="# internally changed to --end `s = sum(numbers)`
echo -e &#34;1\n2\n3\n4&#34; | pz --end sum  # 10"><pre><span><span>#</span> internally changed to --end `s = sum(numbers)`</span>
<span>echo</span> -e <span><span>&#34;</span>1\n2\n3\n4<span>&#34;</span></span> <span>|</span> pz --end sum  <span><span>#</span> 10</span></pre></div>
<h2 dir="auto"><a id="user-content-keep-unique-lines" aria-hidden="true" href="#keep-unique-lines"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Keep unique lines</h2>
<p dir="auto">Replacing <code>| sort | uniq</code> makes little sense, but the demonstration gives you the idea. We initialize a set <code>c</code> (like a <em>collection</em>). When processing a line, <code>skip</code> is set to <code>True</code> if already seen.</p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;1\n2\n2\n3&#34; | pz &#34;skip = s in c; c.add(s)&#34;  --setup &#34;c=set()&#34;
1
2
3"><pre>$ <span>echo</span> -e <span><span>&#34;</span>1\n2\n2\n3<span>&#34;</span></span> <span>|</span> pz <span><span>&#34;</span>skip = s in c; c.add(s)<span>&#34;</span></span>  --setup <span><span>&#34;</span>c=set()<span>&#34;</span></span>
1
2
3</pre></div>
<p dir="auto">However, an advantage over <code>| sort | uniq</code> comes when handling a stream. You see unique lines instantly, without waiting a stream to finish. Useful when using with <code>tail --follow</code>.</p>
<p dir="auto">Alternatively, to assure the values are sorted, we can make a use of <code>--end</code> flag that produces the output after the processing finished.</p>
<div data-snippet-clipboard-copy-content="echo -e &#34;1\n2\n2\n3&#34; | pz &#34;S.add(s)&#34; --end &#34;sorted(S)&#34; -0"><pre><span>echo</span> -e <span><span>&#34;</span>1\n2\n2\n3<span>&#34;</span></span> <span>|</span> pz <span><span>&#34;</span>S.add(s)<span>&#34;</span></span> --end <span><span>&#34;</span>sorted(S)<span>&#34;</span></span> -0</pre></div>
<p dir="auto">Note that we used the variable <code>S</code> which is initialized by default to an empty set (hence we do not have to use <code>--setup</code> at all) and the flag <code>-0</code> to prevent the processing from output (we do not have to use <code>skip</code> parameter then).</p>
<p dir="auto"><sub>(Strictly speaking we could omit <code>-0</code> too. If you use the verbose <code>-v</code> flag, you would see the command changed to <code>s = S.add(s)</code> internally. And since <code>set.add</code> produces <code>None</code> output, it is the same as if it was skipped.)</sub></p>
<p dir="auto">We can omit <code>(s)</code> in the <code>main</code> clause and hence get rid of the quotes all together.</p>
<div data-snippet-clipboard-copy-content="echo -e &#34;1\n2\n2\n3&#34; | pz S.add --end &#34;sorted(S)&#34;"><pre><span>echo</span> -e <span><span>&#34;</span>1\n2\n2\n3<span>&#34;</span></span> <span>|</span> pz S.add --end <span><span>&#34;</span>sorted(S)<span>&#34;</span></span></pre></div>
<p dir="auto">Nevertheless, the most straightforward approach would involve the <code>lines</code> variable, available when using the <code>--end</code> clause.</p>
<div data-snippet-clipboard-copy-content="echo -e &#34;1\n2\n2\n3&#34; | pz --end &#34;sorted(set(lines))&#34;"><pre><span>echo</span> -e <span><span>&#34;</span>1\n2\n2\n3<span>&#34;</span></span> <span>|</span> pz --end <span><span>&#34;</span>sorted(set(lines))<span>&#34;</span></span></pre></div>
<h2 dir="auto"><a id="user-content-counting-words" aria-hidden="true" href="#counting-words"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Counting words</h2>
<p dir="auto">We split the line to get the words and put them in <code>S</code>, a global instance of the <code>set</code>. Then, we print the set length to get the number of unique words.</p>
<div data-snippet-clipboard-copy-content="echo -e &#34;red green\nblue red green&#34; | pz &#39;S.update(s.split())&#39; --end &#39;len(S)&#39;  # 3"><pre><span>echo</span> -e <span><span>&#34;</span>red green\nblue red green<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>S.update(s.split())<span>&#39;</span></span> --end <span><span>&#39;</span>len(S)<span>&#39;</span></span>  <span><span>#</span> 3</span></pre></div>
<p dir="auto">But what if we want to get the most common words and the count of its usages? Let&#39;s use <code>C</code>, a global instance of the <code>collections.Counter</code>. We see then the <code>red</code> is the most_common word and has been used 2 times.</p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;red green\nblue red green&#34; | pz &#39;C.update(s.split())&#39; --end C.most_common
red, 2
green, 2
blue, 1"><pre>$ <span>echo</span> -e <span><span>&#34;</span>red green\nblue red green<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>C.update(s.split())<span>&#39;</span></span> --end C.most_common
red, 2
green, 2
blue, 1</pre></div>
<h2 dir="auto"><a id="user-content-fetching-web-content" aria-hidden="true" href="#fetching-web-content"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Fetching web content</h2>
<p dir="auto">Accessing internet is easy thanks to the <a href="https://requests.readthedocs.io/en/master/" rel="nofollow"><code>requests</code></a> library. Here, we fetch <code>example.com</code>, grep it for all lines containing &#34;href&#34; and print them out while stripping spaces.</p>
<div data-snippet-clipboard-copy-content="$ echo &#34;http://example.com&#34; | pz &#39;requests.get(s).content&#39; | grep href | pz s.strip 
&lt;p&gt;&lt;a href=&#34;https://www.iana.org/domains/example&#34;&gt;More information...&lt;/a&gt;&lt;/p&gt;"><pre>$ <span>echo</span> <span><span>&#34;</span>http://example.com<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>requests.get(s).content<span>&#39;</span></span> <span>|</span> grep href <span>|</span> pz s.strip 
<span>&lt;</span>p&gt;&lt;a href=<span><span>&#34;</span>https://www.iana.org/domains/example<span>&#34;</span></span><span>&gt;</span>More information...<span>&lt;</span>/a&gt;&lt;/p<span>&gt;</span></pre></div>
<p dir="auto">To see how auto-import are resolved, use the verbose mode. (Notice the line <code>Importing requests</code>.)</p>
<div data-snippet-clipboard-copy-content="$ echo &#34;http://example.com&#34; | pz &#39;requests.get(s).content&#39; -v | grep href | pz s.strip 
Changing the command clause to: s = requests.get(s).content
Importing requests
&lt;p&gt;&lt;a href=&#34;https://www.iana.org/domains/example&#34;&gt;More information...&lt;/a&gt;&lt;/p&gt;"><pre>$ <span>echo</span> <span><span>&#34;</span>http://example.com<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>requests.get(s).content<span>&#39;</span></span> -v <span>|</span> grep href <span>|</span> pz s.strip 
Changing the <span>command</span> clause to: s = requests.get(s).content
Importing requests
<span>&lt;</span>p&gt;&lt;a href=<span><span>&#34;</span>https://www.iana.org/domains/example<span>&#34;</span></span><span>&gt;</span>More information...<span>&lt;</span>/a&gt;&lt;/p<span>&gt;</span></pre></div>
<h2 dir="auto"><a id="user-content-handling-nested-quotes" aria-hidden="true" href="#handling-nested-quotes"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Handling nested quotes</h2>
<p dir="auto">To match every line that has a quoted expressions and print out the quoted contents, you may serve yourself of Python triple quotes. In the example below, an apostrophe is used to delimit the <code>COMMAND</code> flag. If we used an apostrophe in the text, we would have to slash it. Instead, triple quotes might improve readability.</p>
<div data-snippet-clipboard-copy-content="echo -e &#39;hello &#34;world&#34;.&#39; | pz &#39;match(r&#34;&#34;&#34;[^&#34;]*&#34;(.*)&#34;.&#34;&#34;&#34;, s)&#39; # world"><pre><span>echo</span> -e <span><span>&#39;</span>hello &#34;world&#34;.<span>&#39;</span></span> <span>|</span> pz <span><span>&#39;</span>match(r&#34;&#34;&#34;[^&#34;]*&#34;(.*)&#34;.&#34;&#34;&#34;, s)<span>&#39;</span></span> <span><span>#</span> world</span></pre></div>
<p dir="auto">In that case, even better is to use the <code>--match</code> flag to get rid of the quoting as much as possible.</p>
<div data-snippet-clipboard-copy-content="echo -e &#39;hello &#34;world&#34;.&#39; | pz --match &#39;[^&#34;]*&#34;(.*)&#34;&#39;  # world"><pre><span>echo</span> -e <span><span>&#39;</span>hello &#34;world&#34;.<span>&#39;</span></span> <span>|</span> pz --match <span><span>&#39;</span>[^&#34;]*&#34;(.*)&#34;<span>&#39;</span></span>  <span><span>#</span> world</span></pre></div>
<h2 dir="auto"><a id="user-content-computing-factorial" aria-hidden="true" href="#computing-factorial"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Computing factorial</h2>
<p dir="auto">Take a look at multiple ways. The simplest is to use the function.</p>
<div data-snippet-clipboard-copy-content="echo 5 | pz factorial  # 120"><pre><span>echo</span> 5 <span>|</span> pz factorial  <span><span>#</span> 120</span></pre></div>
<p dir="auto">What happens in the background? <code>factorial</code> is available from <code>math.factorial</code>. Since it is a callable, we try to put current line as the parameter: <code>factorial(s)</code>. Since <code>s = &#34;5&#34;</code> which means a string, it fails. It then tries to use <code>factorial(n)</code> where <code>n</code> is current line automatically fetched to a number. That works.</p>
<p dir="auto">Harder way? Let&#39;s use <code>math.prod</code> then.</p>
<div data-snippet-clipboard-copy-content="echo 5 | pz &#39;prod(i for i in range(1,n+1))&#39;  # 120"><pre><span>echo</span> 5 <span>|</span> pz <span><span>&#39;</span>prod(i for i in range(1,n+1))<span>&#39;</span></span>  <span><span>#</span> 120</span></pre></div>
<p dir="auto">Without any built-in library? Let&#39;s just use a for-cycle. Process all numbers from 1 to <code>n</code> (which is 5) and multiply to product. Finally, assign <code>n</code> to <code>s</code> which is output.</p>
<div data-snippet-clipboard-copy-content="echo 5 | pz &#39;for c in range(1,n): n*= c ; s = n&#39;   # 120"><pre><span>echo</span> 5 <span>|</span> pz <span><span>&#39;</span>for c in range(1,n): n*= c ; s = n<span>&#39;</span></span>   <span><span>#</span> 120</span></pre></div>
<p dir="auto">Using generator will print a factorial for every number from 1 to <code>-g</code>.</p>
<div data-snippet-clipboard-copy-content="$ pz factorial -g5
1
2
6
24
120"><pre>$ pz factorial -g5
1
2
6
24
120</pre></div>
<h2 dir="auto"><a id="user-content-read-csv" aria-hidden="true" href="#read-csv"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Read CSV</h2>
<p dir="auto">As <code>csv</code> is one of the auto-imported libraries, we may directly access instantiate the reader object. In the following example, we output the second element of every line either progressively or at once when processing finished.</p>
<div data-snippet-clipboard-copy-content="# output line by line
echo &#39;&#34;a&#34;,&#34;b1,b2,b3&#34;,&#34;c&#34;&#39; | pz &#34;(x[1] for x in csv.reader([s]))&#34;  # &#34;b1,b2,b3&#34;

# output at the end
echo &#39;&#34;a&#34;,&#34;b1,b2,b3&#34;,&#34;c&#34;&#39; | pz --end &#34;(x[1] for x in csv.reader(lines))&#34;  # &#34;b1,b2,b3&#34;   "><pre><span><span>#</span> output line by line</span>
<span>echo</span> <span><span>&#39;</span>&#34;a&#34;,&#34;b1,b2,b3&#34;,&#34;c&#34;<span>&#39;</span></span> <span>|</span> pz <span><span>&#34;</span>(x[1] for x in csv.reader([s]))<span>&#34;</span></span>  <span><span>#</span> &#34;b1,b2,b3&#34;</span>

<span><span>#</span> output at the end</span>
<span>echo</span> <span><span>&#39;</span>&#34;a&#34;,&#34;b1,b2,b3&#34;,&#34;c&#34;<span>&#39;</span></span> <span>|</span> pz --end <span><span>&#34;</span>(x[1] for x in csv.reader(lines))<span>&#34;</span></span>  <span><span>#</span> &#34;b1,b2,b3&#34;   </span></pre></div>
<h2 dir="auto"><a id="user-content-generate-random-number" aria-hidden="true" href="#generate-random-number"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Generate random number</h2>
<p dir="auto">First, take a look how to stream random numbers to 100 in Bash.</p>
<div data-snippet-clipboard-copy-content="while :; do echo $((1+$RANDOM%100)); done"><pre><span>while</span> <span>:</span><span>;</span> <span>do</span> <span>echo</span> <span><span>$((</span><span>1</span><span>+</span><span>$RANDOM</span><span>%</span><span>100</span><span>))</span></span><span>;</span> <span>done</span></pre></div>
<p dir="auto">Now examine pure Python solution, without having <code>pz</code> involved.</p>
<div data-snippet-clipboard-copy-content="python3 -c &#34;while True: from random import randint; print(randint(1,100))&#34;"><pre>python3 -c <span><span>&#34;</span>while True: from random import randint; print(randint(1,100))<span>&#34;</span></span></pre></div>
<p dir="auto">Using <code>pz</code>, we relieve the cycle handling and importing burden from the command.</p>
<div data-snippet-clipboard-copy-content="pz &#34;randint(1,100)&#34; --generate=0"><pre>pz <span><span>&#34;</span>randint(1,100)<span>&#34;</span></span> --generate=0</pre></div>
<p dir="auto">Let&#39;s generate few random strings of variable length 1 to 30. When generator flag is used without a number, it cycles five times.</p>
<div data-snippet-clipboard-copy-content="pz &#34;&#39;&#39;.join(random.choice(string.ascii_letters) for _ in range(randint(1,30)))&#34; -S &#34;import string&#34; -g"><pre>pz <span><span>&#34;</span>&#39;&#39;.join(random.choice(string.ascii_letters) for _ in range(randint(1,30)))<span>&#34;</span></span> -S <span><span>&#34;</span>import string<span>&#34;</span></span> -g</pre></div>
<h2 dir="auto"><a id="user-content-average-a-stream-value" aria-hidden="true" href="#average-a-stream-value"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Average a stream value</h2>
<p dir="auto">Let&#39;s have a stream and output the average value.</p>
<div data-snippet-clipboard-copy-content="# print out current line `count` and current average `sum/count`
$ while :; do echo $((1 + $RANDOM % 100)) ; sleep 0.1; done | pz &#39;sum+=n;s=count, sum/count&#39; --setup &#34;sum=0&#34;
1, 38.0
2, 67.0
3, 62.0
4, 49.75

# print out every 10 000 lines
# (thanks to `not i % 10000` expression) 
$ while :; do echo $((1 + $RANDOM % 100)) ;  done | pz &#39;sum+=n;s=sum/count; s = (count,s) if not count % 10000 else &#34;&#34;&#39; --setup &#34;sum=0&#34;
10000, 50.9058
20000, 50.7344
30000, 50.693466666666666
40000, 50.5904"><pre><span><span>#</span> print out current line `count` and current average `sum/count`</span>
$ <span>while</span> <span>:</span><span>;</span> <span>do</span> <span>echo</span> <span><span>$((</span><span>1</span> <span>+</span> <span>$RANDOM</span> <span>%</span> <span>100</span><span>))</span></span> <span>;</span> sleep 0.1<span>;</span> <span>done</span> <span>|</span> pz <span><span>&#39;</span>sum+=n;s=count, sum/count<span>&#39;</span></span> --setup <span><span>&#34;</span>sum=0<span>&#34;</span></span>
1, 38.0
2, 67.0
3, 62.0
4, 49.75

<span><span>#</span> print out every 10 000 lines</span>
<span><span>#</span> (thanks to `not i % 10000` expression) </span>
$ <span>while</span> <span>:</span><span>;</span> <span>do</span> <span>echo</span> <span><span>$((</span><span>1</span> <span>+</span> <span>$RANDOM</span> <span>%</span> <span>100</span><span>))</span></span> <span>;</span>  <span>done</span> <span>|</span> pz <span><span>&#39;</span>sum+=n;s=sum/count; s = (count,s) if not count % 10000 else &#34;&#34;<span>&#39;</span></span> --setup <span><span>&#34;</span>sum=0<span>&#34;</span></span>
10000, 50.9058
20000, 50.7344
30000, 50.693466666666666
40000, 50.5904</pre></div>
<p dir="auto">How can this be simplified? Let&#39;s use an infinite generator <code>-g0</code>. As we know, <code>n</code> is given current line number by the generator and <code>i</code> is by default implicitly declared to <code>i=0</code> so we use it to hold the sum. No setup clause needed. No Bash cycle needed.</p>
<div data-snippet-clipboard-copy-content="$ pz &#34;i+=randint(1,100); s = (n,i/n) if not n % 10000 else &#39;&#39;&#34; -g0
10000, 49.9488
20000, 50.5399
30000, 50.39906666666667
40000, 50.494425"><pre>$ pz <span><span>&#34;</span>i+=randint(1,100); s = (n,i/n) if not n % 10000 else &#39;&#39;<span>&#34;</span></span> -g0
10000, 49.9488
20000, 50.5399
30000, 50.39906666666667
40000, 50.494425</pre></div>
<h2 dir="auto"><a id="user-content-multiline-statements" aria-hidden="true" href="#multiline-statements"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Multiline statements</h2>
<p dir="auto">Should you need to evaluate a short multiline statement, use standard multiline statements, supported by Bash.</p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;1\n2\n3&#34; | pz &#34;if n &gt; 2:
  s = &#39;bigger&#39;
else:
  s = &#39;smaller&#39;
&#34;
smaller
bigger
bigger"><pre>$ <span>echo</span> -e <span><span>&#34;</span>1\n2\n3<span>&#34;</span></span> <span>|</span> pz <span><span>&#34;</span>if n &gt; 2:</span>
<span>  s = &#39;bigger&#39;</span>
<span>else:</span>
<span>  s = &#39;smaller&#39;</span>
<span><span>&#34;</span></span>
smaller
bigger
bigger</pre></div>
<h2 dir="auto"><a id="user-content-simple-progress-bar" aria-hidden="true" href="#simple-progress-bar"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Simple progress bar</h2>
<p dir="auto">Simulate a lengthy processing by generating a long sequence of numbers (as they are not needed, we throw them away by <code>1&gt;/dev/null</code>).
On every 100th line, we move cursor up (<code>\033[1A</code>), clear line (<code>\033[K</code>) and print to <code>STDERR</code> current status.</p>
<div data-snippet-clipboard-copy-content="$ seq 1 100000 | pz &#39;s = f&#34;\033[1A\033[K ... {count} ...&#34; if count % 100 == 0 else None &#39; --stderr 1&gt;/dev/null
 ... 100 ...  # replaced by ... 200 ..."><pre>$ seq 1 100000 <span>|</span> pz <span><span>&#39;</span>s = f&#34;\033[1A\033[K ... {count} ...&#34; if count % 100 == 0 else None <span>&#39;</span></span> --stderr <span>1&gt;</span>/dev/null
 ... 100 ...  <span><span>#</span> replaced by ... 200 ...</span></pre></div>

<h2 dir="auto"><a id="user-content-scope-variables" aria-hidden="true" href="#scope-variables"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Scope variables</h2>
<p dir="auto">In the script scope, you have access to the following variables:</p>
<h3 dir="auto"><a id="user-content-s--current-line" aria-hidden="true" href="#s--current-line"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code>s</code> – current line</h3>
<p dir="auto">Change it according to your needs</p>
<div data-snippet-clipboard-copy-content="echo 5 | pz &#39;s += &#34;4&#34;&#39;  # 54 "><pre><span>echo</span> 5 <span>|</span> pz <span><span>&#39;</span>s += &#34;4&#34;<span>&#39;</span></span>  <span><span>#</span> 54 </span></pre></div>
<h3 dir="auto"><a id="user-content-n--current-line-converted-to-an-int-or-float-if-possible" aria-hidden="true" href="#n--current-line-converted-to-an-int-or-float-if-possible"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code>n</code> – current line converted to an <code>int</code> (or <code>float</code>) if possible</h3>
<div data-snippet-clipboard-copy-content="echo 5 | pz n+2  # 7
echo 5.2 | pz n+2  # 7.2"><pre><span>echo</span> 5 <span>|</span> pz n+2  <span><span>#</span> 7</span>
<span>echo</span> 5.2 <span>|</span> pz n+2  <span><span>#</span> 7.2</span></pre></div>
<h3 dir="auto"><a id="user-content-b--current-line-as-a-byte-string" aria-hidden="true" href="#b--current-line-as-a-byte-string"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code>b</code> – current line as a byte-string</h3>
<p dir="auto">Sometimes the input cannot be converted to str easily. A warning is output, however, you can still operate with raw bytes.</p>
<div data-snippet-clipboard-copy-content="echo -e &#39;\x80 invalid line&#39; | pz s
Cannot parse line correctly: b&#39;\x80 invalid line&#39;
� invalid line

# use the `--quiet` flag to suppress the warning, then decode the bytes
echo -e &#39;\x80 invalid line&#39; | pz &#39;b.decode(&#34;cp1250&#34;)&#39; --quiet
€ invalid line"><pre><span>echo</span> -e <span><span>&#39;</span>\x80 invalid line<span>&#39;</span></span> <span>|</span> pz s
Cannot parse line correctly: b<span><span>&#39;</span>\x80 invalid line<span>&#39;</span></span>
� invalid line

<span><span>#</span> use the `--quiet` flag to suppress the warning, then decode the bytes</span>
<span>echo</span> -e <span><span>&#39;</span>\x80 invalid line<span>&#39;</span></span> <span>|</span> pz <span><span>&#39;</span>b.decode(&#34;cp1250&#34;)<span>&#39;</span></span> --quiet
€ invalid line</pre></div>
<h3 dir="auto"><a id="user-content-count--current-line-number" aria-hidden="true" href="#count--current-line-number"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code>count</code> – current line number</h3>
<div data-snippet-clipboard-copy-content="# display every 1_000nth line
$ pz -g0 n*3 | pz &#34;n if not count % 1000 else None&#34;
3000
6000
9000

# the same, using the `--filter` flag
$ pz -g0 n*3 | pz -F &#34;not count % 1000&#34;"><pre><span><span>#</span> display every 1_000nth line</span>
$ pz -g0 n<span>*</span>3 <span>|</span> pz <span><span>&#34;</span>n if not count % 1000 else None<span>&#34;</span></span>
3000
6000
9000

<span><span>#</span> the same, using the `--filter` flag</span>
$ pz -g0 n<span>*</span>3 <span>|</span> pz -F <span><span>&#34;</span>not count % 1000<span>&#34;</span></span></pre></div>
<h3 dir="auto"><a id="user-content-text--whole-text-all-lines-together" aria-hidden="true" href="#text--whole-text-all-lines-together"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code>text</code> – whole text, all lines together</h3>
<p dir="auto">Not available with the <code>--overflow-safe</code> flag set nor in the <code>main</code> clause unless the <code>--whole</code> flag set.
Ex: get character count (an alternative to <code>| wc -c</code>).</p>
<div data-snippet-clipboard-copy-content="echo -e &#34;hello\nworld&#34; | pz --end &#39;len(text)&#39; # 11"><pre><code>echo -e &#34;hello\nworld&#34; | pz --end &#39;len(text)&#39; # 11
</code></pre></div>
<p dir="auto">When used in the <code>main</code> clause, an error appears.</p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;1\n2\n3&#34; | pz &#39;len(text)&#39;
Did not you forget to use --text?
Exception: &lt;class &#39;NameError&#39;&gt; name &#39;text&#39; is not defined on line: 1"><pre>$ <span>echo</span> -e <span><span>&#34;</span>1\n2\n3<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>len(text)<span>&#39;</span></span>
Did not you forget to use --text<span>?</span>
Exception: <span>&lt;</span>class <span><span>&#39;</span>NameError<span>&#39;</span></span><span>&gt;</span> name <span><span>&#39;</span>text<span>&#39;</span></span> is not defined on line: 1</pre></div>
<p dir="auto">Appending <code>--whole</code> helps, but the result is processed for every line.</p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;1\n2\n3&#34; | pz &#39;len(text)&#39; -w 
5
5
5"><pre>$ <span>echo</span> -e <span><span>&#34;</span>1\n2\n3<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>len(text)<span>&#39;</span></span> -w 
5
5
5</pre></div>
<p dir="auto">Appending <code>-1</code> makes sure the statement gets computed only once.</p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;1\n2\n3&#34; | pz &#39;len(text)&#39; -w1
5"><pre>$ <span>echo</span> -e <span><span>&#34;</span>1\n2\n3<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>len(text)<span>&#39;</span></span> -w1
5</pre></div>
<h3 dir="auto"><a id="user-content-lines--list-of-lines-so-far-processed" aria-hidden="true" href="#lines--list-of-lines-so-far-processed"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code>lines</code> – list of lines so far processed</h3>
<p dir="auto">Not available with the <code>--overflow-safe</code> flag set.</p>
<div data-snippet-clipboard-copy-content="echo -e &#34;hello\nworld&#34; | pz --end lines[-1]  # &#34;world&#34;"><pre><span>echo</span> -e <span><span>&#34;</span>hello\nworld<span>&#34;</span></span> <span>|</span> pz --end lines[-1]  <span><span>#</span> &#34;world&#34;</span></pre></div>
<h3 dir="auto"><a id="user-content-numbers--list-of-numbers-so-far-processed" aria-hidden="true" href="#numbers--list-of-numbers-so-far-processed"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code>numbers</code> – list of numbers so far processed</h3>
<p dir="auto">Not available with the <code>--overflow-safe</code> flag set.</p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;20\n40\n25\n28&#34; | pz &#39;s = count, s, sum(numbers)/count&#39;
1, 20, 20.0
2, 40, 30.0
3, 25, 28.333333333333332
4, 28, 28.25"><pre>$ <span>echo</span> -e <span><span>&#34;</span>20\n40\n25\n28<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>s = count, s, sum(numbers)/count<span>&#39;</span></span>
1, 20, 20.0
2, 40, 30.0
3, 25, 28.333333333333332
4, 28, 28.25</pre></div>
<h3 dir="auto"><a id="user-content-skip-line" aria-hidden="true" href="#skip-line"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code>skip</code> line</h3>
<p dir="auto">If set to <code>True</code>, current line will not be output. If set to <code>False</code> when using the <code>-0</code> flag, the line will be output regardless.</p>
<h3 dir="auto"><a id="user-content-i-s-l-d-c--other-global-variables" aria-hidden="true" href="#i-s-l-d-c--other-global-variables"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code>i</code>, <code>S</code>, <code>L</code>, <code>D</code>, <code>C</code> – other global variables</h3>
<p dir="auto">Some variables are initialized and ready to be used globally. They are common for all the lines.</p>
<ul dir="auto">
<li><code>i = 0</code></li>
<li><code>S = set()</code></li>
<li><code>L = list()</code></li>
<li><code>D = dict()</code></li>
<li><code>C = Counter()</code></li>
</ul>
<p dir="auto"><sub>It is true that using uppercase is not conforming the naming convention. However, in these tiny scripts the readability is the chief principle, every character counts.</sub></p>
<p dir="auto">Using a set <code>S</code>. In the example, we add every line to the set and end print it out in a sorted manner.</p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;2\n1\n2\n3\n1&#34; | pz &#34;S.add(s)&#34; --end &#34;sorted(S)&#34;
1
2
3  "><pre>$ <span>echo</span> -e <span><span>&#34;</span>2\n1\n2\n3\n1<span>&#34;</span></span> <span>|</span> pz <span><span>&#34;</span>S.add(s)<span>&#34;</span></span> --end <span><span>&#34;</span>sorted(S)<span>&#34;</span></span>
1
2
3  </pre></div>
<p dir="auto">Using a list <code>L</code>. Append lines that contains a number bigger than one and finally, print their count. As only the final count matters, suppress the line output with the flag <code>-0</code>.</p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;2\n1\n2\n3\n1&#34; | pz &#34;if n &gt; 1: L.append(s)&#34; --end &#34;len(L)&#34; -0
3  "><pre>$ <span>echo</span> -e <span><span>&#34;</span>2\n1\n2\n3\n1<span>&#34;</span></span> <span>|</span> pz <span><span>&#34;</span>if n &gt; 1: L.append(s)<span>&#34;</span></span> --end <span><span>&#34;</span>len(L)<span>&#34;</span></span> -0
3  </pre></div>
<h2 dir="auto"><a id="user-content-auto-import" aria-hidden="true" href="#auto-import"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Auto-import</h2>
<ul dir="auto">
<li>You can always import libraries you need manually. (Put <code>import</code> statement into the command.)</li>
<li>Some libraries are ready to be used: <code>re.* (match, search, findall), math.* (sqrt,...), defaultdict</code></li>
<li>Some others are auto-imported whenever its use has been detected. In such case, the line is reprocessed.
<ul dir="auto">
<li>Functions: <code>b64decode, b64encode, datetime, (requests).get, glob, iglob, Path, randint, sleep, time, ZipFile</code></li>
<li>Modules: <code>base64, collections, csv, humanize, itertools, jsonpickle, pathlib, random, requests, time, webbrowser, zipfile</code></li>
</ul>
</li>
</ul>
<p dir="auto">Caveat: When accessed first time, the auto-import makes the row reprocessed. It may influence your global variables. Use verbose output to see if something has been auto-imported.</p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;hey\nbuddy&#34; | pz &#39;a+=1; sleep(1); b+=1; s = a,b &#39; --setup &#34;a=0;b=0;&#34; -v
Importing sleep from time
2, 1
3, 2"><pre>$ <span>echo</span> -e <span><span>&#34;</span>hey\nbuddy<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>a+=1; sleep(1); b+=1; s = a,b <span>&#39;</span></span> --setup <span><span>&#34;</span>a=0;b=0;<span>&#34;</span></span> -v
Importing sleep from <span>time</span>
2, 1
3, 2</pre></div>
<p dir="auto">As seen, <code>a</code> was incremented 3× times and <code>b</code> on twice because we had to process the first line twice in order to auto-import sleep. In the first run, the processing raised an exception because <code>sleep</code> was not known. To prevent that, explicitly appending <code>from time import sleep</code> to the <code>--setup</code> flag would do.</p>
<h2 dir="auto"><a id="user-content-output" aria-hidden="true" href="#output"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Output</h2>
<ul dir="auto">
<li>
<p dir="auto">Explicit assignment: By default, we output the <code>s</code>.</p>
<div data-snippet-clipboard-copy-content="echo &#34;5&#34; | pz &#39;s = len(s)&#39; # 1"><pre><span>echo</span> <span><span>&#34;</span>5<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>s = len(s)<span>&#39;</span></span> <span><span>#</span> 1</span></pre></div>
</li>
<li>
<p dir="auto">Single expression: If not set explicitly, we assign the expression to <code>s</code> automatically.</p>
<div data-snippet-clipboard-copy-content="echo &#34;5&#34; | pz &#39;len(s)&#39;  # 1 (command internally changed to `s = len(s)`)"><pre><span>echo</span> <span><span>&#34;</span>5<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>len(s)<span>&#39;</span></span>  <span><span>#</span> 1 (command internally changed to `s = len(s)`)</span></pre></div>
</li>
<li>
<p dir="auto">Tuple, generator: If <code>s</code> ends up as a tuple, its get joined by spaces.</p>
<div data-snippet-clipboard-copy-content="$ echo &#34;5&#34; | pz &#39;s, len(s)&#39;
5, 1 "><pre>$ <span>echo</span> <span><span>&#34;</span>5<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>s, len(s)<span>&#39;</span></span>
5, 1 </pre></div>
<p dir="auto">Consider piping two lines &#39;hey&#39; and &#39;buddy&#39;. We return three elements, original text, reversed text and its length.</p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;hey\nbuddy&#34; | pz &#39;s,s[::-1],len(s)&#39; 
hey, yeh, 3
buddy, yddub, 5"><pre>$ <span>echo</span> -e <span><span>&#34;</span>hey\nbuddy<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>s,s[::-1],len(s)<span>&#39;</span></span> 
hey, yeh, 3
buddy, yddub, 5</pre></div>
</li>
<li>
<p dir="auto">List: When <code>s</code> ends up as a list, its elements are printed to independent lines.</p>
<div data-snippet-clipboard-copy-content="$ echo &#34;5&#34; | pz &#39;[s, len(s)]&#39;
5
1 "><pre>$ <span>echo</span> <span><span>&#34;</span>5<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>[s, len(s)]<span>&#39;</span></span>
5
1 </pre></div>
</li>
<li>
<p dir="auto">Regular match: All groups are treated as a tuple. If no group used, we print the entire matched string.</p>
<div data-snippet-clipboard-copy-content="# no group → print entire matched string
echo &#34;hello world&#34; | pz &#39;search(r&#34;\s.*&#34;, s)&#39; # &#34; world&#34;

# single matched group
echo &#34;hello world&#34; | pz &#39;search(r&#34;\s(.*)&#34;, s)&#39; # &#34;world&#34;

# matched groups treated as tuple
echo &#34;hello world&#34; | pz &#39;search(r&#34;(.*)\s(.*)&#34;, s)&#39;  # &#34;hello, world&#34;"><pre><span><span>#</span> no group → print entire matched string</span>
<span>echo</span> <span><span>&#34;</span>hello world<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>search(r&#34;\s.*&#34;, s)<span>&#39;</span></span> <span><span>#</span> &#34; world&#34;</span>

<span><span>#</span> single matched group</span>
<span>echo</span> <span><span>&#34;</span>hello world<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>search(r&#34;\s(.*)&#34;, s)<span>&#39;</span></span> <span><span>#</span> &#34;world&#34;</span>

<span><span>#</span> matched groups treated as tuple</span>
<span>echo</span> <span><span>&#34;</span>hello world<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>search(r&#34;(.*)\s(.*)&#34;, s)<span>&#39;</span></span>  <span><span>#</span> &#34;hello, world&#34;</span></pre></div>
</li>
<li>
<p dir="auto">Callable: It gets called. Very useful when handling simple function – without the need of explicitly putting parenthesis to call the function, we can omit quoting in Bash (expression <code>s.lower()</code> would have had to be quoted.) Use the verbose flag <code>-v</code> to inspect the internal change of the command.</p>
<div data-snippet-clipboard-copy-content="# internally changed to `s = s.lower()`
echo &#34;HEllO&#34; | pz s.lower  # &#34;hello&#34;
  
# internally changed to `s = len(s)`
echo &#34;HEllO&#34; | pz len  # &#34;5&#34;

# internally changed to `s = base64.b64encode(s.encode(&#39;utf-8&#39;))`
echo &#34;HEllO&#34; | pz b64encode  # &#34;SEVsbE8=&#34;

# internally changed to `s = math.sqrt(n)`
# and then to `s = round(n)`
echo &#34;25&#34; | pz sqrt | pz round  # &#34;5&#34;

# internally changed to `s = sum(numbers)`    
echo -e &#34;1\n2\n3\n4&#34; | pz sum
1
3
6
10

# internally changed to `&#39; - &#39;.join(lines)`      
echo -e &#34;1\n2\n3\n4&#34; | pz  --end &#34;&#39; - &#39;.join&#34;
1 - 2 - 3 - 4"><pre><span><span>#</span> internally changed to `s = s.lower()`</span>
<span>echo</span> <span><span>&#34;</span>HEllO<span>&#34;</span></span> <span>|</span> pz s.lower  <span><span>#</span> &#34;hello&#34;</span>
  
<span><span>#</span> internally changed to `s = len(s)`</span>
<span>echo</span> <span><span>&#34;</span>HEllO<span>&#34;</span></span> <span>|</span> pz len  <span><span>#</span> &#34;5&#34;</span>

<span><span>#</span> internally changed to `s = base64.b64encode(s.encode(&#39;utf-8&#39;))`</span>
<span>echo</span> <span><span>&#34;</span>HEllO<span>&#34;</span></span> <span>|</span> pz b64encode  <span><span>#</span> &#34;SEVsbE8=&#34;</span>

<span><span>#</span> internally changed to `s = math.sqrt(n)`</span>
<span><span>#</span> and then to `s = round(n)`</span>
<span>echo</span> <span><span>&#34;</span>25<span>&#34;</span></span> <span>|</span> pz sqrt <span>|</span> pz round  <span><span>#</span> &#34;5&#34;</span>

<span><span>#</span> internally changed to `s = sum(numbers)`    </span>
<span>echo</span> -e <span><span>&#34;</span>1\n2\n3\n4<span>&#34;</span></span> <span>|</span> pz sum
1
3
6
10

<span><span>#</span> internally changed to `&#39; - &#39;.join(lines)`      </span>
<span>echo</span> -e <span><span>&#34;</span>1\n2\n3\n4<span>&#34;</span></span> <span>|</span> pz  --end <span><span>&#34;</span>&#39; - &#39;.join<span>&#34;</span></span>
1 - 2 - 3 - 4</pre></div>
<p dir="auto">As you see in the examples, if <code>TypeError</code> raised, we try to reprocess the row while adding current line as the argument:</p>
<ul dir="auto">
<li>either its basic form <code>s</code></li>
<li>the <code>numbers</code> if available</li>
<li>using its numeral representation <code>n</code> if available</li>
<li>encoded to bytes <code>s.encode(&#39;utf-8&#39;)</code></li>
</ul>
<p dir="auto">In the <code>--end</code> clause, we try furthermore the <code>lines</code>.</p>
</li>
</ul>
<h2 dir="auto"><a id="user-content-cli-flags" aria-hidden="true" href="#cli-flags"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>CLI flags</h2>
<ul dir="auto">
<li><code>-v</code>, <code>--verbose</code>: See what happens under the hood. Show automatic imports and internal command modification (attempts to make it callable and prepending <code>s =</code> if omitted).
<div data-snippet-clipboard-copy-content="$ echo -e &#34;hello&#34; | pz &#39;invalid command&#39;
Exception: &lt;class &#39;SyntaxError&#39;&gt; invalid syntax (&lt;string&gt;, line 1) on line: hello
$ echo -e &#34;hello&#34; | pz &#39;sleep(1)&#39; --verbose
Importing sleep from time"><pre>$ <span>echo</span> -e <span><span>&#34;</span>hello<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>invalid command<span>&#39;</span></span>
Exception: <span>&lt;</span>class <span><span>&#39;</span>SyntaxError<span>&#39;</span></span><span>&gt;</span> invalid syntax (<span>&lt;</span>string<span>&gt;</span>, line 1) on line: hello
$ <span>echo</span> -e <span><span>&#34;</span>hello<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>sleep(1)<span>&#39;</span></span> --verbose
Importing sleep from <span>time</span></pre></div>
</li>
<li><code>-q</code>, <code>--quiet</code>: See errors and values only. Suppress command exceptions.
<div data-snippet-clipboard-copy-content="echo -e &#34;hello&#34; | pz &#39;invalid command&#39; --quiet # empty result"><pre><span>echo</span> -e <span><span>&#34;</span>hello<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>invalid command<span>&#39;</span></span> --quiet <span><span>#</span> empty result</span></pre></div>
</li>
</ul>
<h3 dir="auto"><a id="user-content-command-clauses" aria-hidden="true" href="#command-clauses"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Command clauses</h3>
<ul dir="auto">
<li><code>COMMAND</code>: The <code>main</code> clause, any Python script executed on every line (multiple statements allowed)</li>
<li><code>-S COMMAND</code>, <code>--setup COMMAND</code>: Any Python script, executed before processing. Useful for variable initializing.
Ex: prepend line numbers by incrementing a variable <code>count</code>.
<div data-snippet-clipboard-copy-content="$ echo -e &#34;row\nanother row&#34; | pz &#39;count+=1;s = f&#34;{count}: {s}&#34;&#39;  --setup &#39;count=0&#39;
1: row
2: another row

# the same using globally available variable `count` instead of using `--setup` and the `--format` flag
$ echo -e &#34;row\nanother row&#34; | pz -f &#39;{count}: {s}&#39;"><pre>$ <span>echo</span> -e <span><span>&#34;</span>row\nanother row<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>count+=1;s = f&#34;{count}: {s}&#34;<span>&#39;</span></span>  --setup <span><span>&#39;</span>count=0<span>&#39;</span></span>
1: row
2: another row

<span><span>#</span> the same using globally available variable `count` instead of using `--setup` and the `--format` flag</span>
$ <span>echo</span> -e <span><span>&#34;</span>row\nanother row<span>&#34;</span></span> <span>|</span> pz -f <span><span>&#39;</span>{count}: {s}<span>&#39;</span></span></pre></div>
</li>
<li><code>-E COMMAND</code>, <code>--end COMMAND</code>: Any Python script, executed after processing. Useful for the final output.
The variable <code>text</code> is available by default here.
<div data-snippet-clipboard-copy-content="$ echo -e &#34;1\n2\n3\n4&#34; | pz --end sum
10
$ echo -e &#34;1\n2\n3\n4&#34; | pz s --end sum
1
2
3
4
10  
$ echo -e &#34;1\n2\n3\n4&#34; | pz sum --end sum
1
3
6
10
10"><pre>$ <span>echo</span> -e <span><span>&#34;</span>1\n2\n3\n4<span>&#34;</span></span> <span>|</span> pz --end sum
10
$ <span>echo</span> -e <span><span>&#34;</span>1\n2\n3\n4<span>&#34;</span></span> <span>|</span> pz s --end sum
1
2
3
4
10  
$ <span>echo</span> -e <span><span>&#34;</span>1\n2\n3\n4<span>&#34;</span></span> <span>|</span> pz sum --end sum
1
3
6
10
10</pre></div>
</li>
<li><code>-F</code>, <code>--filter</code>: Line is piped out unchanged, however only if evaluated to <code>True</code>.
When piping in numbers to 5, we pass only such bigger than 3.
<div data-snippet-clipboard-copy-content="$ echo -e &#34;1\n2\n3\n4\n5&#34; | pz &#34;n &gt; 3&#34;  --filter
4
5"><pre>$ <span>echo</span> -e <span><span>&#34;</span>1\n2\n3\n4\n5<span>&#34;</span></span> <span>|</span> pz <span><span>&#34;</span>n &gt; 3<span>&#34;</span></span>  --filter
4
5</pre></div>
The statement is equivalent to using <code>skip</code> (and not using <code>--filter</code>).
<div data-snippet-clipboard-copy-content="$ echo -e &#34;1\n2\n3\n4\n5&#34; | pz &#34;skip = not n &gt; 3&#34;
4
5"><pre>$ <span>echo</span> -e <span><span>&#34;</span>1\n2\n3\n4\n5<span>&#34;</span></span> <span>|</span> pz <span><span>&#34;</span>skip = not n &gt; 3<span>&#34;</span></span>
4
5</pre></div>
When not using filter, <code>s</code> evaluates to <code>True</code> / <code>False</code>. By default, <code>False</code> or empty values are not output.
<div data-snippet-clipboard-copy-content="$ echo -e &#34;1\n2\n3\n4\n5&#34; | pz &#34;n &gt; 3&#34;   
True
True"><pre>$ <span>echo</span> -e <span><span>&#34;</span>1\n2\n3\n4\n5<span>&#34;</span></span> <span>|</span> pz <span><span>&#34;</span>n &gt; 3<span>&#34;</span></span>   
True
True</pre></div>
</li>
<li><code>-f</code>, <code>--format</code>: Main and end clauses are considered f-strings. The clause is inserted in between three-apostrophes <code>f&#39;&#39;&#39;COMMAND&#39;&#39;&#39;</code> internally.</li>
</ul>
<h3 dir="auto"><a id="user-content-input--output" aria-hidden="true" href="#input--output"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Input / output</h3>
<ul dir="auto">
<li>
<p dir="auto"><code>-n NUM</code> Process only such number of lines. Roughly equivalent to <code>head -n</code>.</p>
</li>
<li>
<p dir="auto"><code>-1</code> Process just the first line.</p>
</li>
<li>
<p dir="auto"><code>-0</code> Skip all lines output. (Useful in combination with <code>--end</code>.)</p>
</li>
<li>
<p dir="auto"><code>--empty</code> Output even empty lines. (By default skipped.)</p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;hey\nbuddy&#34; | pz &#39;s[:-3]&#39;
bu"><pre>$ <span>echo</span> -e <span><span>&#34;</span>hey\nbuddy<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>s[:-3]<span>&#39;</span></span>
bu</pre></div>
<p dir="auto">Should we insist on displaying, we see an empty line now.</p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;hey\nbuddy&#34; | pz &#39;s[:-3]&#39; --empty

bu"><pre>$ <span>echo</span> -e <span><span>&#34;</span>hey\nbuddy<span>&#34;</span></span> <span>|</span> pz <span><span>&#39;</span>s[:-3]<span>&#39;</span></span> --empty

bu</pre></div>
</li>
<li>
<p dir="auto"><code>-g [NUM]</code>, <code>--generate [NUM]</code> Generate lines while ignoring the input pipe. Line will correspond to the iteration cycle count (unless having the <code>--overflow-safe</code> flag on while having an infinite generator – in that case, lines will equal to &#39;1&#39;). If <code>NUM</code> not specified, 5 lines will be produced by default. Putting <code>NUM == 0</code> means an infinite generator. If no <code>main</code> clause set, the number is piped out.</p>
<div data-snippet-clipboard-copy-content="$ pz -g2
1
2
$ pz &#39;i=i+5&#39; -g -v
Changing the main clause to: s = i=i+5
Generating s = 1 .. 5
5
10
15
20
25"><pre>$ pz -g2
1
2
$ pz <span><span>&#39;</span>i=i+5<span>&#39;</span></span> -g -v
Changing the main clause to: s = i=i+5
Generating s = 1 .. 5
5
10
15
20
25</pre></div>
</li>
<li>
<p dir="auto"><code>--stderr</code> Print clauses&#39; output to the <code>STDERR</code>, while letting the original line piped to <code>STDOUT</code> intact. Useful for generating reports during a long operation. Take a look at the following example, every third line will make <code>STDERR</code> to receive a message.</p>
<div data-snippet-clipboard-copy-content="$ pz -g=9 s | pz &#34;s = &#39;Processed next few lines&#39; if count % 3 == 0 else None&#34; --stderr 
1
2
3
Processed next few lines
4
5
6
Processed next few lines
7
8
9
Processed next few lines"><pre>$ pz -g=9 s <span>|</span> pz <span><span>&#34;</span>s = &#39;Processed next few lines&#39; if count % 3 == 0 else None<span>&#34;</span></span> --stderr 
1
2
3
Processed next few lines
4
5
6
Processed next few lines
7
8
9
Processed next few lines</pre></div>
<p dir="auto">Demonstrate different pipes by writing <code>STDOUT</code> to a file and leaving <code>STDERR</code> in the terminal.</p>
<div data-snippet-clipboard-copy-content="$ pz -g=9 s | pz &#34;s = &#39;Processed next few lines&#39; if count % 3 == 0 else None&#34; --stderr &gt; /tmp/example
Processed next few lines
Processed next few lines
Processed next few lines

cat /tmp/example
1
2
3
...  "><pre>$ pz -g=9 s <span>|</span> pz <span><span>&#34;</span>s = &#39;Processed next few lines&#39; if count % 3 == 0 else None<span>&#34;</span></span> --stderr <span>&gt;</span> /tmp/example
Processed next few lines
Processed next few lines
Processed next few lines

cat /tmp/example
1
2
3
...  </pre></div>
</li>
<li>
<p dir="auto"><code>--overflow-safe</code> Prevent <code>lines</code>, <code>numbers</code>, <code>text</code> variables to be available. Useful when handling an infinite input.</p>
<div data-snippet-clipboard-copy-content="# prevent `text` to be populated by default
echo -e  &#34;1\n2\n2\n3&#34; | pz --end &#34;len(text)&#34; --overflow-safe
Did you not forget to use --while to access `text`?
Exception: &lt;class &#39;NameError&#39;&gt; name &#39;text&#39; is not defined in the --end clause

# force to populate `text` 
echo -e  &#34;1\n2\n2\n3&#34; | pz --end &#34;len(text)&#34; --overflow-safe --whole
7"><pre><code># prevent `text` to be populated by default
echo -e  &#34;1\n2\n2\n3&#34; | pz --end &#34;len(text)&#34; --overflow-safe
Did you not forget to use --while to access `text`?
Exception: &lt;class &#39;NameError&#39;&gt; name &#39;text&#39; is not defined in the --end clause

# force to populate `text` 
echo -e  &#34;1\n2\n2\n3&#34; | pz --end &#34;len(text)&#34; --overflow-safe --whole
7
</code></pre></div>
</li>
</ul>
<h3 dir="auto"><a id="user-content-regular-expressions-shortcuts" aria-hidden="true" href="#regular-expressions-shortcuts"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Regular expressions shortcuts</h3>
<ul dir="auto">
<li>
<p dir="auto"><code>--search</code> Equivalent to <code>search(COMMAND, s)</code></p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;hello world\nanother words&#34; | pz --search &#34;.*\s&#34;
hello
another"><pre>$ <span>echo</span> -e <span><span>&#34;</span>hello world\nanother words<span>&#34;</span></span> <span>|</span> pz --search <span><span>&#34;</span>.*\s<span>&#34;</span></span>
hello
another</pre></div>
</li>
<li>
<p dir="auto"><code>--match</code> Equivalent to <code>match(COMMAND, s)</code></p>
</li>
<li>
<p dir="auto"><code>--findall</code> Equivalent to <code>findall(COMMAND, s)</code></p>
</li>
<li>
<p dir="auto"><code>--sub SUBSTITUTION</code> Equivalent to <code>sub(COMMAND, SUBSTITUTION, s)</code></p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;hello world\nanother words&#34; | pz &#34;.*\s&#34; --sub &#34;:&#34;
:world
:words"><pre>$ <span>echo</span> -e <span><span>&#34;</span>hello world\nanother words<span>&#34;</span></span> <span>|</span> pz <span><span>&#34;</span>.*\s<span>&#34;</span></span> --sub <span><span>&#34;</span>:<span>&#34;</span></span>
:world
:words</pre></div>
<p dir="auto">Using groups</p>
<div data-snippet-clipboard-copy-content="$ echo -e &#34;hello world\nanother words&#34; | pz &#34;(.*)\s&#34; --sub &#34;\1&#34;
helloworld
anotherwords"><pre>$ <span>echo</span> -e <span><span>&#34;</span>hello world\nanother words<span>&#34;</span></span> <span>|</span> pz <span><span>&#34;</span>(.*)\s<span>&#34;</span></span> --sub <span><span>&#34;</span>\1<span>&#34;</span></span>
helloworld
anotherwords</pre></div>
</li>
</ul>
<h3 dir="auto"><a id="user-content-bash-completion" aria-hidden="true" href="#bash-completion"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Bash completion</h3>
<ol dir="auto">
<li>Run: <code>apt-get install bash-completion jq</code></li>
<li>Copy: <a href="https://github.com/CZ-NIC/pz/blob/main/extra/pz-autocompletion.bash">extra/pz-autocompletion.bash</a> to <code>/etc/bash_completion.d/</code></li>
<li>Restart terminal</li>
</ol>
</article>
        </div></div>
  </body>
</html>
