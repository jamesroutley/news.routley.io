<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://theleo.zone/posts/configuring-glove80/">Original</a>
    <h1>customizing the Glove80 keyboard with ZMK</h1>
    
    <div id="readability-page-1" class="page"><div><p>I’ve recently been dealing with some wrist/hand/forearm pain from typing. I’ve tried a few different ergonomic keyboards
to see if any of them help, and they definitely have! Some reviews in brief:</p><ul><li><a href="https://www.zsa.io/moonlander/">ZSA Moonlander</a>: ortholinear layout, split halves, tentable, palm rests, but still
did not feel very ergo to me. Felt like I was often stretching my hands quite a bit and the thumb cluster felt
uncomfortably spaced. I enjoyed customizing it, but the keyboard itself wasn’t friendly for my hands.</li><li><a href="https://kinesis-ergo.com/shop/advantage2/">Kinesis Advantage2</a>: ortholinear layout, split halves at a fixed distance,
palm rests, and concave keywells. The concave keywells felt great, as did the thumb cluster compared to the
Moonlander. Customizing the Advantage2 was harder and it was more frustrating to troubleshoot at times, for example,
the firmware seemed to reset sometimes when physically switching the usb cord between computers. Got the silent
switches version off craigslist and wish that I had gotten the tactile switches. Probably could have continued to use
this one happily.</li><li><a href="https://www.moergo.com/">MoErgo Glove80</a>: hands down the best of the bunch. A combination of all the best features of
both prior keyboards in my opinion. Feels great, and I will be sticking with the Glove80.</li></ul><p>There are some great tools for customizing the Glove80, but it still took me a bit of time to get my preferred workflow
together. The goal of this post is to bridge the gap between the keyboard customization gods (there are some people out
there with some <a href="https://my.glove80.com/#/layout/user/6d0bf84e-3a3e-4145-96d9-a9b2aeddd8f1">MAJORLY customized setups</a>) and mere mortals like me who want to change some mappings, have an
extra layer, a couple combos and macros, and basic home row mods.</p><p>The Glove80 runs the excellent open source keyboard firmware <a href="https://zmk.dev/">ZMK</a>, and many of the links in this post
go to the great documentation there.</p><h2 id="components">Components</h2><ul><li>a template of the glove80 <a href="https://github.com/moergo-sc/glove80-zmk-config">zmk config repo</a> - setup instructions in
the README there<ul><li>note that the <a href="https://github.com/moergo-sc/glove80-zmk-config/blob/d09d3a07549490e2feed46c6d469939dd234d399/.github/workflows/build.yml#L14">github action references</a> the <a href="https://github.com/moergo-sc/zmk">glove80 zmk fork</a>, so the built firmware will
include that version of ZMK by default</li></ul></li><li>a browser bookmark of this excellent <a href="https://nickcoutsos.github.io/keymap-editor/">zmk keymap editor</a>, with the source configured to Github (my template
of the repo above)<ul><li>the <a href="https://my.glove80.com/">moergo layout editor</a> is nice but does not have point-and-click macro and combo
definitions the way that nickcoutsos’s does</li></ul></li><li><a href="https://github.com/robinovitch61/glove80-zmk-config/blob/main/config/glove80.keymap">this keymap file</a>, which I’ll walk through below</li></ul><h2 id="updating-configuration-and-firmware">Updating Configuration and Firmware</h2><ol><li>Edit the <a href="https://github.com/robinovitch61/glove80-zmk-config/blob/main/config/glove80.keymap">keymap file</a> and commit the changes, either through an editor directly or through the <a href="https://nickcoutsos.github.io/keymap-editor/">keymap
editor</a>. The commit will trigger a github actions build that will generate an artifact called glove80.uf2
(<a href="https://github.com/robinovitch61/glove80-zmk-config/actions/runs/6790985271">example</a>). You can commit to a
non-<code>main</code> branch and it will still execute the action</li><li>Download the glove80.uf2 artifact and unzip it. Put each half of the keyboard into
<a href="https://cdn.shopify.com/s/files/1/0695/7078/9649/files/Glove80_User_Guide_7Oct2023.pdf?v=1696669801">Bootloader Mode</a>
and drag the glove80.uf2 file to the mounted drive, once for each half</li></ol><h2 id="keymap-walkthrough">Keymap Walkthrough</h2><p>Brief explanations of my current <a href="https://github.com/robinovitch61/glove80-zmk-config/blob/main/config/glove80.keymap">keymap file</a>, starting with some boilerplate includes and definitions:</p><div><pre tabindex="0"><code data-lang="txt"><span><span>#include &lt;behaviors.dtsi&gt;
</span></span><span><span>#include &lt;dt-bindings/zmk/bt.h&gt;
</span></span><span><span>#include &lt;dt-bindings/zmk/keys.h&gt;
</span></span><span><span>#include &lt;dt-bindings/zmk/outputs.h&gt;
</span></span><span><span>#include &lt;dt-bindings/zmk/rgb.h&gt;
</span></span><span><span>
</span></span><span><span>#define LAYER_Base 0
</span></span><span><span>#define LAYER_Lower 1
</span></span><span><span>#define LAYER_Magic 2
</span></span></code></pre></div><p>The “root devicetree node” under which everything else goes:</p><div><pre tabindex="0"><code data-lang="txt"><span><span>/ {
</span></span><span><span>    ...all stuff below
</span></span><span><span>};
</span></span></code></pre></div><p>What I believe is a Glove80-specific node, as the keyboard comes with a “magic” key and I can’t find any reference to a
magic node in the ZMK docs:</p><div><pre tabindex="0"><code data-lang="txt"><span><span>    magic: magic {
</span></span><span><span>        compatible = &#34;zmk,behavior-hold-tap&#34;;
</span></span><span><span>        label = &#34;MAGIC_HOLD_TAP&#34;;
</span></span><span><span>        #binding-cells = &lt;2&gt;;
</span></span><span><span>        flavor = &#34;tap-preferred&#34;;
</span></span><span><span>        tapping-term-ms = &lt;200&gt;;
</span></span><span><span>        bindings = &lt;&amp;mo&gt;, &lt;&amp;rgb_ug_status_macro&gt;;
</span></span><span><span>    };
</span></span></code></pre></div><p>Some Glove80 system level <a href="https://zmk.dev/docs/behaviors/macros">macros</a>:</p><div><pre tabindex="0"><code data-lang="txt"><span><span>    macros {
</span></span><span><span>        /* Glove80 system */
</span></span><span><span>
</span></span><span><span>        rgb_ug_status_macro: rgb_ug_status_macro {
</span></span><span><span>            label = &#34;RGB_UG_STATUS&#34;;
</span></span><span><span>            compatible = &#34;zmk,behavior-macro&#34;;
</span></span><span><span>            #binding-cells = &lt;0&gt;;
</span></span><span><span>            bindings = &lt;&amp;rgb_ug RGB_STATUS&gt;;
</span></span><span><span>        };
</span></span><span><span>        bt_0: bt_0 {
</span></span><span><span>            label = &#34;BT_0&#34;;
</span></span><span><span>            compatible = &#34;zmk,behavior-macro&#34;;
</span></span><span><span>            #binding-cells = &lt;0&gt;;
</span></span><span><span>            bindings = &lt;&amp;out OUT_BLE &amp;bt BT_SEL 0&gt;;
</span></span><span><span>        };
</span></span><span><span>        bt_1: bt_1 {
</span></span><span><span>            label = &#34;BT_1&#34;;
</span></span><span><span>            compatible = &#34;zmk,behavior-macro&#34;;
</span></span><span><span>            #binding-cells = &lt;0&gt;;
</span></span><span><span>            bindings = &lt;&amp;out OUT_BLE &amp;bt BT_SEL 1&gt;;
</span></span><span><span>        };
</span></span><span><span>        bt_2: bt_2 {
</span></span><span><span>            label = &#34;BT_2&#34;;
</span></span><span><span>            compatible = &#34;zmk,behavior-macro&#34;;
</span></span><span><span>            #binding-cells = &lt;0&gt;;
</span></span><span><span>            bindings = &lt;&amp;out OUT_BLE &amp;bt BT_SEL 2&gt;;
</span></span><span><span>        };
</span></span><span><span>        bt_3: bt_3 {
</span></span><span><span>            label = &#34;BT_3&#34;;
</span></span><span><span>            compatible = &#34;zmk,behavior-macro&#34;;
</span></span><span><span>            #binding-cells = &lt;0&gt;;
</span></span><span><span>            bindings = &lt;&amp;out OUT_BLE &amp;bt BT_SEL 3&gt;;
</span></span><span><span>        };
</span></span></code></pre></div><p>My own custom <a href="https://zmk.dev/docs/behaviors/macros">macros</a>:</p><ul><li>The <code>iterm</code> macro activates the key sequence mapping to my
<a href="https://iterm2.com/documentation-hotkey.html">iterm2 toggle all windows hotkey</a> sequence, giving me one-keypress
terminal summon/dismiss.</li><li>The <code>switchapps</code> macro uses <code>cmd-Tab</code> to switch apps.</li><li>The <code>email</code> macro types my email for me :).</li></ul><div><pre tabindex="0"><code data-lang="txt"><span><span>        /* My custom macros */
</span></span><span><span>
</span></span><span><span>        iterm: iterm {
</span></span><span><span>            label = &#34;iterm&#34;;
</span></span><span><span>            compatible = &#34;zmk,behavior-macro&#34;;
</span></span><span><span>            #binding-cells = &lt;0&gt;;
</span></span><span><span>            wait-ms = &lt;40&gt;;
</span></span><span><span>            tap-ms = &lt;40&gt;;
</span></span><span><span>            bindings =
</span></span><span><span>                &lt;&amp;macro_press&gt;,
</span></span><span><span>                &lt;&amp;kp LALT&gt;,
</span></span><span><span>                &lt;&amp;macro_tap&gt;,
</span></span><span><span>                &lt;&amp;kp SPACE&gt;,
</span></span><span><span>                &lt;&amp;macro_release&gt;,
</span></span><span><span>                &lt;&amp;kp LALT&gt;;
</span></span><span><span>        };
</span></span><span><span>        switchapps: switchapps {
</span></span><span><span>            compatible = &#34;zmk,behavior-macro&#34;;
</span></span><span><span>            label = &#34;SWITCHAPPS&#34;;
</span></span><span><span>            #binding-cells = &lt;0&gt;;
</span></span><span><span>            wait-ms = &lt;40&gt;;
</span></span><span><span>            tap-ms = &lt;40&gt;;
</span></span><span><span>            bindings =
</span></span><span><span>                &lt;&amp;macro_press&gt;,
</span></span><span><span>                &lt;&amp;kp LCMD&gt;,
</span></span><span><span>                &lt;&amp;macro_tap&gt;,
</span></span><span><span>                &lt;&amp;kp TAB&gt;,
</span></span><span><span>                &lt;&amp;macro_pause_for_release&gt;,
</span></span><span><span>                &lt;&amp;macro_release&gt;,
</span></span><span><span>                &lt;&amp;kp LCMD&gt;;
</span></span><span><span>        };
</span></span><span><span>        email: email {
</span></span><span><span>            compatible = &#34;zmk,behavior-macro&#34;;
</span></span><span><span>            #binding-cells = &lt;0&gt;;
</span></span><span><span>            bindings = &lt;&amp;kp L &amp;kp E &amp;kp O &amp;kp R &amp;kp O &amp;kp B &amp;kp I &amp;kp N &amp;kp O &amp;kp V &amp;kp I &amp;kp T &amp;kp C &amp;kp H &amp;kp AT_SIGN &amp;kp G &amp;kp M &amp;kp A &amp;kp I &amp;kp L &amp;kp PERIOD &amp;kp C &amp;kp O &amp;kp M&gt;;
</span></span><span><span>            label = &#34;EMAIL&#34;;
</span></span><span><span>            tap-ms = &lt;30&gt;;
</span></span><span><span>            wait-ms = &lt;30&gt;;
</span></span><span><span>        };
</span></span><span><span>    };
</span></span></code></pre></div><p><a href="https://zmk.dev/docs/features/keymaps#behaviors">ZMK behaviors</a> can be bound to things to perform certain actions when
events occur for that binding. I think it is best understood through examples.</p><ul><li>the <code>lower</code> behavior is a “tap dance”, such that holding the bound key results in a momentary switch to the lower
layer, whereas a double-tap (2 presses within 200ms of one another) results in a persistent switch to the lower layer.
This came with the Glove80 default layout and I don’t actually use it right now.</li><li>the <code>ltb</code> (“layer_tap_balanced”) behavior is something I custom defined, and is just a minor tweak on the
<a href="https://zmk.dev/docs/behaviors/layers#layer-tap">layer-tap</a> stock ZMK behavior. The essence of the behavior, which I
currently have bound to the spacebar on the base layer, is that when I hold space, the lower layer activates, but when
I tap it, it just sends a single space. I defined this using a “hold-tap” because the “layer-tap” behavior uses the
<a href="https://zmk.dev/docs/behaviors/hold-tap#flavors">“tap-preferred” flavor</a>, which meant I had to wait a whole 200ms (tapping-term-ms) before the hold behavior
kicked in. I found the <a href="https://zmk.dev/docs/behaviors/hold-tap#flavors">“balanced” flavor</a> to be perfect, as it subverts the tapping-term-ms timeout if
another key is pressed and released before it expires. This sort of deep tweaky customization is what makes ZMK so
awesome!</li></ul><div><pre tabindex="0"><code data-lang="txt"><span><span>    behaviors {
</span></span><span><span>        lower: lower {
</span></span><span><span>            compatible = &#34;zmk,behavior-tap-dance&#34;;
</span></span><span><span>            label = &#34;LAYER_TAP_DANCE&#34;;
</span></span><span><span>            #binding-cells = &lt;0&gt;;
</span></span><span><span>            tapping-term-ms = &lt;200&gt;;
</span></span><span><span>            bindings = &lt;&amp;mo LAYER_Lower&gt;, &lt;&amp;to LAYER_Lower&gt;;
</span></span><span><span>        };
</span></span><span><span>        ltb: layer_tap_balanced {
</span></span><span><span>            compatible = &#34;zmk,behavior-hold-tap&#34;;
</span></span><span><span>            label = &#34;LAYER_TAP_BALANCED&#34;;
</span></span><span><span>            #binding-cells = &lt;2&gt;;
</span></span><span><span>            flavor = &#34;balanced&#34;;
</span></span><span><span>            tapping-term-ms = &lt;200&gt;;
</span></span><span><span>            bindings = &lt;&amp;mo&gt;, &lt;&amp;kp&gt;;
</span></span><span><span>        };
</span></span><span><span>    };
</span></span></code></pre></div><p><a href="https://zmk.dev/docs/features/combos">Combos</a> allow you to press multiple keys to trigger other keys or macros. I find
combos in particular the easiest to define and edit in the <a href="https://nickcoutsos.github.io/keymap-editor/">keymap editor</a>.</p><ul><li>my <code>switch_apps</code> combo triggers the <code>switchapps</code> macro and allows me to press <code>&lt;&gt;</code> together to switch apps.</li><li>the <code>ctrl</code> combo allows me to press <code>m&lt;</code> together to press <code>ctrl</code>.</li></ul><p>These combos are examples of what people refer to as “homerow mods”, even though they’re not actually on the home row…</p><p>Often home row mods are also symmetric across both hands. I may change these up.</p><div><pre tabindex="0"><code data-lang="txt"><span><span>    combos {
</span></span><span><span>        compatible = &#34;zmk,combos&#34;;
</span></span><span><span>
</span></span><span><span>        switch_apps {
</span></span><span><span>            bindings = &lt;&amp;switchapps&gt;;
</span></span><span><span>            key-positions = &lt;60 61&gt;;
</span></span><span><span>            timeout-ms = &lt;70&gt;;
</span></span><span><span>            slow-release;
</span></span><span><span>        };
</span></span><span><span>
</span></span><span><span>        ctrl {
</span></span><span><span>            bindings = &lt;&amp;kp LCTRL&gt;;
</span></span><span><span>            key-positions = &lt;59 60&gt;;
</span></span><span><span>        };
</span></span><span><span>    };
</span></span></code></pre></div><p>Finally, the <a href="https://zmk.dev/docs/features/keymaps#keymap-node">keymap node</a> defines all my layers and the bindings of
behaviors to keys. I just have 3 layers: the base layer, a “lower” layer that is for numbers and symbols, and the
“magic” layer that comes stock with the Glove80. The magic layer is used for admin tasks like getting into bootloader
mode and seeing connection &amp; battery status with the LEDs:</p><div><pre tabindex="0"><code data-lang="txt"><span><span>    keymap {
</span></span><span><span>        compatible = &#34;zmk,keymap&#34;;
</span></span><span><span>
</span></span><span><span>        layer_Base {
</span></span><span><span>            bindings = &lt;
</span></span><span><span>&amp;none                 &amp;kp C_BRI_DN  &amp;kp C_BRI_UP  &amp;kp C_PREV  &amp;kp C_NEXT                                                                                      &amp;kp C_PLAY_PAUSE  &amp;kp C_MUTE  &amp;kp C_VOLUME_DOWN  &amp;kp C_VOLUME_UP  &amp;none
</span></span><span><span>&amp;kp EQUAL             &amp;kp N1        &amp;kp N2        &amp;kp N3      &amp;kp N4      &amp;kp N5                                                                      &amp;kp N6  &amp;kp N7            &amp;kp N8      &amp;kp N9             &amp;kp N0           &amp;kp MINUS
</span></span><span><span>&amp;kp TAB               &amp;kp Q         &amp;kp W         &amp;kp E       &amp;kp R       &amp;kp T                                                                       &amp;kp Y   &amp;kp U             &amp;kp I       &amp;kp O              &amp;kp P            &amp;kp BSLH
</span></span><span><span>&amp;mt LCTRL ESC         &amp;kp A         &amp;kp S         &amp;kp D       &amp;kp F       &amp;kp G                                                                       &amp;kp H   &amp;kp J             &amp;kp K       &amp;kp L              &amp;kp SEMI         &amp;kp SQT
</span></span><span><span>&amp;kp LSHFT             &amp;kp Z         &amp;kp X         &amp;kp C       &amp;kp V       &amp;kp B   &amp;kp DEL   &amp;kp LALT  &amp;email     &amp;caps_word  &amp;kp RCTRL  &amp;kp RCMD      &amp;kp N   &amp;kp M             &amp;kp COMMA   &amp;kp DOT            &amp;kp FSLH         &amp;kp RSHFT
</span></span><span><span>&amp;magic LAYER_Magic 0  &amp;kp GRAVE     &amp;iterm        &amp;kp LEFT    &amp;kp RIGHT           &amp;kp BSPC  &amp;kp LGUI  &amp;kp LCTRL  &amp;kp RALT    &amp;kp RET    &amp;ltb 1 SPACE          &amp;kp DOWN          &amp;kp UP      &amp;kp LBKT           &amp;kp RBKT         &amp;caps_word
</span></span><span><span>            &gt;;
</span></span><span><span>        };
</span></span><span><span>
</span></span><span><span>        layer_Lower {
</span></span><span><span>            bindings = &lt;
</span></span><span><span>&amp;trans                &amp;trans        &amp;trans          &amp;trans        &amp;trans                                                                             &amp;trans            &amp;trans             &amp;trans          &amp;trans           &amp;trans
</span></span><span><span>&amp;kp F1                &amp;kp F2        &amp;kp F3          &amp;kp F4        &amp;kp F5       &amp;none                                                      &amp;none      &amp;kp F6            &amp;kp F7             &amp;kp F8          &amp;kp F9           &amp;kp F10
</span></span><span><span>&amp;kp EQUAL             &amp;kp EXCL      &amp;kp AT          &amp;kp HASH      &amp;kp DLLR     &amp;kp PRCNT                                                  &amp;kp CARET  &amp;kp AMPS          &amp;kp STAR           &amp;kp LPAR        &amp;kp RPAR         &amp;kp MINUS
</span></span><span><span>&amp;trans                &amp;kp N1        &amp;kp N2          &amp;kp N3        &amp;kp N4       &amp;kp N5                                                     &amp;kp N6     &amp;kp N7            &amp;kp N8             &amp;kp N9          &amp;kp N0           &amp;trans
</span></span><span><span>&amp;trans                &amp;kp KP_EQUAL  &amp;kp UNDERSCORE  &amp;kp KP_MINUS  &amp;kp KP_PLUS  &amp;none      &amp;trans  &amp;trans  &amp;trans  &amp;trans  &amp;trans  &amp;trans  &amp;none      &amp;kp LEFT_BRACKET  &amp;kp RIGHT_BRACKET  &amp;kp LEFT_BRACE  &amp;kp RIGHT_BRACE  &amp;trans
</span></span><span><span>&amp;magic LAYER_Magic 0  &amp;trans        &amp;trans          &amp;trans        &amp;trans                  &amp;trans  &amp;trans  &amp;trans  &amp;trans  &amp;trans  &amp;trans             &amp;trans            &amp;trans             &amp;trans          &amp;trans           &amp;trans
</span></span><span><span>            &gt;;
</span></span><span><span>        };
</span></span><span><span>
</span></span><span><span>        layer_Magic {
</span></span><span><span>            bindings = &lt;
</span></span><span><span>&amp;bt BT_CLR   &amp;none            &amp;none            &amp;none            &amp;none                                                                                     &amp;none  &amp;none  &amp;none  &amp;none  &amp;bt BT_CLR_ALL
</span></span><span><span>&amp;none        &amp;none            &amp;none            &amp;none            &amp;none            &amp;none                                                             &amp;none  &amp;none  &amp;none  &amp;none  &amp;none  &amp;none
</span></span><span><span>&amp;none        &amp;rgb_ug RGB_SPI  &amp;rgb_ug RGB_SAI  &amp;rgb_ug RGB_HUI  &amp;rgb_ug RGB_BRI  &amp;rgb_ug RGB_TOG                                                   &amp;none  &amp;none  &amp;none  &amp;none  &amp;none  &amp;none
</span></span><span><span>&amp;bootloader  &amp;rgb_ug RGB_SPD  &amp;rgb_ug RGB_SAD  &amp;rgb_ug RGB_HUD  &amp;rgb_ug RGB_BRD  &amp;rgb_ug RGB_EFF                                                   &amp;none  &amp;none  &amp;none  &amp;none  &amp;none  &amp;bootloader
</span></span><span><span>&amp;sys_reset   &amp;none            &amp;none            &amp;none            &amp;none            &amp;none            &amp;bt_2  &amp;bt_3  &amp;none         &amp;none  &amp;none  &amp;none  &amp;none  &amp;none  &amp;none  &amp;none  &amp;none  &amp;sys_reset
</span></span><span><span>&amp;none        &amp;none            &amp;none            &amp;none            &amp;none                             &amp;bt_0  &amp;bt_1  &amp;out OUT_USB  &amp;none  &amp;none  &amp;none         &amp;none  &amp;none  &amp;none  &amp;none  &amp;none
</span></span><span><span>            &gt;;
</span></span><span><span>        };
</span></span><span><span>    };
</span></span><span><span>};
</span></span></code></pre></div><h2 id="annoyances">Annoyances</h2><ul><li>I’ve found that the online keymap editor sometimes reformats the keymap file arbitrarily, even when it would still be
valid without doing so. For example, it will remove newline spacing, or create an empty <code>behaviors</code> block if none
exists.</li><li>When the firmware build fails, the error message is often very obscure and/or hidden in a lot of log output.</li></ul><h2 id="conclusion">Conclusion</h2><p>A few weeks in, I love my new Glove80 keyboard and the custom configuration I’ve loaded onto it so far. Hopefully this
post helped someone other than just me to get started configuring their own board! If you’d like, tag me at
<code>@robinovitch61</code> in the <a href="https://discord.gg/3E2Kvp8Azk">Glove80 Discord</a>.</p></div></div>
  </body>
</html>
