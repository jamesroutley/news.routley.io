<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/faster-cpython/ideas/blob/main/3.13/README.md">Original</a>
    <h1>Our Plan for Python 3.13</h1>
    
    <div id="readability-page-1" class="page"><div>

    <div data-target="readme-toc.content">
      
  


        <div id="readme">
    <article itemprop="text">
<p dir="auto">Author: Mark Shannon, Michael Droettboom</p>
<h3 dir="auto"><a id="user-content-overview" aria-hidden="true" href="#overview"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Overview</h3>
<p dir="auto">The plan for 3.13 is similar to <a href="https://github.com/faster-cpython/ideas/blob/main/3.12/README.md">early plans for 3.12</a>.</p>
<p dir="auto">The big difference is that we have now finished the foundational work that we need:</p>
<ul dir="auto">
<li><a href="https://peps.python.org/pep-0669/" rel="nofollow">Low impact monitoring (PEP 669)</a> is implemented.</li>
<li>The bytecode compiler is a much better state.</li>
<li>The interpreter generator is working.</li>
<li>Experiments on the register machine are complete.</li>
<li>We have a viable approach to create a low-overhead maintainable machine code generator, based on <a href="https://fredrikbk.com/publications/copy-and-patch.pdf" rel="nofollow">copy-and-patch</a>.</li>
</ul>
<p dir="auto">We plan three parallelizable pieces of work for 3.13:</p>
<ul dir="auto">
<li>The tier 2 optimizer</li>
<li>Enabling subinterpreters from Python code (<a href="https://peps.python.org/pep-0554/" rel="nofollow">PEP 554</a>).</li>
<li>Memory management</li>
</ul>
<h3 dir="auto"><a id="user-content-the-tier-2-optimizer" aria-hidden="true" href="#the-tier-2-optimizer"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>The tier 2 optimizer</h3>
<p dir="auto">See <a href="https://github.com/faster-cpython/ideas/issues/557" data-hovercard-type="issue" data-hovercard-url="/faster-cpython/ideas/issues/557/hovercard">Tier 2 optimizer</a> for an explanation of what the tier2 optimizer is.</p>
<p dir="auto">The workplan is roughly as follows:</p>
<ul dir="auto">
<li>Get the tier 2 interpreter working</li>
<li>Generate (poor quality) superblocks</li>
<li>Implement basic superblock management</li>
<li>In parallel:
<ul dir="auto">
<li>Add support for deoptimization to superblocks</li>
<li>Enhance the superblock creation code</li>
<li>Implement the specializer</li>
<li>Implement the partial evaluator</li>
<li>Implement the copy-and-patch machine code generator
<ul dir="auto">
<li>Build-time integration</li>
<li>Generation of tier 2 code</li>
</ul>
</li>
</ul>
</li>
</ul>
<p dir="auto">Our goal for 3.13 is to reduce the time spent in the interpreter by at least 50%.</p>
<p dir="auto"><a href="https://github.com/faster-cpython/ideas/issues/587" data-hovercard-type="issue" data-hovercard-url="/faster-cpython/ideas/issues/587/hovercard">Detailed plan</a>.
<a href="https://github.com/faster-cpython/ideas/issues/588" data-hovercard-type="issue" data-hovercard-url="/faster-cpython/ideas/issues/588/hovercard">Detailed plan for copy-and-patch</a>.</p>
<h3 dir="auto"><a id="user-content-enabling-subinterpreters-from-python" aria-hidden="true" href="#enabling-subinterpreters-from-python"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Enabling subinterpreters from Python</h3>
<p dir="auto">Unlike the other tasks, which are mainly focused on single-threaded performance, this work builds on the per-interpreter GIL work that shipped in Python 3.12 to allow Python programmers to take advantage of better parallelism in subinterpreters from Python code (without the need to write a C extension).</p>
<p dir="auto">A draft <a href="https://peps.python.org/pep-0554/" rel="nofollow">PEP 554</a> already exists for this work.  The first step will be to get it updated and push for an early approval, so we can change course if necessary.</p>
<p dir="auto"><a href="https://github.com/faster-cpython/ideas/issues/589" data-hovercard-type="issue" data-hovercard-url="/faster-cpython/ideas/issues/589/hovercard">Detailed plan</a>.</p>
<h3 dir="auto"><a id="user-content-better-memory-management" aria-hidden="true" href="#better-memory-management"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Better memory management</h3>
<p dir="auto">The <a href="https://github.com/faster-cpython/benchmarking/blob/main/profiling/profiling.png">profiling data</a> shows that quite a large amount of time spent is spent in memory management and cycle GC. That fraction will only get larger as we speed up the rest of the VM.</p>
<p dir="auto">Unlike the tasks above, we are less certain about the appropriate solutions, so some more research and experimentation is required first.
We plan to do this as a side project based on what we learn from the Tier 2 work above.</p>
<p dir="auto">We want to:</p>
<ul dir="auto">
<li>Do fewer allocations by improving data structures<sup>*</sup></li>
<li>Spend less time doing cycle GCs. This could be as simple as doing fewer collections, or as complex as implementing a new, incremental cycle finder.</li>
</ul>
<p dir="auto"><strong>TODO:</strong> Create issues for investigation</p>
<p dir="auto">List our detailed strategy and workplan for improving allocation/deallocation speed and reducing cycle GC overhead.</p>
<hr/>
<p dir="auto"><strong>*</strong> We also hope that partial evaluation will reduce the number of temporary objects, but that is in the scope of the tier 2 optimizer, not memory management.</p>
</article>
  </div>

    </div>

  </div></div>
  </body>
</html>
