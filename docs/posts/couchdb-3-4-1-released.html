<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.couchdb.org/2024/09/27/3-4-1/">Original</a>
    <h1>CouchDB 3.4.1 Released</h1>
    
    <div id="readability-page-1" class="page"><div>
		
<p>Dear community,</p>



<p>Apache CouchDB® 3.4.1 has been released and is available for download. It is a <em>feature</em> and <em>bugfix</em> release, and was originally published on 2024-09-27.</p>


<div>
<figure><a href="https://blog.couchdb.org/wp-content/uploads/2024/09/spaceballs-facts-11.gif"><img data-attachment-id="3284" data-permalink="https://blog.couchdb.org/2024/09/27/3-4-1/spaceballs-facts-11/#main" data-orig-file="https://blog.couchdb.org/wp-content/uploads/2024/09/spaceballs-facts-11.gif" data-orig-size="500,281" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="spaceballs-facts-11" data-image-description="" data-image-caption="" data-medium-file="https://blog.couchdb.org/wp-content/uploads/2024/09/spaceballs-facts-11.gif?w=300" data-large-file="https://blog.couchdb.org/wp-content/uploads/2024/09/spaceballs-facts-11.gif?w=500" tabindex="0" role="button" width="500" height="281" src="https://blog.couchdb.org/wp-content/uploads/2024/09/spaceballs-facts-11.gif?w=500" alt=""/></a></figure></div>


<p><em>3.4.1?</em> — What happened to 3.4.0?! Great question!</p>



<p>We had 3.4.0 <em>almost</em> ready to be released and mere hours before making it official, we realised that a new feature could lead to an unsatisfactory scenario for some users. Namely: the automatic upgrading of password hashes to a stronger algorithm could lead to folks upgrading to 3.4.1 and them not being able to roll back to the previous version without locking out users that have had their password hashes automatically upgrade.</p>



<p>The CouchDB team aims to make every release <em>safe to upgrade</em>, aside from major releases with well-documented breaking changes. So 3.4.<code>1</code> would not be safe to upgrade and we decided to not announce its availability, even though everything was ready to go.</p>



<p>Instead we immediately fast-tracked version 3.4.1 that disabled the feature by default and this is instead the release that <em>is</em> safe to upgrade to. Please note that the new hashing algorithm is still enabled by default. User accounts created after the upgrade will not be able to downgrade.</p>



<p>The CouchDB team recommends enabling the feature once you are safely running 3.4.1 and have no longer a need to downgrade.</p>



<h2>Release Notes highlights:</h2>



<ul>
<li>Nouveau (beta) a modern, from-the-ground-up implementation of Lucene-based full-text search for CouchDB. Please test this thoroughly and report back any issues you might find.
<ul>
<li><a href="https://docs.couchdb.org/en/latest/experimental.html#nouveauconfig">Setup instructions</a></li>



<li><a href="https://docs.couchdb.org/en/latest/ddocs/nouveau.html#ddoc-nouveau">Usage</a></li>



<li><a href="https://github.com/apache/couchdb/issues/new/choose">Report a bug</a></li>
</ul>
</li>



<li><a href="https://bellard.org/quickjs/">QuickJS</a> as a JavaScript engine option. Advantages over SpiderMonkey:
<ul>
<li>Significantly smaller and <strong>easier to integrate</strong> codebase. We’re using <strong>~6 C files</strong> vs 700+ SM91 C++ files.</li>



<li>Built with Apache CouchDB as opposed having to maintain a separate SpiderMonkey package for OSs that don’t support it (*cough*RedHat9*cough*).</li>



<li>Better sandboxing support.</li>



<li>Preliminary test results show multiple performance improvements.
<ul>
<li><strong>4x faster</strong> than SpiderMonkey 1.8.5.</li>



<li><strong>5x faster</strong> than SpiderMonkey 91.</li>



<li><strong>6x reduced</strong> memory usage per <code>couchjs</code> process (5MB vs 30MB).</li>
</ul>
</li>



<li>Allows compiling JavaScript bytecode ahead of time.</li>



<li>CouchDB also now includes a <a href="https://docs.couchdb.org/en/latest/best-practices/jsdevel.html#scanning-for-quickjs-incompatibilities">scanner plugin</a> that, when enabled, can scan all design docs in all your databases in the background and report incompatibilities between SpiderMonkey and QuickJS. This allows you to <strong>safely migrate to QuickJS</strong>.</li>



<li><strong>SpiderMonkey remains supported and is still the default</strong> in 3.4.0. You can opt into QuickJS by setting your design doc language to <code>&#34;javascript_quickjs&#34;</code>.</li>
</ul>
</li>



<li>Mango: <strong>add keys-only covering indexes</strong>. Improves query response times for certain queries <strong>up to 10x at p(95)</strong>.</li>



<li>Optionally replace md5 with <a href="https://github.com/Cyan4973/xxHash">xxHash</a> for data integrity checksums. 30% speed up on larger (128k) docs, no difference for smaller docs. Note that once you enable this, you cannot go back to an earlier version of CouchDB, if you need a rollback-capable installation. In that case, upgrade to 3.4.0 without changing the default and enable xxHash in 3.5.0 or later so you can roll back to 3.4.0 then.</li>



<li>Require auth for <code>_replicate</code> endpoint. This continues the 3.x closed-by-default design goal.</li>



<li>Introduce PBKDF2-SHA256 for password hashing. The existing PBKDF2-SHA1 variant is now deprecated.  Increases the default iteration count to <code>600000</code>. Also introduce a password hash in-memory cache with a low iteration number, to keep interactive requests fast for a fixed time.
<ul>
<li>Entries in the password hash cache are time-limited, unused entries are automatically deleted, and there is a capacity bound.</li>



<li>Existing hashed user doc entries <s>will be automatically upgraded </s> can be configured to be automatically upgraded during the next successful authentication. To disable auto-upgrading set the <code>[chttpd_auth] upgrade_hash_on_auth</code> config setting to <code>false</code>.</li>



<li>Also added temporary lockouts for accounts that receive repeated authentication failures to avoid a denial of service. Can be disabled in config.</li>
</ul>
</li>



<li>Many small and medium <a href="https://docs.couchdb.org/en/latest/whatsnew/3.4.html#performance">performance improvements</a>.</li>



<li>Many, many bug fixes and improvements to our test suite.</li>
</ul>



<p>See the official release notes document for an exhaustive list of all changes:</p>



<p><a href="https://docs.couchdb.org/en/stable/whatsnew/3.4.html">https://docs.couchdb.org/en/stable/whatsnew/3.4.html</a></p>



<p>Pre-built packages for Windows, macOS, Debian/Ubuntu and RHEL/CentOS as well as Docker images for CouchDB and Nouveau are available alongside the source code distribution: </p>



<p><a href="https://couchdb.apache.org/#download">https://couchdb.apache.org/#download</a></p>



<p>Apache CouchDB® lets you access your data where you need it. The Couch Replication Protocol is implemented in a variety of projects and products that span every imaginable computing environment from globally distributed server-clusters, over mobile phones to web browsers.</p>



<p>Store your data safely, on your own servers, or with any leading cloud provider. Your web- and native applications love CouchDB, because it speaks JSON natively and supports binary data for all your data storage needs.</p>



<p>The Couch Replication Protocol lets your data flow seamlessly between server clusters to mobile phones and web browsers, enabling a compelling offline-first user-experience while maintaining high performance and strong reliability. CouchDB comes with a developer-friendly query language, and optionally MapReduce for simple, efficient, and comprehensive data retrieval.</p>



<p>The community would like to thank all contributors for their part in making this release, from the smallest bug report or patch to major contributions in code, design, or marketing, we couldn’t have done it without you!</p>



<p>On behalf of the CouchDB PMC,</p>
			</div></div>
  </body>
</html>
