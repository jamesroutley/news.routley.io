<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://simonschreibt.de/gat/dont-starve-diablo-parallax-7/">Original</a>
    <h1>Don’t starve, Diablo – Parallax 7</h1>
    
    <div id="readability-page-1" class="page"><div>
			<div>
<div>

<p><img decoding="async" src="https://data.simonschreibt.de/assets/flag_ru.png"/></p>


</div>
</div>
<p>In the 1990s, games started to move from 2D to 3D and if an alien would have landed on earth back then, it surely would have thought that nobody needs these low-res polygon-models without any filtering. Then it would destroy the earth.</p>
<p>Later his mother would teach him what made humans special: Even during the 2D-Era they had enormous willpower to render 3D – even if it wasn’t yet possible! It started with implementing a <a href="http://en.wikipedia.org/wiki/Parallax_scrolling" target="_blank">parallax effect</a> (depending on the “distance” some elements move faster than others). This parallax effect blew people away back in 1982:</p>

<p>It’s really interesting that a bunch of (differently) moving “planes” have such a strong effect. But it’s a bit flat, right? A perspective camera above the ground would be cool but isn’t possible without “real” 3D? Well, let’s have a look through a time machine to the SNES-Era:</p>

<p>This <em>looks</em> 3D but it’s not! It is <a href="http://en.wikipedia.org/wiki/Super_Nintendo_Entertainment_System" target="_blank">SNES</a> tech and is called “<a href="http://en.wikipedia.org/wiki/Mode_7" target="_blank">Mode 7</a>“. To render it, <a href="http://en.wikipedia.org/wiki/Nintendo" target="_blank">Nintendo</a> manipulated textures (trading height for depth) with some coder magic. Here’s someone who knows the recipe (he talks about the <a href="http://en.wikipedia.org/wiki/Game_Boy_Advance" target="_blank">Gameboy Advance</a> but as far as i know it’s true for the SNES either):</p>
<blockquote><p>“The GBA doesn’t have any real 3D hardware capabilities, but you can fake it by cleverly manipulating the scaling and translation REG_BGxX-REG_BGxPD for every scanline.”</p></blockquote>
<p>By the way: even today some people are crazy about the Mode 7 and use it for <a href="http://www.youtube.com/watch?v=BO_GZzrdE9Y" target="_blank">some projects</a> with the <a href="http://www.rpgmakerweb.com/products/programs/rpg-maker-xp" target="_blank">RPG Maker</a>. Impressive!</p>
<p>Nowadays we <em>could</em> render every asset in “real” 3D to give them volume but there are examples where this is just not needed. In fact, it’s sometimes even better to do it old-schoolish:</p>

<p>All the bushes, trees and enemies in <a href="http://www.dontstarvegame.com/" target="_blank">Don’t Starve</a> are flat. And i think it looks awesome!</p>
<p><strong>For me</strong>, <a href="http://us.blizzard.com/en-us/games/d2/" target="_blank">Diablo 2</a> (2D ARPG from year 2000) was the first game which brought the “Moon Patrol”-parallax effect and something like the “Mode 7”-floor-rendering together.</p>
<p>Let’s look at the game with standard settings. Pure 2D. No perspective. No parallax effects:</p>

<p>But the game had a “Perspective Mode”. Let’s turn it <strong>on</strong>! Pay attention, how the pales <strong>don’t</strong> cover the same floor-pixels all the time:</p>

<p>It looks like in Don’t Starve, but remember: Diablo 2 is a <strong>2D</strong> game! There’s no official information about this mode. All what you read now, was only possible by using the awesome tools/documentation by <a href="http://www.angelfire.com/sc/mpq/" target="_blank">Tom Amigo</a> and <a href="http://paul.siramy.free.fr/" target="_blank">Paul Siramy</a> – special thanks to Paul, which answered all my questions and supported me a lot!</p>
<p>It might seem, that Blizzards coders only move the sprites somehow but if you compare the game with perspective mode <span>on</span> and <span>off</span> while standing still, it gets better visible, that they actually “tilt” everything towards the horizon.</p>

<p>This gets even better visible when i add a beautiful checker pattern to the floor textures:</p>

<p>I mean, think of it: every asset has to be transformed somehow, to look perspectively <strong>without any gaps</strong> at the sprite-borders. This is even more impressive if you see of how much sprites the scene consists (a lot chances for gaps…):</p>


<p>And game-tech can’t be complicated enough! So please consider that Blizzard subdivides the sprites <a href="http://paul.siramy.free.fr/_divers/dt1_doc/" target="_blank">into 32x32px parts</a>. This seems to be an optimization to only load necessary parts of an image. Additionally it becomes handy when the transformation is happening. Here you see how an ingame sprite is subdivided:</p>

<p>For every 32px I painted a line on the pale-texture to show a faked wireframe. The result was more interesting than i expected! Like the vertical lines indicate, the sprite got a “real” vanishing point deep in the ground (which you would expect when it comes to perspective):</p>

<p>However, I don’t know why the lower edge of the sprite is bent that way. For the perspective it wouldn’t be necessary (below is a 3Ds Max scene to show that the horizontal lines are straight if the camera isn’t rotated around its front axis):</p>
<p><img decoding="async" loading="lazy" alt="" src="https://data.simonschreibt.de/gat047/d2_persp_test.jpg" width="560" height="600"/></p>
<p>Anyway, Blizzards wizards will know why they do that. It may be worth noting, that this deformation is depended on the “angle” you’re looking at the sprite (or the position of the player/camera). Here you can see how the lower edge is straightened up:</p>

<p>For those who are interested in seeing the deformation on a checker pattern, here’s a screenshot:</p>

<p>If you think that all this is interesting enough, than be amazed by reading more. <a href="http://paul.siramy.free.fr/_divers/dt1_doc/" target="_blank">Paul writes</a> that Sprites can have an orientation value. Depending on this value the sprites are deformed differently (yeah…more complexity)! Here’s an example of some wall which have directions defined like (<span>Left Wall</span>, <span>Upper Wall</span>, <span>Lower-Left corner</span>, etc.)</p>

<p>Let me demonstrate what (i <strong>assume</strong>) has to be done. On the next picture you can see a standard ISO view. Below that, there are the steps which i had to make to “fit” the sprites to a “perspective” ground. I had to re-position, re-scale and deform twice to fit them to the floor-grid.</p>
<p><img decoding="async" loading="lazy" alt="" src="https://data.simonschreibt.de/gat047/d2_persp_tilingtest.gif" width="560" height="500"/></p>
<p>As you see, this sprite-transformation (as i imagine it) is kind of complicated. Let’s have a look how it actually was made in the game:</p>

<p>This sprite is oriented in a different way than the example i mentioned before. And as you see, the deformation is very different! No bending of the upper/lower edges but instead it looks like the edges “point” to a vanishing point to the left. Again an example how it looks in 3Ds Max:</p>
<p><img decoding="async" loading="lazy" alt="" src="https://data.simonschreibt.de/gat047/d2_persp_test_02.jpg" width="560" height="600"/></p>
<p>It’s seems that the game exaggerates the deformation to avoid any gaps between the sprites and i think it’s very successful with that because every sprite of the fence fits perfectly. Pay attention how the edge-orientation (<span>upper</span> edges, <span>lower</span> edges) changes depending on their position:</p>

<p>How important the sprite-orientation values is, shows the next example. If i just tell the game that this isn’t a “right” but a “left” oriented wall, it’s gap-time:</p>

<p>This mode was only activatable with D3D in fullscreen (Diablo 2 also supported Glide and Software Rendering) what made me trying to get my hands on old DirectX-Documentation to get more information. But i wasn’t successful.</p>
<p>So…here ends our trip and i hope you are amazed as I am by this crazy example of the will to make 2D look more 3D. The lack of official information or statements of the government (search your government website for “Diablo 2 perspective mode” … you’ll find nothing!) leads me to one inevitable conclusion:</p>
<p><strong>All this is alien technology!</strong></p>
<p>Tools/Tutorials used for this article</p>
<ul>
<li><a href="http://www.angelfire.com/sc/mpq/" target="_blank">MPQ Editor</a> (for extracing DT1 files out of the MPQ) by <a href="http://www.angelfire.com/sc/mpq/" target="_blank">Tom Amigo</a></li>
<li><a href="http://paul.siramy.free.fr/_divers/dt1/DT1%20Tools.zip" target="_blank">DT1 Tools</a> (for extracting PCX files out of the DT1) by <a href="http://paul.siramy.free.fr/" target="_blank">Paul Simary</a></li>
<li><a href="http://paul.siramy.free.fr/_divers/dt1_doc/" target="_blank">DT1 Tutorial</a> (for understanding the DT1 format) by <a href="http://paul.siramy.free.fr/" target="_blank">Paul Simary</a></li>
<li><a href="http://www.gimp.org/" target="_blank">GIMP</a> (for edit/save the extracted PCX files)</li>
<li><a href="http://paul.siramy.free.fr/_divers/ds1/doc/index.html" target="_blank">Diablo 2 Map Editor</a> (for understanding D2 maps) by <a href="http://paul.siramy.free.fr/" target="_blank">Paul Simary</a></li>
</ul>
<section id="update1">
<p><img decoding="async" src="https://data.simonschreibt.de/assets/icon_update_01.png"/>Update 1</p>
<p>
Thanks <strong>hans wurst</strong> for <a href="http://toothwalker.org/optics/distortion.html" target="_blank">this link about image aberration</a> which really looks like what we see in Diablo 2 (with activated perspective mode). I don’t know, if this is what the D2-Coders used but at least it looks very similar.
</p>
</section>
<section id="update2">
<p><img decoding="async" src="https://data.simonschreibt.de/assets/icon_update_01.png"/>Update 2</p>
<div id="update-content">
<p><a href="http://paul.siramy.free.fr/" target="_blank">Paul Simary</a> just mentioned <a href="https://www.gamasutra.com/blogs/DavidCraddock/20180706/321425/How_StarCraft_and_Shower_Epiphanies_Influenced_Diablo_2s_Design.php" rel="noopener" target="_blank">this article on Gamasutra</a> where more details about the perspective mode where revealed. Thanks Paul! That’s awesome!</p>
<blockquote><p>
A 3D graphics card was required to enable Diablo 2’s Perspective Mode. (Lord of Destruction expansion shown.)</p>
<p>A solution occurred to him late one morning. Like the original game, Diablo IIunfolds on a grid, with one major difference. Each diamond-shaped tile is composed of several smaller diamond tiles that allow for some overlap. This meant that objects such as player-characters, monsters, treasure chests, and items can occupy the same squares on a grid by standing in smaller squares within each larger square, an impossibility in the first Diablo. A more granular layout facilitated Dave’s pseudo-3D solution, which he called Perspective Mode.</p>
<p>His idea was to take the texture stored in every miniature tile and rotate it just a smidge, so that it wasn’t quite orthogonal, as players moved around the screen. The game passed those textures to the video card, which painted them onto two polygons and then stretched them vertically and horizontally so that they appeared larger or smaller depending on the player-character’s position. Trees and buildings, for example, seemed larger or smaller as players moved closer or further away, and scrolled by at a different speed than other objects in the foreground and background, creating a parallax effect. Objects shimmered slightly, the result of bilinear filtering, a process baked into graphics cards that smooths out textures when objects are rendered larger or smaller than their native resolutions.</p>
<p>Everything, from characters and items to structures such as the cabins and towers in Act I, expanded and shrank in Perspective Mode, an option only available to users running 3D cards that the game supported. “It was doing real, 3D math, and making this grid scale slightly, stretch slightly,” Dave explained. “It gave a real sense of depth to the world.”</p>
<p>In an impressively short span of time, Perspective Mode was finished and rolled into the latest build of the game. “There were a bunch of things I had to do to make sure walls lined up properly, and the lighting, but I think I wrote that fairly quickly,” Dave continued. “I think it only took me a week or two to get it working. People loved the way it looked, and it really was awesome, but the artists weren’t super happy they had to go back and chop up things and render them differently. We did feel it was worth it in the end, and added a lot to the game.”
</p></blockquote>
<p>Source: <a href="https://www.gamasutra.com/blogs/DavidCraddock/20180706/321425/How_StarCraft_and_Shower_Epiphanies_Influenced_Diablo_2s_Design.php" rel="noopener" target="_blank">How StarCraft and Shower Epiphanies Influenced Diablo 2’s Design</a></p>
</div>
</section>

					</div></div>
  </body>
</html>
