<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.righto.com/2022/04/reverse-engineering-lm185-voltage.html">Original</a>
    <h1>Reverse-engineering the LM185 voltage reference chip and its bandgap reference</h1>
    
    <div id="readability-page-1" class="page"><div id="post-body-2403064272955247656" itemprop="description articleBody">

<p>Many circuits, such as a computer power supply or a phone charger, require a stable voltage reference, but it&#39;s harder than you might expect to keep a voltage stable when the temperature changes.
One integrated circuit that does this is the LM185.<span id="fnref:lm185"><a href="#fn:lm185">1</a></span>
I looked at the die of this chip and found some interesting features. The same silicon die is used for three different integrated circuits, using tiny internal
fuses to change its functionality.
The chip uses a special circuit called the bandgap reference to keep the voltage stable even if the temperature changes.
In this blog post, I&#39;ll discuss the circuitry of the LM185 and its implementation in silicon.</p>

<p><a href="https://static.righto.com/images/lm185/reg2.jpg"><img alt="Composite die photo of the LM185. Click this (or any other) image for a larger version." height="528" src="https://static.righto.com/images/lm185/reg2-w600.jpg" title="Composite die photo of the LM185. Click this (or any other) image for a larger version." width="600"/></a></p><p>Composite die photo of the LM185. Click this (or any other) image for a larger version.</p>
<p>The photo above shows the LM185 die under the microscope, a tiny square of silicon.
The underlying silicon is blue-gray, while the metal wiring on top is orangish.
Regions of the silicon are doped with various impurities to form the transistors, resistors, and other devices on the chip.
The variations in doping are visible as slight color changes in the silicon.
At the top is the National Semiconductor logo.</p>
<p>The LM185 is available in three variants.
The LM185-ADJ is the adjustable voltage reference. It has three pins: one is a feedback pin that controls the voltage.
The LM185-1.2-N is a two-pin device, called a &#34;micropower voltage reference diode&#34;.
It is similar to a Zener diode providing 1.235V, but with better performance. (Lower power consumption, less noise, and better stability.)
Finally, the LM185-2.5-N provides a 2.5V reference.
The three variants are based on the same silicon die. The latter two have the feedback wired internally to provide a fixed voltage
rather than an adjustable voltage.</p>
<p>The next sections describe how the various components of the chip are fabricated from silicon, and how they appear on the die.</p>
<h3>NPN transistors</h3>
<p>The photo below shows a closeup of one of the transistors in the LM185.
The black lines and slightly different tints in the silicon indicate regions that have been doped to form N and P regions.
The whitish areas are the metal layer of the chip on top of the silicon—these form the wires connected to the collector, emitter, and base.</p>
<p><a href="https://static.righto.com/images/lm185/transistor-structure-npn.jpg"><img alt="Structure of an NPN transistor on the die. I edited the transistor layout so a cross-section would work." height="416" src="https://static.righto.com/images/lm185/transistor-structure-npn-w350.jpg" title="Structure of an NPN transistor on the die. I edited the transistor layout so a cross-section would work." width="350"/></a></p><p>Structure of an NPN transistor on the die. I edited the transistor layout so a cross-section would work.</p>
<p>Underneath the photo is a cross-section drawing illustrating how the transistor is constructed. There&#39;s a lot more than just the N-P-N sandwich you see in books, but if you look carefully at the vertical cross-section below the &#39;E&#39;, you can find the N-P-N that forms the transistor. The emitter (E) wire is connected to N+ silicon. Below that is a P layer connected to the base contact (B). And below that is an N+ layer connected (indirectly) to the collector (C).</p>
<p>The output transistor (below) is much larger than the other transistors and has a different structure in order to support the chip&#39;s high-current output.
It has multiple interlocking &#34;fingers&#34; for the emitter and base, surrounded by the large collector.</p>
<p><a href="https://static.righto.com/images/lm185/npn-large-labeled.jpg"><img alt="A large, high-current NPN output transistor in the LM185 chip. The collector (C), base (B) and emitter (E) are labeled." height="334" src="https://static.righto.com/images/lm185/npn-large-labeled-w400.jpg" title="A large, high-current NPN output transistor in the LM185 chip. The collector (C), base (B) and emitter (E) are labeled." width="400"/></a></p><p>A large, high-current NPN output transistor in the LM185 chip. The collector (C), base (B) and emitter (E) are labeled.</p>
<h3>PNP transistors</h3>
<p>You might expect PNP transistors to be similar to NPN transistors, just swapping the roles of N and P silicon. But for a variety of reasons, PNP transistors have an entirely different construction.
They consist of a small circular emitter (P), surrounded by a ring-shaped base (N), which is surrounded by the collector (P). This forms a P-N-P sandwich horizontally (laterally), unlike the vertical structure of the NPN transistors.</p>
<p>The diagram below shows one of the PNP transistors in the LM185, along with a cross-section showing the silicon structure.
Note that although the metal contact for the base is on the edge of the transistor, it is electrically connected through the N and N+ regions to its active ring in between the collector and emitter.</p>
<p><a href="https://static.righto.com/images/lm185/transistor-structure-pnp.jpg"><img alt="A PNP transistor in the LM185 chip. Connections for the collector (C), emitter (E) and base (B) are labeled, along with N and P doped silicon. The base forms a ring around the emitter, and the collector forms a ring around the base." height="407" src="https://static.righto.com/images/lm185/transistor-structure-pnp-w400.jpg" title="A PNP transistor in the LM185 chip. Connections for the collector (C), emitter (E) and base (B) are labeled, along with N and P doped silicon. The base forms a ring around the emitter, and the collector forms a ring around the base." width="400"/></a></p><p>A PNP transistor in the LM185 chip. Connections for the collector (C), emitter (E) and base (B) are labeled, along with N and P doped silicon. The base forms a ring around the emitter, and the collector forms a ring around the base.</p>
<h3>Resistors</h3>
<p>Resistors are a key component of analog chips. Unfortunately, resistors in ICs are large and inaccurate; the resistances can vary by 50% from chip to chip. Thus, analog ICs are designed so only the ratio of resistors matters, not the absolute values, since the ratios remain nearly constant.
The photo below shows two paralleled resistors. Other resistors have a zig-zag shape to fit a longer resistor into the available space.</p>
<p><a href="https://static.righto.com/images/lm185/resistors.jpg"><img alt="A resistor inside the LM185 chip. The resistor is a strip of P silicon between two metal contacts." height="150" src="https://static.righto.com/images/lm185/resistors-w400.jpg" title="A resistor inside the LM185 chip. The resistor is a strip of P silicon between two metal contacts." width="400"/></a></p><p>A resistor inside the LM185 chip. The resistor is a strip of P silicon between two metal contacts.</p>
<h3>Capacitors</h3>
<p>A capacitor consists of a metal plate on top of silicon, separated by a thin oxide layer that acts as a dielectric.
Capacitors are fairly large on integrated circuits; they are the most visible components on this die.
The capacitor below contains multiple circular patterns. These may be doped silicon regions, where the junction between two regions provides additional capacitance.</p>
<p><a href="https://static.righto.com/images/lm185/capacitor-labeled.jpg"><img alt="A capacitor on the die." height="226" src="https://static.righto.com/images/lm185/capacitor-labeled-w600.jpg" title="A capacitor on the die." width="600"/></a></p><p>A capacitor on the die.</p>
<h3>Fuses</h3>
<p>Fuses allow the circuitry of the chip to be changed after manufacturing.
The LM185 uses fuses for two reasons.
First, fuses can add or remove resistance, allowing the circuit to be tuned for higher performance.
Second, a fuse changes the feedback circuitry between the LM185-1.2-N and LM185-2.5-N variants.
(The LM185-ADJ version requires more changes than are supported by fuses, so it needs some changes to the metal layer. For instance, it has three pads connected instead of two.)</p>
<p>A fuse has two metal pads attached.
Before the chip is packaged, probes can contact the pads and apply a high current to blow the fuse.
The first type of fuse is implemented with a tiny strip of metal that is vaporized to break the circuit, just like a large-scale fuse.
The second type of fuse is an &#34;antifuse&#34;, which has the opposite behavior: it does not conduct until a high current is applied, at which point it
becomes conductive.
The antifuse can be built from a Zener diode, and the process of shorting it out is called a &#34;Zener zap&#34;.
The high current forms metal spikes through the junction, causing it to permanently conduct.
The diagram below shows a fuse and an antifuse as they appear on the die.</p>
<p><a href="https://static.righto.com/images/lm185/fuses.jpg"><img alt="A fuse and an antifuse on the die (I think). The contacts originally had more metal, but I used acid to clean gunk off the die and it dissolved some of the metal." height="279" src="https://static.righto.com/images/lm185/fuses-w600.jpg" title="A fuse and an antifuse on the die (I think). The contacts originally had more metal, but I used acid to clean gunk off the die and it dissolved some of the metal." width="600"/></a></p><p>A fuse and an antifuse on the die (I think). The contacts originally had more metal, but I used acid to clean gunk off the die and it dissolved some of the metal.</p>
<h3>IC circuit: The current mirror</h3>
<p>There are some subcircuits that are very common in analog ICs, but may seem mysterious at first. The current mirror is one of these.
The idea is you start with one known current and then you can &#34;clone&#34; multiple copies of the current with a simple transistor circuit, the current mirror.</p>
<p>The following circuit shows how a current mirror is implemented with three identical transistors.<span id="fnref:currentmirror"><a href="#fn:currentmirror">2</a></span> A reference current passes through the transistor on the right. (In this case, the current is set by the resistor.)
Since all the transistors have the same emitter voltage and base voltage, they source the same current, so the currents on the left match the reference current.</p>
<p><a href="https://static.righto.com/images/lm185/current-mirror.png"><img alt="Current mirror circuit. The currents on the left copy the current on the right." height="262" src="https://static.righto.com/images/lm185/current-mirror-w250.png" title="Current mirror circuit. The currents on the left copy the current on the right." width="250"/></a></p><p>Current mirror circuit. The currents on the left copy the current on the right.</p>
<p>A common use of a current mirror is to replace resistors. As explained earlier, resistors inside ICs are both inconveniently large and inaccurate. It saves space to use a current mirror instead of multiple resistors whenever possible. 
Also, the currents produced by a current mirror are nearly identical, unlike the currents produced by two resistors.</p>
<h2>Interactive chip explorer</h2>
<p>To illustrate how the components form the chip,
the die photo and schematic below are interactive. Click on a component in the die or schematic, and a brief explanation of the component will be displayed. </p>


<p>Click the die or schematic for details...</p>







<!--
<script src="jquery.min.js"></script>
<script src="die-lm185.js"></script>
<script src="notes-lm185.js"></script>
<script src="chip-viewer-lm185.js"></script>
-->



<p>Because the three variants of the LM185 are slightly different, I had to combine three schematics to form the schematic above.
Red components are only in the LM185-ADJ, green components are in the LM185-1.2-N, blue components are in the LM185-2.5-N, and cyan components
are in the latter two chips.
Note that the primary difference is the feedback circuit, but there are additional differences as well.</p>
<h2>How a bandgap reference works</h2>
<p>The main problem with producing a stable voltage from an IC is that the chip&#39;s parameters change as temperature changes.
The bandgap voltage reference is commonly used to create a temperature-independent voltage reference.<span id="fnref:more"><a href="#fn:more">5</a></span>
The trick is that it has one voltage that goes down with temperature and another than goes up with temperature.
If you combine them correctly, you get a voltage that is stable with temperature.</p>
<p>To create a voltage that goes down with temperature, you can put a constant current through the transistor and look at the voltage between the base and emitter, called V<sub>be</sub>. The graph below shows how this voltage drops as the temperature increases. At the left, the line hits the bandgap voltage of silicon, about 1.2 volts; this will be important later.</p>
<p><a href="https://static.righto.com/images/lm185/voltage-curve-1.png"><img alt="Vbe vs temperature for a transistor" height="281" src="https://static.righto.com/images/lm185/voltage-curve-1-w400.png" title="Vbe vs temperature for a transistor" width="400"/></a></p><p>Vbe vs temperature for a transistor</p>
<p>If you set up a second transistor this way but with a lower current<span id="fnref:DENSITY"><a href="#fn:DENSITY">3</a></span>,
you get the same effect but the voltage V<sub>be</sub> curve drops faster. This may not seem helpful since we need a voltage that goes up with temperature. But here&#39;s the trick: if you subtract the two V<sub>be</sub> voltages, the difference <i>increases</i> as temperature increases, since the lines get farther apart. The difference is called ΔV<sub>be</sub>. The graph below shows the V<sub>be</sub> curves for two different transistors, and you can see how the difference ΔV<sub>be</sub> between the curves increases with temperature, even though both curves decrease with temperature.</p>
<p><a href="https://static.righto.com/images/lm185/voltage-curve-2.png"><img alt="Voltages in a bandgap reference: Vbe for two transistors as temperature changes." height="306" src="https://static.righto.com/images/lm185/voltage-curve-2-w400.png" title="Voltages in a bandgap reference: Vbe for two transistors as temperature changes." width="400"/></a></p><p>Voltages in a bandgap reference: Vbe for two transistors as temperature changes.</p>
<p>The final step to a bandgap reference is to combine V<sub>be</sub> and ΔV<sub>be</sub> in the right ratio so the result is constant with temperature. It turns out that if the values sum to the bandgap voltage of silicon (approximately 1.2 volts),
the drop in V<sub>be</sub> and the increase in ΔV<sub>be</sub> cancel out. In the graph below, adding 10 copies of ΔV<sub>be</sub> is the right ratio; the exact ratio depends on the particular transistors. The important thing to notice in the graph below is that as the temperature changes, V<sub>be</sub>+nΔV<sub>be</sub> remains constant - the top of the blue ΔV<sub>be</sub> line remains at the bandgap voltage.</p>
<p><a href="https://static.righto.com/images/lm185/voltage-curve-3.png"><img alt="By adding multiples of ΔVbe to Vbe, the bandgap voltage is reached regardless of temperature." height="295" src="https://static.righto.com/images/lm185/voltage-curve-3-w400.png" title="By adding multiples of ΔVbe to Vbe, the bandgap voltage is reached regardless of temperature." width="400"/></a></p><p>By adding multiples of ΔVbe to Vbe, the bandgap voltage is reached regardless of temperature.</p>
<p>In the LM185, the key transistors are Q10 and Q11, where Q10 has 10 emitters in parallel, so each has 1/10 the current.
Thus, if you feed the same current into both transistors, Q10 has a lower V<sub>be</sub> voltage than Q11 as described above.
Note that Q10 is split in two: one half above Q11 and one half below Q11.
This layout minimizes potential error due to a temperature gradient across the die. Half of Q10 will be hotter than Q11 and half will be cooler, so
the difference will cancel out.</p>
<p><a href="https://static.righto.com/images/lm185/bandgap-transistor-diagram.jpg"><img alt="Transistors Q10 and Q11 are the key to the bandgap reference. Q10 has 10 emitters, so each has 1/10 the current as Q11." height="399" src="https://static.righto.com/images/lm185/bandgap-transistor-diagram-w350.jpg" title="Transistors Q10 and Q11 are the key to the bandgap reference. Q10 has 10 emitters, so each has 1/10 the current as Q11." width="350"/></a></p><p>Transistors Q10 and Q11 are the key to the bandgap reference. Q10 has 10 emitters, so each has 1/10 the current as Q11.</p>
<p>The diagram below shows how the bandgap reference is implemented in the LM185. 
Transistors Q10 and Q11 have different V<sub>be</sub> voltages due to their relative sizes.
The difference in these voltages (ΔV<sub>be</sub>) is developed across R7. 
Since the same current flows through R6, R7, and R8, the voltage across R6 will be 4ΔV<sub>be</sub> and the voltage across R8 will be
6ΔV<sub>be</sub> by Ohm&#39;s law.
Thus, the combination of R6, R7, and R8 multiply ΔV<sub>be</sub> by 11.
Meanwhile, Q14 has its own V<sub>be</sub>. </p>
<p><a href="https://static.righto.com/images/lm185/bandgap-circuit.jpg"><img alt="The bandgap circuit in the LM185." height="418" src="https://static.righto.com/images/lm185/bandgap-circuit-w280.jpg" title="The bandgap circuit in the LM185." width="280"/></a></p><p>The bandgap circuit in the LM185.</p>
<p>Summing the voltages along the right gives V<sub>be</sub> + 11ΔV<sub>be</sub>, which is designed to match
the temperature-stabilized bandgap voltage of 1.2 volts.
Thus, the circuit will be balanced<span id="fnref:bandgap-circuit"><a href="#fn:bandgap-circuit">4</a></span> if the voltage between the feedback input and V+ is 1.2 volts.
If the voltage is not 1.2 volts, Q10 and Q11 will pass different amounts of current. Since the current mirror (Q12 and Q13) attempts to feed the same
current into Q10 and Q11, any discrepancy will appear as current at the error output.
This error current is amplified and controls the output transistor, adjusting the voltage until the feedback voltage is brought back into compliance.
Thus, the circuit maintains the desired voltage, stabilized even if the temperature changes.</p>
<h2>Conclusion</h2>
<p>Well, that turned into a longer blog post than I was expecting.
Although the LM185 doesn&#39;t contain many components by modern standards, it provides a stable, regulated voltage reference.
It has some interesting features such as the use of fuses both to improve performance and to sell
variant chips. 
It also illustrates the principle of the bandgap voltage regulator.</p>
<p>I announce my latest blog posts on Twitter, so follow me <a href="https://twitter.com/kenshirriff">@kenshirriff</a>. I also have an <a href="https://www.righto.com/feeds/posts/default">RSS feed</a>.
Thanks to Mitch Wright for supplying the chip.</p>
<h2>Notes and references</h2>


</div></div>
  </body>
</html>
