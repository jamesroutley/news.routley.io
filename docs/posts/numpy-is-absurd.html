<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gist.github.com/Moelf/59d6312c51c250ba251125e54bea7282">Original</a>
    <h1>Numpy is absurd</h1>
    
    <div id="readability-page-1" class="page"><p>
    Numpy is absurd.
  </p><div>
  <div id="file-index-md">
      
      <div id="file-index-md-readme">
    <article itemprop="text">
<p dir="auto">I always gripe about Python not having built-in array type and Numpy
doesn&#39;t distinguish &#34;vector of vector&#34; from &#34;matrix&#34;, but this still
surprised me.</p>
<h2 dir="auto"><a id="user-content-in-is-actually-intersect" aria-hidden="true" href="#in-is-actually-intersect"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code>in</code> is actually <code>intersect</code>?</h2>
<p dir="auto">It seems that Numpy uses <code>intersect</code> logic to check <code>a in b</code>:</p>
<div><pre><span>In</span> [<span>1</span>]: <span>import</span> <span>numpy</span> <span>as</span> <span>np</span>

<span>In</span> [<span>2</span>]: <span>np</span>.<span>__version__</span>
<span>Out</span>[<span>2</span>]: <span>&#39;1.23.1&#39;</span>

<span>In</span> [<span>3</span>]: <span>np</span>.<span>array</span>([<span>1</span>]) <span>in</span> <span>np</span>.<span>array</span>([<span>1</span>,<span>2</span>,<span>3</span>])
<span>Out</span>[<span>3</span>]: <span>True</span>

<span>In</span> [<span>4</span>]: <span>np</span>.<span>array</span>([<span>1</span>,<span>2</span>,<span>3</span>]) <span>in</span> <span>np</span>.<span>array</span>([<span>1</span>])
<span>Out</span>[<span>4</span>]: <span>True</span></pre></div>
<p dir="auto">also it doesn&#39;t care about <code>dtype</code> at all, so it&#39;s <code>intersect</code> but with value comparison:</p>
<div><pre><span>In</span> [<span>5</span>]: <span>np</span>.<span>array</span>([<span>1</span>,<span>2</span>,<span>3</span>,<span>4</span>,<span>5</span>]) <span>in</span> <span>np</span>.<span>array</span>([<span>2.0</span>])
<span>Out</span>[<span>5</span>]: <span>True</span>

<span>In</span> [<span>6</span>]: <span>float</span>(<span>1</span>) <span>in</span> <span>np</span>.<span>array</span>([<span>1</span>,<span>2</span>,<span>3</span>,<span>4</span>,<span>5</span>])
<span>Out</span>[<span>6</span>]: <span>True</span></pre></div>
<h2 dir="auto"><a id="user-content-in-is-actually-intersectaflat-bflat" aria-hidden="true" href="#in-is-actually-intersectaflat-bflat"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code>in</code> is actually <code>intersect(a.flat, b.flat)</code>?</h2>
<p dir="auto">Things only get weired when we go to higher dimensional array:</p>
<div><pre><span>In</span> [<span>7</span>]: <span>2</span> <span>in</span> <span>np</span>.<span>array</span>([[<span>1</span>,<span>2</span>], [<span>3</span>, <span>4</span>]])
<span>Out</span>[<span>7</span>]: <span>True</span>

<span>In</span> [<span>8</span>]: [<span>2</span>] <span>in</span> <span>np</span>.<span>array</span>([[<span>1</span>,<span>2</span>], [<span>3</span>, <span>4</span>]])
<span>Out</span>[<span>8</span>]: <span>True</span>

<span>In</span> [<span>9</span>]: [[<span>2</span>]] <span>in</span> <span>np</span>.<span>array</span>([[<span>1</span>,<span>2</span>], [<span>3</span>, <span>4</span>]])
<span>Out</span>[<span>9</span>]: <span>True</span>

<span>In</span> [<span>10</span>]: [[[<span>2</span>]]] <span>in</span> <span>np</span>.<span>array</span>([[<span>1</span>,<span>2</span>], [<span>3</span>, <span>4</span>]])
<span>Out</span>[<span>10</span>]: <span>True</span>

<span>In</span> [<span>11</span>]: <span>np</span>.<span>array</span>([[[<span>2</span>]]]) <span>in</span> <span>np</span>.<span>array</span>([[<span>1</span>,<span>2</span>], [<span>3</span>, <span>4</span>]])
<span>Out</span>[<span>11</span>]: <span>True</span></pre></div>
<p dir="auto">Furthur more, because <code>intersect</code> is commutitive, <code>in</code> is also commutitive!</p>
<div><pre><span>In</span> [<span>12</span>]: <span>np</span>.<span>array</span>([[<span>1</span>,<span>2</span>], [<span>3</span>, <span>4</span>]]) <span>in</span> <span>np</span>.<span>array</span>([<span>2</span>])
<span>Out</span>[<span>12</span>]: <span>True</span></pre></div>
<h2 dir="auto"><a id="user-content-wait-wtf" aria-hidden="true" href="#wait-wtf"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Wait, wtf</h2>
<p dir="auto">Finally, just when you throught you understand what Numpy is doing,
it seems there&#39;s special treatment for <code>ndarray</code> of <code>len() == 1</code></p>
<div><pre><span>In</span> [<span>12</span>]: <span>np</span>.<span>array</span>([<span>1</span>,<span>2</span>,<span>3</span>]) <span>in</span> <span>np</span>.<span>array</span>([<span>2</span>])
<span>Out</span>[<span>12</span>]: <span>True</span>

<span>In</span> [<span>14</span>]: <span>np</span>.<span>array</span>([<span>1</span>,<span>2</span>,<span>3</span>]) <span>in</span> <span>np</span>.<span>array</span>([<span>2</span>, <span>3</span>])
<span>&lt;</span><span>ipython</span><span>-</span><span>input</span><span>-</span><span>32</span><span>-</span><span>e5b43569579c</span><span>&gt;</span>:<span>1</span>: <span>DeprecationWarning</span>: <span>elementwise</span> <span>comparison</span> <span>failed</span>; <span>this</span> <span>will</span> <span>raise</span> <span>an</span> <span>error</span> <span>in</span> <span>the</span> <span>future</span>.
  <span>np</span>.<span>array</span>([<span>1</span>,<span>2</span>,<span>3</span>]) <span>in</span> <span>np</span>.<span>array</span>([<span>2</span>, <span>3</span>])
<span>Out</span>[<span>14</span>]: <span>False</span></pre></div>
<p dir="auto">But then what is this?</p>
<div><pre><span>In</span> [<span>15</span>]: <span>np</span>.<span>array</span>([<span>99</span>,<span>2</span>,<span>123</span>]) <span>in</span> <span>np</span>.<span>array</span>([<span>2</span>, <span>30</span>, <span>50</span>])
<span>Out</span>[<span>15</span>]: <span>False</span>

<span>In</span> [<span>16</span>]: <span>np</span>.<span>array</span>([<span>99</span>,<span>2</span>,<span>123</span>]) <span>in</span> <span>np</span>.<span>array</span>([<span>2</span>, <span>123</span>, <span>50</span>])
<span>Out</span>[<span>16</span>]: <span>False</span>

<span>In</span> [<span>17</span>]: <span>np</span>.<span>array</span>([<span>99</span>,<span>2</span>,<span>123</span>]) <span>in</span> <span>np</span>.<span>array</span>([<span>99</span>, <span>123</span>, <span>50</span>])
<span>Out</span>[<span>17</span>]: <span>True</span></pre></div>
</article>
  </div>

  </div>
</div></div>
  </body>
</html>
