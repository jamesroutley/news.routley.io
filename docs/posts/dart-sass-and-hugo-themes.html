<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rgoswami.me/posts/dart-sass-hugo-themes/">Original</a>
    <h1>Dart Sass and Hugo Themes</h1>
    
    <div id="readability-page-1" class="page"><div><blockquote><p>Quick notes on variables, <code>dart-sass</code> and <code>hugo</code></p></blockquote><h2 id="background">Background</h2><p>Recently I decided that it was annoying for me as a user to not know which links
on my site were internal and which led off to an external site.</p><figure><img src="https://d33wubrfki0l68.cloudfront.net/806ff183d277f4796c23cb8f1c722e64498c5ee7/2a3d7/ox-hugo/2023-06-17_16-48-01_screenshot.png" alt="Figure 1: The desired end-result, blue for internal links, purple for external links, colors chosen with ColorHexa"/><figcaption><p><span>Figure 1: </span>The desired end-result, blue for internal links, purple for external links, colors chosen with <a href="https://www.colorhexa.com/">ColorHexa</a></p></figcaption></figure><p>However, since <code>hugo</code> requires <code>baseurl</code> for generating meaningful <code>rss</code> and
<code>sitemap</code> files, this meant either hardcoding the variable into <a href="https://github.com/HaoZeke/hugo-theme-hello-friend-ng-hz">my theme</a>, or
figuring out how to pass variables from my <code>config.toml</code> to my theme’s
(generated) <code>css</code>.</p><p>This about the latter, and is heavily based off of this <a href="https://discourse.gohugo.io/t/initialize-sass-variables-from-hugo-templates/42053">post on the Hugo
Discourse</a>.</p><h2 id="the-css">The CSS</h2><p>The crux of the implementation is simply the use of attribute selectors:</p><div><pre tabindex="0"><code data-lang="scss"><span><span> 1</span><span><span>a</span> <span>{</span>
</span></span><span><span> 2</span><span>  <span>&amp;</span><span>[</span><span>href</span><span>^=</span><span>&#34;/&#34;</span><span>],</span>
</span></span><span><span> 3</span><span>  <span>&amp;</span><span>[</span><span>href</span><span>*=</span><span>&#34;rgoswami.me&#34;</span><span>],</span>
</span></span><span><span> 4</span><span>  <span>&amp;</span><span>[</span><span>href</span><span>^=</span><span>&#34;#&#34;</span><span>]</span> <span>{</span>
</span></span><span><span> 5</span><span>    <span>border-bottom</span><span>:</span> <span>#0380ff</span> <span>0</span><span>.125</span><span>em</span> <span>solid</span><span>;</span>
</span></span><span><span> 6</span><span>  <span>}</span>
</span></span><span><span> 7</span><span>  <span>&amp;</span><span>:not</span><span>([</span><span>href</span><span>^=</span><span>&#34;/&#34;</span><span>])</span><span>:not</span><span>([</span><span>href</span><span>*=</span><span>&#34;rgoswami.me&#34;</span><span>])</span><span>:not</span><span>([</span><span>href</span><span>^=</span><span>&#34;#&#34;</span><span>])</span> <span>{</span>
</span></span><span><span> 8</span><span>    <span>border-bottom</span><span>:</span> <span>#9b36ff</span> <span>0</span><span>.125</span><span>em</span> <span>solid</span><span>;</span>
</span></span><span><span> 9</span><span>  <span>}</span>
</span></span><span><span>10</span><span><span>}</span>
</span></span></code></pre></div><p>Where the main sticking point is being able to pass the name of the site from
the configuration. Although this could be done with <code>libsass</code> and <code>hugo</code> as
detailed in the <a href="https://discourse.gohugo.io/t/initialize-sass-variables-from-hugo-templates/42053">discourse post</a>, it is conceptually clunky, since partials are
not respected when using <code>ExecuteAsTemplate</code> with <a href="https://gohugo.io/hugo-pipes/resource-from-template/">hugo-pipes</a>. A better SCSS
processor could probably take in a better configuration option object…. Which
leads to the next section.</p><h2 id="dart-sass">Dart Sass</h2><p>At some point which I didn’t have time to figure out, <code>libsass</code> got phased out
in favor of <a href="https://sass-lang.com/dart-sass">Dart Sass</a> and includes (among other features) a nifty <code>math</code>
module. This had a few side effects:</p><ul><li>I could swap my hand-kanged <code>exp</code> function for <code>math.exp()</code> and also had to transition to using <code>calc()</code> more (as in <a href="https://github.com/HaoZeke/hugo-theme-hello-friend-ng-hz/commit/3938ac24d3c9e017a6ff633383d3188c5915257f">3938ac2</a>).</li><li>I could pass variables from <code>hugo</code> to <code>scss</code> and from there to <code>css</code> for attribute selectors (as in <a href="https://github.com/HaoZeke/hugo-theme-hello-friend-ng-hz/commit/804d417f1436dc3f58d770a717985fe43cb3813c">804d417</a>)</li></ul><h3 id="ci-updates">CI Updates</h3><p>For various reasons, <code>hugo</code> (even the extended version) does not seem to include
<code>dart-sass-embedded</code> though the <code>snap</code> package does (as noted <a href="https://discourse.gohugo.io/t/using-the-dart-sass-transpiler/41878">here</a> on Discourse).</p><div><pre tabindex="0"><code data-lang="yml"><span><span>1</span><span>- <span>name</span><span>:</span><span> </span><span>Setup Hugo</span><span>
</span></span></span><span><span>2</span><span><span>  </span><span>uses</span><span>:</span><span> </span><span>peaceiris/actions-hugo@v2</span><span>
</span></span></span><span><span>3</span><span><span>  </span><span>with</span><span>:</span><span>
</span></span></span><span><span>4</span><span><span>    </span><span>hugo-version</span><span>:</span><span> </span><span>&#39;0.111.3&#39;</span><span>
</span></span></span><span><span>5</span><span><span>    </span><span>extended</span><span>:</span><span> </span><span>true</span><span>
</span></span></span><span><span>6</span><span><span></span>- <span>name</span><span>:</span><span> </span><span>Install Dart Sass Embedded</span><span>
</span></span></span><span><span>7</span><span><span>  </span><span>run</span><span>:</span><span> </span><span>sudo snap install dart-sass-embedded</span><span>
</span></span></span></code></pre></div><h3 id="local-usage">Local Usage</h3><p><code>hugo serve</code> will correctly compile and load the theme if <code>hugo env</code> recognizes the <code>dart-sass-embedded</code> installation:</p><div><pre tabindex="0"><code data-lang="bash"><span><span> 1</span><span>$ hugo env
</span></span><span><span> 2</span><span>hugo v0.112.3+extended linux/amd64 <span>BuildDate</span><span>=</span>unknown
</span></span><span><span> 3</span><span><span>GOOS</span><span>=</span><span>&#34;linux&#34;</span>
</span></span><span><span> 4</span><span><span>GOARCH</span><span>=</span><span>&#34;amd64&#34;</span>
</span></span><span><span> 5</span><span><span>GOVERSION</span><span>=</span><span>&#34;go1.20.4&#34;</span>
</span></span><span><span> 6</span><span>github.com/sass/libsass<span>=</span><span>&#34;3.6.5&#34;</span>
</span></span><span><span> 7</span><span>github.com/webmproject/libwebp<span>=</span><span>&#34;v1.2.4&#34;</span>
</span></span><span><span> 8</span><span>github.com/sass/dart-sass-embedded/protocol<span>=</span><span>&#34;1.2.0&#34;</span>
</span></span><span><span> 9</span><span>github.com/sass/dart-sass-embedded/compiler<span>=</span><span>&#34;1.54.8&#34;</span>
</span></span><span><span>10</span><span>github.com/sass/dart-sass-embedded/implementation<span>=</span><span>&#34;1.54.8&#34;</span>
</span></span></code></pre></div><p><code>dart-sass-embedded</code> is a node package, which means that <code>npm</code> can be used:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>1</span><span><span>DART_SASS_VERSION</span><span>=</span>1.54.8 npm install sass-embedded-linux-x64@<span>${</span><span>DART_SASS_VERSION</span><span>}</span>
</span></span><span><span>2</span><span><span>PATH</span><span>=</span><span>$PATH</span>:./node_modules/sass-embedded-linux-x64/dart-sass-embedded/ hugo env
</span></span></code></pre></div><p>Personally I ended up using <code>micromamba</code> to grab <code>dart-sass</code> as well.</p><h2 id="passing-variables">Passing Variables</h2><h3 id="user-perspective">User Perspective</h3><p>The theme users simply updates their configuration to include the relevant variables:</p><div><pre tabindex="0"><code data-lang="toml"><span><span>1</span><span><span>baseurl</span> <span>=</span> <span>&#34;https://rgoswami.me/&#34;</span>
</span></span><span><span>2</span><span><span>[</span><span>params</span><span>.</span><span>style</span><span>]</span>
</span></span><span><span>3</span><span><span>site_url</span> <span>=</span> <span>&#34;rgoswami.me&#34;</span> <span># Same as baseurl</span>
</span></span></code></pre></div><h3 id="theme-dev-perspective">Theme Dev Perspective</h3><p>With the <code>hugo</code> asset processing pipeline for <code>dart-sass</code>, the relevant options need to be (minimally) set:</p><div><pre tabindex="0"><code data-lang="html"><span><span>1</span><span>{{ $options := (dict &#34;targetPath&#34; &#34;main.css&#34; &#34;transpiler&#34; &#34;dartsass&#34; &#34;vars&#34; site.Params.style) }}
</span></span><span><span>2</span><span>{{ $style := resources.Get &#34;scss/main.scss&#34; |  resources.ToCSS $options | resources.Minify | resources.Fingerprint }}
</span></span><span><span>3</span><span><span>&lt;</span><span>link</span> <span>rel</span><span>=</span><span>&#34;stylesheet&#34;</span> <span>href</span><span>=</span><span>&#34;{{ $style.RelPermalink }}&#34;</span><span>&gt;</span>
</span></span></code></pre></div><p>Where <code>vars</code> takes a section corresponding to the user-defined section (<code>style</code>
in this case). Usage within <code>scss</code> partials looks like:</p><div><pre tabindex="0"><code data-lang="scss"><span><span>1</span><span><span>@use</span> <span>&#34;hugo:vars&#34;</span> <span>as</span> <span>h</span><span>;</span>
</span></span><span><span>2</span><span><span>$site-url</span><span>:</span> <span>h</span><span>.</span><span>$site_url</span><span>;</span>
</span></span><span><span>3</span><span><span>$link-color</span><span>:</span> <span>#0380ff</span><span>;</span>
</span></span><span><span>4</span><span><span>$external-link-color</span><span>:</span> <span>#9b36ff</span><span>;</span>
</span></span></code></pre></div><p>Which can finally be used to elegantly setup attribute selector based colors:</p><div><pre tabindex="0"><code data-lang="scss"><span><span> 1</span><span><span>a</span> <span>{</span>
</span></span><span><span> 2</span><span>  <span>&amp;</span><span>[</span><span>href</span><span>^=</span><span>&#34;/&#34;</span><span>],</span>
</span></span><span><span> 3</span><span>  <span>&amp;</span><span>[</span><span>href</span><span>*=</span><span>&#34;</span><span>#{</span><span>$site-url</span><span>}</span><span>&#34;</span><span>],</span>
</span></span><span><span> 4</span><span>  <span>&amp;</span><span>[</span><span>href</span><span>^=</span><span>&#34;#&#34;</span><span>]</span> <span>{</span>
</span></span><span><span> 5</span><span>    <span>border-bottom</span><span>:</span> <span>$link-color</span> <span>0</span><span>.125</span><span>em</span> <span>solid</span><span>;</span>
</span></span><span><span> 6</span><span>  <span>}</span>
</span></span><span><span> 7</span><span>  <span>&amp;</span><span>:not</span><span>([</span><span>href</span><span>^=</span><span>&#34;/&#34;</span><span>])</span><span>:not</span><span>([</span><span>href</span><span>*=</span><span>&#34;</span><span>#{</span><span>$site-url</span><span>}</span><span>&#34;</span><span>])</span><span>:not</span><span>([</span><span>href</span><span>^=</span><span>&#34;#&#34;</span><span>])</span> <span>{</span>
</span></span><span><span> 8</span><span>    <span>border-bottom</span><span>:</span> <span>$external-link-color</span> <span>0</span><span>.125</span><span>em</span> <span>solid</span><span>;</span>
</span></span><span><span> 9</span><span>  <span>}</span>
</span></span><span><span>10</span><span><span>}</span>
</span></span></code></pre></div><h2 id="conclusions">Conclusions</h2><p>Of the many maintenance burdens I have accrued over the years, one of the least
often discussed is the underlying theme used for the site. Some day that will be
rectified. I think web design via vanilla JS, S(CSS) and HTML is a pretty nifty
gateway into other languages (interpreted and compiled). The approach could be
(and perhaps should be) extended to color other links and sites differently
(e.g. all my content on other sites in blue). For now this works well enough at
any rate.</p></div></div>
  </body>
</html>
