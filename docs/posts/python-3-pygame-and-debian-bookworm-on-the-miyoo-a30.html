<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.jtolio.com/2025/02/py3-pygame-miyoo-a30/">Original</a>
    <h1>Python 3, Pygame, and Debian Bookworm on the Miyoo A30</h1>
    
    <div id="readability-page-1" class="page"><div>
  

<p>What if I told you you can get a full Linux computer with WiFi and a GPU in a
small, pocket form factor for about <a href="https://docs.google.com/spreadsheets/d/1x_PmVHiQNHyw5t05peEDG1DcCKDCvH_UPd3p7yCw4xg/edit">$30 USD on AliExpress</a>? You might say “but what about the new tariffs?” and I’d say “oof, oh right, okay who knows, but it’s probably still pretty cheap!” (Edit: looks like you can get one for about $40 now).</p>

<p>It wasn’t a big hit with the
retro handheld gaming community, but the
<a href="https://retrocatalog.com/retro-handhelds/miyoo-a30">Miyoo A30</a> has a 4 core
Cortex A7 with a Mali-400 MP GPU, 512 MB of RAM, WiFi, and an incredible little
640x480 IPS screen. It has enough power to emulate many
Nintendo 64 games, but that’s not what I bought it for.
In fact, I bought two so my son and I could make networked multiplayer games
together.</p>

<div>
  <figure>
    
        <img src="https://www.jtolio.com/images/a30.jpg"/>
    
    
</figure>

</div>


<p>I already have a <a href="https://github.com/jtolio/viricide">game I made in Pygame</a> back in
college, so naturally, I wanted to first get modern Python 3 and Pygame working on
it.</p>

<p>If you want to ignore my work log and just skip to the files, at the bottom
I have premade files for you so you can install Python programs on your Miyoo
A30 by just copying some things onto your SD card.</p>

<h2 id="game-plan:8d57e4422a6e5ed1f965c5d347001476">Game plan</h2>

<ul>
<li>Install the latest software and software drivers on the Miyoo A30</li>
<li>Get Debian running in a chroot</li>
<li>Override drivers so the hardware works</li>
<li>Tell spruceOS how to start the programs</li>
</ul>

<h3 id="upgrading-the-miyoo-a30:8d57e4422a6e5ed1f965c5d347001476">Upgrading the Miyoo A30</h3>

<p>First step, the software that comes on this little device is garbage, so you want to
replace that.</p>

<p>The internet
seems to think that <a href="https://spruceui.github.io/">spruceOS</a> is currently the best
custom image you can get for the A30, and it is quite nice. It doesn’t come with
Python or Pygame, but it does come with firmware upgrade software (so that your WiFi
drivers are the latest), and also comes with all of the latest and greatest
emulators optimally configured if that’s your thing.</p>

<p>The only downside with running spruceOS is it still uses a Linux 3.x kernel. Using
the provided kernel is a good call since it has the best driver support for the
hardware, but Linux 3.x is missing some syscalls some Debian Bookworm software now
takes for granted. This means that Debian Bookworm’s <code>apt-get</code> won’t work, but
that’s okay, many other things still work, including <code>venv</code> and <code>pip</code>.</p>

<h3 id="debian-in-a-chroot:8d57e4422a6e5ed1f965c5d347001476">Debian in a chroot</h3>

<p>On my laptop, I used <code>debootstrap</code> to create a folder with a Debian system ready to
be configured.</p>

<pre><code>sudo debootstrap --arch=armhf --foreign --variant=minbase --include python3,python3-venv,python3-pip,python3-requests,python3-pygame,nano bookworm ~/miyoo-bookworm/
</code></pre>

<p>Since <code>apt-get</code> doesn’t work, if you’re doing this yourself, make sure to include
any packages you want in your Debian installation in the list above.</p>

<p>Then, on the Miyoo A30, in spruceOS’s advanced configuration, I enabled SSH,
SSHed to the device, then created an ext4 filesystem on the SD card and mounted
it:</p>

<pre><code>dd if=/dev/zero of=bookworm-python.img bs=4096 count=$((1024*256))
mkfs.ext4 bookworm-python.img
mkdir bookworm-python
mount -o loop bookworm-python.img bookworm-python
</code></pre>

<p>Then, I <code>scp</code>ed all of the contents of my laptop’s <code>miyoo-bookworm</code> folder into
that new loopback mountpoint.</p>

<p>Finally, I ran this on the Miyoo to finish the Debian installation:</p>

<pre><code>chroot bookworm-python
/debootstrap/debootstrap --second-stage
</code></pre>

<p>Tada! Debian works! Python works!</p>

<h3 id="graphics-and-input-drivers:8d57e4422a6e5ed1f965c5d347001476">Graphics and input drivers</h3>

<p>Okay, so Pygame doesn’t really work yet, since the Debian installation doesn’t
have the right SDL drivers or GPU drivers. The spruceOS installation does
though.</p>

<p>Inside the Debian filesystem, I made <code>/usr/local/lib/miyoo-overrides</code>. Then I
copied the following libraries from the spruceOS parent filesystem’s
<code>/usr/lib/miyoo</code> folder into the Debian filesystem’s <code>miyoo-overrides</code> folder
that I just made: <code>libEGL.so*</code>, <code>libGLESv1_CM.so*</code>, <code>libGLESv2.so*</code>, <code>libMali.so</code>, <code>libSDL2-2.0.so*</code>, and <code>libudev.so*</code>. Note that all of the <code>libEGL</code> and <code>libGLES</code> libraries are actually just symlinks to <code>libMali.so</code>.</p>

<p>I reentered the chroot and ran:</p>

<pre><code>echo /usr/local/lib/miyoo-overrides/ &gt; /etc/ld.so.conf.d/00-miyoo-overrides.conf
ldconfig
</code></pre>

<p>This makes it so all programs inside the chroot can find the spruceOS provided
video and input libraries.</p>

<h3 id="get-the-python-apps-to-show-up-in-spruceos:8d57e4422a6e5ed1f965c5d347001476">Get the Python apps to show up in spruceOS</h3>

<p>First we need a tool for safely entering the chroot while still having all of
the kernel devices and filesystems show up appropriately. Here is
<code>run-inside.sh</code> which will start a program inside the chroot, making sure it
is set up right.</p>

<pre><code>#!/bin/sh

BASE=/mnt/SDCARD/bookworm-python3.img
ROOT=/mnt/SDCARD/bookworm-python3

mount &gt; /tmp/current-mounts
if ! grep -q $ROOT /tmp/current-mounts; then
  mkdir -p $ROOT
  mount -o loop $BASE $ROOT
  for dir in /dev /proc /sys /tmp /dev/pts /mnt/SDCARD; do
    mkdir -p $ROOT$dir
    mount -o loop $dir $ROOT$dir
  done
  mkdir -p $ROOT/mnt/root
  mount -o loop / $ROOT/mnt/root
fi

rm /tmp/current-mounts

command=&#34;$1&#34;
shift
if [ &#34;x$command&#34; == &#34;x&#34; ]; then
  command=&#34;/bin/bash&#34;
fi

exec chroot $ROOT/ /usr/bin/env \
  LD_LIBRARY_PATH= \
  PATH=/usr/sbin:/usr/bin:/sbin:/bin \
  SHELL=/bin/bash \
  &#34;$command&#34; &#34;$@&#34;
</code></pre>

<p>Now, we need a sample Pygame app. I used <a href="https://github.com/pcorbel/hello-miyoo/blob/main/app/app.py">this one</a> for testing. I put this project’s <code>app.py</code>
on my SD card.</p>

<p>Finally, you need to make a script on the SD card inside <code>Roms/PORTS</code>. Here
is <code>hello-miyoo.sh</code>:</p>

<pre><code>#!/bin/sh

exec /mnt/SDCARD/run-inside.sh python3 /mnt/SDCARD/app.py
</code></pre>

<p>When you next open your Miyoo spruceOS UI, There will be an entry named after
this script (<code>hello-miyoo</code>) in the “Ports” section of the “Games” category!</p>

<h2 id="what-doesn-t-work:8d57e4422a6e5ed1f965c5d347001476">What doesn’t work</h2>

<p>Mostly, this works great! All of the buttons are recognized by Pygame,
Pygame gets GPU acceleration, sound works, etc.</p>

<p>Unfortunately, the screen is rotated 90 degrees. With some other spruceOS
provided builds of libSDL2, the screen isn’t rotated, but GPU acceleration is
disabled and many other things are broken.</p>

<p>If anyone has an idea of how to fix this, please <a href="https://www.jtolio.com/contact/">let me know!</a></p>

<p>For now, I am simply using Pygame to rotate my screen another 90 degrees.</p>

<h2 id="all-the-files:8d57e4422a6e5ed1f965c5d347001476">All the files</h2>

<ul>
<li><a href="https://link.storjshare.io/s/jxrcn4q6yfstkrkmub4p46eghppa/miyoo-a30/bookworm-python3.img.gz?download=1">bookworm-python3.img.gz</a> - 384MiB when extracted, the full Debian Bookworm install that comes with Python 3, Pygame, and Miyoo drivers.</li>
<li><a href="https://link.storjshare.io/s/jxrcn4q6yfstkrkmub4p46eghppa/miyoo-a30/run-inside.sh?download=1">run-inside.sh</a> - The tool for safely mounting and entering the Debian Bookworm image.</li>
<li><a href="https://link.storjshare.io/s/jxrcn4q6yfstkrkmub4p46eghppa/miyoo-a30/sammygame.zip?download=1">sammygame.zip</a> - a small Sokoban game featuring my son’s hamster.</li>
<li><a href="https://link.storjshare.io/s/jxrcn4q6yfstkrkmub4p46eghppa/miyoo-a30/run-app.sh?download=1">run-app.sh</a> - An example script for placement in the spruceOS <code>Roms/PORTS</code> folder.</li>
</ul>

</div></div>
  </body>
</html>
