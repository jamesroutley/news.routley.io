<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://microsoft.github.io/verona/pyrona.html">Original</a>
    <h1>Project Verona: Fearless Concurrency for Python</h1>
    
    <div id="readability-page-1" class="page"><div id="main_content_wrap">
      <section id="main_content">
        

<p>As part of Project Verona, we have been developing a new ownership model for Python, called Lungfish.
This model is designed to provide a safe and efficient way to manage memory and concurrency in Python programs.
This page explains our experiments to develop this approach.</p>

<h2 id="plan-for-python">Plan for Python</h2>

<h3 id="quick-prototyping-in-frankenscript">Quick prototyping in FrankenScript</h3>

<p>Modifying a production language is a complex task.
As an initial step, we have been developing a toy language called <a href="https://github.com/fxpl/frankenscript">FrankenScript</a> that allows us to quickly prototype our ideas for region-based ownership.
FrankenScript is a small language that is designed to be easy to modify and extend.
It is based on the ideas of ownership and concurrency that we are exploring in Project Verona, but where all the checks are dynamic.</p>

<p>This prototype has given us confidence in the conceptual ideas behind our ownership model, and has allowed us to explore the design space of ownership in a dynamic language.
It has also helped us explain our ideas and the different design decisions to people outside the Project Verona team.</p>

<p>FrankenScript generates a series of mermaid diagrams that show the region structure of the program.  An example of this is shown below:</p>

<p><img src="https://microsoft.github.io/verona/assets/images/mermaidexample.svg" alt="mermaidexample"/></p>



<p>Over the last two years, we have been engaging with the Faster CPython team at Microsoft as a sounding board for our ideas.
In May 2025, we will be taking our first steps into the boarder Python community at the <a href="https://us.pycon.org/2025/events/language-summit/">Python Language Summit</a>.
The presentation that we gave on the Python language summit can be found <a href="https://wrigstad.com/summit-presentation-final.pdf">here</a>.
We are seeking feedback from the core developers and broader community behind the language.</p>

<h3 id="steps-to-a-new-ownership-model">Steps to a new ownership model</h3>

<p>Building an ownership model for Python is a complex task, and we are taking a step-by-step approach to ensure that we get it right.</p>

<p>The first step is actually to build a concept of deep immutability into Python.  This can be split into three parts:</p>

<ul>
  <li>
    <p>Deep Immutability: We are starting with a deep immutability model, we have been drafting a <a href="https://github.com/TobiasWrigstad/peps/pull/8">PEP</a> to describe this model.
The current prototype is in a PR to a fork of CPython 3.12: https://github.com/mjp41/cpython/pull/51</p>
  </li>
  <li>
    <p>Manage cyclic immutable garbage with reference counting and 
atomic reference counting of immutable objects. This will enable objects to be moved between sub-interpreters as they will no longer be managed by the interpreter local cycle collector.
The current prototype is on the following branch: https://github.com/mjp41/cpython/tree/scc, which is based on top of the PR 51 mentioned above.</p>
  </li>
  <li>
    <p>Integration with message passing between sub-interpreters (<a href="https://peps.python.org/pep-0734/">PEP734</a>).  This will enable us to get parallel performance even though we are technically not losing the GIL.</p>
  </li>
</ul>

<p>Deep Immutability is a key part of any ownership model as we need concurrent threads to be able to share type information without risking it being mutated under foot.
As types in Python are mutable objects, we need a way to share these objects between threads.</p>

<p>Once the immutability model is in place, then we can start applying the region-based ownership model to Python to permit safe sharing and transfer of mutable state.
This involves applying the ideas developed in the FrankenScript prototype to Python.
We have made progress on this in our prototyping ideas on CPython, but nothing is ready to try yet.</p>

<h2 id="faq">FAQ</h2>

<h3 id="why-python">Why Python?</h3>

<p>Python is the most popular programming language in the world.
With <a href="https://peps.python.org/pep-0703/">PEP703</a>, aka NoGil or “Free-Threaded” Python, Python is moving to a fully concurrent model.
This means a vast quantity of programmers will be potentially exposed to concurrency issues.
Bringing an ownership model to Python will help to make it easier to write concurrent programs, and to avoid the pitfalls of concurrency.</p>

<p>This is a perfect opportunity to influence the future of Python, and to help make programming experience better for everyone.</p>

<h3 id="why-not-threads-and-locks">Why not threads and locks?</h3>

<p>We are initially exploring using message passing between sub-interpreters.  However, we could also apply the region ideas to locks, and provide a lock that gives temporary access to a region of memory associated with that lock.</p>

<p>We have sketched out a design for how to integrate with the full PEP 703 work, but have not attempted to implement that yet.</p>

<h3 id="why-not-simply-use-rusts-ownership-model">Why not simply use Rust’s ownership model?</h3>

<p>Rust’s ownership model is designed for a statically typed language, and restricts the type of object graphs that can be used in the language.
There is so much existing code in Python that the restrictions of Rust’s ownership model would be too limiting.
We are designing a new ownership model based on regions that is designed to work with Python’s dynamic typing and existing object graphs.</p>

<p>Our approach draws heavily from the experience of languages with ownership models like Rust, Cyclone Encore, and Pony, but is based completely on dynamic checks.  This completely alters the kind of things that can be checked in comparison to a statically typed approach.</p>

<h3 id="what-has-project-verona-learnt-from-this-work">What has Project Verona learnt from this work?</h3>

<p>Performing ownership research in a dynamically typed language has been a massive learning experience for the Project Verona team.
It has challenged every assumption we have made about ownership and concurrency in a statically typed language.
Moreover, it has shown us certain programming patterns that are really easy to check in a dynamic region system, but are really hard to check in a statically typed language.
We are currently re-evaluating the balance between the static and dynamic checks in our ownership model, and how to best combine them.  Hopefully, we will be able to bring some of these ideas back into the Project Verona research language.</p>

<h3 id="where-can-i-find-out-more">Where can I find out more?</h3>

<p>We have a detailed list of publications related to Project Verona on our <a href="https://microsoft.github.io/verona/publications.html">publications page</a>.
The most relevant paper to this work is <a href="https://www.microsoft.com/en-us/research/publication/dynamic-region-ownership-for-concurrency-safety/">Dynamic Region Ownership for Concurrency Safety</a>.</p>

<p>You can try our toy language, <a href="https://github.com/fxpl/frankenscript">FrankenScript</a>.
We also provide a <a href="https://github.com/microsoft/verona-artifacts/tree/main/frankenscript">docker container</a> to test FrankenScript quickly.</p>

<p>We are also working on several forks of Python that implement our ideas, these are currently on <a href="https://github.com/mjp41/cpython">GitHub</a>.</p>

<h3 id="how-can-i-get-involved--who-can-i-talk-to">How can I get involved?  Who can I talk to?</h3>

<p>We have listed a few places where you can find parts of the project that are available.
If you want to find out more about those, raise issues on the appropriate GitHub repo.</p>

<p>If it is more general, please raise an issue on the <a href="https://github.com/microsoft/verona/">Project Verona Github repo</a>,
or you can join our discussions list <a href="https://lists.uu.se/sympa/info/lungfish">lungfish@lists.uu.se</a>.</p>

      </section>
    </div></div>
  </body>
</html>
