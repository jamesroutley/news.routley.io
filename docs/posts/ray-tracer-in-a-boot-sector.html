<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/nanochess/RayTracer">Original</a>
    <h1>Ray tracer in a boot sector</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><em>by Oscar Toledo G. Apr/12/2024</em></p>
<p dir="auto"><a href="http://nanochess.org" rel="nofollow">http://nanochess.org</a></p>
<p dir="auto"><a href="https://github.com/nanochess">https://github.com/nanochess</a></p>

<p dir="auto">This is a port of the amazing Ray Tracer in Atari 8-bit BASIC by D. Scott Williamson. You can see it at <a href="https://bunsen.itch.io/raytrace-movie-atari-8bit-by-d-scott-williamson" rel="nofollow">https://bunsen.itch.io/raytrace-movie-atari-8bit-by-d-scott-williamson</a></p>
<p dir="auto">This was based on a static BBC micro version by <a href="https://mastodon.social/@coprolite9000@mastodon.me.uk" rel="nofollow">@coprolite9000</a> (see <a href="https://bbcmic.ro/?t=9ctpk" rel="nofollow">https://bbcmic.ro/?t=9ctpk</a>) that was based on <a href="https://twitter.com/Kweepa" rel="nofollow">@kweepa</a>&#39;s original one (see <a href="https://x.com/bbcmicrobot/status/1322988586828849152" rel="nofollow">whole X thread</a>), however at this point it looks like the program cannot be decoded back.</p>
<p dir="auto">I asked Williamson for permission to make a port to a boot sector, and here it is. I was running around 590 bytes until I found a duplicated calculation that could be made into a subroutine. The code isn&#39;t exactly the same because I changed some constants to adapt it, and also collapsed some to save bytes. Anyway, I&#39;m pretty happy I finally found good use for the VGA palette!</p>
<p dir="auto">If you are going to run it in real hardware it requires a minimum of a Pentium Pro, otherwise most modern emulators will be able to run it.</p>
<p dir="auto">One of the biggest surprises is how so fast are modern computers so technically the animation is real-time in my Macbook Air running the ray tracer in Windows XP under VirtualBox. You can see it on <a href="https://www.youtube.com/watch?v=AZdzECF2Huw" rel="nofollow">Youtube</a>.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/nanochess/RayTracer/blob/master/RayTracer_animated.gif"><img src="https://github.com/nanochess/RayTracer/raw/master/RayTracer_animated.gif" alt="Ray tracer in a boot sector animation" data-animated-image=""/></a></p>

<p dir="auto">If you want to assemble it, you must download the Netwide Assembler (NASM) from <a href="http://www.nasm.us" rel="nofollow">www.nasm.us</a></p>
<p dir="auto">Use this command line:</p>
<div data-snippet-clipboard-copy-content="nasm -f bin ray.asm -Dcom_file=1 -o ray.com
nasm -f bin ray.asm -Dcom_file=0 -o ray.img"><pre><code>nasm -f bin ray.asm -Dcom_file=1 -o ray.com
nasm -f bin ray.asm -Dcom_file=0 -o ray.img
</code></pre></div>
<p dir="auto">Tested with VirtualBox for macOS running Windows XP and also executing directly the bootsector. It probably works with QEMU:</p>
<div data-snippet-clipboard-copy-content="qemu-system-x86_64 -fda ray.img"><pre><code>qemu-system-x86_64 -fda ray.img
</code></pre></div>
<p dir="auto">Because DOSBox-X runs very slowly, I further tested with VirtualBox over Windows 11 (Asus TUF F17), created a Windows XP 32-bit machine (you don&#39;t need to install Windows nor a hard disk image), in Configuration/Storage in the bottom there is a icon saying &#34;Add controller&#34;, choose I82078 (floppy), then click &#34;Add floppy drive&#34;, and select the boot sector as image (ray.img).</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/nanochess/RayTracer/blob/master/RayTracer.png"><img src="https://github.com/nanochess/RayTracer/raw/master/RayTracer.png" alt="Ray tracer in a boot sector"/></a></p>

<p dir="auto">Thanks to Peter Ferrie for helping me to save 23 bytes (my original program was 506 bytes, now it is 483 bytes).</p>
<p dir="auto">Thanks to birdie-github for contributing the animated GIF of the ray tracer.</p>

<p dir="auto">Do you want to learn 8086/8088 assembler? Get my books Programming Boot Sector Games containing an 8086/8088 crash course! Also available More Boot Sector Games. Now available from Lulu and Amazon!</p>
</article></div></div>
  </body>
</html>
