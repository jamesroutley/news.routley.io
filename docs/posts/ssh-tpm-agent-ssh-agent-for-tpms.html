<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/Foxboron/ssh-tpm-agent">Original</a>
    <h1>Show HN: ssh-tpm-agent â€“ SSH agent for TPMs</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><code>ssh-tpm-agent</code> is a ssh-agent compatible agent that allows keys to be created
by the Trusted Platform Module (TPM) for authentication towards ssh servers.</p>
<p dir="auto">TPM sealed keys are private keys created inside the Trusted Platform Module
(TPM) and sealed in <code>.tpm</code> suffixed files. They are bound to the hardware they
where produced on and can&#39;t be transferred to other machines.</p>
<p dir="auto">This allows one to utilize a native client instead of having to side load
existing PKCS11 libraries into the ssh-agent and/or ssh client.</p>

<ul dir="auto">
<li>A working <code>ssh-agent</code>.</li>
<li>Keys created on the TPM, sealed outside of it.</li>
<li>PIN support.</li>
<li>TPM session encryption.</li>
</ul>

<p dir="auto">The key format and technical details might change between iterations.  Consider
this agent experimental.</p>
<p dir="auto">Instead of utilizing the TPM directly, you can use <code>--swtpm</code> or <code>export SSH_TPM_AGENT_SWTPM=1</code> to create a identity backed by
<a href="https://github.com/stefanberger/swtpm">swtpm</a> which will be stored under
<code>/var/tmp/ssh-tpm-agent</code>.</p>
<p dir="auto">Note that <code>swtpm</code> provides no security properties and should only be used for
testing.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-installation" aria-hidden="true" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h2>
<p dir="auto">The simplest way of installing this plugin is by running the follow go command.</p>
<p dir="auto"><code>go install github.com/Foxboron/ssh-tpm-agent/cmd/...@latest</code></p>
<p dir="auto">Alternatively download the <a href="https://github.com/foxboron/ssh-tpm-plugin/releases">pre-built binaries</a>.</p>

<div dir="auto" data-snippet-clipboard-copy-content="# Create key
$ ssh-tpm-keygen
Generating a sealed public/private ecdsa key pair.
Enter file in which to save the key (/home/fox/.ssh/id_ecdsa):
Enter pin (empty for no pin):
Enter same pin again:
Your identification has been saved in /home/fox/.ssh/id_ecdsa.tpm
Your public key has been saved in /home/fox/.ssh/id_ecdsa.pub
The key fingerprint is:
SHA256:NCMJJ2La+q5tGcngQUQvEOJP3gPH8bMP98wJOEMV564
The key&#39;s randomart image is the color of television, tuned to a dead channel.

$ cat /home/fox/.ssh/id_ecdsa.pub
ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOTOsMXyjTc1wiQSKhRiNhKFsHJNLzLk2r4foXPLQYKR0tuXIBMTQuMmc7OiTgNMvIjMrcb9adgGdT3s+GkNi1g=

# Using the socket
$ ssh-tpm-agent -l /var/tmp/tpm.sock

$ export SSH_AUTH_SOCK=&#34;/var/tmp/tpm.sock&#34; ssh git@github.com"><pre><span><span>#</span> Create key</span>
$ ssh-tpm-keygen
Generating a sealed public/private ecdsa key pair.
Enter file <span>in</span> which to save the key (/home/fox/.ssh/id_ecdsa):
Enter pin (empty <span>for</span> no pin):
Enter same pin again:
Your identification has been saved <span>in</span> /home/fox/.ssh/id_ecdsa.tpm
Your public key has been saved <span>in</span> /home/fox/.ssh/id_ecdsa.pub
The key fingerprint is:
SHA256:NCMJJ2La+q5tGcngQUQvEOJP3gPH8bMP98wJOEMV564
The key<span><span>&#39;</span>s randomart image is the color of television, tuned to a dead channel.</span>
<span></span>
<span>$ cat /home/fox/.ssh/id_ecdsa.pub</span>
<span>ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOTOsMXyjTc1wiQSKhRiNhKFsHJNLzLk2r4foXPLQYKR0tuXIBMTQuMmc7OiTgNMvIjMrcb9adgGdT3s+GkNi1g=</span>
<span></span>
<span># Using the socket</span>
<span>$ ssh-tpm-agent -l /var/tmp/tpm.sock</span>
<span></span>
<span>$ export SSH_AUTH_SOCK=&#34;/var/tmp/tpm.sock&#34; ssh git@github.com</span></pre></div>

<p dir="auto">It is possible to use the public keys created by <code>ssh-tpm-keygen</code> inside ssh
configurations.</p>
<p dir="auto">The below example uses <code>ssh-tpm-agent</code> and also passes the public key to ensure
not all identities are leaked from the agent.</p>
<div data-snippet-clipboard-copy-content="Host example.com
    IdentityAgent $SSH_AUTH_SOCK

Host *
    IdentityAgent /var/tmp/tpm.sock
    IdentityFile ~/.ssh/id_ecdsa.pub"><pre><code>Host example.com
    IdentityAgent $SSH_AUTH_SOCK

Host *
    IdentityAgent /var/tmp/tpm.sock
    IdentityFile ~/.ssh/id_ecdsa.pub
</code></pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-license" aria-hidden="true" href="#license"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>License</h2>
<p dir="auto">Licensed under the MIT license. See <a href="https://github.com/Foxboron/ssh-tpm-agent/blob/master/LICENSE">LICENSE</a> or <a href="http://opensource.org/licenses/MIT" rel="nofollow">http://opensource.org/licenses/MIT</a></p>
</article>
          </div></div>
  </body>
</html>
