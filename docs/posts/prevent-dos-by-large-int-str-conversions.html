<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/python/cpython/issues/95778">Original</a>
    <h1>Prevent DoS by large int-str conversions</h1>
    
    <div id="readability-page-1" class="page"><div disabled="" sortable="">
<div>
          <p dir="auto">This is appalling.</p>
<p dir="auto">Situation: people pass untrusted data to slow built-in functions. Reasonable solution: a) patch vulnerable programs, b) optimize said functions. CPython&#39;s solution: just limit stuff.</p>
<p dir="auto">Your rationale is founded on the fact that developers constantly add bugs and fixing them is not an option. Fixing bugs is like, more than half of what developers normally do.</p>
<p dir="auto">When ReDoS was discovered, did we limit the number of iterations of the matching algorithm? No. Then why should we do the same here? There are dangerous tools, but they are often much more useful due to lack of artificial limits. When did we drop &#34;Special cases aren&#39;t special enough to break the rules.&#34;</p>
<p dir="auto">To add insult to injury, people seem to be talking about limiting <code>repr</code> too. How many bugs that will cause, I can&#39;t tell: I saw people use <code>repr(...)</code> to generate non-Python code as a universal solution that works with both integers and strings, and I foresee problems when it starts generating non-digit strings.</p>
<p dir="auto">You&#39;re limiting integer to string conversions. How soon are you going to limit <code>repr(list)</code> because of the billion laughs attack?</p>
<p dir="auto">Why is <code>_PY_LONG_MAX_STR_DIGITS_THRESHOLD</code> even a constant? No one&#39;s going to recompile Python, and if people actually start using this security &#34;feature&#34;, chances are it&#39;ll be enabled everywhere, and then programs that use big arithmetic and parse numbers from the user input will silently stop working. It&#39;s not even <em>big</em> arithmetic, really: the discussed limit to <code>repr</code> seems to be only 512 bit, which is much less than thousands-of-bits numbers used in cryptography <em>right now, in Python</em>. In fact, the problem doesn&#39;t go away if it&#39;s variable: the problem is that it&#39;s global, affecting the whole application rather than the user-facing part. When did we drop &#34;Explicit is better than implicit?&#34;</p>
<p dir="auto">And then, has anyone actually researched how much trusted code parses integers from untrusted sources directly? To me it seems that even ReDoS should be more popular than this. I think people seldom call <code>int</code> on user input directly: they either use parsing libraries like <code>json</code> and <code>yaml</code>, or (hear me out) use (web) frameworks that parse the data themselves. Either way, there&#39;s a finite number of places where checks should be added, and even if it&#39;s tens of places, it&#39;s so much better than limiting <em>every single program</em>, including those that don&#39;t even face the outer world, because it&#39;ll be actually configurable.</p>
<p dir="auto">I don&#39;t think I even understand why a limit is added in the first place. If Python used a quadratic algorithm for multiplication instead of FFT, that would not be considered a vulnerability but an inefficiency. There are much faster algorithms than the one used by CPython, I literally found one by googling &#34;subquadratic base conversion&#34;. There: <a href="https://members.loria.fr/PZimmermann/mca/mca-cup-0.5.9.pdf" rel="nofollow"><em>Richard P. Brent and Paul Zimmermann</em>, Modern Computer Arithmetic</a>. <a data-error-text="Failed to load title" data-id="1199074143" data-permission-text="Title is private" data-url="https://github.com/python/cpython/issues/90716" data-hovercard-type="issue" data-hovercard-url="/python/cpython/issues/90716/hovercard" href="https://github.com/python/cpython/issues/90716">#90716</a>, the issue that was tracking this, was dropped because what, developers tried to invent stuff themselves instead of comparing with state of art, and just chose the simplest option after an inevitable failure?</p>
      </div>
</div></div>
  </body>
</html>
