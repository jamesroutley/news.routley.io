<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/LeonHartley/Coerce-rs">Original</a>
    <h1>Show HN: Coerce â€“ Distributed actor framework in Rust</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">Coerce-rs is an asynchronous (async/await) Actor runtime and distributed system framework for Rust. It allows for
extremely simple yet powerful actor-based distributed system development. With minimal code, you can build a highly
scalable, fault-tolerant modern actor-driven application.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-crates" aria-hidden="true" href="#crates"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Crates</h2>
<table>
<thead>
<tr>
<th><strong>Crate</strong></th>
<th><strong>Purpose</strong></th>
<th><strong>Latest Version</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://crates.io/crates/coerce" rel="nofollow">coerce</a></td>
<td>The main Coerce runtime and framework</td>
<td><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/f300dd794d4dc442541df0a6f2f11779aa91820dd7782a4ce1896e4eca70c36a/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f636f657263652e737667"><img src="https://camo.githubusercontent.com/f300dd794d4dc442541df0a6f2f11779aa91820dd7782a4ce1896e4eca70c36a/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f636f657263652e737667" alt="crates.io" data-canonical-src="https://img.shields.io/crates/v/coerce.svg"/></a></td>
</tr>
<tr>
<td><a href="https://crates.io/crates/coerce-redis" rel="nofollow">coerce-redis</a></td>
<td>Actor persistence provider for Redis. Enables event source and snapshots to be read and written from Redis.</td>
<td><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/c293d3d86e8281cec7d75a2b1be6097cfb2da466fd0abfeb368bb3d610b123ed/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f636f657263652d72656469732e737667"><img src="https://camo.githubusercontent.com/c293d3d86e8281cec7d75a2b1be6097cfb2da466fd0abfeb368bb3d610b123ed/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f636f657263652d72656469732e737667" alt="crates.io" data-canonical-src="https://img.shields.io/crates/v/coerce-redis.svg"/></a></td>
</tr>
<tr>
<td><a href="https://crates.io/crates/coerce-macros" rel="nofollow">coerce-macros</a></td>
<td>Useful macros allowing for quick implementations of snapshots, JSON-serialisable remote messages and more.</td>
<td><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/72554c72ccd2d6daaf32e7a51d1850291be117443773b324242fe92f881d1130/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f636f657263652d6d6163726f732e737667"><img src="https://camo.githubusercontent.com/72554c72ccd2d6daaf32e7a51d1850291be117443773b324242fe92f881d1130/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f636f657263652d6d6163726f732e737667" alt="crates.io" data-canonical-src="https://img.shields.io/crates/v/coerce-macros.svg"/></a></td>
</tr>
<tr>
<td><a href="https://crates.io/crates/coerce-k8s" rel="nofollow">coerce-k8s</a></td>
<td>Kubernetes discovery provider, automatically discover cluster peers hosted in Kubernetes, based on a configurable pod-selection label</td>
<td><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/dd7df1441b1092f6626d15e1a8d69738ba986c52ac2e3fb0b9e3a6f1d24c6570/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f636f657263652d6b38732e737667"><img src="https://camo.githubusercontent.com/dd7df1441b1092f6626d15e1a8d69738ba986c52ac2e3fb0b9e3a6f1d24c6570/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f636f657263652d6b38732e737667" alt="crates.io" data-canonical-src="https://img.shields.io/crates/v/coerce-k8s.svg"/></a></td>
</tr>
</tbody>
</table>
<h2 tabindex="-1" dir="auto"><a id="user-content-features" aria-hidden="true" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Features</h2>
<h3 tabindex="-1" dir="auto"><a id="user-content-actors" aria-hidden="true" href="#actors"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Actors</h3>
<ul dir="auto">
<li>Type-safe actors</li>
<li>Supervision / child spawning</li>
<li>Location-transparent <code>ActorRef&lt;A&gt;</code> types (ActorRef may comprise of a <code>LocalActorRef&lt;A&gt;</code> or a <code>RemoteActorRef&lt;A&gt;</code>)</li>
<li>Metrics available out of the box</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-remoting" aria-hidden="true" href="#remoting"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Remoting</h2>
<ul dir="auto">
<li>Communicate with an actor from anywhere in the cluster</li>
<li>Actors can be deployed locally or to other remote nodes</li>
<li>Protobuf network protocol</li>
<li>Actor-driven networking layer</li>
</ul>
<h3 tabindex="-1" dir="auto"><a id="user-content-distributed-sharding" aria-hidden="true" href="#distributed-sharding"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Distributed Sharding</h3>
<ul dir="auto">
<li>Actor IDs can resolve to specific shards, which can be spread across a cluster of Coerce nodes</li>
<li>Automatic load balancing, shards will be fairly allocated across the cluster</li>
<li>Self-recovering when nodes are lost, actors can be automatically restarted on other healthy nodes</li>
</ul>
<h3 tabindex="-1" dir="auto"><a id="user-content-persistence" aria-hidden="true" href="#persistence"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Persistence</h3>
<ul dir="auto">
<li>Journaling / event sourcing</li>
<li>Snapshotting</li>
<li>Pluggable storage providers (in-memory and redis readily available, MySQL is planned)</li>
</ul>
<h3 tabindex="-1" dir="auto"><a id="user-content-distributed-pubsub" aria-hidden="true" href="#distributed-pubsub"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Distributed PubSub</h3>
<ul dir="auto">
<li>Actors can subscribe to programmable topics from anywhere in the cluster</li>
<li>System-level topic provided to receive updated system state (e.g new nodes joining, nodes lost etc.)</li>
</ul>
<h3 tabindex="-1" dir="auto"><a id="user-content-http-api" aria-hidden="true" href="#http-api"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>HTTP API</h3>
<ul dir="auto">
<li>Easily accessible metrics and information useful for diagnosis</li>
</ul>

<p dir="auto">Building Coerce is easy. All you need is the latest Rust stable or nightly installed, along with Cargo.</p>
<div dir="auto" data-snippet-clipboard-copy-content="# Clone the repository
git clone https://github.com/leonhartley/coerce-rs &amp;&amp; cd coerce-rs

## run Cargo build to build the entire workspace, including the examples and the tests
cargo build

## Alternatively, if you&#39;d like to build the library, dependencies and run the tests
cargo test"><pre><span><span>#</span> Clone the repository</span>
git clone https://github.com/leonhartley/coerce-rs <span>&amp;&amp;</span> <span>cd</span> coerce-rs

<span><span>#</span># run Cargo build to build the entire workspace, including the examples and the tests</span>
cargo build

<span><span>#</span># Alternatively, if you&#39;d like to build the library, dependencies and run the tests</span>
cargo <span>test</span></pre></div>

<h3 tabindex="-1" dir="auto"><a id="user-content-sharded-chat-example" aria-hidden="true" href="#sharded-chat-example"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Sharded Chat example</h3>

<p dir="auto">Every actor belongs to an ActorSystem.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-asyncawait-actors" aria-hidden="true" href="#asyncawait-actors"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>async/await Actors</h3>
<p dir="auto">An actor is just another word for a unit of computation. It can have mutable state, it can receive messages and perform
actions. One caveat though.. It can only do one thing at a time. This can be useful because it can alleviate the need
for thread synchronisation, usually achieved by locking (using <code>Mutex</code>, <code>RwLock</code> etc).</p>
<h4 tabindex="-1" dir="auto"><a id="user-content-how-is-this-achieved-in-coerce" aria-hidden="true" href="#how-is-this-achieved-in-coerce"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>How is this achieved in Coerce?</h4>
<p dir="auto">Coerce uses Tokio&#39;s MPSC channels (<a href="https://docs.rs/tokio/0.2.4/tokio/sync/mpsc/fn.channel.html" rel="nofollow">tokio::sync::mpsc::channel</a>), every actor created spawns a task listening
to messages from a
<code>Receiver</code>, handling and awaiting the result of the message. Every reference (<code>ActorRef&lt;A: Actor&gt;</code>) holds
a <code>Sender&lt;M&gt; where A: Handler&lt;M&gt;</code>, which can be cloned.</p>
<p dir="auto">Actors can be stopped and actor references can be retrieved by ID from anywhere in your application. IDs are <code>String</code>
but if an ID isn&#39;t provided upon creation, a new <code>Uuid</code> will be generated. Anonymous actors are automatically dropped (
and <code>Stopped</code>)
when all references are dropped. Tracked actors (using global fn <code>new_actor</code>) must be stopped.</p>
<details>
  <summary>Basic ActorSystem + EchoActor example</summary>
<h3 tabindex="-1" dir="auto"><a id="user-content-example" aria-hidden="true" href="#example"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Example</h3>
<div dir="auto" data-snippet-clipboard-copy-content="pub struct EchoActor {}

#[async_trait]
impl Actor for EchoActor {}

pub struct EchoMessage(String);

impl Message for EchoMessage {
    type Result = String;
}

#[async_trait]
impl Handler&lt;EchoMessage&gt; for EchoActor {
    async fn handle(
        &amp;mut self,
        message: EchoMessage,
        _ctx: &amp;mut ActorContext,
    ) -&gt; String {
        message.0.clone()
    }
}

pub async fn run() {
    let mut actor = new_actor(EchoActor {}).await.unwrap();

    let hello_world = &#34;hello, world&#34;.to_string();
    let result = actor.send(EchoMessage(hello_world.clone())).await;

    assert_eq!(result, Ok(hello_world));
}"><pre><span>pub</span> <span>struct</span> <span>EchoActor</span> <span>{</span><span>}</span>

<span>#<span>[</span>async_trait<span>]</span></span>
<span>impl</span> <span>Actor</span> <span>for</span> <span>EchoActor</span> <span>{</span><span>}</span>

<span>pub</span> <span>struct</span> <span>EchoMessage</span><span>(</span><span>String</span><span>)</span><span>;</span>

<span>impl</span> <span>Message</span> <span>for</span> <span>EchoMessage</span> <span>{</span>
    <span>type</span> <span>Result</span> = <span>String</span><span>;</span>
<span>}</span>

<span>#<span>[</span>async_trait<span>]</span></span>
<span>impl</span> <span>Handler</span><span>&lt;</span><span>EchoMessage</span><span>&gt;</span> <span>for</span> <span>EchoActor</span> <span>{</span>
    <span>async</span> <span>fn</span> <span>handle</span><span>(</span>
        <span>&amp;</span><span>mut</span> <span>self</span><span>,</span>
        <span>message</span><span>:</span> <span>EchoMessage</span><span>,</span>
        <span>_ctx</span><span>:</span> <span>&amp;</span><span>mut</span> <span>ActorContext</span><span>,</span>
    <span>)</span> -&gt; <span>String</span> <span>{</span>
        message<span>.</span><span>0</span><span>.</span><span>clone</span><span>(</span><span>)</span>
    <span>}</span>
<span>}</span>

<span>pub</span> <span>async</span> <span>fn</span> <span>run</span><span>(</span><span>)</span> <span>{</span>
    <span>let</span> <span>mut</span> actor = <span>new_actor</span><span>(</span><span>EchoActor</span> <span>{</span><span>}</span><span>)</span><span>.</span><span>await</span><span>.</span><span>unwrap</span><span>(</span><span>)</span><span>;</span>

    <span>let</span> hello_world = <span>&#34;hello, world&#34;</span><span>.</span><span>to_string</span><span>(</span><span>)</span><span>;</span>
    <span>let</span> result = actor<span>.</span><span>send</span><span>(</span><span>EchoMessage</span><span>(</span>hello_world<span>.</span><span>clone</span><span>(</span><span>)</span><span>)</span><span>)</span><span>.</span><span>await</span><span>;</span>

    <span>assert_eq</span><span>!</span><span>(</span>result, <span>Ok</span><span>(</span>hello_world<span>)</span><span>)</span><span>;</span>
<span>}</span></pre></div>
<h3 tabindex="-1" dir="auto"><a id="user-content-timer-example" aria-hidden="true" href="#timer-example"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Timer Example</h3>
<div dir="auto" data-snippet-clipboard-copy-content="pub struct EchoActor {}

#[async_trait]
impl Actor for EchoActor {}

pub struct EchoMessage(String);

impl Message for EchoMessage {
    type Result = String;
}

pub struct PrintTimer(String);

impl TimerTick for PrintTimer {}

#[async_trait]
impl Handler&lt;PrintTimer&gt; for EchoActor {
    async fn handle(&amp;mut self, msg: PrintTimer, _ctx: &amp;mut ActorContext) {
        println!(&#34;{}&#34;, msg.0);
    }
}

pub async fn run() {
    let mut actor = new_actor(EchoActor {}).await.unwrap();
    let hello_world = &#34;hello world!&#34;.to_string();

    // print &#34;hello world!&#34; every 5 seconds
    let timer = Timer::start(actor.clone(), Duration::from_secs(5), TimerTick(hello_world));

    // timer is stopped when handle is out of scope or can be stopped manually by calling `.stop()`
    sleep(Duration::from_secs(20)).await;
    timer.stop();
}"><pre><span>pub</span> <span>struct</span> <span>EchoActor</span> <span>{</span><span>}</span>

<span>#<span>[</span>async_trait<span>]</span></span>
<span>impl</span> <span>Actor</span> <span>for</span> <span>EchoActor</span> <span>{</span><span>}</span>

<span>pub</span> <span>struct</span> <span>EchoMessage</span><span>(</span><span>String</span><span>)</span><span>;</span>

<span>impl</span> <span>Message</span> <span>for</span> <span>EchoMessage</span> <span>{</span>
    <span>type</span> <span>Result</span> = <span>String</span><span>;</span>
<span>}</span>

<span>pub</span> <span>struct</span> <span>PrintTimer</span><span>(</span><span>String</span><span>)</span><span>;</span>

<span>impl</span> <span>TimerTick</span> <span>for</span> <span>PrintTimer</span> <span>{</span><span>}</span>

<span>#<span>[</span>async_trait<span>]</span></span>
<span>impl</span> <span>Handler</span><span>&lt;</span><span>PrintTimer</span><span>&gt;</span> <span>for</span> <span>EchoActor</span> <span>{</span>
    <span>async</span> <span>fn</span> <span>handle</span><span>(</span><span>&amp;</span><span>mut</span> <span>self</span><span>,</span> <span>msg</span><span>:</span> <span>PrintTimer</span><span>,</span> <span>_ctx</span><span>:</span> <span>&amp;</span><span>mut</span> <span>ActorContext</span><span>)</span> <span>{</span>
        <span>println</span><span>!</span><span>(</span><span>&#34;{}&#34;</span>, msg.<span>0</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span>

<span>pub</span> <span>async</span> <span>fn</span> <span>run</span><span>(</span><span>)</span> <span>{</span>
    <span>let</span> <span>mut</span> actor = <span>new_actor</span><span>(</span><span>EchoActor</span> <span>{</span><span>}</span><span>)</span><span>.</span><span>await</span><span>.</span><span>unwrap</span><span>(</span><span>)</span><span>;</span>
    <span>let</span> hello_world = <span>&#34;hello world!&#34;</span><span>.</span><span>to_string</span><span>(</span><span>)</span><span>;</span>

    <span>// print &#34;hello world!&#34; every 5 seconds</span>
    <span>let</span> timer = <span>Timer</span><span>::</span><span>start</span><span>(</span>actor<span>.</span><span>clone</span><span>(</span><span>)</span><span>,</span> <span>Duration</span><span>::</span><span>from_secs</span><span>(</span><span>5</span><span>)</span><span>,</span> <span>TimerTick</span><span>(</span>hello_world<span>)</span><span>)</span><span>;</span>

    <span>// timer is stopped when handle is out of scope or can be stopped manually by calling `.stop()`</span>
    <span>sleep</span><span>(</span><span>Duration</span><span>::</span><span>from_secs</span><span>(</span><span>20</span><span>)</span><span>)</span><span>.</span><span>await</span><span>;</span>
    timer<span>.</span><span>stop</span><span>(</span><span>)</span><span>;</span>
<span>}</span></pre></div>
</details>

</article>
          </div></div>
  </body>
</html>
