<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/katanemo/archgw/">Original</a>
    <h1>Show HN: ArchGW â€“ An intelligent edge and service proxy for agents</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/katanemo/archgw/blob/main/docs/source/_static/img/arch-logo.png"><img src="https://github.com/katanemo/archgw/raw/main/docs/source/_static/img/arch-logo.png" alt="Arch Logo" width="75%"/></a>
</p>


<p dir="auto"><a href="https://www.producthunt.com/posts/arch-3?embed=true&amp;utm_source=badge-top-post-badge&amp;utm_medium=badge&amp;utm_souce=badge-arch-3" rel="nofollow"><img src="https://camo.githubusercontent.com/18281de55c44394ed508a571bbad58f060be786c7d62e9d90cc70636e66fa90b/68747470733a2f2f6170692e70726f6475637468756e742e636f6d2f776964676574732f656d6265642d696d6167652f76312f746f702d706f73742d62616467652e7376673f706f73745f69643d353635373631267468656d653d6461726b26706572696f643d6461696c7926743d31373432333539343239393935" alt="Arch - Build fast, hyper-personalized agents with intelligent infra | Product Hunt" width="188" height="41" data-canonical-src="https://api.producthunt.com/widgets/embed-image/v1/top-post-badge.svg?post_id=565761&amp;theme=dark&amp;period=daily&amp;t=1742359429995"/></a></p>
<p dir="auto">AI demos are easy to build. But past the thrill of a quick hack, you are left building, maintaining and scaling low-level plumbing code for agents that slows down AI innovation. For example:</p>
<ul dir="auto">
<li>You want to build specialized agents, but get stuck building <strong>routing and handoff</strong> code.</li>
<li>You want use new LLMs, but struggle to <strong>quickly and safely add LLMs</strong> without writing integration code.</li>
<li>You&#39;re bogged down with prompt engineering work to <strong>clarify user intent and validate inputs</strong>.</li>
<li>You&#39;re wasting cycles choosing and integrating code for <strong>observability</strong> instead of it happening transparently.</li>
</ul>
<p dir="auto">With Arch, you can move faster by focusing on higher-level objectives in a language and framework agnostic way. <strong>Arch</strong> was built by the contributors of <a href="https://www.envoyproxy.io/" rel="nofollow">Envoy Proxy</a> with the belief that:</p>
<blockquote>
<p dir="auto">Prompts are nuanced and opaque user requests, which require the same capabilities as traditional HTTP requests including secure handling, intelligent routing, robust observability, and integration with backend (API) systems to improve speed and accuracy for common agentic scenarios  â€“ all outside core application logic.*</p>
</blockquote>
<p dir="auto"><strong>Core Features</strong>:</p>
<ul dir="auto">
<li><code>ðŸš¦ Routing to Agents</code>. Engineered with purpose-built <a href="https://huggingface.co/collections/katanemo/arch-function-66f209a693ea8df14317ad68" rel="nofollow">LLMs</a> for fast (&lt;100ms) agent routing and hand-off scenarios</li>
<li><code>ðŸ”— Routing to LLMs</code>: Unify access and routing to any LLM, including dynamic routing via <a href="#Preference-based-Routing">preference policies</a>.</li>
<li><code>â›¨ Guardrails</code>: Centrally configure and prevent harmful outcomes and ensure safe user interactions</li>
<li><code>âš¡ Tools Use</code>: For common agentic scenarios let Arch instantly clarify and convert prompts to tools/API calls</li>
<li><code>ðŸ•µ Observability</code>: W3C compatible request tracing and LLM metrics that instantly plugin with popular tools</li>
<li><code>ðŸ§± Built on Envoy</code>: Arch runs alongside app servers as a containerized process, and builds on top of <a href="https://envoyproxy.io" rel="nofollow">Envoy&#39;s</a> proven HTTP management and scalability features to handle ingress and egress traffic related to prompts and LLMs.</li>
</ul>
<p dir="auto"><strong>High-Level Sequence Diagram</strong>:
<a target="_blank" rel="noopener noreferrer" href="https://github.com/katanemo/archgw/blob/main/docs/source/_static/img/arch_network_diagram_high_level.png"><img src="https://github.com/katanemo/archgw/raw/main/docs/source/_static/img/arch_network_diagram_high_level.png" alt="alt text"/></a></p>
<p dir="auto"><strong>Jump to our <a href="https://docs.archgw.com" rel="nofollow">docs</a></strong> to learn how you can use Arch to improve the speed, security and personalization of your GenAI apps.</p>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</p><p dir="auto">Today, the function calling LLM (Arch-Function) designed for the agentic and RAG scenarios is hosted free of charge in the US-central region. To offer consistent latencies and throughput, and to manage our expenses, we will enable access to the hosted version via developers keys soon, and give you the option to run that LLM locally. For more details see this issue <a href="https://github.com/katanemo/archgw/issues/258" data-hovercard-type="issue" data-hovercard-url="/katanemo/archgw/issues/258/hovercard">#258</a></p>
</div>

<p dir="auto">To get in touch with us, please join our <a href="https://discord.gg/pGZf2gcwEc" rel="nofollow">discord server</a>. We will be monitoring that actively and offering support there.</p>

<ul dir="auto">
<li><a href="https://github.com/katanemo/archgw/blob/main/demos/samples_python/weather_forecast/README.md">Sample App: Weather Forecast Agent</a> - A sample agentic weather forecasting app that highlights core function calling capabilities of Arch.</li>
<li><a href="https://github.com/katanemo/archgw/blob/main/demos/samples_python/network_switch_operator_agent/README.md">Sample App: Network Operator Agent</a> - A simple network device switch operator agent that can retrive device statistics and reboot them.</li>
<li><a href="https://github.com/katanemo/archgw/blob/main/demos/use_cases/spotify_bearer_auth">User Case: Connecting to SaaS APIs</a> - Connect 3rd party SaaS APIs to your agentic chat experience.</li>
</ul>

<p dir="auto">Follow this quickstart guide to use arch gateway to build a simple AI agent. Laster in the section we will see how you can Arch Gateway to manage access keys, provide unified access to upstream LLMs and to provide e2e observability.</p>

<p dir="auto">Before you begin, ensure you have the following:</p>
<ol dir="auto">
<li><a href="https://docs.docker.com/get-started/get-docker/" rel="nofollow">Docker System</a> (v24)</li>
<li><a href="https://docs.docker.com/compose/install/" rel="nofollow">Docker compose</a> (v2.29)</li>
<li><a href="https://www.python.org/downloads/" rel="nofollow">Python</a> (v3.12)</li>
</ol>
<p dir="auto">Arch&#39;s CLI allows you to manage and interact with the Arch gateway efficiently. To install the CLI, simply run the following command:</p>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p><p dir="auto">We recommend that developers create a new Python virtual environment to isolate dependencies before installing Arch. This ensures that archgw and its dependencies do not interfere with other packages on your system.</p>
</div>
<div dir="auto" data-snippet-clipboard-copy-content="$ python3.12 -m venv venv
$ source venv/bin/activate   # On Windows, use: venv\Scripts\activate
$ pip install archgw==0.3.4"><pre>$ <span>python3.12 -m venv venv</span>
$ <span><span>source</span> venv/bin/activate   <span><span>#</span> On Windows, use: venv\Scripts\activate</span></span>
$ <span>pip install archgw==0.3.4</span></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Build Agentic Apps with Arch Gateway</h3><a id="user-content-build-agentic-apps-with-arch-gateway" aria-label="Permalink: Build Agentic Apps with Arch Gateway" href="#build-agentic-apps-with-arch-gateway"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">In following quickstart we will show you how easy it is to build AI agent with Arch gateway. We will build a currency exchange agent using following simple steps. For this demo we will use <code>https://api.frankfurter.dev/</code> to fetch latest price for currencies and assume USD as base currency.</p>
<div dir="auto"><h4 tabindex="-1" dir="auto">Step 1. Create arch config file</h4><a id="user-content-step-1-create-arch-config-file" aria-label="Permalink: Step 1. Create arch config file" href="#step-1-create-arch-config-file"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Create <code>arch_config.yaml</code> file with following content,</p>
<div dir="auto" data-snippet-clipboard-copy-content="version: v0.1.0

listeners:
  ingress_traffic:
    address: 0.0.0.0
    port: 10000
    message_format: openai
    timeout: 30s

llm_providers:
  - access_key: $OPENAI_API_KEY
    model: openai/gpt-4o

system_prompt: |
  You are a helpful assistant.

prompt_guards:
  input_guards:
    jailbreak:
      on_exception:
        message: Looks like you&#39;re curious about my abilities, but I can only provide assistance for currency exchange.

prompt_targets:
  - name: currency_exchange
    description: Get currency exchange rate from USD to other currencies
    parameters:
      - name: currency_symbol
        description: the currency that needs conversion
        required: true
        type: str
        in_path: true
    endpoint:
      name: frankfurther_api
      path: /v1/latest?base=USD&amp;symbols={currency_symbol}
    system_prompt: |
      You are a helpful assistant. Show me the currency symbol you want to convert from USD.

  - name: get_supported_currencies
    description: Get list of supported currencies for conversion
    endpoint:
      name: frankfurther_api
      path: /v1/currencies

endpoints:
  frankfurther_api:
    endpoint: api.frankfurter.dev:443
    protocol: https"><pre><span>version</span>: <span>v0.1.0</span>

<span>listeners</span>:
  <span>ingress_traffic</span>:
    <span>address</span>: <span>0.0.0.0</span>
    <span>port</span>: <span>10000</span>
    <span>message_format</span>: <span>openai</span>
    <span>timeout</span>: <span>30s</span>

<span>llm_providers</span>:
  - <span>access_key</span>: <span>$OPENAI_API_KEY</span>
    <span>model</span>: <span>openai/gpt-4o</span>

<span>system_prompt</span>: <span>|</span>
<span>  You are a helpful assistant.</span>
<span></span>
<span></span><span>prompt_guards</span>:
  <span>input_guards</span>:
    <span>jailbreak</span>:
      <span>on_exception</span>:
        <span>message</span>: <span>Looks like you&#39;re curious about my abilities, but I can only provide assistance for currency exchange.</span>

<span>prompt_targets</span>:
  - <span>name</span>: <span>currency_exchange</span>
    <span>description</span>: <span>Get currency exchange rate from USD to other currencies</span>
    <span>parameters</span>:
      - <span>name</span>: <span>currency_symbol</span>
        <span>description</span>: <span>the currency that needs conversion</span>
        <span>required</span>: <span>true</span>
        <span>type</span>: <span>str</span>
        <span>in_path</span>: <span>true</span>
    <span>endpoint</span>:
      <span>name</span>: <span>frankfurther_api</span>
      <span>path</span>: <span>/v1/latest?base=USD&amp;symbols={currency_symbol}</span>
    <span>system_prompt</span>: <span>|</span>
<span>      You are a helpful assistant. Show me the currency symbol you want to convert from USD.</span>
<span></span>
<span></span>  - <span>name</span>: <span>get_supported_currencies</span>
    <span>description</span>: <span>Get list of supported currencies for conversion</span>
    <span>endpoint</span>:
      <span>name</span>: <span>frankfurther_api</span>
      <span>path</span>: <span>/v1/currencies</span>

<span>endpoints</span>:
  <span>frankfurther_api</span>:
    <span>endpoint</span>: <span>api.frankfurter.dev:443</span>
    <span>protocol</span>: <span>https</span></pre></div>
<div dir="auto"><h4 tabindex="-1" dir="auto">Step 2. Start arch gateway with currency conversion config</h4><a id="user-content-step-2-start-arch-gateway-with-currency-conversion-config" aria-label="Permalink: Step 2. Start arch gateway with currency conversion config" href="#step-2-start-arch-gateway-with-currency-conversion-config"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="
$ archgw up arch_config.yaml
2024-12-05 16:56:27,979 - cli.main - INFO - Starting archgw cli version: 0.3.4
2024-12-05 16:56:28,485 - cli.utils - INFO - Schema validation successful!
2024-12-05 16:56:28,485 - cli.main - INFO - Starting arch model server and arch gateway
2024-12-05 16:56:51,647 - cli.core - INFO - Container is healthy!"><pre>$ archgw up arch_config.yaml
2024-12-05 16:56:27,979 - cli.main - INFO - Starting archgw cli version: 0.3.4
2024-12-05 16:56:28,485 - cli.utils - INFO - Schema validation successful<span>!</span>
2024-12-05 16:56:28,485 - cli.main - INFO - Starting arch model server and arch gateway
2024-12-05 16:56:51,647 - cli.core - INFO - Container is healthy<span>!</span></pre></div>
<p dir="auto">Once the gateway is up you can start interacting with at port 10000 using openai chat completion API.</p>
<p dir="auto">Some of the sample queries you can ask could be <code>what is currency rate for gbp?</code> or <code>show me list of currencies for conversion</code>.</p>
<div dir="auto"><h4 tabindex="-1" dir="auto">Step 3. Interacting with gateway using curl command</h4><a id="user-content-step-3-interacting-with-gateway-using-curl-command" aria-label="Permalink: Step 3. Interacting with gateway using curl command" href="#step-3-interacting-with-gateway-using-curl-command"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Here is a sample curl command you can use to interact,</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ curl --header &#39;Content-Type: application/json&#39; \
  --data &#39;{&#34;messages&#34;: [{&#34;role&#34;: &#34;user&#34;,&#34;content&#34;: &#34;what is exchange rate for gbp&#34;}], &#34;model&#34;: &#34;none&#34;}&#39; \
  http://localhost:10000/v1/chat/completions | jq &#34;.choices[0].message.content&#34;

&#34;As of the date provided in your context, December 5, 2024, the exchange rate for GBP (British Pound) from USD (United States Dollar) is 0.78558. This means that 1 USD is equivalent to 0.78558 GBP.&#34;
"><pre>$ curl --header <span><span>&#39;</span>Content-Type: application/json<span>&#39;</span></span> \
  --data <span><span>&#39;</span>{&#34;messages&#34;: [{&#34;role&#34;: &#34;user&#34;,&#34;content&#34;: &#34;what is exchange rate for gbp&#34;}], &#34;model&#34;: &#34;none&#34;}<span>&#39;</span></span> \
  http://localhost:10000/v1/chat/completions <span>|</span> jq <span><span>&#34;</span>.choices[0].message.content<span>&#34;</span></span>

<span><span>&#34;</span>As of the date provided in your context, December 5, 2024, the exchange rate for GBP (British Pound) from USD (United States Dollar) is 0.78558. This means that 1 USD is equivalent to 0.78558 GBP.<span>&#34;</span></span>
</pre></div>
<p dir="auto">And to get list of supported currencies,</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ curl --header &#39;Content-Type: application/json&#39; \
  --data &#39;{&#34;messages&#34;: [{&#34;role&#34;: &#34;user&#34;,&#34;content&#34;: &#34;show me list of currencies that are supported for conversion&#34;}], &#34;model&#34;: &#34;none&#34;}&#39; \
  http://localhost:10000/v1/chat/completions | jq &#34;.choices[0].message.content&#34;

&#34;Here is a list of the currencies that are supported for conversion from USD, along with their symbols:\n\n1. AUD - Australian Dollar\n2. BGN - Bulgarian Lev\n3. BRL - Brazilian Real\n4. CAD - Canadian Dollar\n5. CHF - Swiss Franc\n6. CNY - Chinese Renminbi Yuan\n7. CZK - Czech Koruna\n8. DKK - Danish Krone\n9. EUR - Euro\n10. GBP - British Pound\n11. HKD - Hong Kong Dollar\n12. HUF - Hungarian Forint\n13. IDR - Indonesian Rupiah\n14. ILS - Israeli New Sheqel\n15. INR - Indian Rupee\n16. ISK - Icelandic KrÃ³na\n17. JPY - Japanese Yen\n18. KRW - South Korean Won\n19. MXN - Mexican Peso\n20. MYR - Malaysian Ringgit\n21. NOK - Norwegian Krone\n22. NZD - New Zealand Dollar\n23. PHP - Philippine Peso\n24. PLN - Polish ZÅ‚oty\n25. RON - Romanian Leu\n26. SEK - Swedish Krona\n27. SGD - Singapore Dollar\n28. THB - Thai Baht\n29. TRY - Turkish Lira\n30. USD - United States Dollar\n31. ZAR - South African Rand\n\nIf you want to convert USD to any of these currencies, you can select the one you are interested in.&#34;
"><pre>$ curl --header <span><span>&#39;</span>Content-Type: application/json<span>&#39;</span></span> \
  --data <span><span>&#39;</span>{&#34;messages&#34;: [{&#34;role&#34;: &#34;user&#34;,&#34;content&#34;: &#34;show me list of currencies that are supported for conversion&#34;}], &#34;model&#34;: &#34;none&#34;}<span>&#39;</span></span> \
  http://localhost:10000/v1/chat/completions <span>|</span> jq <span><span>&#34;</span>.choices[0].message.content<span>&#34;</span></span>

<span><span>&#34;</span>Here is a list of the currencies that are supported for conversion from USD, along with their symbols:\n\n1. AUD - Australian Dollar\n2. BGN - Bulgarian Lev\n3. BRL - Brazilian Real\n4. CAD - Canadian Dollar\n5. CHF - Swiss Franc\n6. CNY - Chinese Renminbi Yuan\n7. CZK - Czech Koruna\n8. DKK - Danish Krone\n9. EUR - Euro\n10. GBP - British Pound\n11. HKD - Hong Kong Dollar\n12. HUF - Hungarian Forint\n13. IDR - Indonesian Rupiah\n14. ILS - Israeli New Sheqel\n15. INR - Indian Rupee\n16. ISK - Icelandic KrÃ³na\n17. JPY - Japanese Yen\n18. KRW - South Korean Won\n19. MXN - Mexican Peso\n20. MYR - Malaysian Ringgit\n21. NOK - Norwegian Krone\n22. NZD - New Zealand Dollar\n23. PHP - Philippine Peso\n24. PLN - Polish ZÅ‚oty\n25. RON - Romanian Leu\n26. SEK - Swedish Krona\n27. SGD - Singapore Dollar\n28. THB - Thai Baht\n29. TRY - Turkish Lira\n30. USD - United States Dollar\n31. ZAR - South African Rand\n\nIf you want to convert USD to any of these currencies, you can select the one you are interested in.<span>&#34;</span></span>
</pre></div>

<p dir="auto">Arch supports two primary routing strategies for LLMs: model-based routing and preference-based routing.</p>

<p dir="auto">Model-based routing allows you to configure static model names for routing. This is useful when you always want to use a specific model for certain tasks, or manually swap between models. Below an example configuration for model-based routing, and you can follow our <a href="https://github.com/katanemo/archgw/blob/main/demos/use_cases/README.md">usage guide</a> on how to get working.</p>
<div dir="auto" data-snippet-clipboard-copy-content="version: v0.1.0

listeners:
  egress_traffic:
    address: 0.0.0.0
    port: 12000
    message_format: openai
    timeout: 30s

llm_providers:
  - access_key: $OPENAI_API_KEY
    model: openai/gpt-4o
    default: true

  - access_key: $MISTRAL_API_KEY
    model: mistral/mistral-3b-latest"><pre><span>version</span>: <span>v0.1.0</span>

<span>listeners</span>:
  <span>egress_traffic</span>:
    <span>address</span>: <span>0.0.0.0</span>
    <span>port</span>: <span>12000</span>
    <span>message_format</span>: <span>openai</span>
    <span>timeout</span>: <span>30s</span>

<span>llm_providers</span>:
  - <span>access_key</span>: <span>$OPENAI_API_KEY</span>
    <span>model</span>: <span>openai/gpt-4o</span>
    <span>default</span>: <span>true</span>

  - <span>access_key</span>: <span>$MISTRAL_API_KEY</span>
    <span>model</span>: <span>mistral/mistral-3b-latest</span></pre></div>

<p dir="auto">Preference-based routing is designed for more dynamic and intelligent selection of models. Instead of static model names, you write plain-language routing policies that describe the type of task or preference â€” for example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="version: v0.1.0

listeners:
  egress_traffic:
    address: 0.0.0.0
    port: 12000
    message_format: openai
    timeout: 30s

llm_providers:
  - model: openai/gpt-4.1
    access_key: $OPENAI_API_KEY
    default: true
    routing_preferences:
      - name: code generation
        description: generating new code snippets, functions, or boilerplate based on user prompts or requirements

  - model: openai/gpt-4o-mini
    access_key: $OPENAI_API_KEY
    routing_preferences:
      - name: code understanding
        description: understand and explain existing code snippets, functions, or libraries"><pre><span>version</span>: <span>v0.1.0</span>

<span>listeners</span>:
  <span>egress_traffic</span>:
    <span>address</span>: <span>0.0.0.0</span>
    <span>port</span>: <span>12000</span>
    <span>message_format</span>: <span>openai</span>
    <span>timeout</span>: <span>30s</span>

<span>llm_providers</span>:
  - <span>model</span>: <span>openai/gpt-4.1</span>
    <span>access_key</span>: <span>$OPENAI_API_KEY</span>
    <span>default</span>: <span>true</span>
    <span>routing_preferences</span>:
      - <span>name</span>: <span>code generation</span>
        <span>description</span>: <span>generating new code snippets, functions, or boilerplate based on user prompts or requirements</span>

  - <span>model</span>: <span>openai/gpt-4o-mini</span>
    <span>access_key</span>: <span>$OPENAI_API_KEY</span>
    <span>routing_preferences</span>:
      - <span>name</span>: <span>code understanding</span>
        <span>description</span>: <span>understand and explain existing code snippets, functions, or libraries</span></pre></div>
<p dir="auto">Arch uses a lightweight 1.5B autoregressive model to map prompts (and conversation context) to these policies. This approach adapts to intent drift, supports multi-turn conversations, and avoids the brittleness of embedding-based classifiers or manual if/else chains. No retraining is required when adding new models or updating policies â€” routing is governed entirely by human-readable rules. You can learn more about the design, benchmarks, and methodology behind preference-based routing in our paper:</p>
<p><a href="https://arxiv.org/abs/2506.16655" rel="nofollow">
    <img src="https://github.com/katanemo/archgw/raw/main/docs/source/_static/img/arch_router_paper_preview.png" alt="Arch Router Paper Preview"/>
  </a>
</p>

<p dir="auto">Arch is designed to support best-in class observability by supporting open standards. Please read our <a href="https://docs.archgw.com/guides/observability/observability.html" rel="nofollow">docs</a> on observability for more details on tracing, metrics, and logs. The screenshot below is from our integration with Signoz (among others)</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/katanemo/archgw/blob/main/docs/source/_static/img/tracing.png"><img src="https://github.com/katanemo/archgw/raw/main/docs/source/_static/img/tracing.png" alt="alt text"/></a></p>

<p dir="auto">When debugging issues / errors application logs and access logs provide key information to give you more context on whats going on with the system. Arch gateway runs in info log level and following is a typical output you could see in a typical interaction between developer and arch gateway,</p>
<div data-snippet-clipboard-copy-content="$ archgw up --service archgw --foreground
...
[2025-03-26 18:32:01.350][26][info] prompt_gateway: on_http_request_body: sending request to model server
[2025-03-26 18:32:01.851][26][info] prompt_gateway: on_http_call_response: model server response received
[2025-03-26 18:32:01.852][26][info] prompt_gateway: on_http_call_response: dispatching api call to developer endpoint: weather_forecast_service, path: /weather, method: POST
[2025-03-26 18:32:01.882][26][info] prompt_gateway: on_http_call_response: developer api call response received: status code: 200
[2025-03-26 18:32:01.882][26][info] prompt_gateway: on_http_call_response: sending request to upstream llm
[2025-03-26 18:32:01.883][26][info] llm_gateway: on_http_request_body: provider: gpt-4o-mini, model requested: None, model selected: gpt-4o-mini
[2025-03-26 18:32:02.818][26][info] llm_gateway: on_http_response_body: time to first token: 1468ms
[2025-03-26 18:32:04.532][26][info] llm_gateway: on_http_response_body: request latency: 3183ms
..."><pre><code>$ archgw up --service archgw --foreground
...
[2025-03-26 18:32:01.350][26][info] prompt_gateway: on_http_request_body: sending request to model server
[2025-03-26 18:32:01.851][26][info] prompt_gateway: on_http_call_response: model server response received
[2025-03-26 18:32:01.852][26][info] prompt_gateway: on_http_call_response: dispatching api call to developer endpoint: weather_forecast_service, path: /weather, method: POST
[2025-03-26 18:32:01.882][26][info] prompt_gateway: on_http_call_response: developer api call response received: status code: 200
[2025-03-26 18:32:01.882][26][info] prompt_gateway: on_http_call_response: sending request to upstream llm
[2025-03-26 18:32:01.883][26][info] llm_gateway: on_http_request_body: provider: gpt-4o-mini, model requested: None, model selected: gpt-4o-mini
[2025-03-26 18:32:02.818][26][info] llm_gateway: on_http_response_body: time to first token: 1468ms
[2025-03-26 18:32:04.532][26][info] llm_gateway: on_http_response_body: request latency: 3183ms
...
</code></pre></div>
<p dir="auto">Log level can be changed to debug to get more details. To enable debug logs edit (supervisord.conf)[arch/supervisord.conf], change the log level <code>--component-log-level wasm:info</code> to <code>--component-log-level wasm:debug</code>. And after that you need to rebuild docker image and restart the arch gateway using following set of commands,</p>
<div data-snippet-clipboard-copy-content="# make sure you are at the root of the repo
$ archgw build
# go to your service that has arch_config.yaml file and issue following command,
$ archgw up --service archgw --foreground"><pre><code># make sure you are at the root of the repo
$ archgw build
# go to your service that has arch_config.yaml file and issue following command,
$ archgw up --service archgw --foreground
</code></pre></div>

<p dir="auto">We would love feedback on our <a href="https://github.com/orgs/katanemo/projects/1">Roadmap</a> and we welcome contributions to <strong>Arch</strong>!
Whether you&#39;re fixing bugs, adding new features, improving documentation, or creating tutorials, your help is much appreciated.
Please visit our <a href="https://github.com/katanemo/archgw/blob/main/CONTRIBUTING.md">Contribution Guide</a> for more details</p>
</article></div></div>
  </body>
</html>
