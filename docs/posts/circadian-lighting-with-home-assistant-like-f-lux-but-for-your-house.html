<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tylercipriani.com/blog/2022/10/17/whole-house-circadian-lighting-with-home-assistant/">Original</a>
    <h1>Circadian lighting with Home Assistant: Like f.lux, but for your house</h1>
    
    <div id="readability-page-1" class="page"><article class="page">







<div id="pagebody">

<section id="content" role="main">
<blockquote>
<p>Artificial lighting is omnipresent in contemporary society with
disruptive consequences for human sleep</p>
<p>– Sarah L Chellappa, <a href="https://doi.org/10.1093/sleep/zsaa214">https://doi.org/10.1093/sleep/zsaa214</a></p>
</blockquote>
<figure>
<img src="https://photos.tylercipriani.com/thumbs/e3/bca0651e47a7d6aed643f9560bdd5c/large.jpg" alt="Night &amp; Day – 🌛 left-side is 18:14 MDT (light color @ 2600 K); 🌞 right-side is 15:20 MDT (light color @ 4900 K)"/>
<figcaption aria-hidden="true">Night &amp; Day – 🌛 left-side is 18:14
MDT (light color @ 2600 K); 🌞 right-side is 15:20 MDT (light color @
4900 K)</figcaption>
</figure>
<p>Light messes with my sleep, mood, and alertness.</p>
<p>My house lights should auto-adjust themselves—like <a href="https://justgetflux.com/">f.lux</a> or <a href="http://jonls.dk/redshift/">redshift</a> on my laptop:</p>
<ul>
<li>🌞 White/Blue, bright light during the day</li>
<li>🌛 Red/Yellow, dim light at night</li>
</ul>
<p>I was worried that getting this to work for my whole house meant
endless fiddling with <a href="https://twitter.com/internetofshit">“smart”</a> devices.</p>
<p>But <a href="https://www.home-assistant.io/">Home Assistant</a>
papered over the vendor and hardware woes and made setup simple.</p>
<section id="the-goals-of-my-house-lighting">
<h2>The goals of my house lighting</h2>
<p>I had the following goals for this project:</p>
<ul>
<li><strong>Circadian lighting in all rooms</strong> – Bright,
blue/white light during the day; dim, red/yellow light after
sunset.</li>
<li><strong>Control by switches</strong> – I disdain fiddling with
tablets/phones to turn lights on and off. I’d also hoped to avoid an
always-on speaker listening to me.</li>
<li><strong>Automatic</strong> – Light should shift temperature and
brightness automatically throughout the day.</li>
<li><strong>Ability to override</strong> – I should be able to override
the automatic settings quickly with a switch. Sometimes it’s nice to be
able to see what you’re doing late at night—circadian rhythm be
damned.</li>
<li><strong>Platform independent</strong> – Because hue bulbs are
expensive, I need to be able to add to the system over time. Everything
from DIY light strips to hue bulbs to random smart bulbs from
Alibaba.com should work together.</li>
<li><strong>Self-hosted</strong> – All software should live on my home
network and work with only a local network.</li>
</ul>
</section>
<section id="the-results">
<h2>The Results</h2>
<figure>
<img src="https://photos.tylercipriani.com/thumbs/18/b3386a14e8de005cbb0460f590e51b/large.jpg" alt="Red light from my Taloya smart light in the bathroom, so I’m not blinded in the middle of the night"/>
<figcaption aria-hidden="true">Red light from my Taloya smart light in
the bathroom, so I’m not blinded in the middle of the night</figcaption>
</figure>
<p>The effects have been subtle but noticeable.</p>
<p>During the day, I’m sharp, and at night I’m ready to sleep.</p>
<p>In the evenings, after the sun sets, the lights dim, and it gets
harder to read and work on projects—<strong>that’s a feature</strong>.
It’s a signal that it’s time for bed.</p>
<p>The most significant benefit I’ve noticed is that <strong>I can get
back to sleep</strong> after getting up in the middle of the night—now
that I’m no longer blinded by harsh overhead light in the bathroom.</p>
</section>
<section id="home-assistant-setup">
<h2>Home Assistant setup</h2>
<figure>
<img src="https://photos.tylercipriani.com/2022-10-18_HA-kitchen.png" alt="Home Assistant Lovelace card to control my Circadian Lighting"/>
<figcaption aria-hidden="true">Home Assistant Lovelace card to control
my Circadian Lighting</figcaption>
</figure>
<p>Home Assistant made this possible.</p>
<p>The <a href="https://github.com/claytonjn/hass-circadian_lighting">Circadian
lighting component</a> (available via <a href="https://hacs.xyz/">Home
Assistant Community Store (HACS)</a>) computes solar noon based on my
location and auto-adjusts the brightness of my lights and the color
temperature based on the time of day.</p>
<figure>
<img src="https://photos.tylercipriani.com/2022-10-17_circadian-lighting-grafana.png" alt="Grafana graph of all the lights in my house—brightness % vs. color temperature in Kelvin over a week"/>
<figcaption aria-hidden="true">Grafana graph of all the lights in my
house—brightness % vs. color temperature in Kelvin over a
week</figcaption>
</figure>
<p>I use <a href="https://www.zigbee2mqtt.io/">Zigbee2MQTT</a> to
capture events from my switches and send them to Home Assistant over <a href="https://www.home-assistant.io/integrations/mqtt">MQTT</a>—I found
this easier than adding a Zigbee gateway to Home Assistant directly.</p>
<p>I have <a href="https://www.home-assistant.io/getting-started/automation/">automation</a>
that allows me to override circadian lighting when I need maximum
brightness or when I want the nightlight.</p>
</section>
<section id="the-hardware-setup">
<h2>The hardware setup</h2>
<figure>
<img src="https://photos.tylercipriani.com/thumbs/b9/9dba616bfc80749e863e52bf110a24/large.jpg" alt="Tiny linux box for running Home Assistant VM + Conbee II Zigbee Gateway"/>
<figcaption aria-hidden="true">Tiny linux box for running Home Assistant
VM + Conbee II Zigbee Gateway</figcaption>
</figure>
<p><strong>Lights</strong>:</p>
<ul>
<li>Hue bulbs – I have a lot of hue bulbs.
<ul>
<li>Some are <a href="https://www.amazon.com/Philips-Hue-Bluetooth-compatible-Assistant/dp/B07QV9XB87/">full-color
bulbs</a>, while others do <a href="https://www.amazon.com/gp/product/B07QV9XLSD/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&amp;psc=1">color
temperature</a>.</li>
<li>Three different form factors—A19 bulbs, <a href="https://www.amazon.com/gp/product/B07WTJZCZL/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&amp;psc=1">GU10s</a>
for the <a href="https://www.ikea.com/us/en/p/tidig-ceiling-light-with-5-spotlights-nickel-plated-00262657/">Ikea
Tidig</a> in our kitchen, and the <a href="https://www.amazon.com/Philips-Hue-Bluetooth-compatible-activated/dp/B07VRF9NWK/">Edison
bulb</a> for our fancy dining room light.</li>
<li>These are good light bulbs.</li>
</ul></li>
<li><a href="https://www.amazon.com/gp/product/B07WY3VM1M/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&amp;psc=1">Taloya
smart ceiling light</a> – this is the bathroom light, integrated with
Home Assistant via <a href="https://github.com/rospogrigio/localtuya">LocalTuya</a>.</li>
</ul>
<p><strong>Buttons</strong>:</p>
<ul>
<li><a href="https://www.amazon.com/gp/product/B07D19YXND/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&amp;psc=1">Aqara
mini switch</a> – one each for me and my partner for controlling the
bedroom lamps.</li>
<li><a href="https://www.amazon.com/gp/product/B099KDS3W9/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&amp;th=1">MOES
Zigbee 4-gang switch</a> – bathroom lights—one button for on/off, one
button for bright, one for dim, one for the red nightlight.</li>
</ul>
<p><strong>Other hardware</strong>:</p>
<ul>
<li><a href="https://www.amazon.com/gp/product/B07PZ7ZHG5/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&amp;psc=1">Conbee
II Zigbee Gateway</a> – Handles the incoming Zigbee signals.</li>
</ul>
</section>
<section id="todo-finish-lighting">
<h2>TODO: finish lighting</h2>
<p>House lighting is never done. I have ideas for my lights that I’m
still pondering.</p>
<ol type="1">
<li><strong>SAD office light</strong> – I’m lacking an extremely bright
office light—this is especially noticeable when winter brings darkness
at 4:30pm. I’m pondering building something that I can attach to this
system.</li>
<li><strong>Hyperion media lighting</strong> – Ambiant bias lighting for
the TV via <a href="https://sequr.be/blog/2021/04/diy-ambilight-for-your-tv-or-computer-using-a-rpi-and-hyperion/">Hyperion</a>.
This is neat, but it’s a low priority since I don’t watch much TV (and
my TV is from 2012, anyway. I’m not fancy).</li>
<li><strong>Moar WLED</strong> – I added <a href="https://kno.wled.ge">WLED</a> strip lighting over the sink (which
works perfectly with Home Assistant), but I need more to brighten up the
whole space.</li>
</ol>
</section>

</section>









</div>



</article></div>
  </body>
</html>
