<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nicole.express/2022/the-nes-as-an-artifact.html">Original</a>
    <h1>What made the NES so interesting?</h1>
    
    <div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p>I often like to cover oddities here; details of computers and arcade systems people may not have heard of, that didn’t sell well but had unique or interesting characteristics. But focusing on oddities like that can disguise the fact that sometimes, even systems that were very popular can stand out for unique design. Such be it with the Nintendo Entertainment System: had Nintendo’s console flopped, it’d definitely have a post already. But it doesn’t. Let’s fix that! And answer a simple question I was asked: what’s the deal with special chip games?</p>

<h2 id="the-famicom">The Famicom</h2>

<p>The Family Computer was Nintendo’s first console. Releasing in 1983, just a year after 1982’s <em>Donkey Kong Jr.</em>, the first Nintendo arcade game to be developed entirely in-house, without help from Ikegami Tsushinki. (Though they may have peeked at the prior boards just a bit, and got sued just a bit, but that’s another story) And isn’t it adorable?</p>

<p><img src="https://nicole.express/assets/img/nes/family.jpg" title="Thanks Miri! Your Famicom is in way better shape than mine" alt="A very nice and clean Famicom"/></p>

<p>The interesting thing about the Famicom is that it was released in 1983, and its last licensed game in Japan, <em>Master Takahashi’s Adventure Island IV</em>, came out in 1994. The last licensed game, <em>Wario’s Woods</em>, came out in 1995 in Europe. That’s a long lifespan, and unlike the PC Engine, whose last licensed game <em>Dead of the Brain Vol. 1 and 2</em> came out after a several-year drought, the Famicom was continuously getting more and more games. (Between unlicensed titles, the NES-on-a-chip and homebrew, it has never really stopped, either)</p>

<p><img src="https://nicole.express/assets/img/nes/advisl4.jpg" title="this island isn&#39;t very adventurous, i&#39;ve been on way more adventurous ones, sorry master higgins i guess my island&#39;s just a little more adventurous than yours" alt="Adventure Island 4"/></p>

<p>Think about the Famicom launch title <em>Donkey Kong</em>. It’s a reasonable arcade conversion, with high quality graphics. But much like the <a href="https://www.youtube.com/watch?v=nI9WwdVb-_A">ColecoVision pack-in</a>, it only includes three of the arcade game’s four levels, and none of the interstitials (“HOW HIGH CAN YOU GET”). It has 16kiB of program ROM and 8kiB of character ROM (just like <a href="https://nicole.express/2019/making-of-aspect-star-n-coding.html"><em>Aspect Star “N”</em></a>).</p>

<p><img src="https://nicole.express/assets/img/nes/donkey.jpg" title="if this were the gameboy, Mario&#39;d be a pile of ash right now" alt="Donkey Kong on NES"/></p>

<p>The largest game, HAL Laboratory’s 1991 <em>Metal Slader Glory</em>, dwarfs even <em>Adventure Island IV</em> with 512kiB of program ROM and 512kiB of character ROM. Its MMC5 mapper chip allows for a ton of advanced features. As for the game itself, it’s a text adventure with some stunning graphics, especially when viewed on a CRT.</p>

<p><img src="https://nicole.express/assets/img/nes/glory.jpg" title="GLORIOUS" alt="Metal Slader Glory, with a detailed picture of a mecha"/></p>



<p>But most people know this. The Famicom and NES benefitted from chips– like the aforementioned MMC5– inside the cartridges that expanded the system’s capabilities. For example, even a more modest title like <em>Championship Bowling</em> uses a “CNROM” board, which allows for larger graphics ROMs than the 8kiB limit; in this case, 32kiB, four times the graphics space.</p>

<p><img src="https://nicole.express/assets/img/nes/bowl.jpg" title="Hey let&#39;s Bowl!" alt="A circuit board for League Bowling. It has four chips."/></p>

<p>Have you ever wondered, though, what that means, exactly? What are these additional chips doing? And why did we see this on Nintendo’s consoles more than any other manufacturer?</p>

<p><img src="https://nicole.express/assets/img/nes/phan.jpg" title="it&#39;s called battery backup because the battery is on the back" alt="The master system game Phantasy Star, with three chips. The battery is on the back"/></p>

<p>Here’s the inside of the most sophisticated Sega Master System game, <em>Phantasy Star</em>. It’s got a larger program ROM (with a mapper to help out), and a smaller, battery-backed RAM chip. But it offers no technical enhancements to the Master System hardware; graphically, <em>Phantasy Star</em> is unable to do anything that launch-title <a href="https://nicole.express/2022/teddy-boy-2.html"><em>Teddy Boy</em></a> couldn’t have done; it can just do more of it with that big beefy ROM. <em>Championship Bowling</em> is digging into the deep internals of the graphics side of the system in a way <em>Phantasy Star</em> simply can’t. (Or, depending on your point of view, doesn’t need to)</p>

<h2 id="cartridge-ports">Cartridge ports</h2>

<p>The <a href="https://nicole.express/2021/the-most-unfair-child.html">Fairchild Channel F</a> used the Fairchild F8 CPU, which had kind of a strange architecture with no address bus <em>per se</em>. So let’s switch to the Atari 2600.</p>

<p><img src="https://nicole.express/assets/img/nes/2600-cart.png" title="Shield your eyes, ground your shields, and eye your ground" alt="Atari 2600 cart pinout. Address, data, power, ground. That&#39;s it."/></p>

<p>The Atari 2600’s cartridge port is a model of sheer simplicity. 13 address lines allow for 8kiB of gaming action– well, actually, A12 needs to be used as a chip select, so 4kiB of gaming action. There’s an 8-bit data bus, 5V for power, and grounds. That’s all you need, right?</p>

<p>Wrong. The Atari 2600’s cartridge port is actually very limited, and couldn’t even do <em>Phantasy Star</em> above. It’s missing a pin on the 6507 CPU called “R/W”; this means that the Atari cartridge has no idea when the game is reading or writing from memory. This is fine for a ROM chip, which can’t be written to anyway. But what if you wanted to put RAM on the cartridge? After all, the 2600 only has 128 bytes built in. You can’t do it. Not in a straightforward fashion, anyway.</p>

<p><img src="https://nicole.express/assets/img/pratfall/atari-pitfall-2.jpg" title="fun fact: I don&#39;t have a 2600" alt="The Atari computer version of Pitfall II. Pitfall Harry runs towards his niece."/></p>

<p>Well, of course, people found ways around these limitations. Without them, we wouldn’t have <a href="https://nicole.express/2021/fallin-in-a-pitfall.html"><em>Pitfall II</em></a> (Atari home computer version, not the 2600, pictured above) But it made things pretty complex to juggle when you had such a small window for your ROM to begin with.</p>

<p>Not only does the Master System have a larger address space for cartridges (thanks to its Zilog Z80, rather than the MOS 6507), it sent nearly all the signals from the Z80 out to the cartridge, including read and write signals. This allows for <em>Phantasy Star</em>’s save RAM– plus, all of this was also true of the predecessor to the Master System, the SG-1000, which had RAM expansion on at least one title, <em>The Castle</em>.</p>

<p>The NES went even further than that.</p>

<h2 id="chr">CHR</h2>

<p>What do the ColecoVision, the Sega SG-1000, and the <a href="https://nicole.express/2021/i-am-the-mark-iii.html">Master System</a> all have in common? They all have the same amount of <strong>VRAM</strong> (Video RAM), 16kiB. This is because they have (more or less) the same video chip; and the TMS99xx video chip was very sophisticated for its time, allowing for cheaper dynamic RAM. In fact, back in 1979, that 16kiB formed the bulk of the RAM for TI’s TI-99/4A computer.</p>

<p>What is video RAM? It’s a solution to a serious problem. A video signal on the NES is a composite signal, ~60Hz in NTSC regions, ~15kHz line rate. Something like this.</p>

<p><img src="https://nicole.express/assets/img/inter&amp;lace/progressive-scan.png" title="no tate mode, this is the NES" alt="Successive lines being scanned on a television"/></p>

<p>The key thing to note about this signal, though, is that the video processor must constantly output its signal. It can’t be early, it can’t be late, it can’t take a break. This means if there’s a conflict between the processor wanting to use RAM, and the video chip wanting to use RAM, the video chip must win. The Apple ][ pulls this off with careful timing, but it only runs at 1MHz and has no sprites (or even colors, sort of). The more advanced video chips in the Commodore 64 and Atari 8-bit computers, meanwhile, must have the ability to stall the CPU to let the graphics chip through. Lines where this happens are called “badlines” on the C64.</p>



<p>Video RAM lets the CPU run at full speed at all times by having the graphics chip use RAM on a separate bus. The downside is that you need to go through the video chip to access this RAM, which is a lot slower. For example, writing a byte <code>$0A</code> to RAM address <code>$2000</code> is pretty easy on the 6502:</p>

<div><div><pre><code>LDA #$0A ; Load the accumulator with 0x0A
STA $2000 ; Store the accumulator at $2000
</code></pre></div></div>

<p>What if we want to write that byte to video RAM? On the NES, it would look like this:</p>

<div><div><pre><code>LDA #$20 ; high byte of $2000
STA $2006 ; PPUADDR register
LDA #$00 ; low byte of $2000
STA $2006 ; same register
LDA #$0A
STA $2007 ; PPUDATA register
</code></pre></div></div>

<p>On the NES, writing an immediate value to a known arbitrary address is three times as slow as accessing regular RAM. And it’s even more limited than this. The CPU always has access to its regular RAM, but on the NES (not all systems with VRAM have this same limitation) you can not write to video RAM at all while it’s drawing the screen. Therefore, the “VBLANK”, or vertical blanking period, when the beam isn’t drawing a visible picture, is of the utmost importance.</p>



<h3 id="dare-to-compare">Dare to compare</h3>

<p>So, the TI-99/4A computers, the ColecoVision, the SG-1000, and the MSX1 standard, and more all use the TMS99xxA series video chips, and all of them had 16kiB of video RAM. Here’s what <em>Dig Dug</em> looks like on the MSX1.</p>

<p><img src="https://nicole.express/assets/img/nes/digdug-sms.jpg" title="I&#39;m waiting for you" alt="Dig Dug on NES. It&#39;s less colorful, especially the sprites"/></p>

<p>The NES has 2kiB of video RAM, one eighth of the MSX1. It also, though, has 256 bytes of OAM (object attribute memory in NES language, or sprite data to use more common terminology), and 32 bytes of palette RAM that aren’t included in that 2kiB. So, what does <em>Dig Dug</em>, released by the same company in the same time period, look like on the NES?</p>

<p><img src="https://nicole.express/assets/img/nes/digdug-nes.jpg" title="NONE MAY ESCAPE" alt="Dig Dug on NES. It&#39;s more colorful"/></p>



<p>MSX fans are probably already writing in. After all, the NES has several big advantages over the MSX. In these screenshots alone, you have:</p>

<ul>
  <li>Three-color sprites (vs. monochrome on the MSX1)</li>
  <li>Up to eight sprites per scanline (vs. 4 on the MSX1)</li>
  <li>Higher vertical resolution</li>
  <li>More colorful tilemap</li>
</ul>

<p>However, all of these should actually be taking up <em>more</em> VRAM than the MSX, not less. Well, of course, what’s going on is well-known. The game <em>Dig Dug</em> uses <strong>CHR-ROM</strong>. A <em>Dig Dug</em> cartridge has an 8kiB ROM inside of it that’s hooked up directly to that video bus. So to say “the MSX1 has 16kiB of VRAM, the NES has &lt;2kiB” is really not being a fair comparison. The MSX fans have a point.</p>

<p>But that has an important, key implication: to make CHR-ROM possible, the NES exposes the video bus over the cartridge slot. It looks like this:</p>

<p><img src="https://nicole.express/assets/img/nes/famicom-cart.png" title="Oh gods" alt="Famicom cart pinout. There are a lot of signals"/></p>

<p>There’s a lot more signals to play with here than even the Master System. Most importantly, though, are those labeled PPU. They refer to the Picture Processing Unit, the NES’ graphics chip, and are hooked up directly to what on the MSX is an internal graphics bus. In fact, you can even put RAM on the board, and have the benefits of modifiable-on-the-fly VRAM. (And if you want, even bankswitch it) Unlike the Neo Geo, the NES was designed for this usecase, and the RAM can be modified in the same way as the VRAM that is built into the NES. (Which is used for tile maps and the like) This is typically called <strong>CHR-RAM</strong>.</p>



<h2 id="discrete-logic">Discrete logic</h2>

<p>Let’s take a closer look at CNROM. This is just an example, and there are many mappers like it– what they have in common is that they’re built out of discrete logic, like Sega’s <a href="https://nicole.express/2021/a-lot-of-effort-for-dots.html"><em>Dottori-kun</em></a> arcade board, but usually they try not to use more than one or two chips. Here’s a closer look at <em>Championship Bowling</em>.</p>

<p><img src="https://nicole.express/assets/img/nes/bowl2.png" title="help, help, i&#39;m being zoomed in" alt="The CNROM board above. The chips are clearly labeled now. On the top row, NES-1F-0 PRG, NES-1F-0 CHR, and a small Nintendo-labeled IC. On the bottom, a 74HC161 branded Toshiba."/></p>

<p>The two ROMs are the program and character ROM, and the small Nintendo-branded chip is the lockout chip. This board uses 32kiB of program ROM, so there’s nothing particularly interesting there. What’s interesting is the 74HC161. This is a standard chip; it’s a binary counter.</p>

<p><img src="https://nicole.express/assets/img/nes/161.png" title="yep" alt="A 74HC161 pinout"/></p>

<p>However, its clock input <code>CP</code> is not actually connected to anything, so the count will never increase. And so this is configured as a simple latch; a value stored on the D0, D1, D2, D3 pins will be output on the Q0, Q1, Q2, and Q3 pins. The benefit is that the value is “latched”; the Q pins can keep outputting the same value that’s set on the D side during a brief period the chip is enabled.</p>

<p>How are they written? It’s simply enabled whenever any of the ROM region is written to. This means no logic is needed to choose an address, and ROM isn’t usually written to in day-to-day coding, since it can’t store a value. The downside of this simple single-discrete-chip approach, however, is <a href="https://www.nesdev.org/wiki/Bus_conflict">bus conflicts</a>; they can be worked around, however.</p>

<p>This is called bankswitching: Two of these pins are attached to two address lines of the character ROM. So the NES still only sees 8kiB at any given time, but it can be divided into four”pages” that can be swapped out by the program. And unlike, say, a CD-ROM or a floppy disk, loading pages of data is essentially instant; it responds very fast.</p>

<p>Fast enough, in fact, that games like <em>Super Mario Bros. 2</em> (which is not CNROM, but just being used as an example because it’s widely recognizable, and was released on multiple mappers) can actually animate themselves just by switching out banks. This allows for things like the tufts of grass and the leaves on the climbing vines.</p>

<p><video src="/assets/img/nes/smb2.mp4" width="75%" autoplay="" loop="" muted=""> You don&#39;t have a video tag support or something? So you can&#39;t see this footage of *Super Mario Bros. 2*. But I&#39;ll let you in on a secret the video-seers don&#39;t know: this is actually *Super Mario USA*, the Japanese re-release.</video></p>

<p>Compare to its Famicom Disk System counterpart, <em>Yume Koujou: Doki Doki Panic</em>, and you’ll find a much more stationary game. This is because the Disk System game uses VRAM (as do all disk system games), and doesn’t have time to copy that much data into RAM during the short vertical blanking interval. With bankswitching, it takes no time at all, and allows a lot of the world to move.</p>

<p><img src="https://nicole.express/assets/img/nes/ddp.jpg" title="using a still image is cheating? yes I suppose" alt="Doki Doki Panic. It&#39;s not animated"/></p>

<h3 id="unrom-and-bankswitched-prg">UNROM and Bankswitched PRG</h3>

<p>Here’s <i>Rush ‘n’ Attack</i>, a game that uses the UNROM PCB. This game PCB uses 8kiB of CHR-RAM, but also has bankswitching for the program ROM. Bankswitching the program ROM can have some additional complexity, which is why this board is a bit more complicated.</p>

<p><img src="https://nicole.express/assets/img/nes/rush.jpg" title="a product of its time; russia would never attack anyone here in 2022" alt="Rush n Attack PCB, in the UNROM series, with multiple discrete logic chips and RAM instead of the character ROM"/></p>

<p>On the NES cartridge, typically there is a 32kiB window used for cartridge ROM. However, UNROM only has 16kiB of bankswitched ROM. The remaining 16kiB of the ROM are always available and in a known position between <code>$C000-$FFFF</code>. This is called a “fixed bank”. Why bother?</p>

<ol>
  <li>Discrete logic (and many ASICs too) does not start up in a reliable state. Therefore, at bootup, which bank is selected is unpredictable. Since the NES always starts by looking at the reset vector at <code>$FFFC</code>, having this part of ROM be fixed makes things more reliable. (For CHR, this isn’t as big of a deal, because the program can just make sure it sets the bank when it starts up)</li>
  <li>Switching a page is instantaneous; this is nice for animations, but it also means that if you’re executing code from a bank that’s switched, you suddenly end up in the next bank. The processor doesn’t know about your bankswitching, though, and will just keep executing code from that same address in the new bank. If your bankswitching happens in a fixed portion, then you won’t have to worry about getting your code switched out from underneath you.</li>
</ol>



<p>Discrete logic mappers continued to be used throughout the NES’ life due to their low cost and simple implementation. I don’t want to give the impression that they ceased to exist; in fact, most types of boards continued to coexist. New NROM games, without a mapper of any sort, came out as late as 1993, with Namco’s <em>Ms. Pac-Man</em>.</p>



<h2 id="asic-mappers">ASIC Mappers</h2>

<p>Once we go beyond the simpler discrete logic-based circuitboards, we can start to look at some of the more elaborate possibilities that ASIC mappers open up. On the other hand, though, I don’t want to imply that discrete logic <em>can’t</em> be used to create elaborate circuits. And on the third hand coming out of my chest, there are a <em>lot</em> of different boards and different chips out there. So I’ve decided to limit the rest of this post into looking at the Nintendo MMC series, which among the ASIC-based mappers are definitely the most common.</p>

<p>ASIC just means “application-specific integrated circuit”; this is a common industry term referring to creating a dedicated chip rather than piecing it together out of general-purpose chips. Arguably even the NES’ PPU and CPU are ASICs.</p>



<h2 id="the-nintendo-mmc1">The Nintendo MMC1</h2>

<p>The Nintendo MMC1 began appearing in cartridges in the first half of 1987. Here it is on Culture Brain’s <em>Hiryuu no Ken II</em>; it’s an “SLROM” board, which means that in addition to an MMC1, it has both program ROM and character ROM, but no additional RAM. For variety’s sake, this is a Famicom game, and as a result, does not have a lockout chip– you might be forgiven for thinking it did, though, if you didn’t look closely at that small Nintendo IC. But it has too many pins for that.</p>

<p><img src="https://nicole.express/assets/img/nes/mmc1.jpg" title="small number of pins-- big number of power!" alt="A board with the Nintendo MMC1. There are three chips; a CHR-ROM, PRG-ROM, and a smaller IC"/></p>

<p>The Nintendo MMC1 is a small chip which controls a lot of lines. It seems that in order to reduce the number of required pins, it’s actually communicated with in a serial fashion through a shift register, one bit at a time. Later MMC chips would “bite the bullet” and use larger packages instead, though it’s worth noting that any NES programmer should be used to dealing with shift registers; that’s how controllers are read.</p>

<p>In terms of capabilities, it’s primarily about bank-switching, as well as the capability of manipulating the other control lines. For example, the VRAM of the NES is so small, that it can only scroll smoothly horizontally or vertically, but not both. (This is called “nametable mirroring”, and uses the <code>CIRAM</code> pins.) On mapper-less or simpler cartridges, this was set in hardware; for example, since <em>Aspect Star “N”</em> only has vertical scrolling, it uses <a href="https://nicole.express/2020/making-of-aspect-star-n-cartridge-production.html">horizontal mirroring</a>. You can see a solder blob on the upper left of the RetroStage PCB I used.</p>

<p><img src="https://nicole.express/assets/img/asncart-1.jpg" title="Two years ago I typoed retroboard as retrobard, though you should know" alt="The discrete reproboard. A solder blob in the top left is labeled &#39;HORIZ&#39;"/></p>

<p>The MMC1 through its control circuit can not only control multiple switchable program and character ROM banks, it can change the mirroring on the fly. This allows for games like <em>Kid Icarus</em> (the first MMC1 game) and <em>Metroid</em>, where hallways can go vertically or horizontally, but never both.</p>

<p><img src="https://nicole.express/assets/img/fdstunez/disksys.jpg" title="I still love the font &#39;Avant Garde&#39;" alt="The Famicom Disk System disk drive, showing the logo"/></p>

<p>One thing I’m not sure about is if MMC1 was particularly designed for Famicom Disk System ports. The Famicom Disk System also allowed games to switch their mirroring on the fly, and this was necessary for gameplay. But it also had other functions the MMC1 did not duplicate, like timers and its <a href="https://nicole.express/2021/music-for-the-whole-family.html">extra sound channels</a>. (While that last one wasn’t an option in North America or Europe, it could’ve been done for Japan)</p>

<p>There was another Disk System feature that MMC1 brought to the cartridge system. Look at this cartridge circuit board (<em>Ultima: Exodus</em>, which was not a Disk System port, but it’s the same one used by <em>The Legend of Zelda</em>, which was) and see if you can figure it out.</p>

<p><img src="https://nicole.express/assets/img/nes/battery.jpg" title="Getting so many chips for your cartridge dollar" alt="An MMC1 circuitboard with a battery"/></p>

<p>That’s right: saved games, in this case courtesy of battery-backed SRAM rather than a floppy disk. As far as I know there’s no reason technically that earlier games with on-cartridge SRAM (even the mapperless <em>Family Basic</em>) couldn’t have saved it with a battery, but it was the MMC1 games that actually brought out that capability.</p>



<h3 id="by-your-powers-combined">By your powers combined</h3>

<p>One use of MMC1 you might not expect is in one of the most common NES games of all time, <em>Super Mario Bros./Duck Hunt/World Class Track Meet</em>, which was sold alongside the “Power Set”, which included the NES console, a Zapper light gun, and the Power Pad peripheral. The three-game multicart includes games for both of these accessories; and of course, the must-have <em>Super Mario Bros.</em>.</p>

<p><video src="/assets/img/nes/multicart.mp4" width="75%" autoplay="" loop="" muted=""> You don&#39;t have a video tag support or something? So you can&#39;t see this footage of *Super Mario Bros*/*Duck Hunt*/*World Class Track Meet*? Ah too bad.</video></p>

<p>All of these games were released separately without mappers at all, except for <em>World Class Track Meet</em>, which used the simple discrete-logic CNROM, much like <em>Championship Bowling</em>.</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>Mapper</th>
      <th>Mirroring</th>
      <th>PRG ROM</th>
      <th>CHR ROM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><em>Super Mario Bros</em></td>
      <td>NROM</td>
      <td>V</td>
      <td>32 kiB</td>
      <td>8 kiB</td>
    </tr>
    <tr>
      <td><em>Duck Hunt</em></td>
      <td>NROM</td>
      <td>V</td>
      <td>16 kiB</td>
      <td>8 kiB</td>
    </tr>
    <tr>
      <td><em>World Class Track Meet</em></td>
      <td>CNROM</td>
      <td>H</td>
      <td>32 kiB</td>
      <td>32 kiB</td>
    </tr>
    <tr>
      <td><strong>Total</strong></td>
      <td>MMC1</td>
      <td>Switchable</td>
      <td>128kiB</td>
      <td>64kiB</td>
    </tr>
  </tbody>
</table>

<p>MMC1 offers the ability to do the proper bankswitching to include the more complex CNROM game <em>World Class Track Meet</em>; the previous <em>Super Mario Bros.</em>/<em>Duck Hunt</em> multi-cart used a simpler discrete logic board.</p>

<p>You might notice that the board offers way too much ROM space. In the CHR-ROM, many of these pages are empty, but one of them contains what appears to be the background graphics of <em>Super Mario Bros. 2</em> for the Famicom Disk System. <a href="https://tcrf.net/Super_Mario_Bros._%2B_Duck_Hunt_%2B_World_Class_Track_Meet">TCRF</a> has some codes to let you use them in <em>Super Mario Bros.</em>, but of course that does result in some glitches.</p>

<p><img src="https://nicole.express/assets/img/nes/chr000.png" title="The shaded version of the &#39;Atari Font&#39; is something I&#39;ve always found very nice" alt="Background tiles of SMB2j"/></p>

<p>I’m not sure why this is there; perhaps they were considering an MMC1 conversion of <em>Super Mario Bros. 2</em>’s Japanese version at some time, but it’s worth noting that these tiles are after the tiles of the select screen, while all playable games are before. Could <em>Super Mario Bros./Duck Hunt/World Class Track Meet</em> have had a fourth game? I guess we’ll never be sure. <em>Super Mario Bros 2</em> would’ve required additional work to port above and beyond the existing games, being designed to load data from disk as well as using the FDS’ timer, but given that other disk system game ports used MMC1 it seems possible, and the timer could be worked around.</p>

<p><img src="https://nicole.express/assets/img/nes/blob.jpg" title="where&#39;d my resolution go" alt="Epoxy blobs on a small circuitboard"/></p>

<p>One other thing of interest about this game is that because it was produced in such high quantities, it uses “chip-on-board” or “epoxy blob” technology. Thankfully, use of this technology is fairly rare among Nintendo-manufactured boards of this period, only being seen in the very most popular or most manufactured boards. You do see it on some non-Nintendo manufactured Famicom games, though.</p>

<h2 id="nintendo-mmc2">Nintendo MMC2</h2>

<p>MMC1 was used in a <em>lot</em> of games. <a href="https://www.nesdev.org/wiki/MMC1">390</a>, if the NESdev wiki is to be trusted. So what about MMC2? It’s used in a whopping… one. But hey, if you’re going to be used in one game, at least be used in a good one.</p>

<p><img src="https://nicole.express/assets/img/nes/punchy.jpg" title="No Mike Tyson here" alt="Punch-Out Title screen"/></p>

<p><em>Punch-Out!!</em>, or <em>Mike Tyson’s Punch-Out!!</em> if you were early to the party, is an NES boxing title that has the good timing to come out at a high point of interest in the sport, and also the luck of being a good game. Well, that part might not be luck.</p>

<p>If you haven’t played it, it’s a behind-the-shoulder boxing game where you control the underdog fighter Little Mac as he rises up the ranks and defeats a series of colorful and cartoonish boxers, ending up with <del>Mike Tyson himself</del> Mr. Dream who isn’t Mike Tyson at all what are you talking about. I’m not very good at it, though, so expect to see the first fight.</p>

<p><img src="https://nicole.express/assets/img/nes/punched.jpg" title="Now the puncher has become the punch-ee... but I guess that&#39;s normal for boxing" alt="Little Mac gets beat up"/></p>

<p>The MMC2 can bankswitch both program ROM and character ROM, with two switchable banks for background and sprites. The program ROM is a bit interesting, with the 32kiB window divided into a 24kiB fixed block and only 8kiB that can be banked. But the most interesting thing about MMC2 is its character ROM handling.</p>

<p>So when we talked about bankswitching CHR-ROM, it’s important to note that at any given time, the PPU can only “see” 8kiB of ROM. MMC1 and the discrete logic boards we’ve looked at have the bankswitching controlled by the <strong>CPU</strong>. This is fine if you’re changing banks for the whole screen at a time, like <em>Super Mario Bros. 2</em>, but what if you want to change banks mid-screen? You’d have to carefully time your code; none of the mappers we’ve seen so far have provided timers of any sort to help with that, either.</p>

<p>On Nintendo MMC2, however, the developer sets two banks at once for each of its CHR banks using the CPU as usual. Then, two special tiles, <code>$FD</code> and <code>$FE</code>, allow rapid switching between them– this is because the MMC2 has access to the CHR bus mentioned before. The CPU doesn’t have to be involved at the moment of bankswitching; the presence of the tile tells the mapper all it needs to know. Let’s see how this looks in practice.</p>

<p><img src="https://nicole.express/assets/img/nes/pre-match.jpg" title="Glass Joe has nothing to fear from me" alt="Little Mac and Glass Joe compare stats"/></p>

<p>On this screen, Little Mac and Glass Joe compare stats. The interesting thing is that Joe and Mac are in different banks, while the text shares a bank with Mac. You can drive this home by looking at the screen in a nametable viewer in an emulator like FCEUX.</p>

<p><img src="https://nicole.express/assets/img/nes/nameless.png" title="Glass Joe did have to fear becoming numbers, though" alt="Little Mac is seen on the nametable, but his trainer is a sprite and his opponent is numbers"/></p>

<p>MMC2, however, allows bankswitching within a line with ease. Let’s use a hacked ROM to make FD and FE visible. (Note that in some cases the palette made my edited tiles not appear, so I have manipulated this screenshot to make it more clear)</p>

<p><img src="https://nicole.express/assets/img/nes/pre-match2.jpg" title="FDGlass Joe has nothing to fear from meFE" alt="Little Mac and Glass Joe compare stats, with FD and FE blocking out parts of the screen"/></p>

<p>One other place it’s used is for the “GET UP!” message when Little Mac is knocked out and Mario starts the count. (This screenshot is not manipulated, beyond the hacked ROM)</p>

<p><img src="https://nicole.express/assets/img/nes/get-up.jpg" title="Glass Joe is behind the FE, and he doesn&#39;t like it" alt="Glass Joe is standing on a mat made of FE tiles. The text at the bottom says GET UP!, but has an FD tile starting it."/></p>

<p>This fully PPU-controlled bankswitching feature doesn’t actually get used too much, which may be why MMC2 was never picked up again for later titles. Still, it definitely had its use for this game, and with the sales success of <em>Punch-Out!!</em>, that may have been enough to justify its existence.</p>

<h2 id="ooops-a-digression-the-namco-109">Ooops a digression: the Namco 109</h2>

<p>It’s commonly believed that while in Japan, Famicom publishers could do whatever they wanted and use whatever chips they wished, in America and Europe, Nintendo strictly limited them to using their in-house mappers. And it’s true that Nintendo did require that all licensees have their games manufactured in-house. But if that mapper requirement was true, how do you explain <em>this</em>?</p>

<p><img src="https://nicole.express/assets/img/nes/gauntlet.jpg" title="that tiny compressed nintendo text, lol" alt="Gauntlet NES using a DxROM board"/></p>

<p>This is the NES-DRROM, manufactured by Nintendo for the Tengen game <em>Gauntlet</em>. While Tengen would go on to make their own boards in violation of Nintendo’s licensing, this game is from the brief era in which they were Nintendo licensees, and the two chips on it are rather interesting.</p>

<p><img src="https://nicole.express/assets/img/nes/namco.jpg" title="namco wasn&#39;t brave enough to put their name on it" alt="A small IC labeled 109 JAPAN"/></p>

<p>First, the Namco 109. (Sometimes called the Namcot 109) This is part of a seemingly-identical series of Namco mappers, the 108, 109, 118 or 119. What they have in common is sophisticated PRG and CHR banking, with four switchable PRG banks, and a whopping 6 simultaneous switchable CHR banks: 2 in the <code>$0xxx</code> region used typically by backgrounds, and 4 in the <code>$1xxx</code> region of CHR-ROM typically used by sprites.</p>

<p>If you’re only familiar with the NES, you might be surprised to see a Namco chip; something this specific is unlikely to be useful for systems that aren’t the Famicom as far as I know. While licensing prevented Namco from publishing NES games under their own label until very late in the console’s life, it was one of the largest and most prolific Famicom developers, where the licensing was much looser and Namco could manufacture their own boards and chips in-house. They also sold their chips to other developers, and this one in particular seems to have been used quite a lot, especially in Japan.</p>

<p>What about the other chip?</p>

<p><img src="https://nicole.express/assets/img/nes/ramco.jpg" title="ramco" alt="A small IC labeled MB8416-A-15-SK"/></p>

<p>NESCardDB reports this as a 2kiB SRAM. There’s no battery for power, and this is actually attached to the CHR bus– but there’s also a CHR-ROM. In this case, the RAM is actually being used to provide additional nametables. While the NES has the capability for four screens’ worth of nametables, it only has enough RAM for two; this is the reason for the mirroring mentioned above. But by adding this extra RAM, any need for mirroring at all is eliminated. (The Namcot 109 doesn’t actually allow you to control mirroring, but this would be unnecessary here anyway)</p>

<p><img src="https://nicole.express/assets/img/nes/gaunt.jpg" title="Nicole shot the food, probably" alt="Gauntlet gameplay. Dungeon with lots of enemies"/></p>

<p>This extra RAM makes <em>Gauntlet</em>, a port of the arcade classic, possible. The game has scrolling in two-directions. With four nametables instead of two, <em>Gauntlet</em> avoids the attribute glitches on the right side of the screen in <em>Super Mario Bros. 3</em> (below); and indeed, since the game’s levels are the same size as the nametables: it doesn’t need to do any fancy code to load new parts of the level, and it can load it all at once.</p>

<p><img src="https://nicole.express/assets/img/nes/glitch.jpg" title="Nintendo sued Tengen because they were jealous of their mad programming skillz" alt="Super Mario Bros. 3 gameplay. The wooden tank has a tile that is cyan."/></p>

<p>Let’s take a look at those nametables.</p>

<p><img src="https://nicole.express/assets/img/nes/gtable.png" title="The leftmost column of tiles is also the rightmost column, it loops" alt="Gauntlet nametable, showing a match for where we are"/></p>

<p>Notice that the enemies show up here. <em>Gauntlet</em> is willing to go to such lengths to avoid scrolling; it actually uses software sprites to avoid flicker. And this explains why it goes to such lengths to avoid scrolling: unlike sprites, the tilemap on the NES can only be changed using the slower CHR-RAM process mentioned above, so freeing up vblank time from scrolling gives the game more time to move enemies. And it still does have slowdown despite this.</p>

<p>Tengen wasn’t the only one to use a Namco 109 chip in a US release; the first seems to be Data East’s <em>Ring King</em> in 1987, a port of Namco’s <em>Family Boxing</em>. (This version did not have the extra nametable RAM, so didn’t have the four-screen mirroring, but since it’s a boxing game, it didn’t need it) Sunsoft would also bring their own mappers to Nintendo-manufacturered boards for <em>Batman: Return of the Joker</em> and the (in)famous Scandinavian <em>Mr. Gimmick</em>.</p>

<p><img src="https://nicole.express/assets/img/nes/tengy.jpg" title="Tengen and Nintendo: Friends forever" alt="Tengen presents Gauntlet Licensed by Nintendo of America"/></p>

<p>So why did some companies, like Konami, prefer to switch to Nintendo-made mappers for the US releases of games? Well, I don’t have access to the licensing agreements Nintendo had their partners sign, but my guess is that it just came down to money. Tengen would switch to manufacturing their own games outside of Nintendo’s licensing system at the end of 1988, so perhaps the situation that produced <em>Gauntlet</em> wasn’t stable. (And that’s a fascinating story <a href="https://en.wikipedia.org/wiki/Atari_Games_Corp._v._Nintendo_of_America_Inc.">of its own</a>)</p>

<h2 id="nintendo-mmc3">Nintendo MMC3</h2>

<p>Another thing came along in the end of 1988: the MMC3 enhancement chip. This chip powered a lot of the console’s mega-hits, including <em>Super Mario Bros. 3</em>, the American <em>Super Mario Bros. 2</em>, <em>Adventure Island IV</em>, <em>Shadowgate</em>, <em>Kirby’s Adventure</em>, and the last licensed NES game in North America, <em>Wario’s Woods</em>. NESdev claims a list of 300 titles. Not as many as MMC1, but not too shabby.</p>

<p><img src="https://nicole.express/assets/img/nes/mmc3.jpg" title="that tiny compressed nintendo text, lol" alt="A small surface-mount IC labeled Nintendo MMC3A"/></p>

<p>The MMC3 pictured above comes from the game <em>Legacy of the Wizard</em>, whose Japanese version, <em>Dragon Slayer 4: Drasle Family</em> used a Namco 109 chip just like <em>Gauntlet</em>, though it didn’t have the additional nametable RAM. As it turns out, the MMC3’s PRG and CHR banking match the Namco 108 family. From its release in the fourth quarter of 1988, MMC3 began to be used for games ported from the Namco 108 chips.</p>

<p><img src="https://nicole.express/assets/img/nes/legacyt.jpg" title="the legacy of the blizzard is better" alt="Legacy of the Wizard with a board on top. The MMC3 is the same as above"/></p>

<p><em>Legacy of the Wizard</em> is a really fun game, but it doesn’t use many of the more advanced features of the MMC3. The Namcot 108 series <em>only</em> features bankswitching; it can’t even control nametable mirroring like the MMC1 did. The MMC3 can control mirroring and many other features; but since <em>Legacy of the Wizard</em> stays quite close to its Japanese original, we’ll need to look for a different game to show them off.</p>

<p><img src="https://nicole.express/assets/img/nes/drasle.jpg" title="we! are! drasle family! i got my pink blob monster slash dog and me!" alt="Legacy of the Wizard gameplay. Pochi walks by a dragon"/></p>



<h3 id="rares-high-speed">Rare’s <em>High Speed</em></h3>

<p><img src="https://nicole.express/assets/img/nes/speed.jpg" title="go go go go go go go go got to go fast" alt="High Speed with a circuitboard on top. The circuitboard is described below"/></p>

<p>Here’s Rare’s <em>High Speed</em>. It’s a pinball video game, and we all know how I like pinball. But you might also notice the circuitboard is a bit more complex than the <em>Legacy of the Wizard</em> board. This circuitboard, NES-TQROM, was only used by two games, both pinball conversions by Rare, and has the very interesting feature of the Sharp RAM chip.</p>

<p><img src="https://nicole.express/assets/img/nes/speeder.jpg" title="is this a racing game? are you suuuuuuuure" alt="High Speed title screen with a sweet red sports car"/></p>

<p>While the MMC3 could support additional program RAM, used in games like <em>Super Mario Bros. 3</em> or with battery backup in games like <em>Kirby’s Adventure</em>, or four nametables, like in <em>Rad Racer II</em>, this game uses the additional RAM to have simultaneously both CHR-RAM and CHR-ROM. Both can be banked simultaneously alongside each other; much of the game uses CHR-RAM for sprites like the ball, while also using ROM elsewhere, especially for the background. This feature did require an additional 74HC32 discrete logic OR chip to provide a chip select signal, so it goes beyond the stock MMC3 by one logic gate.</p>

<p><img src="https://nicole.express/assets/img/nes/pinball.jpg" title="i thought high speed used a launch button but it turns out I was thinking of high speed 2" alt="High Speed pinball gameplay"/></p>

<p>So first impressions off the bat are that <em>High Speed</em> looks great on NES, if perhaps a little busy. But there is an immortal problem of bringing pinball to game consoles. Pinball machines are pretty much always vertically oriented; this is due to gravity. Home televisions are oriented horizontally, and people rarely are willing to use <em>tate</em> mode. The 1978 <a href="https://nicole.express/2021/pinball-in-your-house.html">Sears Pinball Breakaway</a> solved this by changing the proportions. But this game needs to stick to the proportions of the real machine it’s based off of.</p>

<p>How does it solve the verticality problem?</p>

<p><img src="https://nicole.express/assets/img/nes/scrool.jpg" title="simcopter 1 reporting heavy traffic" alt="High Speed pinball gameplay. The bottom half of the screen is stationary"/></p>

<p>Scrolling, of course! Well, I say, “of course”, but there are actually plenty of quite good flip-screen pinball games. The problem of scrolling pinball, you see, is that it results in the flippers moving on the screen; the player really wants to be focused on the flippers, so it helps if they’re in the same place. <em>High Speed</em> splits the difference by focusing you on the bottom of the screen where the main flippers are, but the secondary flipper does move.</p>

<p>But you might be thinking. “Hey Nicole! That’s a lot of tiles on screen. And those are pretty detailed, so it’s not like clever reuse can get you that far” And you’d be right! Let’s take a look at the nametables. These were, as usual, taken using the FCEUX emulator; the white bar represents where the scanline on the screen is. Basically you can think of this as a picture of what the nametables look like to the PPU when it’s drawing at the white bar.</p>

<p><img src="https://nicole.express/assets/img/nes/4tables.png" title="sometimes you want to go, where the table knows your name" alt="High Speed pinball. There are four segments of the screen"/></p>

<p>The game is rapidly switching out the nametable four times per screen. Unlike the MMC2, on the MMC3 the CPU still has to handle all the bankswitching itself, but it has another trick up its sleeve: the IRQ. The 6502 has no multithreading or multicore capability, but has interrupt capability: a pin on the CPU that can receive a signal that will force it to drop what it’s doing and run a separate process, called an <strong>interrupt handler</strong>. The 6502 has two interrupts on board.</p>

<p>On the NES, one of the two interrupts, the NMI (non-maskable interrupt, but the non-maskableness of it isn’t very important today), is hooked up to the PPU, and can be used to let the CPU know when the PPU is in vblank. This is generally very important for reasons discussed above. The IRQ, however, is available on the cartridge slot. This is another “secret power” of the Famicom design, allowing the cartridge to keep track of things the processor can’t.</p>



<p>Have you seen <a href="https://www.youtube.com/watch?v=l7rce6IQDWs">Ben Eater’s YouTube video on creating a video card</a>? The Nintendo PPU is quite a bit more complex, but both that and Ben’s homebrew card have something in common: they are built around a series of timers. A television signal must produce certain pulses at certain times, and the data for certain lines at certain times.</p>

<p>The key thing about this is that it means that it’s very reliable on when it does certain things. For example, let’s take a simple screen from <em>Aspect Star “N”</em>. This screen is showing a glitch, but it doesn’t matter.</p>

<p><img src="https://nicole.express/assets/img/aspect/four-enemies.png" title="MissingNo the Mouse!" alt="An early development screen of Aspect Star N showing an unexpected fourth enemy"/></p>

<p>All of the tiles forming the level are the tilemap, and are made out of tiles in the block <code>$0000-$0FFF</code>. So the PPU must access those tiles when drawing the screen. Nicole, the aspect markers, and the four enemies are all drawn using sprites, and the sprites in this game are stored in the area <code>$1000-$1FFF</code>. The PPU fetches the sprites for each line separately from the tile, and most crucially, always fetches <em>something</em>, even when there are no sprites on that line. Because it’s just a series of timers and counters.</p>

<p>The MMC3 uses this knowledge to provide a <strong>scanline counter</strong>. If a game uses backgrounds in the first half of the 8kiB CHR zone, and sprites from the second half– as most games do, and as the MMC3 CHR layout encourages– then you can detect when it goes from fetching tiles, to when it fetches sprites, just by seeing when fetches go about <code>$1000</code>. This means looking at the PPU address line <code>A12</code>, which is right there on the cartridge edge.</p>

<p>Now of course, this is a bit of a delicate dance, and it can be broken. But if care is used, a scanline counter can be set, that is decremented each time that <code>A12</code> line change occurs (with some in-chip filtering to eliminate false positives). When the counter reaches zero, it will fire an IRQ, and if the dance succeeded, that will have been the number of lines you set in the counter. You can see how this allows <em>High Speed</em> to use far more tiles for its tilemap than should be possible; it’s also used for the status bar in <em>Super Mario Bros. 3</em>. (Where there are some minor glitches often visible at the seam, like above the text “World 8” here)</p>

<p><img src="https://nicole.express/assets/img/nes/smb3.jpg" title="Mario then realized in horror that he was in the Famicom version" alt="Mario 3. The sidebar is separated by some glitchy line, which reveals the secret"/></p>

<p>The MMC3 appeared at the end of 1988. This is a time when Nintendo started to see increasing competition from the Sega Master System; the Sega Master System also has a scanline counter and interrupt. You can’t really say that Nintendo “stole” the idea (similar timing concepts definitely predate Sega’s console; including on the Famicom Disk System, though that wasn’t tied to scanlines), but it’s possible that they were implemented only now because competition were heating up on the market.</p>

<h2 id="mmc4">MMC4</h2>

<p>The MMC3 did not have the MMC2’s “change CHR banks using a magic tile” trick. However, Nintendo brought that back with the MMC4. In fact, the MMC4 is pretty much identical in capabilities to the MMC2, except the program ROM banking is structured differently, and there are some minor technical implementation differences.</p>

<p>But you won’t see any MMC4 games in the west. As far as I know, just three titles used it:</p>

<ul>
  <li><em>Famicom Wars</em></li>
  <li><em>Fire Emblem</em></li>
  <li><em>Fire Emblem Gaiden</em></li>
</ul>

<p>What do all of these games have in common? Despite their modern successors having huge western fanbases, during the NES era they never left Japan. Another thing all these games have in common is the heavy use of Japanese-language text.</p>

<p><img src="https://nicole.express/assets/img/nes/emblem.jpg" title="this is the very first piece of in-game dialogue in the game. making up for the effort in the SMB3 screenshot" alt="The first dialogue in fire emblem. The text box is surrounded by FD and FE."/></p>

<p>Unlike <em>Punch-Out!!</em>, the FD and FE tiles aren’t always blank. In this game, <em>Fire Emblem</em>, they form the borders of textboxes; this makes perfect sense, allowing the game to switch in a different bank for text and character portraits. The game has both hiragana and katakana, which use a lot of the CHR space.</p>

<p>MMC4 does not have the scanline IRQ feature that MMC3 had, though, which may explain why it wasn’t used as often by developers. Or perhaps it just was exclusive for Intelligent Systems, and they didn’t want to share.</p>

<h2 id="nintendo-mmc5">Nintendo MMC5</h2>

<p>We already saw one MMC5 game mentioned; the beefy <em>Metal Slader Glory</em>. MMC5 is definitely the most advanced Nintendo mapper, and possibly is the most advanced mapper to be used by anyone on the NES. For example, it doesn’t have a single bankswitching layout. It has multiple, which can be selected and even switched on the fly. It uses a deep knowledge of the internal state of the NES to allow for graphics tricks that were unthinkable at the system’s release. It even has expansion audio, though since this board (<em>Laser Invasion</em> by Konami) is a North American release, it won’t be hooked up.</p>

<p><img src="https://nicole.express/assets/img/nes/MMC5.jpg" title="laser invasion is mmc5 on easy mode" alt="Laser Invasion circuit board. It&#39;s bigger than the other boards we&#39;ve seen, and the MMC5 chip is a large surface-mount part"/></p>

<p>The MMC5 is the only Nintendo MMC chip that doesn’t just augment the capabilities of the PPU, it augments the CPU beyond just bankswitching. It features a built in 8-bit multiplier (16-bit output); the 6502 can’t do multiplication natively, so there are definitely cases where this will speed things up. This sort of CPU assistance would become a lot more popular on the Super Nintendo.</p>

<p>The first MMC5 game seems to have been <em>Nobunaga’s Ambition II</em>, released in Japan in February of 1990. The SNES came out in Japan at the end of that year, so there was only a limited window in which the MMC5 was the best home hardware Nintendo had.</p>

<h3 id="expanded-attributes">Expanded attributes</h3>

<p>So what kind of tricks were up the MMC5’s sleeve? Well, let’s take a look at a tactical battle in <em>Nobunaga’s Ambition II</em> to start.</p>

<p><img src="https://nicole.express/assets/img/nes/nobo.jpg" title="gridzzz" alt="an offset grid in Nobunaga&#39;s Ambition II"/></p>

<p>Now, if you’re familiar with the NES hardware, you might already see what’s impressive. But if you’re not, let’s go into a bit of detail about attribute tables. See, the NES tilemap is made out of 8x8 tiles, each of which can have four colors from a set of four palettes. Let’s take a look at <em>Aspect Star “N”</em>. I’ve died, which will limit the number of sprites on screen. The main thing to look at is the tilemap under the 16x16 grid.</p>

<p><img src="https://nicole.express/assets/img/nes/boring-tiles.png" title="could I have just turned sprites off, since I&#39;m using an emulator? yes." alt="Aspect Star N, divided into 16x16 regions."/></p>

<p>Notice that things like the Aspect tiles have their own palette, but are limited to their own 16x16 region. The only thing that crosses these barriers are the sprites that Nicole is made out of. This is called the “attribute table” on the NES; you can only change the colors of the tilemap within a 16x16 block. This is a major reason so many things on NES games are 16x16 tiles in size. Whereas in <em>Nobunaga’s Ambition II</em>, things are different.</p>

<p><img src="https://nicole.express/assets/img/nes/exciting-tiles.png" title="thank gods for this game&#39;s auto-play feature" alt="Nobunaga&#39;s Ambition, divided into 16x16 regions. Colors cross regions"/></p>

<p>Notice that there’s no way to arrange the 16x16 grid so that it lines up with the tilemap palettes. The attributes are no longer 16x16, but are now 8x8, the same size as the tiles. How did they manage this?</p>

<p>The PPU attribute tables are just a part of the nametables; they’re at the end, but they’re at known spots in RAM. That RAM is, of course, accessed over the PPU bus. It turns out that the PPU fetches a palette for each 8x8 tile. The MMC5 keeps very close track of the PPU timing, so it knows when to swap out for the palette it wants; it can even change the CHR bank on the fly for each tile as well. This allows for a huge number of tiles on screen, and for more advanced color patterns. (A downside, though, is that the same expansion table is used for every nametable)</p>

<h3 id="vertical-split-mode-and-scanline-timing">Vertical split mode and scanline timing</h3>

<p>Another fun party trick the MMC5 can play with its expansion RAM is the use of a vertically split mode, by keeping track of each scanline, and swapping out which nametable to read from when a certain horizontal point is reached. A downside here is that it doesn’t interact particularly well with horizontal scrolling, but it’s still good enough to put a cool effect at the beginning of HAL Laboratory’s <em>Uchuu Keibitai SDF</em>.</p>

<p><img src="https://nicole.express/assets/img/nes/vert.jpg" title="welcome to space kirby" alt="A vertically split screen with spaceship parts on each side"/></p>

<p>The scanline detection of the MMC5 is much more accurate than the MMC3, since instead of relying on the PPU switching from nametables to sprites and looking at just one address line, it relies on close examination of nametable fetches. This requires more logic and a more complex circuit, but it allows for a much more accurate timer.</p>

<p>As a result, MMC5 doesn’t technically have a scanline counter. It actually has a direct <strong>scanline IRQ</strong>. Instead of counting down from a particular point, you just tell MMC5 which scanline you want an interrupt on. Notice that the <em>Super Mario Bros. 3</em> screenshot above had some glitchiness at the seam, which Rare was able to avoid through careful timing. Meanwhile, look at this neat takeoff sequence from <em>Laser Invasion</em>.</p>

<p><video src="/assets/img/nes/invade.mp4" width="75%" controls=""> You don&#39;t have a video tag support or something? So you can&#39;t see this footage of *Laser Invasion* </video></p>

<p>Those are some <em>very</em> impressive visuals for the humble NES, and they’re made possible by the highly accurate scanline timing of MMC5.</p>

<p>The MMC5 has a number of other features as well, including timers added in the MMC5A variant. This is just a taste; unfortunately, due to its expense and late release, MMC5 was not nearly as widely used as MMC1 or MMC3; NESdev claims only 15 games.</p>

<h2 id="nintendo-mmc6">Nintendo MMC6</h2>

<p>The MMC line ends on kind of an uninteresting note. The MMC6 is just a variant of the MMC3, used in <em>StarTropics</em> and <em>StarTropics II</em>. It supports less save RAM; only 1kiB vs. 8kiB. That’s about it.</p>

<p>Oh, and one other thing. Ever seen this label on an NES cart?</p>

<p><img src="https://nicole.express/assets/img/nes/poweroff.jpg" title="I think they made the text red to stress its importance, but it&#39;s not as readable against the gold sticker as the black is" alt="If you are saving your game information for later play, you must hold in the reset button on the Control Deck while turning off the power. Failure to do so may result in the loss of your stored game information."/></p>

<p>Why did you need to hold RESET while turning off the power? Well, the power switch on the NES just cuts off the power supply. As the 6502 loses power, it will continue to try to run its program, and can for a brief period run in an unpredictable mode where it could write to the wrong address or do other unpredictable things. This isn’t a big deal; unless it happens to write to those magic addresses that are battery-backed. Then it could corrupt your saved games. Holding RESET basically puts the processor in a stasis where it won’t do anything unpredictable.</p>

<p>The MMC6, on the other hand, has a special address which allows it to protect the memory. At this point to corrupt the memory the NES would have to first hit the protect address by chance, and then hit the memory; this is much more unlikely, and the <a href="https://archive.org/details/star-tropics-nes-hiresscans/StarTropics%20-%20Manual%20%28Searchable%29/mode/2up"><em>StarTropics</em> manual</a> removes the ubiquitous warning about holding in the RESET button.</p>

<p>MMC6 and MMC3 are so similar that the ubiquitous INES standard for ROM headers doesn’t actually distinguish the two. However, this can cause issues with the sound driver in the game <em>Low G Man</em>; the issue was obscure enough that it was missed during the standard’s creation.</p>

<p>And that’s the last MMC chip!</p>

<h2 id="a-quick-digression-on-the-super-nintendo">A quick digression on the Super Nintendo</h2>

<p>The Super Nintendo does not expose the S-PPU over the cartridge slot like the NES did. Instead, it has 64kiB of VRAM, which is definitely nothing to sneeze at. The S-PPU is arguably one of the most powerful graphics chips of the 16-bit console generation, with its Mode 7 even surpassing the mighty Neo Geo in some ways by having scaling and enlarging of a single tilemap. So instead, SNES expansion chips tended to augment the CPU, using things like digital signal processor chips to perform calculations faster than the sluggish 3.5MHz 65C816 could.</p>

<p>Still, over time even the S-PPU stuttered with the demands of 3D graphics. <em>Star Fox</em> famously introduced the SuperFX chip (codenamed “Mario”) to deal with this and provide some impressive polygonal graphics at a less impressive frame rate.</p>

<p><img src="https://nicole.express/assets/img/nes/superfx.jpg" title="super mario fx when" alt="The SuperFX. There is a ROM and a RAM, but the MARIO chip is the star"/></p>

<p>Without access to the PPU bus, how does the SuperFX work? It renders to a block of RAM, and then the CPU’s job is to copy that block into the VRAM. An NES game that used a similar technique of offloading its rendering could in theory provide faster results by using the PPU bus; one example I know of that goes further than MMC5 is YouTube user TheRasteri’s <a href="https://www.youtube.com/watch?v=FzVN9kIUNxw">homebrew port of <em>Doom</em></a> using a Raspberry Pi. After looking into what expansion chips on the NES did during the system’s life, I can’t really say it’s cheating here. Nintendo would’ve done the same thing if they had the opportunity.</p>

<p><img src="https://nicole.express/assets/img/nes/gameover.jpg" title="i don&#39;t remember my pinball machine sending me to space" alt="High Speed game over"/></p>

  </div>

  
</article>

      </div>
    </div></div>
  </body>
</html>
