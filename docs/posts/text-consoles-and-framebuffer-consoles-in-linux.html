<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://utcc.utoronto.ca/~cks/space/blog/linux/TextAndFramebufferConsoles">Original</a>
    <h1>Text consoles and framebuffer consoles in Linux</h1>
    
    <div id="readability-page-1" class="page"><div><h2>Text consoles and framebuffer consoles in Linux</h2>

	<p><small>June 10, 2022</small></p>
</div><div><p>If you&#39;ve been running x86 Linux servers for long enough, you&#39;ve
probably noticed two changes in <a href="https://utcc.utoronto.ca/~cks/space/blog/linux/ManyConsolesOfLinux">the kernel&#39;s text console</a>. On the one hand, the text console has gotten
substantially bigger, sporting sizes like 128x40 instead of the
much smaller old sizes, for example 80x25. On the other hand, text
output to the console has generally gotten slower, usually much
slower than you would expect for the change in console size. These
two changes are not unrelated, because they are both part of a
fundamental change in how the kernel console normally worked and
works on x86 hardware.</p>

<p>For a long time, the Linux kernel text console on x86 hardware used
<a href="https://en.wikipedia.org/wiki/VGA-compatible_text_mode">VGA text mode</a>
(<a href="https://en.wikipedia.org/wiki/Text_mode#PC_common_text_modes">also</a>).
The important thing about VGA text mode is that what the kernel
wrote into display memory in order to show things was not pixels
but characters (okay, 8-bit codepoints). The actual <a href="https://en.wikipedia.org/wiki/VGA-compatible_text_mode#Text_buffer">text buffer</a> used
two bytes in order to add colour and attributes, but that&#39;s only a
small change. The important thing is that manipulating an 80x25
buffer of 16-bit objects is quite fast. Completely repainting the
entire screen requires writing only 4,000 bytes.</p>

<p>When we got <a href="https://utcc.utoronto.ca/~cks/space/blog/linux/KernelModesettingBackground">kernel mode setting</a>,
this VGA text mode way to display console text went away. Instead,
once the kernel sets the mode it switches over to a <a href="https://www.kernel.org/doc/html/latest/fb/fbcon.html">framebuffer
console</a>.
The framebuffer &#39;text&#39; console is text rendering done on top of a
fully pixel-addressable framebuffer (or these days on top of <a href="https://dri.freedesktop.org/wiki/DRM/">the
kernel&#39;s DRM system and a suitable graphics driver</a>). As you may have noticed,
the kernel&#39;s framebuffer console implementation is not the fastest
thing in the world (for whatever reason).</p>

<p>(I believe that the framebuffer console driver on x86 hardware
emulates VGA text mode, but it&#39;s only an emulation and the actual
display of text is done by directly copying font bitmaps around and
otherwise manipulating the framebuffer on a pixel by pixel basis.)</p>

<p>I&#39;m not certain how the console works these days if you use the
&#39;<code>nomodeset</code>&#39; <a href="https://www.kernel.org/doc/html/latest/admin-guide/kernel-parameters.html">kernel parameter</a>.
Some things in <a href="https://blog.dowhile0.org/2022/04/22/fedora-36-a-brave-new-drm-kms-only-world/">Fedora 36: A brave new (DRM/KMS only) world</a>
suggest that the kernel may now always uses some sort of framebuffer
and framebuffer console rendering, not VGA text mode rendering (even
on systems without the Fedora 36 change). On the other hand, an
Ubuntu 22.04 machine booted with &#39;<code>nomodeset</code>&#39; reports &#39;Console:
colour VGA+ 80x25&#39; (and no additional console messages, such as,
eg, &#39;Console: switching to colour frame buffer device 128x48&#39;).
Energetic people may get more from <a href="https://www.kernel.org/doc/html/latest/driver-api/console.html">the kernel&#39;s Console Drivers
documentation</a>
than I did.</p>
</div></div>
  </body>
</html>
