<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.atomic14.com/2023/05/04/hue-light-hacking.html">Original</a>
    <h1>Hue Light Hack</h1>
    
    <div id="readability-page-1" class="page"><div>
            <p><a href="https://www.youtube.com/c/atomic14" title="Watch my videos!" "="">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://www.patreon.com/atomic14" title="Help support me on Patreon!" "="">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://twitter.com/mrbananas" title="Follow me on twitter" "="">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://www.facebook.com/atomic14Videos" "="">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://github.com/atomic14" title="Fork me on github" "="">
          <i></i>
        </a>
          ·  
    
  
  <a href="https://www.atomic14.com/index.html">Posts</a>  ·  
  <a href="https://www.atomic14.com/videos/index.html">Videos</a>  ·  
  <a href="https://www.atomic14.com/about/index.html">About</a>
</p>
          </div><div>
            <p>I’ve got a bunch of Philip’s Hue Color light bulbs, so I thought it might be fun to take one apart and do a bit of hacking.</p>

<p>If you’re here from Hacker News - <a href="https://youtu.be/WCniHh2_F7s">watch the video - it’s really good!</a> (Even if I do say so myself)</p>

<lite-youtube videoid="WCniHh2_F7s" playlabel="Adding Memory To ChatGPT"></lite-youtube>

<h2 id="disassembling-the-hue-light-bulb">Disassembling the Hue Light Bulb</h2>

<p>First, we need to open up the light bulb. Using a spudger, carefully pry the plastic diffuser away from the base, working around the stubborn silicon sealant. I got slightly bored and once I’d made a gap shoved a screwdriver in there to pry it off.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/spudger.webp" alt="Spudger"/></p>

<p>Next, remove the inner diffuser and the aluminum PCB with the LEDs on it. You might need to remove some surrounding plastic and metal for this.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/led-pcb.webp" alt="LED PCB"/></p>

<p>To pop off the base of the light bulb I squashed it in a vice until the plastic cracked - you may want to find a less destructive method.</p>

<h2 id="inside-the-hue-light-bulb">Inside the Hue Light Bulb</h2>

<p>The power board and the logic board are separate components, they seperate quite easily even when covered in the potting compound. Once they are separate you can attack each on in turn. Removing the potting compound from the power board is pretty easy. For the logic board there’s a plastic surround and potting compound can be pretty difficult to get off - it’s easy to lose or damage some of the small ICs.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/lost-components.webp" alt="Lost Components"/></p>

<p>But after a bit of work you’ll end up with these three PCBS:</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/pcbs.webp" alt="PCBs"/></p>

<h3 id="the-power-board">The Power Board</h3>

<p>There’s nothing too exciting about this - it takes in the mains voltage, runs it through a bridge rectifier and then there’s a switch mode power supply generating 5V along with a hight voltage (probably around 24V) for driving the LEDs.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/power-board.webp" alt="POWER Board"/></p>

<h3 id="led-pcb">LED PCB</h3>

<p>The LED PCB has an 8-pin socket labeled A to H. B and C were pretty straightforward - they just connect to the thermistor. The other pins were slightly confusing, but by connecting the power supply through a resistor and trying different combinations, we can determine which pins that control the various LED colors.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/led-pcb2.webp" alt="LED PCB"/></p>

<p>This gives us the slightly confusing schematic below - but don’t worry all will become clear:</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/schematic1.webp" alt="LED Schematic"/></p>

<h3 id="the-logic-board">The Logic Board</h3>

<p>The logic board has 5 P-Channel MOSFETs, buzzing out the source and drain of these we end up with this much more sensible schematic.</p>

<p>Each set of LEDs can be bypassed by turning on the MOSFETs - it’s pretty clever.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/schematic2.webp" alt="LED Schematic Improved"/></p>

<p>The board uses an AP8802 step-down constant current LED driver, capable of supplying up to 1A. It’s configured to supply around 0.5A to the LEDs. What’s very clever with the way the LEDs and MOSFETs are laid out is that we only need one LED driver chip for all the LEDs - this is a relatively expensive component compared to the jelly bean MOSFETs, transistors and other components.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/ap8802.webp" alt="AP8802"/></p>

<p>The MCU on the logic board is an Atmel SAM R21, a 32-bit ARM Cortex M0+ processor with a 2.4GHz ISM band transceiver for Zigbee communication. It has 256KB of Flash and 32KB of SRAM and runs at 48MHz.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/sam-r21.webp" alt="Atmel SAM R21"/></p>

<p>The transmitter on this uses a PCB antenna with a bunch of capacitors and inductors to tune it to the right frequency.</p>

<h2 id="does-it-still-work-and-some-more-reverse-engineering">Does it still work? And some more reverse engineering</h2>

<p>It does! If we solder some power cables on and provide it with 5V the light bulb shows up in the Hue app on my phone. It we connect 24V to the LED supply then they light up. We can control the colors from the Hue app - though since I lost one of the ICs we don’t get perfect colors.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/it-works.webp" alt="It Works"/></p>

<p>With the board we can work out what signals are coming from the MCU. These resistors here are connected directly to the MCU and go through this set of ICs to drive the PMOS FETs. The schematic is something like this - we have a level shifter followed by a push-pull driver connected to the gate of the MOSFET.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/schematic3.webp" alt="LED Driver"/></p>

<p>Probing the resistors while changing the color in the Hue app we work out the signals for each of the colors and for the white LEDs.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/probing.webp" alt="Probing"/></p>

<p>The last thing I checked was the control input of the AP8802 - I wasn’t sure if this was being used to control the overall brightnesss, but it turns out that this is just left floating and is only pulled low when the light is fully turned off.</p>



<p>With the R,G,B and white signals worked out we can now solder some wires to the MCU side of the resistors and connect them to a breadboard. By driving LEDs at low power directly from the MCU we can create various colors and control the brightness.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/wires.webp" alt="Wires"/></p>

<p>That works pretty well, we can control the LEDs without any problems. All three colors work and the two whites also work - though I’m suspicious that the “warm white” LEDs may be used for yellow.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/breadboard.webp" alt="Breadboard"/></p>

<p>I also tried out my old Moonlamp - it’s the first electronics project I posted to YouTube.</p>

<p>It’s got a RGB LED with a common annode. Since it doesn’t have a white LED I’ve just ORed the signal in with the RGB signals.</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/moonlamp-schematic.webp" alt="Moon Lamp Schematic"/></p>

<p>I’ve used my old board which already has MOSFETs on it for driving the LEDs. It works really well!</p>

<p><img src="https://www.atomic14.com/assets/article_images/2023-05-05/moonlamp.webp" alt="Moon Lamp"/></p>

<p>If you want to watch a video of it in action you can see it here:</p>

<lite-youtube videoid="WCniHh2_F7s" playlabel="Adding Memory To ChatGPT"></lite-youtube>

          </div><div>
            <p><a href="https://www.youtube.com/c/atomic14" title="Watch my videos!" "="">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://www.patreon.com/atomic14" title="Help support me on Patreon!" "="">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://twitter.com/mrbananas" title="Follow me on twitter" "="">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://www.facebook.com/atomic14Videos" "="">
          <i></i>
        </a>
          ·  
    
  
    
        <a href="https://github.com/atomic14" title="Fork me on github" "="">
          <i></i>
        </a>
          ·  
    
  
  <a href="https://www.atomic14.com/index.html">Posts</a>  ·  
  <a href="https://www.atomic14.com/videos/index.html">Videos</a>  ·  
  <a href="https://www.atomic14.com/about/index.html">About</a>
</p>
          </div></div>
  </body>
</html>
