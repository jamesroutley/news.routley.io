<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://igorstechnoclub.com/server-sent-events-sse-are-underrated/">Original</a>
    <h1>Server-Sent Events (SSE) Are Underrated</h1>
    
    <div id="readability-page-1" class="page"><div>
    

    
        
    

    
        

        <p>
            <i>
                <time datetime="2024-12-25T21:26Z">
                    25 Dec, 2024
                </time>
            </i>
        </p>
    

    <p>Most developers know about WebSockets, but Server-Sent Events (SSE) offer a simpler, often overlooked alternative that deserves more attention. Let&#39;s explore why this technology is underrated and how it can benefit your applications.</p>
<h2 id="what-are-server-sent-events">What are Server-Sent Events?</h2><p>SSE establishes a one-way communication channel from server to client over HTTP. Unlike WebSockets&#39; bidirectional connection, SSE maintains an open HTTP connection for server-to-client updates. Think of it as a radio broadcast: the server (station) transmits, and clients (receivers) listen.</p>
<h2 id="why-are-they-underrated">Why are they Underrated?</h2><p>Two main factors contribute to SSE&#39;s underappreciation:</p>
<ol>
<li>WebSocket&#39;s Popularity: WebSockets&#39; full-duplex communication capabilities often overshadow SSE&#39;s simpler approach</li>
<li>Perceived Limitations: The unidirectional nature might seem restrictive, though it&#39;s often sufficient for many use cases</li>
</ol>
<h2 id="key-strengths-of-sse">Key Strengths of SSE</h2><h3 id="1-implementation-simplicity">1. Implementation Simplicity</h3><p>SSE leverages standard HTTP protocols, eliminating the complexity of WebSocket connection management.</p>
<h3 id="2-infrastructure-compatibility">2. Infrastructure Compatibility</h3><p>SSE works seamlessly with existing HTTP infrastructure:</p>
<ul>
<li>Load balancers</li>
<li>Proxies</li>
<li>Firewalls</li>
<li>Standard HTTP servers</li>
</ul>
<h3 id="3-resource-efficiency">3. Resource Efficiency</h3><p>Lower resource consumption compared to WebSockets due to:</p>
<ul>
<li>Unidirectional nature</li>
<li>Standard HTTP connection usage</li>
<li>No persistent socket maintenance</li>
</ul>
<h3 id="4-automatic-reconnection">4. Automatic Reconnection</h3><p>Built-in browser support for:</p>
<ul>
<li>Connection interruption handling</li>
<li>Automatic reconnection attempts</li>
<li>Resilient real-time experience</li>
</ul>
<h3 id="5-clear-semantics">5. Clear Semantics</h3><p>One-way communication pattern enforces:</p>
<ul>
<li>Clear separation of concerns</li>
<li>Straightforward data flow</li>
<li>Simplified application logic</li>
</ul>
<h2 id="practical-applications">Practical Applications</h2><p>SSE excels in these scenarios:</p>
<ol>
<li>Real-time News Feeds and Social Updates</li>
<li>Stock Tickers and Financial Data</li>
<li>Progress Bars and Task Monitoring</li>
<li>Server Logs Streaming</li>
<li>Collaborative Editing (for updates)</li>
<li>Gaming Leaderboards</li>
<li>Location Tracking Systems</li>
</ol>
<h2 id="implementation-examples">Implementation Examples</h2><h3 id="server-side-flask">Server-Side (Flask)</h3><div><pre><span></span><span>from</span> <span>flask</span> <span>import</span> <span>Flask</span><span>,</span> <span>Response</span><span>,</span> <span>stream_with_context</span>
<span>import</span> <span>time</span>
<span>import</span> <span>random</span>

<span>app</span> <span>=</span> <span>Flask</span><span>(</span><span>__name__</span><span>)</span>

<span>def</span> <span>generate_random_data</span><span>():</span>
    <span>while</span> <span>True</span><span>:</span>
        <span>data</span> <span>=</span> <span>f</span><span>&#34;data: Random value: </span><span>{</span><span>random</span><span>.</span><span>randint</span><span>(</span><span>1</span><span>,</span><span> </span><span>100</span><span>)</span><span>}</span><span>\n\n</span><span>&#34;</span>
        <span>yield</span> <span>data</span>
        <span>time</span><span>.</span><span>sleep</span><span>(</span><span>1</span><span>)</span>

<span>@app</span><span>.</span><span>route</span><span>(</span><span>&#39;/stream&#39;</span><span>)</span>
<span>def</span> <span>stream</span><span>():</span>
    <span>return</span> <span>Response</span><span>(</span>
        <span>stream_with_context</span><span>(</span><span>generate_random_data</span><span>()),</span>
        <span>mimetype</span><span>=</span><span>&#39;text/event-stream&#39;</span>
    <span>)</span>

<span>if</span> <span>__name__</span> <span>==</span> <span>&#39;__main__&#39;</span><span>:</span>
    <span>app</span><span>.</span><span>run</span><span>(</span><span>debug</span><span>=</span><span>True</span><span>)</span>
</pre></div>
<h3 id="client-side-javascript">Client-Side (JavaScript)</h3><div><pre><span></span><span>const</span><span> </span><span>eventSource</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>EventSource</span><span>(</span><span>&#34;/stream&#34;</span><span>);</span>

<span>eventSource</span><span>.</span><span>onmessage</span><span> </span><span>=</span><span> </span><span>function</span><span>(</span><span>event</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>const</span><span> </span><span>dataDiv</span><span> </span><span>=</span><span> </span><span>document</span><span>.</span><span>getElementById</span><span>(</span><span>&#34;data&#34;</span><span>);</span>
<span>    </span><span>dataDiv</span><span>.</span><span>innerHTML</span><span> </span><span>+=</span><span> </span><span>`&lt;p&gt;</span><span>${</span><span>event</span><span>.</span><span>data</span><span>}</span><span>&lt;/p&gt;`</span><span>;</span>
<span>};</span>

<span>eventSource</span><span>.</span><span>onerror</span><span> </span><span>=</span><span> </span><span>function</span><span>(</span><span>error</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>console</span><span>.</span><span>error</span><span>(</span><span>&#34;SSE error:&#34;</span><span>,</span><span> </span><span>error</span><span>);</span>
<span>};</span>
</pre></div>
<h2 id="code-explanation">Code Explanation</h2><h3 id="server-side-components">Server-Side Components:</h3><ul>
<li><code>/stream</code> route handles SSE connections</li>
<li><code>generate_random_data()</code> continuously yields formatted events</li>
<li><code>text/event-stream</code> mimetype signals SSE protocol</li>
<li><code>stream_with_context</code> maintains Flask application context</li>
</ul>
<h3 id="client-side-components">Client-Side Components:</h3><ul>
<li><code>EventSource</code> object manages SSE connection</li>
<li><code>onmessage</code> handler processes incoming events</li>
<li><code>onerror</code> handles connection issues</li>
<li>Automatic reconnection handled by browser</li>
</ul>
<h2 id="limitations-and-considerations">Limitations and Considerations</h2><p>When implementing SSE, be aware of these constraints:</p>
<h3 id="1-unidirectional-communication">1. Unidirectional Communication</h3><ul>
<li>Server-to-client only</li>
<li>Requires separate HTTP requests for client-to-server communication</li>
</ul>
<h3 id="2-browser-support">2. Browser Support</h3><ul>
<li><a href="https://caniuse.com/?search=EventSource">Well-supported</a> in modern browsers</li>
<li>May need polyfills for older browsers</li>
</ul>
<h3 id="3-data-format">3. Data Format</h3><ul>
<li>Primary support for text-based data</li>
<li>Binary data requires encoding (e.g., Base64)</li>
</ul>
<h2 id="best-practices">Best Practices</h2><ol>
<li>Error Handling</li>
</ol>
<div><pre><span></span><span>eventSource</span><span>.</span><span>onerror</span><span> </span><span>=</span><span> </span><span>function</span><span>(</span><span>error</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>if</span><span> </span><span>(</span><span>eventSource</span><span>.</span><span>readyState</span><span> </span><span>===</span><span> </span><span>EventSource</span><span>.</span><span>CLOSED</span><span>)</span><span> </span><span>{</span>
<span>        </span><span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;Connection was closed&#34;</span><span>);</span>
<span>    </span><span>}</span>
<span>};</span>
</pre></div>
<ol start="2">
<li>Connection Management</li>
</ol>
<div><pre><span></span><span>// Clean up when done</span>
<span>function</span><span> </span><span>closeConnection</span><span>()</span><span> </span><span>{</span>
<span>    </span><span>eventSource</span><span>.</span><span>close</span><span>();</span>
<span>}</span>
</pre></div>
<ol start="3">
<li>Reconnection Strategy</li>
</ol>
<div><pre><span></span><span>let</span><span> </span><span>retryAttempts</span><span> </span><span>=</span><span> </span><span>0</span><span>;</span>
<span>const</span><span> </span><span>maxRetries</span><span> </span><span>=</span><span> </span><span>5</span><span>;</span>

<span>eventSource</span><span>.</span><span>onclose</span><span> </span><span>=</span><span> </span><span>function</span><span>()</span><span> </span><span>{</span>
<span>    </span><span>if</span><span> </span><span>(</span><span>retryAttempts</span><span> </span><span>&lt;</span><span> </span><span>maxRetries</span><span>)</span><span> </span><span>{</span>
<span>        </span><span>setTimeout</span><span>(()</span><span> </span><span>=&gt;</span><span> </span><span>{</span>
<span>            </span><span>// Reconnect logic</span>
<span>            </span><span>retryAttempts</span><span>++</span><span>;</span>
<span>        </span><span>},</span><span> </span><span>1000</span><span> </span><span>*</span><span> </span><span>retryAttempts</span><span>);</span>
<span>    </span><span>}</span>
<span>};</span>
</pre></div>
<h2 id="real-world-example-chatgpts-implementation">Real-World Example: ChatGPT&#39;s Implementation</h2><p>Modern Language Learning Models (LLMs) utilize Server-Sent Events (SSE) for streaming responses. Let&#39;s explore how these implementations work and what makes them unique.</p>
<h2 id="the-general-pattern">The General Pattern</h2><p>All major LLM providers implement streaming using a common pattern:</p>
<ul>
<li>Return <code>content-type: text/event-stream</code> header</li>
<li>Stream data blocks separated by <code>\r\n\r\n</code></li>
<li>Each block contains a <code>data: JSON</code> line</li>
</ul>
<h3 id="important-note">Important Note</h3><p>While SSE typically works with the browser&#39;s EventSource API, LLM implementations can&#39;t use this directly because:</p>
<ul>
<li>EventSource only supports GET requests</li>
<li>LLM APIs require POST requests</li>
</ul>
<h2 id="openai-implementation">OpenAI Implementation</h2><h3 id="basic-request-structure">Basic Request Structure</h3><div><pre><span></span>curl<span> </span>https://api.openai.com/v1/chat/completions<span> </span><span>\</span>
<span>  </span>-H<span> </span><span>&#34;Content-Type: application/json&#34;</span><span> </span><span>\</span>
<span>  </span>-H<span> </span><span>&#34;Authorization: Bearer </span><span>$OPENAI_API_KEY</span><span>&#34;</span><span> </span><span>\</span>
<span>  </span>-d<span> </span><span>&#39;{</span>
<span>    &#34;model&#34;: &#34;gpt-4o-mini&#34;,</span>
<span>    &#34;messages&#34;: [{&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;Hello, world?&#34;}],</span>
<span>    &#34;stream&#34;: true,</span>
<span>    &#34;stream_options&#34;: {</span>
<span>      &#34;include_usage&#34;: true</span>
<span>    }</span>
<span>  }&#39;</span>
</pre></div>
<h3 id="response-format">Response Format</h3><p>Each chunk follows this structure:</p>
<div><pre><span></span><span>&#34;data&#34;</span><span>:{</span>
<span>   </span><span>&#34;id&#34;</span><span>:</span><span>&#34;chatcmpl-AiT7GQk8zzYSC0Q8UT1pzyRzwxBCN&#34;</span><span>,</span>
<span>   </span><span>&#34;object&#34;</span><span>:</span><span>&#34;chat.completion.chunk&#34;</span><span>,</span>
<span>   </span><span>&#34;created&#34;</span><span>:</span><span>1735161718</span><span>,</span>
<span>   </span><span>&#34;model&#34;</span><span>:</span><span>&#34;gpt-4o-mini-2024-07-18&#34;</span><span>,</span>
<span>   </span><span>&#34;system_fingerprint&#34;</span><span>:</span><span>&#34;fp_0aa8d3e20b&#34;</span><span>,</span>
<span>   </span><span>&#34;choices&#34;</span><span>:[</span>
<span>      </span><span>{</span>
<span>         </span><span>&#34;index&#34;</span><span>:</span><span>0</span><span>,</span>
<span>         </span><span>&#34;delta&#34;</span><span>:{</span>
<span>            </span><span>&#34;content&#34;</span><span>:</span><span>&#34;!&#34;</span>
<span>         </span><span>},</span>
<span>         </span><span>&#34;logprobs&#34;</span><span>:</span><span>null</span><span>,</span>
<span>         </span><span>&#34;finish_reason&#34;</span><span>:</span><span>null</span>
<span>      </span><span>}</span>
<span>   </span><span>],</span>
<span>   </span><span>&#34;usage&#34;</span><span>:</span><span>null</span>
<span>}</span>

<span>&#34;data&#34;</span><span>:{</span>
<span>   </span><span>&#34;id&#34;</span><span>:</span><span>&#34;chatcmpl-AiT7GQk8zzYSC0Q8UT1pzyRzwxBCN&#34;</span><span>,</span>
<span>   </span><span>&#34;object&#34;</span><span>:</span><span>&#34;chat.completion.chunk&#34;</span><span>,</span>
<span>   </span><span>&#34;created&#34;</span><span>:</span><span>1735161718</span><span>,</span>
<span>   </span><span>&#34;model&#34;</span><span>:</span><span>&#34;gpt-4o-mini-2024-07-18&#34;</span><span>,</span>
<span>   </span><span>&#34;system_fingerprint&#34;</span><span>:</span><span>&#34;fp_0aa8d3e20b&#34;</span><span>,</span>
<span>   </span><span>&#34;choices&#34;</span><span>:[</span>
<span>      </span><span>{</span>
<span>         </span><span>&#34;index&#34;</span><span>:</span><span>0</span><span>,</span>
<span>         </span><span>&#34;delta&#34;</span><span>:{</span>
<span>            </span>
<span>         </span><span>},</span>
<span>         </span><span>&#34;logprobs&#34;</span><span>:</span><span>null</span><span>,</span>
<span>         </span><span>&#34;finish_reason&#34;</span><span>:</span><span>&#34;stop&#34;</span>
<span>      </span><span>}</span>
<span>   </span><span>],</span>
<span>   </span><span>&#34;usage&#34;</span><span>:</span><span>null</span>
<span>}</span>
</pre></div>
<p>Key headers returned by OpenAI:</p>
<div><pre><span></span>HTTP/2 200
date: Wed, 25 Dec 2024 21:21:59 GMT
content-type: text/event-stream; charset=utf-8
access-control-expose-headers: X-Request-ID
openai-organization: user-esvzealexvl5nbzmxrismbwf
openai-processing-ms: 100
openai-version: 2020-10-01
x-ratelimit-limit-requests: 10000
x-ratelimit-limit-tokens: 200000
x-ratelimit-remaining-requests: 9999
x-ratelimit-remaining-tokens: 199978
x-ratelimit-reset-requests: 8.64s
x-ratelimit-reset-tokens: 6ms
</pre></div>
<h2 id="implementation-details">Implementation Details</h2><h3 id="stream-completion">Stream Completion</h3><p>The stream ends with:</p>

<h3 id="usage-information">Usage Information</h3><p>Final message includes token usage:</p>
<div><pre><span></span><span>&#34;data&#34;</span><span>:{</span>
<span>   </span><span>&#34;id&#34;</span><span>:</span><span>&#34;chatcmpl-AiT7GQk8zzYSC0Q8UT1pzyRzwxBCN&#34;</span><span>,</span>
<span>   </span><span>&#34;object&#34;</span><span>:</span><span>&#34;chat.completion.chunk&#34;</span><span>,</span>
<span>   </span><span>&#34;created&#34;</span><span>:</span><span>1735161718</span><span>,</span>
<span>   </span><span>&#34;model&#34;</span><span>:</span><span>&#34;gpt-4o-mini-2024-07-18&#34;</span><span>,</span>
<span>   </span><span>&#34;system_fingerprint&#34;</span><span>:</span><span>&#34;fp_0aa8d3e20b&#34;</span><span>,</span>
<span>   </span><span>&#34;choices&#34;</span><span>:[</span>
<span>      </span>
<span>   </span><span>],</span>
<span>   </span><span>&#34;usage&#34;</span><span>:{</span>
<span>      </span><span>&#34;prompt_tokens&#34;</span><span>:</span><span>11</span><span>,</span>
<span>      </span><span>&#34;completion_tokens&#34;</span><span>:</span><span>18</span><span>,</span>
<span>      </span><span>&#34;total_tokens&#34;</span><span>:</span><span>29</span><span>,</span>
<span>      </span><span>&#34;prompt_tokens_details&#34;</span><span>:{</span>
<span>         </span><span>&#34;cached_tokens&#34;</span><span>:</span><span>0</span><span>,</span>
<span>         </span><span>&#34;audio_tokens&#34;</span><span>:</span><span>0</span>
<span>      </span><span>},</span>
<span>      </span><span>&#34;completion_tokens_details&#34;</span><span>:{</span>
<span>         </span><span>&#34;reasoning_tokens&#34;</span><span>:</span><span>0</span><span>,</span>
<span>         </span><span>&#34;audio_tokens&#34;</span><span>:</span><span>0</span><span>,</span>
<span>         </span><span>&#34;accepted_prediction_tokens&#34;</span><span>:</span><span>0</span><span>,</span>
<span>         </span><span>&#34;rejected_prediction_tokens&#34;</span><span>:</span><span>0</span>
<span>      </span><span>}</span>
<span>   </span><span>}</span>
<span>}</span>
</pre></div>
<h2 id="conclusion">Conclusion</h2><p>SSE provides an elegant solution for real-time, server-to-client communications. Its simplicity, efficiency, and integration with existing infrastructure make it an excellent choice for many applications. While WebSockets remain valuable for bidirectional communication, SSE offers a more focused and often more appropriate solution for one-way data streaming scenarios.</p>
<p>Want more content like this? Sign up to my blog!</p>


    

    
        

        
            


        
    


  </div></div>
  </body>
</html>
