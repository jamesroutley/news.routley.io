<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/fish-shell/fish-shell/pull/9512">Original</a>
    <h1>Rewrite it in Rust</h1>
    
    <div id="readability-page-1" class="page"><div disabled="" sortable="">
<div>
          <p dir="auto">I&#39;ve been alternating between obsessed with and simply always entertaining in the back of my mind the idea of a rust-powered fish for many years now (and have discussed that with other team members), so I&#39;m approaching this with an open mind, but also with concerns. I must say that I knew this was coming for many months now from following <a data-hovercard-type="user" data-hovercard-url="/users/ridiculousfish/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ridiculousfish">@ridiculousfish</a> on GitHub (<g-emoji alias="heart" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png">❤️</g-emoji>), and have been wondering how it would the topic would be broached.</p>
<p dir="auto">I passionately believe that rust is the way forward for writing any new code, especially in a cross-platform context. Quite apart from all the memory and concurrency safety it brings to the table, the general approach of the language and the community to always put correctness first and foremost has built a strong culture of correct, well-designed, and fairly maintainable software engineering. The package management is great, the team is fantastic, and support in the broader software world has been extremely positive and welcoming.</p>
<p dir="auto">To go further, I have written my own fish-compatible rewrite (<em>not</em> port) of fish&#39;s tokenizer and was making progress on the AST and parser when I last had my &#34;burning desire&#34; to see something like fish but in rust. I was maintaining it on my private git server and not GitHub, but I&#39;ve pushed it to GH in case anyone cares to take a look: <a href="https://github.com/mqudsi/velvet">https://github.com/mqudsi/velvet</a></p>
<p dir="auto">Having said all that, I worry that rushing any part of this could be a death knell for the project. A quality rewrite (or port) takes time, on the magnitude of years rather than days. One good example to take inspiration from is tectonic, a xelatex port that started off with machine-rewritten code and then manually made progress on actual, idiomatic rust conversions... but even that was a greenfield project and not a first-party effort and so not saddled with some of the concerns we would be saddled by. The recommended module-by-module approach is definitely a great suggestion for a starting place, and I think it has great potential.</p>
<p dir="auto">Off the top of my head, some concerns or points:</p>
<ul dir="auto">
<li>Compatibility, obviously. Fish runs on archaic hardware for fun. This would be the end of that. That&#39;s not a reason that should stand in the way of progress, but it&#39;s something we can&#39;t turn a blind eye to and would have to quite clearly signal that we&#39;re ok giving up all platforms that don&#39;t run (modern versions of) rust.</li>
<li>Idiomatic rust is too high-level for fish. You don&#39;t fork in rust, using the standard library interface doesn&#39;t give you access to poll/select/epoll/kqueue/whatever natively. async io is a horrible fake cludge with tokio/async_std faking it with thread pools or whatnot and performing far worse than truly native async implementations. We&#39;d have to go that mostly alone to keep the same code we have (thinking &#34;port&#34; and not &#34;rewrite&#34; and aiming to preserve what we have).</li>
<li>Despite whether we call it a &#34;port&#34; or a &#34;rewrite&#34; there&#39;s going to be a heck of a lot of rewriting taking place. Subtle bugs will creep in. Subtle compatibility fixes that weren&#39;t properly documented or annotated will be lost.</li>
<li>We will be in a state of partial limbo until this completes one way or the other. We won&#39;t want to make any major changes to the C++ codebase while we&#39;re trying to get to feature parity in the rust one. Depending on how things unfold this could greatly hinder further progress in the project.</li>
<li>Not all core team members are fluent in rust. This seems unfair.</li>
<li>C++ isn&#39;t really a &#34;legacy&#34; language yet, no matter how much we wish the world would start treating it like that given all its warts and shortcomings.</li>
<li>I understand what <a data-hovercard-type="user" data-hovercard-url="/users/ridiculousfish/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ridiculousfish">@ridiculousfish</a> meant by &#34;Rust is what we need to turn on concurrent function execution&#34; but respectfully disagree. A complete rewrite (or port, if you prefer) to another language is a great time to facilitate that, but it&#39;s hardly a requirement, though I guess it could functionally be considered one if you want to take into account correctness, maintainability, etc.</li>
</ul>
      </div>
</div></div>
  </body>
</html>
