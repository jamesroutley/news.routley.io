<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nicole.express/2023/bang-bang-youre-dead.html">Original</a>
    <h1>Yes, You Can Use Lightguns on LCDs– Sometimes</h1>
    
    <div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p>Old-school cathode ray tube TVs have become <em>de rigeur</em> in the retro scene as the <em>true</em> way to experience retro games “the way they were designed”. But there’s a lot of benefits to modern TVs; they’re lighter, usually bigger, and there are a lot of upscalers that give really good pictures. But then you give up peripherals like light guns, that are permanently tied to the television’s timing. Or <em>are</em> they?</p>

<h2 id="the-humble-lightgun">The humble lightgun</h2>

<p>For the purposes of this blog post, let’s set out some ground rules.</p>

<ul>
  <li>When I say “lightgun”, I mean the guns that were shipped for the Famicom and the Nintendo Entertainment System. Different guns worked different ways.</li>
  <li>When I say “LCDs”, I pretty much mean all modern television screens. In fact, even the short-lived generation of HD widescreen CRT TVs share this problem.</li>
</ul>

<p>But what problem? Well, I’m getting ahead of myself.</p>

<p><img src="https://nicole.express/assets/img/gunz/zapper.jpg" title="Not to be confused with the ?ZAPer, who is just some guy who cheats in ZZT" alt="THE INCREDIBLY ACCURATE LIGHT SENSING VIDEO GUN."/></p>

<p>The Zapper was the western packaging of the Famicom Gun. Either way they work the same inside, just one looks like a raygun and is fondly remembered, and one looks like a realistic gun and doesn’t seem to have been nearly as popular. Make your own cultural assumptions.</p>

<p><img src="https://nicole.express/assets/img/blast/gun.JPEG" title="plastic guns for a plastic world" alt="The Famicom Gun, much more realistic looking"/></p>

<p>This is one case where Nintendo drew on their history. They had actually been making light gun games since 1973’s Laser Clay Shooting System and toys before that. The exact details of each system they’ve used varied a bit, but the basic concept doesn’t differ too much.</p>

<p>The Zapper gun consists of a trigger and a photodiode, basically a simple light sensor. When the trigger is pulled (on the NES and Famicom, this is a falling edge from 5V to 0V), the game reads the signals from the photodiode to determine what happened. (Interestingly, on the NES and Famicom, the Zapper trigger and photodiode have their own pins, and aren’t read serially like the controller is)</p>

<p>The thing to stress is, the photodiode is literally one bit of information. All the game can figure out from that is whether there’s light going into it at any particular time.</p>

<p>Let’s use a concrete example– <em>Hogan’s Alley</em>.</p>

<p><img src="https://nicole.express/assets/img/gunz/title.png" title="no YOUR framemeister is too bright" alt="Hogan&#39;s Alley title screen"/></p>

<p>Game mode “A” is a simple shooting gallery. You are given three figures, and have to make a split-second decision which of the three you should shoot.</p>

<p><img src="https://nicole.express/assets/img/gunz/trio.png" title="basically &#39;profiling the game&#39;" alt="Hogan&#39;s Alley gameplay, showing the three figures"/></p>



<p>So there’s your problem. The photodiode gives you one bit of information; that’s not nearly enough to distinguish the three characters. After all, they all use similarly colored pixels, not that the photodiode even has color information.</p>

<p>Well, you might already know the answer. The photodiode only provides one bit… <em>at a time</em>. By setting a clever number of frames, you can extract more information.</p>

<p><img src="https://nicole.express/assets/img/gunz/violence.gif" title="Look just don&#39;t shoot people it&#39;s rude" alt="Hogan&#39;s Alley, showing the three figures, and then alternating through each white frame described below"/></p>

<p>First, a black frame. This helps prevent cheating; at this point, it knows that your gun is pointed at a TV which is turned off. Then, a succession of frames that are mostly black, with white targets. Each one corresponds to one of the figures on screen. Since this all happened so fast, your gun is still pointing at the same place it was when you pulled the trigger.</p>

<p>Why does it only check two? It thinks it figured out who I shot. And there’s the problem; I was pointing the gun at an LCD TV; a small widescreen monitor I keep next to my desktop alongside a CRT as a test setup.</p>

<p>The problem is, a CRT TV draws frames in real time. The Nintendo knows that when it draws a frame, that frame drawing is corresponding with the moving electron beam of the television in real time. In fact, <a href="https://www.nesdev.org/wiki/Zapper">NESdev</a> claims that the photodiodes use have their signal die in as short as 10 scanlines, so the game needs to check more frequently than the 60Hz clock that usually governs an NES game.</p>

<p>What the Famicom <em>doesn’t</em> expect is that the screen could be <em>late</em>.</p>

<h3 id="resolutions-and-frequencies">Resolutions and frequencies</h3>

<p>Pretty much all analog video signals, RGB or otherwise, are imitating the raster of a television. That is to say, it assumes there is only a dot being drawn on screen at a time, and it provides signals that are timed as that dot moves across the screen.</p>

<p><img src="https://nicole.express/assets/img/inter&amp;lace/progressive-scan.png" title="i wrote a blog post on interlacing we&#39;re not talking about it today" alt="Successive lines being scanned on a television"/></p>

<p>This works perfectly fine for a CRT television that’s tuned to expect a line frequency of 15kHz and field rate of 60Hz, like most standard-definition televisions in Japan or here in North America. However, this assumption breaks down very fast. Those 60Hz monitors almost certainly can’t even handle PAL video, with the same line frequency. For example, here’s a 60Hz Monitor /// failing to handle <a href="https://nicole.express/2021/pal-in-the-usa.html">a 50Hz signal</a> coming out of an SC-3000.</p>

<p><img src="https://nicole.express/assets/img/pal/monitor3.jpg" title="the long-lasting phosphor isn&#39;t helping; and might stymie a light gun too, actually" alt="The Monitor III with an NTSC raster failing miserably to display PAL video"/></p>

<p>The same issue applies to VGA CRTs and HD CRT televisions, whose native line frequencies are much higher. Non-CRT televisions don’t even draw the screen in the same way! And oftentimes even a digital input signal won’t be at the same resolution as the panel in the screen.</p>

<p>So every single modern TV has a scaler inside. These can be particularly bad at handling 240p, but pretty much every signal that comes into a television will need some processing to match how it works inside.</p>

<p>And that’s why your lightgun won’t work on an LCD television. By the time the screen shows the white frames, the game already thinks you lost and went out to do something else. This is true even the Framemeister scaler I’m using here; as its very name implies, it’s a frame-buffer, so before even the TV has seen the signal it’s a frame behind.</p>

<p>Note that even “Game Modes” can’t get the lag down to the zero it needs to be here. The signal just isn’t suitable for your television. It <em>must</em> be processed.</p>

<h2 id="so-thats-it">So… that’s it?</h2>

<p>Obviously not, didn’t you read the title of the post? You can still play <em>Wild Gunman</em>! The GAME A mode, anyways. It turns out this doesn’t actually go through the dance above; there’s only one thing on screen. It just checks your timing. But be warned; you can still lose!</p>

<p><img src="https://nicole.express/assets/img/gunz/gunman.jpg" title="bang" alt="Wild Gunman loss screen"/></p>

<p>But what if you want to play a <del>better</del> different lightgun game? Even the other game modes on <em>Wild Gunman</em> won’t work like this.</p>

<p>Here’s the clever thing. While your television is definitely displaying the screen late, if it’s a decent scaler, the lag is going to be constant. If it’s constant, it can be predicted. If it can be predicted, the game can be reprogrammed to wait that long.</p>

<p>Now, you might say, that seems like a lot of work! And it is. But thankfully, I don’t have to do it– the folks at <a href="http://neslcdmod.com/">LCDMOD</a> already have. Unfortunately, this is a pretty considerable mod, so patches are mostly limited to the earlier titles.</p>

<p><img src="https://nicole.express/assets/img/gunz/allee.jpg" title="look I like Hogan&#39;s Alley okay" alt="Hogan&#39;s Alley gameplay, showing the three figures"/></p>

<h3 id="tools-of-the-trade">Tools of the trade</h3>

<p>It’s worth noting that Nintendo, which had been making light toys for awhile, was already wise to ways people cheated. One way they got around that was to use a photodiode that was most sensitive to the 15kHz light of a CRT television electron beam. That way, in addition to the black frame check above, it wouldn’t work to just point the gun at a lightbulb or other light source.</p>

<p><img src="https://nicole.express/assets/img/gunz/tomy.jpg" title="honestly the black plastic is a pretty nice look" alt="A Tomee light gun. It has no visible branding, and is made of orange and black plastic"/></p>

<p>Of course, an LCD TV doesn’t put off a 15kHz light. Thankfully, the solution to this is pretty simple. Just use a third-party light gun– <em>Duck Hunt</em> is legendary enough that they still make these things. You don’t need to buy <a href="https://hyperkinstore.com/hyper-blaster-hd-hyperkin/">Hyperkin’s</a> model; I used a “Tomee” branded one and it also had a compatible photodiode. In this case being cheap is better.</p>



<p>Note that I’m not sure if these modern guns are made for the Famicom, where, as I noted, the light gun seems to have been a lot less popular. (<em>Gumshoe</em>, a first-party Nintendo light-gun game, was only released in the west; a rare case of Nintendo ignoring its own home market.) Personally, I’m using an <a href="https://misteraddons.com/products/nes-controllers-to-famicom-console-adapter">adapter</a> from MiSTer Addons; make sure to use the controller 2 position. (Also not sponsored)</p>

<p>And, well, that’s it. Well, you need a way to play modded ROMs on your console, too, and dump the original ROMs so you can patch them. But I’m assuming most people who read this blog can figure that out?</p>

<h3 id="it-just-works">It just works?</h3>

<p>Yep! At least it did for me.</p>

<p><img src="https://nicole.express/assets/img/gunz/time.jpg" title="that time was also wrong" alt="Hogan&#39;s Alley title screen with a delay time in the top of the screen"/></p>

<p>Note that generally, the title screens of the supported games have been modded to add a system to detect when the gun is pressed, and figure out the particular lag time for your particular TV; after all, this can vary considerably from television to television. (The 0.0 earlier was from when I ran it on a CRT)</p>

<p>All of these screenshots were taken from my composite-modded (and <a href="https://nicole.express/2022/what-does-the-nes-say.html">stereo-modded</a>) Famicom connected through the RGB Blaster through the Framemeister, but my actual goal was to use the <a href="https://nicole.express/2019/battle-of-the-neslikes.html">RetroUSB AVS</a>, which forms part of my living room setup. Its slightly-different framerate didn’t matter at all, thankfully.</p>

<h2 id="can-sega-do-what-nintendoes">Can Sega do what Nintendoes?</h2>

<p>Now, you might wonder, does this apply to the Sega Light Phaser as well? After all, the <a href="https://nicole.express/2021/i-am-the-mark-iii.html">Master System</a> had a great many games using this light gun, generally reported to be more advanced and more accurate than the Nintendo counterpart.</p>

<p><img src="https://nicole.express/assets/img/gunz/phased.jpg" title="Sensitive. Caring. Even loving. Our researchers say that the Sega Light Phaser is the most affectionate peripheral we&#39;ve made yet." alt="The back of the box of the Sega Light Phaser, which calls it &#39;Sensitive&#39; and &#39;Super accurate&#39;"/></p>

<p>Well, uh, I don’t have a Light Phaser. But I’m pretty sure that it won’t work. Now, the light phaser is a photodiode and a trigger, much like the NES Zapper, Famicom Gun, or its clones. The big difference is the sensitivity of the photodiode– essentially, while the Zapper’s takes 10-25 scanlines to go from “on” to “off” after it stops seeing light, the Light Phaser is fast enough that, from the perspective of the 3.5MHz Z80, more or less instant. If the photodiode is on, the Phaser sees light. If it’s not, then it doesn’t.</p>

<p><img src="https://nicole.express/assets/img/gunz/gangz.jpg" title="named for Clarence W. Gangster, I assume" alt="Gangster Town title screen"/></p>

<p>Here’s <em>Gangster Town</em>. Now as I said, I don’t have a light phaser. But here’s something interesting about the light phaser: it doesn’t use extra pins. The trigger of the light phaser is also button 1 on the joypad. So even though I can’t successfully shoot something, I can see what the game does when it <em>tries</em> to detect if I shot something.</p>



<p>The game starts with a feature that I have to assume Sega added mostly to show off how accurate the phaser is; you write in your name by using the phaser to shoot the letters. This would take a lot of frames to check every single letter if this worked the same way as the Zapper.</p>

<p><img src="https://nicole.express/assets/img/gunz/grid.gif" title="re-read the box text above, it warned you" alt="A grid of letters to input your name, alternating with a plain white frame"/></p>

<p>The Light Phaser doesn’t draw any boxes; it just turns the screen entirely white for several frames. This is made possible by two things. First, that faster photodiode. But also, the Sega Master System has some features the NES doesn’t: horizontal and vertical counters.</p>

<p>A Master System game can read two IO registers to determine exactly what horizontal pixel (HCounter) and what scanline (VCounter) is being drawn. Even better, because horizontal beam timing is hard (ask any <a href="https://nicole.express/2023/have-you-read-atari-today.html">Atari 2600</a> programmer), it latches the HCounter. While the photodiode is active, the HCounter won’t change, so it will appear “stuck” at the value of the first horizontal position where the gun saw the screen. Vertical timing is more forgiving, so no latch is needed.</p>

<p>Of course, the gun will be pointing (the photodiode will “see”) an area on the screen larger than one pixel, so some processing of these signals is necessary; the <a href="https://www.smspower.org/Development/SMSOfficialDocs#HOWTHEGUNWORKS">Sega official documentation</a> recommends doing some averaging across frames to get a good signal. But in theory this is much more accurate than the Zapper, and doesn’t require the white boxes.</p>

<p>But look at what we’ve done here: the Master System is literally reading in-line with the electron beam. This means that for this to work, you really do need an electron beam that moves in sync with the VDP. An LCD just won’t give you that moving dot, no matter how much delay you add.</p>

<p>While you could fall back to the white boxes with delays approach if you were writing Master System Light Phaser homebrew for HDTVs, it would be harder to implement than the NES, because it would require much stricter timing. After all, the photodiode is going to go out much sooner; the slower photodiode on the Zapper gives some leeway. I doubt anyone will bother. The town can keep its gangsters one more day.</p>

<p><img src="https://nicole.express/assets/img/gunz/scott.jpg" title="GREAT SCOTT, YOU&#39;VE GOT ZERO POINTS!" alt="Gangster Town attract mode, showing Gangsters in pinstripe suits marching around a brightly-colored city"/></p>

<p><em>Note that there are more elaborate ways to play lightgun games on modern TVs, including one, the <a href="https://www.lightgunverter.com/">LightGunVerter</a>, which promises Master System support, and uses a Wiimote as a gun and internally fakes the signal timing to match what the console might expect. This device is no longer manufactured, but it is an open source project, so perhaps I might take a future look at it.</em></p>

  </div>

  
</article>

      </div>
    </div></div>
  </body>
</html>
