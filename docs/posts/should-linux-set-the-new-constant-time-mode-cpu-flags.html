<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lore.kernel.org/lkml/YwgCrqutxmX0W72r@gmail.com/">Original</a>
    <h1>Should Linux set the new constant-time mode CPU flags?</h1>
    
    <div id="readability-page-1" class="page"><pre id="b">From: Eric Biggers &lt;ebiggers@kernel.org&gt;
To: x86@kernel.org, linux-arm-kernel@lists.infradead.org
Cc: linux-crypto@vger.kernel.org, linux-kernel@vger.kernel.org,
	Adam Langley &lt;agl@google.com&gt;,
	&#34;Jason A. Donenfeld&#34; &lt;Jason@zx2c4.com&gt;,
	Ard Biesheuvel &lt;ardb@kernel.org&gt;
Subject: <a href="#r" id="t">Should Linux set the new constant-time mode CPU flags?</a>
Date: Thu, 25 Aug 2022 23:15:58 +0000	<a href="#r">[thread overview]</a>
Message-ID: &lt;YwgCrqutxmX0W72r@gmail.com&gt; (<a href="https://lore.kernel.org/lkml/YwgCrqutxmX0W72r@gmail.com/raw">raw</a>)

Hi,

Intel and ARM recently published documentation that says that no instructions
are guaranteed to be constant-time with respect to their data operands, unless a
&#34;data independent timing&#34; flag in the IA32_UARCH_MISC_CTL register (Intel) or
DIT register (arm64) is set:

* <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/best-practices/data-operand-independent-timing-isa-guidance.html">https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/best-practices/data-operand-independent-timing-isa-guidance.html</a>
* <a href="https://developer.arm.com/documentation/ddi0595/2021-06/AArch64-Registers/DIT--Data-Independent-Timing">https://developer.arm.com/documentation/ddi0595/2021-06/AArch64-Registers/DIT--Data-Independent-Timing</a>

This is a major problem for crypto code, which needs to be constant-time,
especially with respect to keys.  And since this is a CPU issue, it affects all
code running on the CPU.  While neither company is treating this as a security
disclosure, to me this looks exactly like a CPU vulnerability.

For Intel, given that the mitigation is to set an MSR flag, it seems that the
kernel will need to do that -- similar to the MSR flags that enable mitigations
for speculative execution vulnerabilities.

For arm64, it&#39;s not clear to me whether the DIT flag is privileged or not.  If
privileged, I expect it would need to be set by the kernel just like the Intel
flag.  If unprivileged, I expect there will still be work to do in the kernel,
as the flag will need to be set when running any crypto code in the kernel.

I&#39;m wondering if people are aware of this issue, and whether anyone has any
thoughts on whether/where the kernel should be setting these new CPU flags.
There don&#39;t appear to have been any prior discussions about this.  (Thanks to
Adam Langley, who maintains BoringSSL, for bringing this to my attention.)

- Eric
</pre><hr/><pre><a href="https://lore.kernel.org/lkml/Ywh09ZXBZFA3R0W6@worktop.programming.kicks-ass.net/" rel="next">next</a>             <a href="#R">reply</a><a id="related">	</a>other threads:[<a href="https://lore.kernel.org/lkml/?t=20220825231606">~2022-08-25 23:16 UTC</a>|<a href="https://lore.kernel.org/lkml/">newest</a>]

<b>Thread overview: </b>12+ messages / expand[<a href="https://lore.kernel.org/lkml/YwgCrqutxmX0W72r@gmail.com/T/#u">flat</a>|<a href="https://lore.kernel.org/lkml/YwgCrqutxmX0W72r@gmail.com/t/#u">nested</a>]  <a href="https://lore.kernel.org/lkml/YwgCrqutxmX0W72r@gmail.com/t.mbox.gz">mbox.gz</a>  <a href="https://lore.kernel.org/lkml/YwgCrqutxmX0W72r@gmail.com/t.atom">Atom feed</a>  <a href="#b">top</a>
<b>2022-08-25 23:15 <a id="r" href="#t">Eric Biggers [this message]</a></b>
2022-08-26  7:23 ` <a href="https://lore.kernel.org/lkml/Ywh09ZXBZFA3R0W6@worktop.programming.kicks-ass.net/">Should Linux set the new constant-time mode CPU flags?</a> Peter Zijlstra
2022-08-26  8:45 ` <a href="https://lore.kernel.org/lkml/CAK8P3a3LnqdJ7bp+wjwUyb=7rQqL7W4nina-yQ5_Ff=XtaTr+A@mail.gmail.com/">Arnd Bergmann</a>
2022-09-15 17:18   ` <a href="https://lore.kernel.org/lkml/YyNefT72+OqkaPMS@arm.com/">Catalin Marinas</a>
2022-08-26 15:40 ` <a href="https://lore.kernel.org/lkml/CAH8yC8ktFYKy1qjz6Gi0NcWv1GZTi=mqP2hADFaAwbfivDpxzQ@mail.gmail.com/">Jeffrey Walton</a>
2022-08-29 16:39 ` <a href="https://lore.kernel.org/lkml/Ywzr2d52ixYXUDWR@zx2c4.com/">Jason A. Donenfeld</a>
2022-08-29 18:08   ` <a href="https://lore.kernel.org/lkml/Yw0Ah5m%2F2HDDvCjS@gmail.com/">Eric Biggers</a>
2022-08-29 19:09     ` <a href="https://lore.kernel.org/lkml/Yw0O6pQ7oKHGmQ0O@zx2c4.com/">Jason A. Donenfeld</a>
2022-08-29 19:05   ` <a href="https://lore.kernel.org/lkml/Yw0OF89auWTh12Xd@zx2c4.com/">Jason A. Donenfeld</a>
2022-08-30 14:25   ` <a href="https://lore.kernel.org/lkml/6ec9cdab-db5b-ab28-c92d-79c3812dd369@intel.com/">Dave Hansen</a>
2022-09-01 11:00     ` <a href="https://lore.kernel.org/lkml/YxCQzZqLZ49gLlrH@hirez.programming.kicks-ass.net/">Peter Zijlstra</a>
2022-09-15 17:52     ` <a href="https://lore.kernel.org/lkml/YyNmQ2bPvf3B3Xvo@arm.com/">Catalin Marinas</a>
</pre><hr/><pre id="R"><b>Reply instructions:</b>

You may reply publicly to <a href="#t">this message</a> via plain-text email
using any one of the following methods:

* Save the following mbox file, import it into your mail client,
  and reply-to-all from there: <a href="https://lore.kernel.org/lkml/YwgCrqutxmX0W72r@gmail.com/raw">mbox</a>

  Avoid top-posting and favor interleaved quoting:
  <a href="https://en.wikipedia.org/wiki/Posting_style#Interleaved_style">https://en.wikipedia.org/wiki/Posting_style#Interleaved_style</a>

* Reply using the <b>--to</b>, <b>--cc</b>, and <b>--in-reply-to</b>
  switches of git-send-email(1):

  git send-email \
    --in-reply-to=YwgCrqutxmX0W72r@gmail.com \
    --to=ebiggers@kernel.org \
    --cc=Jason@zx2c4.com \
    --cc=agl@google.com \
    --cc=ardb@kernel.org \
    --cc=linux-arm-kernel@lists.infradead.org \
    --cc=linux-crypto@vger.kernel.org \
    --cc=linux-kernel@vger.kernel.org \
    --cc=x86@kernel.org \
    /path/to/YOUR_REPLY

  <a href="https://kernel.org/pub/software/scm/git/docs/git-send-email.html">https://kernel.org/pub/software/scm/git/docs/git-send-email.html</a>

* If your mail client supports setting the <b>In-Reply-To</b> header
  via mailto: links, try the <a href="mailto:ebiggers@kernel.org?In-Reply-To=%3CYwgCrqutxmX0W72r@gmail.com%3E&amp;Cc=Jason%40zx2c4.com%2Cagl%40google.com%2Cardb%40kernel.org%2Clinux-arm-kernel%40lists.infradead.org%2Clinux-crypto%40vger.kernel.org%2Clinux-kernel%40vger.kernel.org%2Cx86%40kernel.org&amp;Subject=Re%3A%20Should%20Linux%20set%20the%20new%20constant-time%20mode%20CPU%20flags%3F">mailto: link</a>
</pre>

  Be sure your reply has a <b>Subject:</b> header at the top and a blank line
  before the message body.
<hr/><pre>This is a public inbox, see <a href="https://lore.kernel.org/lkml/_/text/mirror/">mirroring instructions</a>
for how to clone and mirror all data and code used for this inbox;
as well as URLs for NNTP newsgroup(s).</pre></div>
  </body>
</html>
