<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rachelbythebay.com/w/2024/08/17/hash/">Original</a>
    <h1>A common bug in a bunch of feed readers</h1>
    
    
<p>
Yeah, it&#39;s another thing about feed readers.  I don&#39;t blame you if you 
want to skip this one.
</p>
<p>
A reader (that is, a person!) reached out earlier and asked me to look 
in some a bug report for a feed reader.  It seems they passed along some 
of the details from one of my earlier posts, and it was closed with no 
action taken.
</p>
<p>
The program in question has cache problems, and it&#39;s something that&#39;s 
surprisingly common.  A bunch of different programs do this, and it&#39;s 
interesting to wonder how they all came to this point.
</p>
<p>
Well, at least for some of them (the PHP-based ones), I think I know 
now: they&#39;re probably using the same library underneath, and it&#39;s been 
hacked to do some kind of &#34;hash match&#34; thing based on the body of the 
feed - like a md5sum or somesuch.
</p>
<p>
It goes something like this, apparently: fetch the feed for the first 
time.  Then store the hash, the Last-Modified time, and the ETag.
</p>
<p>
Next time, send If-Modified-Since and If-None-Match using the stored 
values.  But, then, if the hash of the body matches, return immediately 
and don&#39;t update anything else... *even if* the Last-Modified and/or 
ETag values changed!  So, next time, they send the old values again, and 
it never gets any better.
</p>
<p>
Therein lies the shared bug: they&#39;re not designed around the notion of 
&#34;always return the values you got last time from the web server&#34;.  If 
they had been, they would not throw them away just because the hash 
matched.
</p>
<p>
So, when might the hash match when the LM or ETag values are the same?
</p>
<p>
Easy!  When someone does this, or the equivalent:
</p>
<pre class="terminal">webserver$ touch feed.xml
</pre>
<p>
That will bump both of those fields and will leave the body unchanged.
</p>
<p>
Them not handling that case means they will start sending unconditionals 
until the body finally changes.  That could be days or weeks later 
depending on how often something actually changes in the feed.  Not 
good.
</p>

  </body>
</html>
