<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/usbarmory/go-boot">Original</a>
    <h1>Go-boot: bare metal Go UEFI boot manager</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">The <a href="https://github.com/usbarmory/go-boot">go-boot</a> project is a
<a href="https://github.com/usbarmory/tamago">TamaGo</a> unikernel implementing a UEFI
Shell and OS loader for AMD64 platforms, allowing UEFI API interaction and OS
loading.</p>
<p dir="auto">The OS loading functionality supports launching of:</p>
<ul dir="auto">
<li><code>.</code> EFI application images</li>
<li><code>l</code> Linux kernels, with configuration parsed from Linux Userspace API (UAPI) <a href="https://uapi-group.org/specifications/specs/boot_loader_specification/" rel="nofollow">boot loader entries</a></li>
<li><code>w</code> Windows UEFI boot manager</li>
</ul>
<p dir="auto">The support of
<a href="https://github.com/usbarmory/boot-transparency">boot-transparency</a> is planned
for future releases.</p>

<p dir="auto">Andrea Barisani
<a href="mailto:andrea@inversepath.com">andrea@inversepath.com</a></p>

<p dir="auto">The default operation is to present an UEFI shell and its help, the ⏎ shortcut
(identically to <code>l</code> or <code>linux</code>) boots the default UAPI entry set at compile
time (see <em>Compiling</em>).</p>
<div data-snippet-clipboard-copy-content="Shell&gt; go-boot.efi

initializing EFI services
initializing console (text)

go-boot • tamago/amd64 (go1.24.1) • UEFI x64

.               &lt;path&gt;                   # load and start EFI image
build                                    # build information
cat             &lt;path&gt;                   # show file contents
clear                                    # clear screen
cpuid           &lt;leaf&gt; &lt;subleaf&gt;         # show CPU capabilities
date            (time in RFC339 format)? # show/change runtime date and time
efivar          (verbose)?               # list UEFI variables
dns             &lt;host&gt;                   # resolve domain
exit,quit                                # exit application
halt,shutdown                            # shutdown system
info                                     # runtime information
linux,l         (loader entry path)?     # boot Linux kernel image
linux,l,\r                               # `l \loader\entries\arch.conf`
log                                      # show runtime logs
ls              (path)?                  # list directory contents
lspci                                    # list PCI devices
memmap          (e820)?                  # show UEFI memory map
mode            &lt;mode&gt;                   # set screen mode
net             &lt;ip&gt; &lt;mac&gt; &lt;gw&gt; (debug)? # start UEFI networking
peek            &lt;hex offset&gt; &lt;size&gt;      # memory display (use with caution)
poke            &lt;hex offset&gt; &lt;hex value&gt; # memory write   (use with caution)
protocol        &lt;registry format GUID&gt;   # locate UEFI protocol
reset           (cold|warm)?             # reset system
stack                                    # goroutine stack trace (current)
stackall                                 # goroutine stack trace (all)
stat            &lt;path&gt;                   # show file information
uefi                                     # UEFI information
uptime                                   # show system running time
windows,win,w                            # launch Windows UEFI boot manager

&gt; uefi
UEFI Revision ......: 2.70
Firmware Vendor ....: Lenovo
Firmware Revision ..: 0x1560
Runtime Services  ..: 0x90e2eb98
Boot Services ......: 0x6bd17690
Frame Buffer .......: 1920x1200 @ 0x4000000000
Configuration Tables: 0x8f426018
  ee4e5898-3914-4259-9d6e-dc7bd79403cf (0x8db6dc98)
  dcfa911d-26eb-469f-a220-38b7dc461220 (0x8b037018)
...

&gt; memmap
Type Start            End              Pages            Attributes
02   0000000090000000 0000000090000fff 0000000000000001 000000000000000f
...

&gt; linux \loader\entries\arch.conf
loading boot loader entry \loader\entries\arch.conf
go-boot exiting EFI boot services and jumping to kernel
Linux version 6.13.6-arch1-1 (linux@archlinux) (gcc (GCC) 14.2.1 20250207, GNU ld (GNU Binutils) 2.44)
..."><pre><code>Shell&gt; go-boot.efi

initializing EFI services
initializing console (text)

go-boot • tamago/amd64 (go1.24.1) • UEFI x64

.               &lt;path&gt;                   # load and start EFI image
build                                    # build information
cat             &lt;path&gt;                   # show file contents
clear                                    # clear screen
cpuid           &lt;leaf&gt; &lt;subleaf&gt;         # show CPU capabilities
date            (time in RFC339 format)? # show/change runtime date and time
efivar          (verbose)?               # list UEFI variables
dns             &lt;host&gt;                   # resolve domain
exit,quit                                # exit application
halt,shutdown                            # shutdown system
info                                     # runtime information
linux,l         (loader entry path)?     # boot Linux kernel image
linux,l,\r                               # `l \loader\entries\arch.conf`
log                                      # show runtime logs
ls              (path)?                  # list directory contents
lspci                                    # list PCI devices
memmap          (e820)?                  # show UEFI memory map
mode            &lt;mode&gt;                   # set screen mode
net             &lt;ip&gt; &lt;mac&gt; &lt;gw&gt; (debug)? # start UEFI networking
peek            &lt;hex offset&gt; &lt;size&gt;      # memory display (use with caution)
poke            &lt;hex offset&gt; &lt;hex value&gt; # memory write   (use with caution)
protocol        &lt;registry format GUID&gt;   # locate UEFI protocol
reset           (cold|warm)?             # reset system
stack                                    # goroutine stack trace (current)
stackall                                 # goroutine stack trace (all)
stat            &lt;path&gt;                   # show file information
uefi                                     # UEFI information
uptime                                   # show system running time
windows,win,w                            # launch Windows UEFI boot manager

&gt; uefi
UEFI Revision ......: 2.70
Firmware Vendor ....: Lenovo
Firmware Revision ..: 0x1560
Runtime Services  ..: 0x90e2eb98
Boot Services ......: 0x6bd17690
Frame Buffer .......: 1920x1200 @ 0x4000000000
Configuration Tables: 0x8f426018
  ee4e5898-3914-4259-9d6e-dc7bd79403cf (0x8db6dc98)
  dcfa911d-26eb-469f-a220-38b7dc461220 (0x8b037018)
...

&gt; memmap
Type Start            End              Pages            Attributes
02   0000000090000000 0000000090000fff 0000000000000001 000000000000000f
...

&gt; linux \loader\entries\arch.conf
loading boot loader entry \loader\entries\arch.conf
go-boot exiting EFI boot services and jumping to kernel
Linux version 6.13.6-arch1-1 (linux@archlinux) (gcc (GCC) 14.2.1 20250207, GNU ld (GNU Binutils) 2.44)
...
</code></pre></div>

<p dir="auto"><a href="https://pkg.go.dev/github.com/usbarmory/go-boot" rel="nofollow"><img src="https://camo.githubusercontent.com/1280be51cfaca015309656f9d1ca547200be57cb206155ba8b2f847901aa08d8/68747470733a2f2f706b672e676f2e6465762f62616467652f6769746875622e636f6d2f75736261726d6f72792f676f2d626f6f742e737667" alt="Go Reference" data-canonical-src="https://pkg.go.dev/badge/github.com/usbarmory/go-boot.svg"/></a></p>

<p dir="auto">The list of supported hardware is available in the
project wiki <a href="https://github.com/usbarmory/go-boot/wiki#hardware-compatibility-list">HCL</a>.</p>
<p dir="auto">The list provides test <code>IMAGE_BASE</code> values to pass while <em>Compiling</em>.</p>

<p dir="auto">Build the <a href="https://github.com/usbarmory/tamago-go">TamaGo compiler</a>
(or use the <a href="https://github.com/usbarmory/tamago-go/releases/latest">latest binary release</a>):</p>
<div data-snippet-clipboard-copy-content="wget https://github.com/usbarmory/tamago-go/archive/refs/tags/latest.zip
unzip latest.zip
cd tamago-go-latest/src &amp;&amp; ./all.bash
cd ../bin &amp;&amp; export TAMAGO=`pwd`/go"><pre><code>wget https://github.com/usbarmory/tamago-go/archive/refs/tags/latest.zip
unzip latest.zip
cd tamago-go-latest/src &amp;&amp; ./all.bash
cd ../bin &amp;&amp; export TAMAGO=`pwd`/go
</code></pre></div>
<p dir="auto">The following environment variables configure the <code>go-boot.efi</code> executable
build:</p>
<ul dir="auto">
<li>
<p dir="auto"><code>IMAGE_BASE</code>: must be set (in hex) within a memory range
available in the target UEFI environment for the unikernel allocation, the
<a href="https://github.com/usbarmory/go-boot/wiki#hardware-compatibility-list">HCL</a> or
<code>memmap</code> command from an <a href="https://github.com/pbatard/UEFI-Shell">UEFI Shell</a>
can provide such value, when empty a common default value is set.</p>
</li>
<li>
<p dir="auto"><code>DEFAULT_EFI_ENTRY</code>: defines the <code>.</code> shortcut entry path
for EFI image loading, it defaults to <code>\efi\boot\bootx64.efi</code>
when unspecified.</p>
</li>
<li>
<p dir="auto"><code>DEFAULT_LINUX_ENTRY</code>: defines the <code>linux,l,\r</code> shortcut loader entry path
for Linux kernel image booting, it defaults to <code>\loader\entries\arch.conf</code>
when unspecified.</p>
</li>
<li>
<p dir="auto"><code>CONSOLE</code>: set to either <code>com1</code> or <code>text</code> (default) controls the output
console to either serial port or UEFI console.</p>
</li>
<li>
<p dir="auto"><code>NET</code>: set to either <code>0</code> (default) or <code>1</code> controls enabling of UEFI
networking support (see <em>UEFI networking</em>).</p>
</li>
</ul>
<p dir="auto">Build the <code>go-boot.efi</code> executable:</p>
<div data-snippet-clipboard-copy-content="git clone https://github.com/usbarmory/go-boot &amp;&amp; cd go-boot
make efi IMAGE_BASE=10000000 CONSOLE=text"><pre><code>git clone https://github.com/usbarmory/go-boot &amp;&amp; cd go-boot
make efi IMAGE_BASE=10000000 CONSOLE=text
</code></pre></div>

<p dir="auto">The <code>go-boot.efi</code> application executable, built after <em>Compiling</em>, can be
loaded from an <a href="https://github.com/pbatard/UEFI-Shell">UEFI Shell</a>
or boot manager, the following example shows an entry for
<a href="https://www.freedesktop.org/wiki/Software/systemd/systemd-boot/" rel="nofollow">systemd-boot</a>:</p>
<div data-snippet-clipboard-copy-content="# /boot/loader/entries/go-boot.conf
title Go Boot
efi /EFI/Linux/go-boot.efi"><pre><code># /boot/loader/entries/go-boot.conf
title Go Boot
efi /EFI/Linux/go-boot.efi
</code></pre></div>

<p dir="auto">The following example shows creation of an EFI boot entry using
<a href="https://github.com/rhboot/efibootmgr">efibootmgr</a>:</p>
<div data-snippet-clipboard-copy-content="efibootmgr -C -L &#34;go-boot&#34; -d $DISK -p $PART -l &#39;\EFI\go-boot.efi&#39;"><pre><code>efibootmgr -C -L &#34;go-boot&#34; -d $DISK -p $PART -l &#39;\EFI\go-boot.efi&#39;
</code></pre></div>

<p dir="auto">With <code>NET=1</code> passed in the environment builds include UEFI networking support
through the <a href="https://uefi.org/specs/UEFI/2.10_A/24_Network_Protocols_SNP_PXE_BIS.html" rel="nofollow">Simple Network Protocol</a>
(SNP) and <a href="https://github.com/usbarmory/go-net">go-net</a>.</p>
<p dir="auto">On such builds the <code>net</code> and <code>dns</code> commands become available and <code>make qemu</code>
will require a tap0 interface.</p>
<p dir="auto">The <code>net</code> command takes an IP address in CIDR notation, a fixed MAC address or
<code>:</code> to automatically generate a random MAC, and a gateway IP address as
arguments.</p>
<p dir="auto">The optional <code>debug</code> strings can be passed as final argument to <code>net</code> to enable
Go <a href="https://pkg.go.dev/net/http/pprof" rel="nofollow">profiling server</a> and an unauthenticated
SSH console exposing the UEFI shell.</p>
<div data-snippet-clipboard-copy-content="&gt; net 10.0.0.1/24 : 10.0.0.2 debug
starting debug servers:
        http://10.0.0.1:80/debug/pprof
        ssh://10.0.0.1:22
network initialized (10.0.0.1/24 da:e7:ac:e2:5e:05)

&gt; dns golang.org
[142.251.209.17 2a00:1450:4002:410::2011]"><pre><code>&gt; net 10.0.0.1/24 : 10.0.0.2 debug
starting debug servers:
        http://10.0.0.1:80/debug/pprof
        ssh://10.0.0.1:22
network initialized (10.0.0.1/24 da:e7:ac:e2:5e:05)

&gt; dns golang.org
[142.251.209.17 2a00:1450:4002:410::2011]
</code></pre></div>

<p dir="auto">QEMU supported targets can be executed under emulation, using the
<a href="https://github.com/tianocore/tianocore.github.io/wiki/OVMF">Open Virtual Machine Firmware</a>
as follows:</p>
<div data-snippet-clipboard-copy-content="make qemu OVMFCODE=&lt;path to OVMF_CODE.fd&gt;"><pre><code>make qemu OVMFCODE=&lt;path to OVMF_CODE.fd&gt;
</code></pre></div>
<p dir="auto">With <code>NET=1</code> tap0 should be configured as follows (Linux example):</p>
<div data-snippet-clipboard-copy-content="ip tuntap add dev tap0 mode tap group &lt;your user group&gt;
ip addr add 10.0.0.2/24 dev tap0
ip link set tap0 up"><pre><code>ip tuntap add dev tap0 mode tap group &lt;your user group&gt;
ip addr add 10.0.0.2/24 dev tap0
ip link set tap0 up
</code></pre></div>
<p dir="auto">An emulated target can be <a href="https://retrage.github.io/2019/12/05/debugging-ovmf-en.html/" rel="nofollow">debugged with GDB</a>
using <code>make qemu-gdb</code>, this will make qemu waiting for a GDB connection that
can be launched as follows:</p>
<div data-snippet-clipboard-copy-content="gdb -ex &#34;target remote 127.0.0.1:1234&#34;"><pre><code>gdb -ex &#34;target remote 127.0.0.1:1234&#34;
</code></pre></div>
<p dir="auto">Breakpoints can be set in the usual way:</p>


<p dir="auto">The following example demonstrates how to create, and deploy, a UEFI-bootable
image for cloud deployments:</p>
<ul dir="auto">
<li><a href="https://github.com/usbarmory/go-boot/wiki/Google-Compute-Engine">Google Compute Engine</a></li>
</ul>

<p dir="auto">go-boot | <a href="https://github.com/usbarmory/go-boot">https://github.com/usbarmory/go-boot</a>
Copyright (c) The go-boot authors. All Rights Reserved.</p>
<p dir="auto">These source files are distributed under the BSD-style license found in the
<a href="https://github.com/usbarmory/go-boot/blob/main/LICENSE">LICENSE</a> file.</p>
</article></div></div>
  </body>
</html>
