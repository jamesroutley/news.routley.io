<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/hermitcore/rusty-hermit">Original</a>
    <h1>RustyHermit – A Rust-based, lightweight unikernel</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://chanind.github.io/hermitcore/rusty-hermit/blob/master/img/hermitcore_logo.png"><img width="100" src="https://chanind.github.io/hermitcore/rusty-hermit/raw/master/img/hermitcore_logo.png"/></a></p>

<p dir="auto"><a href="https://matrix.osbyexample.com:3008" rel="nofollow"><img src="https://camo.githubusercontent.com/870584ac85aee5080786251071d760f4bea8ee6c40ca1442f735b306548d1b58/68747470733a2f2f6d61747269782e6f7362796578616d706c652e636f6d3a333030382f62616467652e737667" alt="Slack Status" data-canonical-src="https://matrix.osbyexample.com:3008/badge.svg"/></a></p>
<p dir="auto"><a href="http://www.hermitcore.org" rel="nofollow">RustyHermit</a> is a <a href="http://unikernel.org" rel="nofollow">unikernel</a> targeting a scalable and predictable runtime for high-performance and cloud computing.
Unikernel means, you bundle your application directly with the kernel library, so that it can run without any installed operating system.
This reduces overhead, therefore, interesting applications include virtual machines and high-performance computing.</p>
<p dir="auto">The kernel is able to run <a href="https://github.com/hermitcore/rusty-hermit">Rust</a> applications, as well as <a href="https://github.com/hermitcore/hermit-playground">C/C++/Go/Fortran</a> applications.</p>
<p dir="auto">The repository contains following directories and submodules:</p>
<ol dir="auto">
<li><em>demo</em> is a small demo application based on the data-parallelism library <a href="https://github.com/rayon-rs/rayon">Rayon</a></li>
<li><em>hermit-abi</em> contains the platform APIs and builds the interface between library operating system and the application</li>
<li><em>hermit-sys</em> contains a crate to automate the build process of the library operating systems</li>
<li><em>libhermit-rs</em> is the kernel itself</li>
<li><em>netbench</em> provides some basic network benchmarks</li>
</ol>
<h2 dir="auto"><a id="user-content-background" aria-hidden="true" href="#background"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Background</h2>
<p dir="auto"><strong>RustyHermit</strong> is a rewrite of HermitCore in <a href="https://www.rust-lang.org" rel="nofollow">Rust</a> developed at <a href="https://www.rwth-aachen.de" rel="nofollow">RWTH-Aachen</a>.
HermitCore was a research unikernel written in C (<a href="https://github.com/hermitcore/libhermit">libhermit</a>).</p>
<p dir="auto">The ownership  model of Rust guarantees memory/thread-safety and enables us to eliminate many classes of bugs at compile-time.
Consequently, the use of Rust for kernel development promises fewer vulnerabilities in comparison to common programming languages.</p>
<p dir="auto">The kernel and the integration into the Rust runtime are entirely written in Rust and do not use any C/C++ Code.
We extended the Rust toolchain so that the build process is similar to Rust&#39;s usual workflow.
Rust applications that use the Rust runtime and do not directly use OS services are able to run on RustyHermit without modifications.</p>
<h2 dir="auto"><a id="user-content-requirements" aria-hidden="true" href="#requirements"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Requirements</h2>
<ul dir="auto">
<li><a href="https://www.rust-lang.org/tools/install" rel="nofollow"><code>rustup</code></a></li>
<li><a href="https://nasm.us/" rel="nofollow">NASM</a> (only for SMP on x86_64)</li>
</ul>
<h2 dir="auto"><a id="user-content-building-your-own-applications" aria-hidden="true" href="#building-your-own-applications"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building your own applications</h2>
<p dir="auto">To give you an example on how to build your application with RustyHermit, lets create a new cargo project:
A more comprehensive version of the example project is published at <a href="https://github.com/hermitcore/rusty-demo">rusty-demo</a>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="cargo new hello_world
cd hello_world"><pre>cargo new hello_world
<span>cd</span> hello_world</pre></div>
<p dir="auto">To bind the library operating system to the application, add the crate <a href="https://crates.io/crates/hermit-sys" rel="nofollow">hermit-sys</a> to the dependencies in the file <em>Cargo.toml</em>.
It is important to use at least the <em>optimization level 1</em>.
Consequently, it is required to <strong>extend</strong> <em>Cargo.toml</em> with following lines:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# Cargo.toml

[target.&#39;cfg(target_os = &#34;hermit&#34;)&#39;.dependencies]
hermit-sys = &#34;0.2.*&#34;"><pre><span><span>#</span> Cargo.toml</span>

[<span>target</span>.<span>&#39;cfg(target_os</span> <span>=</span> <span>&#34;hermit&#34;)&#39;</span>.<span>dependencies</span>]
<span>hermit-sys</span> = <span><span>&#34;</span>0.2.*<span>&#34;</span></span></pre></div>
<p dir="auto">To link the application with RustyHermit, declare <code>hermit_sys</code> an <code>external crate</code> in the main file of your application.</p>
<div dir="auto" data-snippet-clipboard-copy-content="// src/main.rs

#[cfg(target_os = &#34;hermit&#34;)]
use hermit_sys as _;

fn main() {
        println!(&#34;Hello World!&#34;);
}"><pre><span>// src/main.rs</span>

<span>#<span>[</span>cfg<span>(</span>target_os = <span>&#34;hermit&#34;</span><span>)</span><span>]</span></span>
<span>use</span> hermit_sys <span>as</span> _<span>;</span>

<span>fn</span> <span>main</span><span>(</span><span>)</span> <span>{</span>
        <span>println</span><span>!</span><span>(</span><span>&#34;Hello World!&#34;</span><span>)</span><span>;</span>
<span>}</span></pre></div>
<p dir="auto">The final step is building the application as follows:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cargo build -Zbuild-std=std,core,alloc,panic_abort --target x86_64-unknown-hermit"><pre>cargo build -Zbuild-std=std,core,alloc,panic_abort --target x86_64-unknown-hermit</pre></div>
<p dir="auto">(You can set an easy alias for this in the <code>.cargo/config</code> file. Take a look at the <a href="https://github.com/hermitcore/rusty-demo/blob/master/.cargo/config">demo</a>)</p>
<p dir="auto">The resulting &#34;hypervisor-ready&#34; binary then can be found in <code>target/x86_64-unknown-hermit/debug</code>.</p>
<h2 dir="auto"><a id="user-content-running-rustyhermit" aria-hidden="true" href="#running-rustyhermit"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Running RustyHermit</h2>
<p dir="auto">RustyHermit binaries can be run on either uhyve or qemu.</p>
<h3 dir="auto"><a id="user-content-using-uhyve-as-hypervisor" aria-hidden="true" href="#using-uhyve-as-hypervisor"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Using uhyve as Hypervisor</h3>
<p dir="auto">RustyHermit can run within our own hypervisor <a href="https://github.com/hermitcore/uhyve"><em>uhyve</em></a> , which requires <a href="https://www.linux-kvm.org/" rel="nofollow">KVM</a> to create a virtual machine.
Please install the hypervisor as follows:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cargo +nightly install uhyve --locked"><pre>cargo +nightly install uhyve --locked</pre></div>
<p dir="auto">Afterwards, your are able to start RustyHermit applications within our hypervisor:</p>
<div dir="auto" data-snippet-clipboard-copy-content="uhyve target/x86_64-unknown-hermit/debug/hello_world"><pre>uhyve target/x86_64-unknown-hermit/debug/hello_world</pre></div>
<p dir="auto">More details can be found in the <a href="https://github.com/hermitcore/uhyve">uhyve README</a>.</p>
<h3 dir="auto"><a id="user-content-using-qemu-as-hypervisor" aria-hidden="true" href="#using-qemu-as-hypervisor"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Using Qemu as Hypervisor</h3>
<p dir="auto">It is also possible to run RustyHermit within <a href="https://www.qemu.org" rel="nofollow">Qemu</a>.
RustyHermit produces 64-bit binaries, but Qemu&#39;s x86 emulation cannot boot them directly.
Therefore, the loader <a href="https://github.com/hermitcore/rusty-loader">rusty-loader</a> is required to boot the application.
A prebuilt loader binary can be found at <a href="https://github.com/hermitcore/rusty-loader/releases">rusty-loader releases</a>.</p>
<p dir="auto">The unikernel application <code>app</code> can be booted with the following command:</p>
<div dir="auto" data-snippet-clipboard-copy-content="qemu-system-x86_64 -smp 1 \
    -cpu qemu64,apic,fsgsbase,rdtscp,xsave,xsaveopt,fxsr \
    -device isa-debug-exit,iobase=0xf4,iosize=0x04 \
    -display none -m 64M -serial stdio -enable-kvm \
    -kernel path_to_loader/rusty-loader-x86_64 \
    -initrd path_to_app/app"><pre>qemu-system-x86_64 -smp 1 \
    -cpu qemu64,apic,fsgsbase,rdtscp,xsave,xsaveopt,fxsr \
    -device isa-debug-exit,iobase=0xf4,iosize=0x04 \
    -display none -m 64M -serial stdio -enable-kvm \
    -kernel path_to_loader/rusty-loader-x86_64 \
    -initrd path_to_app/app</pre></div>
<p dir="auto">It is important to enable the processor features <em>fsgsbase</em> and <em>rdtscp</em> because it is a prerequisite to boot RustyHermit.</p>
<p dir="auto">You can provide arguments to the application via the kernel commandline, which you can set with qemu&#39;s <code>-append</code> option. Since both the kernel and the application can have parameters, they are separated with <code>--</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="qemu-system-x86_64 ... -append &#34;kernel-arguments -- application-arguments&#34;"><pre>qemu-system-x86_64 ... -append <span><span>&#34;</span>kernel-arguments -- application-arguments<span>&#34;</span></span></pre></div>
<h3 dir="auto"><a id="user-content-using-qemu-as-microvm" aria-hidden="true" href="#using-qemu-as-microvm"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Using Qemu as microVM</h3>
<p dir="auto">Qemu provides <a href="https://qemu.readthedocs.io/en/latest/system/i386/microvm.html" rel="nofollow">microvm virtual platform</a>, which is a minimalist machine type without PCI nor ACPI support.
In comparison to a common hypervisor, it has a clearly smaller memory footprint and a faster boot time.
To use this VM type, all default features of RustyHermit has to be disabled (especially PCI and ACPI support).
For instance, the following command builds the smallest version of the <a href="https://github.com/hermitcore/rusty-hermit/tree/master/examples/hello_world"><code>hello_world</code> example</a>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cargo build -Zbuild-std=core,alloc,std,panic_abort --target x86_64-unknown-hermit --no-default-features -p hello_world --release"><pre>cargo build -Zbuild-std=core,alloc,std,panic_abort --target x86_64-unknown-hermit --no-default-features -p hello_world --release</pre></div>
<p dir="auto">Afterwards, this minimal example can be loaded with the same boot loader like the common Qemu machine type:</p>
<div dir="auto" data-snippet-clipboard-copy-content="qemu-system-x86_64 \
    -M microvm,x-option-roms=off,pit=off,pic=off,rtc=on,auto-kernel-cmdline=off \
    -nodefaults -no-user-config -display none -smp 1 -m 512M -serial stdio \
    -kernel path_to_loader/rusty-loader \
    -initrd path_to_hello_world/hello_world \
    -cpu qemu64,apic,fsgsbase,rdtscp,xsave,xsaveopt,fxsr \
    -device isa-debug-exit,iobase=0xf4,iosize=0x04 \
    -append &#34;-freq 2800&#34;"><pre>qemu-system-x86_64 \
    -M microvm,x-option-roms=off,pit=off,pic=off,rtc=on,auto-kernel-cmdline=off \
    -nodefaults -no-user-config -display none -smp 1 -m 512M -serial stdio \
    -kernel path_to_loader/rusty-loader \
    -initrd path_to_hello_world/hello_world \
    -cpu qemu64,apic,fsgsbase,rdtscp,xsave,xsaveopt,fxsr \
    -device isa-debug-exit,iobase=0xf4,iosize=0x04 \
    -append <span><span>&#34;</span>-freq 2800<span>&#34;</span></span></pre></div>
<p dir="auto">Depending on the virtualized processor, the processor frequency has to pass as kernel argument (<code>-freq</code>) to the kernel.
MHz is used as unit of frequency here.</p>
<p dir="auto">Kernel features like TCP/IP support can be reenabled manually.
For instance, the following command creates a <a href="https://github.com/hermitcore/rusty-hermit/tree/master/examples/httpd">minimal web-server</a> for Qemu&#39;s microvm platform:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cargo build -Zbuild-std=core,alloc,std,panic_abort --target x86_64-unknown-hermit --no-default-features --features tcp -p httpd --release"><pre>cargo build -Zbuild-std=core,alloc,std,panic_abort --target x86_64-unknown-hermit --no-default-features --features tcp -p httpd --release</pre></div>
<h2 dir="auto"><a id="user-content-advanced-features" aria-hidden="true" href="#advanced-features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Advanced Features</h2>
<p dir="auto">You are not happy with <code>Hello World</code> yet?</p>
<h3 dir="auto"><a id="user-content-controlling-kernel-message-verbosity" aria-hidden="true" href="#controlling-kernel-message-verbosity"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Controlling kernel message verbosity</h3>
<p dir="auto">RustyHermit uses the lightweight logging crate <a href="https://github.com/rust-lang/log">log</a> to print kernel messages.
If the environment variable <code>HERMIT_LOG_LEVEL_FILTER</code> is set at compile time to a string matching the name of a <a href="https://docs.rs/log/0.4.8/log/enum.LevelFilter.html" rel="nofollow">LevelFilter</a>, then that value is used for the LevelFilter.
If the environment variable is not set, or the name doesn&#39;t match, then LevelFilter::Info is used by default, which is the same as it was before.</p>
<p dir="auto">For instance, the following command builds RustyHermit with debug messages:</p>
<div dir="auto" data-snippet-clipboard-copy-content="HERMIT_LOG_LEVEL_FILTER=Debug cargo build -Zbuild-std=core,alloc,std,panic_abort --target x86_64-unknown-hermit "><pre>HERMIT_LOG_LEVEL_FILTER=Debug cargo build -Zbuild-std=core,alloc,std,panic_abort --target x86_64-unknown-hermit </pre></div>
<h3 dir="auto"><a id="user-content-network-support" aria-hidden="true" href="#network-support"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Network support</h3>
<p dir="auto">To enable an ethernet device, we have to setup a tap device on the
host system. For instance, the following command establish the tap device
<code>tap10</code> on Linux:</p>
<div dir="auto" data-snippet-clipboard-copy-content="sudo ip tuntap add tap10 mode tap
sudo ip addr add 10.0.5.1/24 broadcast 10.0.5.255 dev tap10
sudo ip link set dev tap10 up
sudo bash -c &#39;echo 1 &gt; /proc/sys/net/ipv4/conf/tap10/proxy_arp&#39;"><pre>sudo ip tuntap add tap10 mode tap
sudo ip addr add 10.0.5.1/24 broadcast 10.0.5.255 dev tap10
sudo ip link <span>set</span> dev tap10 up
sudo bash -c <span><span>&#39;</span>echo 1 &gt; /proc/sys/net/ipv4/conf/tap10/proxy_arp<span>&#39;</span></span></pre></div>
<p dir="auto">Add the feature <code>tcp</code> in the <code>Cargo.toml</code>. This includes the network stack <a href="https://github.com/smoltcp-rs/smoltcp">smoltcp</a> and offers TCP/UDP communication.
<code>hermi-sys</code> dependency has to be factored out of <code>[target.&#39;cfg(target_os = &#34;hermit&#34;)&#39;.dependencies]</code> because it requires features selection for network support to work thus this snippet should be added to <code>Cargo.toml</code></p>
<div dir="auto" data-snippet-clipboard-copy-content="# Cargo.toml

[target.&#39;cfg(target_os = &#34;hermit&#34;)&#39;.dependencies.hermit-sys]
version = &#34;0.2.*&#34;
default-features = false
features = [&#34;tcp&#34;, &#34;pci&#34;]"><pre><span><span>#</span> Cargo.toml</span>

[<span>target</span>.<span>&#39;cfg(target_os</span> <span>=</span> <span>&#34;hermit&#34;)&#39;</span>.<span>dependencies</span>.<span>hermit-sys</span>]
<span>version</span> = <span><span>&#34;</span>0.2.*<span>&#34;</span></span>
<span>default-features</span> = <span>false</span>
<span>features</span> = [<span><span>&#34;</span>tcp<span>&#34;</span></span>, <span><span>&#34;</span>pci<span>&#34;</span></span>]</pre></div>
<p dir="auto">Per default, RustyHermit&#39;s network interface uses <code>10.0.5.3</code> as IP address, <code>10.0.5.1</code>
for the gateway and <code>255.255.255.0</code> as network mask.
The default configuration could be overloaded at compile time by the environment variables
<code>HERMIT_IP</code>, <code>HERMIT_GATEWAY</code> and <code>HERMIT_MASK</code>.
For instance, the following command sets the IP address to <code>10.0.5.100</code>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="HERMIT_IP=&#34;10.0.5.100&#34; cargo build -Zbuild-std=core,alloc,std,panic_abort --target x86_64-unknown-hermit "><pre>HERMIT_IP=<span><span>&#34;</span>10.0.5.100<span>&#34;</span></span> cargo build -Zbuild-std=core,alloc,std,panic_abort --target x86_64-unknown-hermit </pre></div>
<p dir="auto">Currently, RustyHermit does only support network interfaces through <a href="https://www.redhat.com/en/blog/introduction-virtio-networking-and-vhost-net" rel="nofollow">virtio</a>.
To use it, you have to start RustyHermit in Qemu with following command:</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ qemu-system-x86_64 -cpu qemu64,apic,fsgsbase,rdtscp,xsave,xsaveopt,fxsr \
        -enable-kvm -display none -smp 1 -m 1G -serial stdio \
        -device isa-debug-exit,iobase=0xf4,iosize=0x04 \
        -kernel path_to_loader/rusty-loader \
        -initrd path_to_app/app \
        -netdev tap,id=net0,ifname=tap10,script=no,downscript=no,vhost=on \
        -device virtio-net-pci,netdev=net0,disable-legacy=on"><pre>$ qemu-system-x86_64 -cpu qemu64,apic,fsgsbase,rdtscp,xsave,xsaveopt,fxsr \
        -enable-kvm -display none -smp 1 -m 1G -serial stdio \
        -device isa-debug-exit,iobase=0xf4,iosize=0x04 \
        -kernel path_to_loader/rusty-loader \
        -initrd path_to_app/app \
        -netdev tap,id=net0,ifname=tap10,script=no,downscript=no,vhost=on \
        -device virtio-net-pci,netdev=net0,disable-legacy=on</pre></div>
<p dir="auto">You can now access the files in SHARED_DIRECTORY under the virtiofs tag like <code>/myfs/testfile</code>.</p>
<h2 dir="auto"><a id="user-content-use-rustyhermit-for-cc-go-and-fortran-applications" aria-hidden="true" href="#use-rustyhermit-for-cc-go-and-fortran-applications"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Use RustyHermit for C/C++, Go, and Fortran applications</h2>
<p dir="auto">If you are interested to build C/C++, Go, and Fortran applications on top of a Rust-based library operating system, please take a look at <a href="https://github.com/hermitcore/hermit-playground">https://github.com/hermitcore/hermit-playground</a>.</p>
<h2 dir="auto"><a id="user-content-missing-features" aria-hidden="true" href="#missing-features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Missing features</h2>
<ul dir="auto">
<li>Multikernel support (might be coming)</li>
<li>Virtio support (partly available)</li>
<li>Network support (partly available)</li>
</ul>
<h2 dir="auto"><a id="user-content-wiki" aria-hidden="true" href="#wiki"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Wiki</h2>
<p dir="auto">Please use the <a href="https://github.com/hermitcore/rusty-hermit/wiki">Wiki</a> to get further information and configuration options.</p>
<h2 dir="auto"><a id="user-content-credits" aria-hidden="true" href="#credits"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Credits</h2>
<p dir="auto">RustyHermit is derived from following tutorials and software distributions:</p>
<ol dir="auto">
<li>Philipp Oppermann&#39;s <a href="http://blog.phil-opp.com/" rel="nofollow">excellent series of blog posts</a>.</li>
<li>Erik Kidd&#39;s <a href="http://www.randomhacks.net/bare-metal-rust/" rel="nofollow">toyos-rs</a>, which is an extension of Philipp Opermann&#39;s kernel.</li>
<li>The Rust-based teaching operating system <a href="http://rwth-os.github.io/eduOS-rs/" rel="nofollow">eduOS-rs</a>.</li>
</ol>
<p dir="auto">HermitCore&#39;s Emoji is provided for free by <a href="https://www.gfxmag.com/crab-emoji-vector-icon/" rel="nofollow">EmojiOne</a>.</p>
<h2 dir="auto"><a id="user-content-license" aria-hidden="true" href="#license"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>License</h2>
<p dir="auto">Licensed under either of</p>
<ul dir="auto">
<li>Apache License, Version 2.0, (<a href="https://chanind.github.io/hermitcore/rusty-hermit/blob/master/LICENSE-APACHE">LICENSE-APACHE</a> or <a href="http://www.apache.org/licenses/LICENSE-2.0" rel="nofollow">http://www.apache.org/licenses/LICENSE-2.0</a>)</li>
<li>MIT license (<a href="https://chanind.github.io/hermitcore/rusty-hermit/blob/master/LICENSE-MIT">LICENSE-MIT</a> or <a href="http://opensource.org/licenses/MIT" rel="nofollow">http://opensource.org/licenses/MIT</a>)</li>
</ul>
<p dir="auto">at your option.</p>
<h2 dir="auto"><a id="user-content-contribution" aria-hidden="true" href="#contribution"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Contribution</h2>
<p dir="auto">Unless you explicitly state otherwise, any contribution intentionally submitted for inclusion in the work by you, as defined in the Apache-2.0 license, shall be dual licensed as above, without any additional terms or conditions.</p>
<p dir="auto">RustyHermit is being developed on <a href="https://github.com/hermitcore/rusty-hermit">GitHub</a>.
Create your own fork, send us a pull request, and chat with us on <a href="https://matrix.osbyexample.com:3008" rel="nofollow">Slack</a></p>
<h2 dir="auto"><a id="user-content-publications" aria-hidden="true" href="#publications"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Publications</h2>
<p dir="auto">The following scientific publications are related to RustyHermit:</p>
<ul dir="auto">
<li>S. Lankes et al. - <a href="https://dl.acm.org/doi/10.1145/3365137.3365395" rel="nofollow">Exploring Rust for Unikernel Development</a></li>
<li>M. Sung et al. - <a href="https://dl.acm.org/doi/10.1145/3381052.3381326" rel="nofollow">Intra-unikernel isolation with Intel memory protection keys</a></li>
<li>S. Lankes et al. - <a href="https://link.springer.com/chapter/10.1007/978-3-030-59851-8_22" rel="nofollow">RustyHermit: A Scalable, Rust-Based Virtual Execution Environment</a></li>
</ul>
<h2 dir="auto"><a id="user-content-funding" aria-hidden="true" href="#funding"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Funding</h2>
<p dir="auto">The development of this project was partially funded by the European Union’s Horizon 2020 research and innovation programme under grant agreement No 957246 - IoT-NGIN.</p>
</article>
          </div></div>
  </body>
</html>
