<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://oldvcr.blogspot.com/2022/10/going-where-beos-netpositive-hasnt-gone.html">Original</a>
    <h1>Going where BeOS NetPositive hasn&#39;t gone before: NetPositive&#43;</h1>
    
    <div id="readability-page-1" class="page"><div id="post-body-3282220300812555823" itemprop="description articleBody">

<p>
(How do you <a href="http://testou.free.fr/www.beatjapan.org/mirror/www.be.com/support/qandas/faqs/faq-0407.html">pronounce BeOS</a>?)

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEguwKsOJjjM_bhGmBFn2EcPrUfaTBW1dA7H6gUuQalM4Y-i6HfeQ6t26_LpvxPzmYXv3UdEdmrYJJuI5rYWoFo2JSIqBK3JLb-tT27lma8mCsyF8dBWrE9ckHiO0VGFET2YkTqTl_95-k44AHf-3kGZkGuHP6ueyipy1ezbFW-R3WCrOhwTKEhUN3KI/s4080/IMG_20221003_212459.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEguwKsOJjjM_bhGmBFn2EcPrUfaTBW1dA7H6gUuQalM4Y-i6HfeQ6t26_LpvxPzmYXv3UdEdmrYJJuI5rYWoFo2JSIqBK3JLb-tT27lma8mCsyF8dBWrE9ckHiO0VGFET2YkTqTl_95-k44AHf-3kGZkGuHP6ueyipy1ezbFW-R3WCrOhwTKEhUN3KI/s320/IMG_20221003_212459.jpg" width="320"/></a></p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjT-xExMENsNUP8nuIfFmroO4fvk7VhdLIvr9uw6QFdUWGVD94bUN83TQvtLq8TCMc3ljHmfFWuH0sqDc5htFCPT9ITXsXMplhHDJP2O9NDGaNxFZV9UxQJG1jfVvsd_QLCJG9pmOKLj_v2MTAlz0YvVgDI_xMV7JJTq_61uD7Pwl3QLQuGYk8074j9/s4080/IMG_20221003_212650.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjT-xExMENsNUP8nuIfFmroO4fvk7VhdLIvr9uw6QFdUWGVD94bUN83TQvtLq8TCMc3ljHmfFWuH0sqDc5htFCPT9ITXsXMplhHDJP2O9NDGaNxFZV9UxQJG1jfVvsd_QLCJG9pmOKLj_v2MTAlz0YvVgDI_xMV7JJTq_61uD7Pwl3QLQuGYk8074j9/s320/IMG_20221003_212650.jpg" width="320"/></a></p><p>

This is a real 133MHz BeBox running otherwise stock BeOS R5, surfing Hacker News and Lobste.rs using a modified, bug-fixed NetPositive wired to offload encryption to an onboard copy of <a href="https://github.com/classilla/cryanc">Crypto Ancienne</a> (see my notes <a href="http://oldvcr.blogspot.com/2022/07/crypto-ancienne-20-now-brings-tls-13-to.html">on the BeOS port</a>). NetPositive is the only known browser on the PowerPC ports of BeOS — it&#39;s probably possible to compile Lynx 2.8.x with BeOS CodeWarrior, but I&#39;ve only seen it built for Intel, and Mozilla and Opera were definitely Intel/BONE-only. With hacks for self-hosted TLS bolted on, NetPositive&#39;s not fast but it works, and supports up to TLS 1.2 currently due to BeOS stack limitations.
</p><p>
If you use another system to host the <tt>carl</tt> tool, it&#39;s faster and you get TLS 1.3, shown here talking to my local NetBSD/macppc proxy server running <tt>carl</tt> via <tt>inetd</tt>:

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjdrBfox_QZ-mdyD2bu5vRvgAbJUTrqVj4wK52JkDk0Lkrl1YpzNu2J9NHIl5rFSiMnkzCjLVaKSl8RkNBbdf-5QCj_-SsnH8bgdghnd0VzuTOmg1OI8wuhOkYLwDZGC1Oq_s-OBB5Lra5-Ut9gYwMMnhkKhAD58ZAWM5J9-J2cqO4vsBL72mQrsISe/s1024/tls13-beos.png"><img alt="" data-original-height="768" data-original-width="1024" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjdrBfox_QZ-mdyD2bu5vRvgAbJUTrqVj4wK52JkDk0Lkrl1YpzNu2J9NHIl5rFSiMnkzCjLVaKSl8RkNBbdf-5QCj_-SsnH8bgdghnd0VzuTOmg1OI8wuhOkYLwDZGC1Oq_s-OBB5Lra5-Ut9gYwMMnhkKhAD58ZAWM5J9-J2cqO4vsBL72mQrsISe/s320/tls13-beos.png" width="320"/></a></p><p>

And here&#39;s the <a href="https://www.haiku-os.org/">Haiku home page</a> accessed on a Power Mac running R5.0.3, also with self-hosted crypto:

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi4ZRxPThHGjyVO-oDlmhHnUarHf7DmrwepDdQRriiH8-BwmDx2BMy7Z8PlJgfUMYx5G-Mz6X2waCHgwb-M2uVLQ3LqLm80XC5FaeDyRanwmVYcfJIM7httm69wGW4GYc3sqIXKSF6x4HYsp0zWn6BhBcwcpQruWF49JsNpR8KNZCJFq0HTIKQ9V5TS/s1024/bemac.png"><img alt="" data-original-height="768" data-original-width="1024" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi4ZRxPThHGjyVO-oDlmhHnUarHf7DmrwepDdQRriiH8-BwmDx2BMy7Z8PlJgfUMYx5G-Mz6X2waCHgwb-M2uVLQ3LqLm80XC5FaeDyRanwmVYcfJIM7httm69wGW4GYc3sqIXKSF6x4HYsp0zWn6BhBcwcpQruWF49JsNpR8KNZCJFq0HTIKQ9V5TS/s320/bemac.png" width="320"/></a></p><p>

Sadly I got the kiss-off of death from Cloudflare trying to access OSnews (it does work with naked </p><tt>carl</tt><p> from the command line, so it must be objecting to the NetPositive user agent despite <a href="https://www.osnews.com/story/73/sony-drops-evilla-zdnews-reports-that-beia-is-dead-too/">its long history of BeOS reporting</a>), but you can see the connection was at least attempted:

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhclRqThk-gMHeUvTeEJyEoahEU-cPjf5qCamvZwhdqbB7HiUk8935zWcVrolMud8sbRO4sUIDPZKBmxoVf1QtTE3vPsO0MhYMKkd7Z2KX3qlNtqJO4zor0RuSm6oahjg3FL6DkrtfodfoYSubOVf2Br9QIqkA8QB4unZ380mhBpODjcl-vy7g5R5rL/s1024/osnewskissoff-beos.png"><img alt="" data-original-height="768" data-original-width="1024" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhclRqThk-gMHeUvTeEJyEoahEU-cPjf5qCamvZwhdqbB7HiUk8935zWcVrolMud8sbRO4sUIDPZKBmxoVf1QtTE3vPsO0MhYMKkd7Z2KX3qlNtqJO4zor0RuSm6oahjg3FL6DkrtfodfoYSubOVf2Br9QIqkA8QB4unZ380mhBpODjcl-vy7g5R5rL/s320/osnewskissoff-beos.png" width="320"/></a></p><p>

Before we continue, something for the lawyers. <b>This is an unofficial and unauthorized hack of NetPositive,</b> currently the intellectual property of ACCESS Co. Ltd. through their 2005 purchase of PalmSource, who purchased the rights to BeOS after Be&#39;s demise in 2001. <a href="https://web.archive.org/web/20071007025153/http://www.zeta-os.com/cms/news.php?extend.50">ACCESS has not authorized</a> any release or update of BeOS or any BeOS system component. <b>This modification contains copyrighted code and resources, is not for sale or rental, would be only be of significant interest to a relatively small group of people, and we&#39;re all weird anyway.</b> Please don&#39;t sue weird people! We love all your products, probably!
</p><p>
Also, why no Intel? Simply because there&#39;s <a href="https://www.haiku-os.org/">Haiku</a>, which has BeOS compatibility and is better in every way, including multiple browser choices and some that are even vaguely current. This project is for the underloved PowerPC side of the house, because I&#39;m a Power ISA bigot and this is how I roll. It will work on any PPC BeBox (if someone runs this on a 66MHz system I will be impressed) and of course on <a href="http://testou.free.fr/www.beatjapan.org/mirror/www.be.com/support/guides/beosreadylist_ppc.html">any Power Mac compatible with BeOS</a>.
</p><p>
Anyway, let&#39;s talk about the changes. NetPositive+ (get it? Net++? <em>get it??</em>) is a reworked alteration of 3.0d3, the last NetPositive release. This was a beta version of the browser that added an ad filter and, more importantly, JavaScript. Unlike NetPositive&#39;s core layout engine which was entirely written at Be, the JavaScript interpreter was a third-party product called <a href="http://web.archive.org/web/20010515192138/http://www.nombas.com/us/">ScriptEase licensed from Nombas, Inc</a>. Nombas ceased to, um, be around the same time as Be in 2001, but they actually <a href="http://brent-noorda.com/nombas/history/HistoryOfNombas.html">sold the company to Openwave</a>, which used it in products of their own.
</p><p>
(Tangent: does the name Nombas sound oddly familiar to you, especially if you&#39;re an astronomy geek? It should: it&#39;s <a href="http://brent-noorda.com/nombas/us/index.htm">the JavaScript engine in the James Webb Space Telescope</a>. Which is <a href="https://www.talospace.com/2022/01/another-powerpc-in-space.html">also PowerPC</a>! How&#39;s that for some weird nerdy coincidences!)
</p><p>
Unfortunately, the integration of ScriptEase into NetPositive was crashtastic (I&#39;ll politely refrain from assigning fault) and it doesn&#39;t work hardly at all with modern sites even when it doesn&#39;t blow up, so I stripped it out along with the ad filter since it had various problems not immediately worth solving; perhaps a quest for later. Since that essentially makes it equivalent with 2.2.2, the last non-beta release, I altered the resources to make it version &#34;2.3.&#34;
</p><p>
The main modification was to mangle its proxy support to send HTTPS requests over HTTP, which is <a href="http://oldvcr.blogspot.com/2020/11/fun-with-crypto-ancienne-tls-for.html">the core mechanic Crypto Ancienne uses</a> in proxy mode. This turned out to be less complex than <a href="http://oldvcr.blogspot.com/2021/03/the-final-official-release-of-classilla.html">modifying Classilla</a> to do the same, because unlike most early SSL browsers that use the <tt>CONNECT</tt> method to tunnel a socket through the proxy, what NetPositive actually does with HTTPS sites is connect to the proxy over SSL and make a regular proxy request. All I needed to do was force it to make the same connection on an unencrypted port. (Note that this short-circuits the internal SSL support somewhat, though since it&#39;s limited to SSLv3 this should be of little consequence with modern servers.)
</p><p>
Naturally this successful modification then unmasked other bugs in the browser. My first draft worked on many sites but a number of them would instead download the HTML source to disk with <a href="https://discuss.haiku-os.org/t/removing-nosniff-for-beos-netpositive-compatibility/4197">the MIME type of <tt>nosniff</tt></a>. This comes from a serious bug in how headers are parsed; the search for the string <tt>Content-type</tt> — among others — will actually match <em>anywhere</em> in a header, including <tt>X-Content-Type-Options: nosniff</tt>, which then overrides the actual MIME type. This is now fixed (I think).
</p><p>
With that patched, though, while more sites would load some would just sit and hang until some timeout was reached (Hacker News was one). After some fruitless mucking around in layout I eventually traced this to gaps in its HTTP protocol support, which was mostly but not quite completely RFC-compliant and wasn&#39;t sending correct headers (also fixed, I think). As a finishing touch for this go-around, I made a new about resource (and fixed the link to the plugins list page, which is invariably blank) and linked in some new code to support <tt>&amp;#x...;</tt> entities, since this just looked nicer on most web pages.
</p><p>
Okay, okay, you have a BeBox (or <a href="http://testou.free.fr/www.beatjapan.org/mirror/www.be.com/support/guides/beosreadylist_ppc.html">a compatible Power Mac</a> running BeOS) and you want to try it out. Here&#39;s the steps.
</p><ul><li>First, <a href="gopher://gopher.floodgap.com/5/archive/be-power/net/NetPositive+-2.3.zip">download the NetPositive+ binary from the Be-Power repository</a> on the Floodgap gopher server and unzip it, and place it anywhere convenient. Its presence will not interfere with your existing NetPositive 2.2 or 3.0d3 installation. Yes, I know that there isn&#39;t a gopher client on BeOS ... yet! Just copy it over to your system (good old FTP is simplest).
</li><li>Second, decide if you want to run <tt>carl</tt> on a separate host or run it locally. You should be warned that running it self-hosted is slower and currently glitchy. Not crash-your-machine glitchy, but it&#39;s already known that Crypto Ancienne pushes classic BeOS to its limits and you will get occasionally mangled pages or timeouts, especially on slower systems. Additionally, TLS 1.3 is not currently supported if you run local.
<ul><li>So let&#39;s first say you want to run it on a separate host for speed. In that case, clone and compile it <a href="https://github.com/classilla/cryanc">from the Crypto Ancienne github</a> on the desired host (for most systems this is as simple as <tt>cc -O3 -o carl carl.c</tt> or something similar, substitute <tt>gcc</tt> or <tt>clang</tt> as appropriate), then set up your local <tt>inetd</tt> or <tt>inetd</tt>-equivalent to run it with the <tt>-p</tt> (for proxy mode) option on a desired port (my convention is port 8765, though if you&#39;re still running Ultraseek, pick something else). In NetPositive+, go to the Preferences window, select the Connections tab, check &#34;Enable proxies&#34; and put the hostname and port 8765 into the fields. Both HTTP and HTTPS requests will go through this host. I strongly recommend that this host be on <em>the same local network</em> as your BeOS box: all requests and data go back and forth unencrypted between your BeOS machine and this one, and if you run <tt>carl</tt> listening on an externally routable interface, you&#39;ve just created an open proxy!
<p>
Alternatively, if you just want to play around without messing with <tt>inetd.conf</tt>, Jef Poskanzer&#39;s very useful <a href="http://acme.com/software/micro_inetd/"><tt>micro_inetd</tt></a> will also run <tt>carl</tt>. The command line once you&#39;ve built it is almost always something like <tt>./micro_inetd 8765 carl -p</tt> (assuming that <tt>carl</tt> is in your path). This will serve the proxy until you kill it.
</p></li><li>But then let&#39;s say you like living dangerously and want to run the full proof-of-concept locally, top to bottom and soup to nuts. I like the way you think! First, compile <tt>carl</tt> from Github using BeOS&#39; provided Metrowerks <tt>mwcc</tt> (Fred Fish Geek Gadgets <tt>gcc</tt> support coming soon): <tt>cc -o carl carl.c</tt> (yes, <em>without</em> optimization), or download <a href="gopher://gopher.floodgap.com/5/archive/be-power/net/carl-cryanc2-beos-ppc-r5.zip">a pre-built binary from Be-Power</a>. Next, since BONE was never supported on PowerPC, you&#39;ll need <tt>inetb</tt>, my <tt>micro_inetd</tt> clone for pre-BONE BeOS (read more about how <a href="http://oldvcr.blogspot.com/2021/02/make-bebox-great-again-tls-12-inetd-and.html">I got around the BeOS&#39; POSIX layer limitations</a>), a PowerPC binary and source code for which <a href="gopher://gopher.floodgap.com/9/archive/be-power/net/inetb.tar.gz">you can also get on Be-Power</a>. I put both <tt>carl</tt> and <tt>inetb</tt> into <tt>/boot/home/config/bin</tt> on the BeBox and Power Mac.
<p>
Now, start the proxy (be sure your BeOS machine is not externally accessible, or edit <tt>inetb.c</tt> to make it only listen to <tt>localhost</tt>): <tt>inetb 8765 carl -pt</tt> (the <tt>-t</tt> option to disable timeouts is needed because you must compile <tt>carl</tt> without optimization to reduce its stack overhead, meaning transactions may take substantially longer). In NetPositive+, go to the Preferences window, select the Connections tab, check &#34;Enable proxies&#34; and put <tt>localhost</tt> and port 8765 into the fields. Both HTTP and HTTPS requests will go through <tt>carl</tt>. If you want to bounce your outgoing requests through an outbound SOCKS proxy, which I highly recommend for security, add it as an argument (e.g., <tt>inetb 8765 carl -pt socks5://socks5:1080/</tt>). Note that although <tt>carl</tt> allows SOCKS 5 as a URL scheme, all requests are made using SOCKS 4.
</p></li></ul>
</li><li>As your last step, be sure to make sure the browser&#39;s document encoding is set to UTF-8 for most sites: the default is ISO-8859-1, predictably spewing mojibake on many pages, and there really isn&#39;t any plumbing for dynamically selecting the character set (... yet). Then just enter any URL and go. Note that form submissions to sites will generate an &#34;insecure&#34; warning, because technically your connection to the proxy is indeed not encrypted. You decide if you want to turn this off.
</li></ul><p>
An obvious question: why not simply link Crypto Ancienne into NetPositive+, since it has an OpenSSL compatibility mode from its upstream, and I can clearly link in new code? Three reasons: first, I doubt very much the antediluvian OpenSSL in NetPositive (I suppose I should be lucky it&#39;s not </p><tt>SSLeay</tt><p>) is ABI-compatible, and the OpenSSL mode is not well-tested. Second, if I find a site that doesn&#39;t work with Crypto Ancienne, and I do periodically, I don&#39;t have to labouriously reconstruct the browser with the changes. But the third and biggest reason is that </p><tt>carl</tt><p> really strains the classic BeOS&#39; stack limits (again, <a href="http://oldvcr.blogspot.com/2022/07/crypto-ancienne-20-now-brings-tls-13-to.html">read the previous article</a> for what horrible things I had to do to get it working in even this state). There is no way I can run that within NetPositive+; all the additional overhead and stack pressure would make the browser unstable. By keeping it as a separate component accessible only over a TCP socket, if that instance of the proxy gets unsettled for some reason then you can just reload the page and try again.
</p><p>
Since I can now add code to the browser, though, there are more opportunities for improvement. First off, we should try to upgrade its cookie support so I can actually log in and post things from the BeBox. And rather than writing a standalone Gopher client for BeOS I think I&#39;ll just hack it into NetPositive and abuse its existing FTP protocol support for rendering menus so this way you can download stuff from Be-Power directly. No one&#39;s going to be hacking CSS into this and the JavaScript support should just be politely forgotten (regardless of how it good it is at managing devices in Earth orbit), but NetPositive+&#39;s layout engine is pretty quick because it&#39;s simple, and it seems to me that simple should work well on these old machines. Post your experiences in the comments.
</p><p><i>Using hacked browsers,</i></p>

</div></div>
  </body>
</html>
