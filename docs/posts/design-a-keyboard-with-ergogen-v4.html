<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://flatfootfox.com/ergogen-introduction/">Original</a>
    <h1>Design a keyboard with Ergogen v4</h1>
    
    <div id="readability-page-1" class="page"><section>
      <p>Howdy and welcome to a new series on ergonomic mechanical keyboard design! Over the course of the next few articles, I&#39;m going to walk through the process of creating an ergonomic keyboard design from scratch using the <a href="https://github.com/ergogen/ergogen">Ergogen</a> keyboard layout generator. The end result will be a PCB design file we can finish in KiCAD before sending off to a PCB fabricator.</p><p><a href="https://github.com/ergogen/ergogen">Ergogen</a> is a one of those passion project that has really grow into its own. It began as a tool to aid Dénes Bán in the development of his <a href="https://zealot.hu/absolem/">Absolem</a> keyboard. After aiding Bán in the creation of <em>one</em> specific keyboard, but he suddenly <a href="https://kbd.news/Declarative-keyboard-design-with-Ergogen-v4.0-1814.html">found himself</a> in possession of a tool that could allow anyone to create <em>any</em> keyboard layout. Over the course of the next three years, Ergogen has evolved from an opinionated set of scripts for one user to a project with a dedicated following.</p><p>The keyboard designed in this series will be the second full keyboard I&#39;ve created in Ergogen. I&#39;m by no means as prolific as a <a href="https://www.youtube.com/@BenVallack">Ben Vallack</a> in this space, but I enjoyed the process of creating <a href="https://flatfootfox.com/the-chonkv-keyboard">my first keyboard</a> enough to put a bit of extra work in when it came to documenting the creation of this next one. This is by no means meant to be a set of comprehensive documentation for Ergogen, and is instead designed primarily to give readers a basic understanding of what the tool&#39;s like to use.</p><p>I have been planning writing this set of articles for a while now. Ergogen&#39;s a nice piece of software to work with, but it can have something of a rocky onboarding process. Depending on what you&#39;re looking to do, you often need to reference the tool&#39;s <a href="https://docs.ergogen.xyz">documentation</a>, various <a href="https://www.youtube.com/watch?v=M_VuXVErD6E">YouTube guides</a>, and an assortment of best-practice GitHub repos. I&#39;m still carrying a torch for long form written how-tos, but what really lit a fire under me was the release of Ergogen v4.</p><p>Ergogen v4 made <a href="https://kbd.news/Declarative-keyboard-design-with-Ergogen-v4.0-1814.html">several breaking changes</a> to Ergogen&#39;s syntax. Now in addition to piecing together the required info, you also need to parse those pieces through the <a href="https://github.com/tsteffek/Ergogen-V4-Migration-Guide">v4 migration guide</a>. It&#39;s <em>a lot</em>, and I know I would have appreciated an end-to-end example when getting started with Ergogen.</p><p>So here you go.</p><h2 id="a-bit-of-background">A Bit Of Background</h2><figure><img src="https://flatfootfox.com/content/images/2023/03/Sofle-Angle-1.png" alt="" loading="lazy" width="1000" height="750" srcset="https://flatfootfox.com/content/images/size/w600/2023/03/Sofle-Angle-1.png 600w, https://flatfootfox.com/content/images/2023/03/Sofle-Angle-1.png 1000w" sizes="(min-width: 720px) 720px"/></figure><p>Let&#39;s back up for a second. This series is a design guide for how to create your own custom ergonomic mechanical keyboard. If you&#39;re not quite sure what those are, I recommend taking a look at my review of the <a href="https://flatfootfox.com/a-review-of-the-sofle-choc/">Sofle Choc keyboar</a>d. The review is ostencibly about one specific keyboard, but the writeup ballooned in scope and the first half serves as a general zero-to-ergonomic-mechanical-keyboards introduction.</p><p>Most importantly, it covered many of the aspects that seperate standard mechanical keyboards from their &#34;ergonomic&#34; counterparts. Ergogen is an opinionated tool, and it&#39;s designed primarily to create ergonomic &#34;column stagger&#34; layouts. That is to say, keyboards where all of the keys in a particular column (<code>1</code>-<code>Q</code>-<code>A</code>-<code>Z</code>, etc.) are aligned together in a straight line. You can technically force Ergogen to do a classic row stagger, but it&#39;s not what it was built for and other tools may be better suited for traditional keyboard layouts.</p><p>So if some of the terms used in this guide seem a bit confusing, I highly recommend going back and checking out that <a href="https://flatfootfox.com/a-review-of-the-sofle-choc/">Sofle Choc review</a>. Additionally, <a href="https://www.reddit.com/r/ErgoMechKeyboards/">/r/ergomechkeyboards</a> is a good resource to discover what&#39;s going on in this particular niche of clacky keyboards. Like most things in 2023, Ergogen also has an active <a href="https://discord.gg/DbCfZfZ">Discord</a> for specific questions.</p><h2 id="so-what-is-ergogen">So What Is Ergogen?</h2><figure><img src="https://flatfootfox.com/content/images/2023/03/Screenshot-2023-03-27-at-8.56.29-AM.png" alt="" loading="lazy" width="911" height="389" srcset="https://flatfootfox.com/content/images/size/w600/2023/03/Screenshot-2023-03-27-at-8.56.29-AM.png 600w, https://flatfootfox.com/content/images/2023/03/Screenshot-2023-03-27-at-8.56.29-AM.png 911w" sizes="(min-width: 720px) 720px"/></figure><p>Whoops. I probably should have explained that earlier. Ergogen, as per it&#39;s <a href="https://github.com/ergogen/ergogen">Github page</a>, &#34;aims to provide a common configuration format to describe ergonomic 2D layouts and generate automatic plates, cases, as well as un-routed PCBs for them.&#34; In it&#39;s most simple form, Ergogen is a set of scripts designed to turn text files into keyboard design files. You give it a config file describing a keyboard, and it will output a trace-less PCB file and some .dxf / .stl files you can use to get started when creating a case. Ergogen is designed to get you out of graphical CAD tools and fiddly alignment controls, letting you focus on parametrically defining a keyboard layout down to the last millimeter.</p><p>Ergogen config files are based on YAML. For the uninitiated, YAML is a data-serialization language designed to allow actual human beings to author structured data without having to spend too much time fussing around with brackets and quotation marks. (You may know it as &#34;<em>Yet Another Markup Language</em>&#34;, although they&#39;ve recently pivoted to &#34;<em>YAML Ain&#39;t Markup Language</em>&#34; to emphasize its focused on structuring data instead of documents.) If you have familiarity with formats like JSON, you should feel right at home with YAML. Just know that in lieu of brackets, YAML uses indentation to indicate grouped blocks of data. If you start getting errors, make sure to double check your tabs or spaces.</p><p>Once you have your Ergogen .yaml file ready to go, you need some way to process it. Ergogen is a NodeJS based project, which means it&#39;s fairly straightforward to get it running locally on your machine. Once you have Node installed, you just need to run the Node Package Manger&#39;s install scrip on your local command line with <code>npm i -g ergogen</code>. After that point, you can parse your local Ergogen file with <code>ergogen input.yaml -o output_folder</code>.</p><p>If you don&#39;t have Node installed or are generally weary of command lines, there&#39;s also a web-based version of Ergogen. This site lets you paste in an Ergogen config file and then download the generated outputs right from your browser. Ergogen community member Cache has done an excellent job of adding live previews to <a href="https://ergogen.cache.works">ergogen.cache.works</a>, letting you quickly itterate through layouts during the early parts of your design process. This site has been updated to Ergogen v4, so even longtime Ergogen enthusiasts are starting to make the pivot to the new syntax changes.</p><h2 id="the-anatomy-of-an-ergogen-config">The Anatomy of an Ergogen Config</h2><p>Creating a new Ergogen config is as simple as opening <a href="https://ergogen.cache.works">ergogen.cache.works</a> and clearing the text on the left side of the screen. You can also open up your favorite text editor and create <code>your-keyboard-name.yaml</code>. (It&#39;s alright, I can give you a minute to think a good name for your new board.) Even if you&#39;re going to use the web versions, it&#39;s a good idea to save your files offline when you&#39;re done tweaking it. The web page will try to keep your edits stored locall in your browser, but you never want to lose hours of work if something goes wrong.</p><p>Ergogen has five primary sections:</p><h3 id="units-covered-in-part-1">Units (Covered in <a href="https://flatfootfox.com/ergogen-part1-units-points/">Part 1</a>)</h3><p>This is a short section of your Ergogen config where you can define custom units. If you find yourself constantly using the same numbers over and over in your config, this is where you can assign a variable to them.</p><h3 id="points-covered-in-part-1">Points (Covered in <a href="https://flatfootfox.com/ergogen-part1-units-points/">Part 1</a>)</h3><figure><img src="https://flatfootfox.com/content/images/2023/03/Screenshot-2023-03-27-at-9.24.58-AM.png" alt="" loading="lazy" width="1466" height="726" srcset="https://flatfootfox.com/content/images/size/w600/2023/03/Screenshot-2023-03-27-at-9.24.58-AM.png 600w, https://flatfootfox.com/content/images/size/w1000/2023/03/Screenshot-2023-03-27-at-9.24.58-AM.png 1000w, https://flatfootfox.com/content/images/2023/03/Screenshot-2023-03-27-at-9.24.58-AM.png 1466w" sizes="(min-width: 720px) 720px"/><figcaption>Points define the overall layout of the keyboard.</figcaption></figure><p>Points is where the real magic happens. A &#34;Point&#34; in Ergogen is the [x,y] position of a single key. So the &#34;Points&#34; section is the place where you actually get to define the custom layout of your keyboard. Rather than having to set an explicit [x,y] position for every key on your board, Ergogen has custom definitions for quickly creating entire columns, rows, and thumb clusters.</p><p>Points themselves aren&#39;t saved as an Ergogen export, but are used as references for the next few sections.</p><h3 id="outlines-covered-in-part-2">Outlines (Covered in <a href="https://flatfootfox.com/ergogen-part2-outlines/">Part 2</a>)</h3><figure><img src="https://flatfootfox.com/content/images/2023/03/Screenshot-2023-03-27-at-9.25.25-AM.png" alt="" loading="lazy" width="1464" height="744" srcset="https://flatfootfox.com/content/images/size/w600/2023/03/Screenshot-2023-03-27-at-9.25.25-AM.png 600w, https://flatfootfox.com/content/images/size/w1000/2023/03/Screenshot-2023-03-27-at-9.25.25-AM.png 1000w, https://flatfootfox.com/content/images/2023/03/Screenshot-2023-03-27-at-9.25.25-AM.png 1464w" sizes="(min-width: 720px) 720px"/><figcaption>Outlines provide a border for the keyboard.</figcaption></figure><p>The Outline section allows users to define the shape of their keyboard. This is done by creating a variety of vector shape definitions. These outlines can reference the points we created earlier, so it&#39;s simple to define a shape such as, &#34;Draw a border around all my keys with a 3mm padding on each edge.&#34; The outlines defined in this section can be referenced later on by both the PCBs and Cases sections.</p><p>Outlines can also be exported by Ergogen as .dxf files that can be use in graphics or CAD applications.</p><h3 id="pcbs-covered-in-part-3">PCBs (Covered in <a href="https://flatfootfox.com/ergogen-part3-pcbs/">Part 3</a>)</h3><figure><img src="https://flatfootfox.com/content/images/2023/03/Screenshot-2023-03-27-at-9.26.44-AM.png" alt="" loading="lazy" width="2000" height="1013" srcset="https://flatfootfox.com/content/images/size/w600/2023/03/Screenshot-2023-03-27-at-9.26.44-AM.png 600w, https://flatfootfox.com/content/images/size/w1000/2023/03/Screenshot-2023-03-27-at-9.26.44-AM.png 1000w, https://flatfootfox.com/content/images/size/w1600/2023/03/Screenshot-2023-03-27-at-9.26.44-AM.png 1600w, https://flatfootfox.com/content/images/size/w2400/2023/03/Screenshot-2023-03-27-at-9.26.44-AM.png 2400w" sizes="(min-width: 720px) 720px"/><figcaption>Ergogen&#39;s output is an unrouted KiCAD PCB with footprints for all the required parts.</figcaption></figure><p>If Points are where the magic happens, PCBs are the star of the show. Creating a circuit board we can send off for manufacturing is the whole reason we&#39;re here after all. The PCB section has a few different things going on. First of all, you need to import an outline to give shape to the new PCB. Next you need to assign a variety of component footprints. The Points section defines where each key should go, but we still need to specify what sort of key switch footprint we need on the board. This is also where we can add component definitions and footprints for other parts like the microcontroller and its reset button. Finally, we&#39;ll need to define the &#34;Nets&#34; for our components. These are definitions used by the PCB to indicate that Key A needs to connect to Pin B.</p><p>PCBs are exported by Ergogen as a KiCAD PCB file. KiCAD typically uses a &#34;Project&#34; structure to organize files. These projects will often include a schematic file defining how components are designed to connect in addition to the PCB file. Since Ergogen has already handled defining these nets, it foregoes the project file and the schematic and only exports the KiCAD PCB file.</p><h3 id="cases-covered-in-part-4">Cases (Covered in <a href="https://flatfootfox.com/ergogen-part4-footprints-cases/">Part 4</a>)</h3><figure><img src="https://flatfootfox.com/content/images/2023/04/Ergogen-Case-1.png" alt="" loading="lazy" width="2000" height="781" srcset="https://flatfootfox.com/content/images/size/w600/2023/04/Ergogen-Case-1.png 600w, https://flatfootfox.com/content/images/size/w1000/2023/04/Ergogen-Case-1.png 1000w, https://flatfootfox.com/content/images/size/w1600/2023/04/Ergogen-Case-1.png 1600w, https://flatfootfox.com/content/images/2023/04/Ergogen-Case-1.png 2189w" sizes="(min-width: 720px) 720px"/><figcaption>Ergogen makes it easy to throw together a quick case.</figcaption></figure><p>This last section is entirely optional. Many custom keyboard designs will rely on a bare PCB and apply rubber bumpers directly to the bottom of the circuit board. If you have access to a 3D printer though, it can be nice to add a bit of color and stability to your design. The Cases section allows you to add depth to any of your outlines. You simply define how tall you want the piece to be, and Ergogen will create the associated 3D model.</p><p>There are some basic operations for adding and subtract case parts from one another. For example, you can define the bottom plate of your case, define several screw holes, and then subtract the screw hole portions from the bottom plate.</p><p>Ergogen v3 previously exported cases files in the .stl lingua franca format of 3D printing. Due to some technical issues with the .stl file creation library, v4 is currently exporting cases as .jscad files. If you&#39;d like to convert these into .stl files, you can use sites like <a href="https://openjscad.xyz/">openjscad.xyz</a> or their <a href="https://www.npmjs.com/package/@jscad/cli">NPM package</a>.</p><h3 id="what-ergogen-doesnt-do-for-you-covered-in-the-finale">What Ergogen Doesn&#39;t Do For You (Covered in the Finale)</h3><figure><img src="https://flatfootfox.com/content/images/2023/04/Screenshot-2023-04-16-at-12.27.39-PM.png" alt="" loading="lazy" width="1146" height="726" srcset="https://flatfootfox.com/content/images/size/w600/2023/04/Screenshot-2023-04-16-at-12.27.39-PM.png 600w, https://flatfootfox.com/content/images/size/w1000/2023/04/Screenshot-2023-04-16-at-12.27.39-PM.png 1000w, https://flatfootfox.com/content/images/2023/04/Screenshot-2023-04-16-at-12.27.39-PM.png 1146w" sizes="(min-width: 720px) 720px"/><figcaption>The finished PCB after routing in KiCAD.</figcaption></figure><p>At the end of this process, you&#39;ll have an <em>unrouted</em> PCB file. If you&#39;ve never made a PCB before, routing is the process of drawing traces to connect two points on a circuit board. All those lines criss-crossing a PCB are physical electrical wires. Most importantly, they can&#39;t overlap or cross one another.</p><p>For geeks who typical work in code, the realities of physics placing limitations on one&#39;s project is a jarring discovery. Automatic routing tools exist, but they often come with their own issues or are part of paid CAD software. Connecting all of the components on one&#39;s keyboard is like trying to solve a hundred wandering salesmen problems on something slightly larger than an index card.</p><p>After Ergogen&#39;s done its work, you&#39;ll need to roll up your sleeves and start routing your circuit board in KiCAD. KiCAD is a capable piece of open source CAD software, but it&#39;s not without its own learning curve. If you used some early versions of <a href="https://www.gimp.org">GIMP</a> or <a href="https://inkscape.org">Inkscape</a>, you&#39;ll have a rough idea for the sort of UI you&#39;re in for.</p><p>Once you&#39;ve finished routing your board, you can send it off to a PCB fabrication service. KiCAD supports exporting to the industry standard Gerber file format, so you shouldn&#39;t have any trouble getting your new keyboard manufactured. Unless you really shell out for express shipping it will take about two weeks for you to receive your new PCBs. That time is in line with many keyboard part sellers, so you can order all the switches, microcontrollers, and keycaps you need at this time.</p><p>The last step is creating a keyboard firmware for your new board. The <a href="http://qmk.fm">QMK</a> and <a href="http://zmk.dev">ZMK</a> open source keyboard firmwares use the same column and row matrix approach as Ergogen so it shouldn&#39;t be too difficult to get your new firmware created. There&#39;s plenty of existing configurations to reference, and you&#39;ve got plenty of time to tackle the firmware while your PCBs are waiting to arrive.</p><h2 id="what-ill-be-building-in-this-guide">What I&#39;ll Be Building In This Guide</h2><p>Good artists borrow, and great artists steal. In this guide, I&#39;m going to be creating a keyboard loosely based off <a href="https://josefadamcik.github.io/SofleKeyboard/">Josef Adamčík&#39;s Sofle keyboard</a>. It&#39;s a 6x4+5 column staggered layout that I&#39;ve grown quite fond of, and should be a useful layout to mimic when showing off Ergogen&#39;s features. While the Sofle Choc offers a Choc switch compatible version of this keyboard, there isn&#39;t a Choc <em>spaced</em> version of the Sofle yet. So this guide&#39;s a totally selfish excuse for me to recreate this board with Choc spacing and claim it was for site content. (Update: Adamčík&#39;s working on a <a href="https://josef-adamcik.cz/electronics/sofle-unsplit-stana-keyboard.html">unibody Choc-spaced Sofle variant</a> now!)</p><p>Now that you know what we&#39;ll be tackling, let&#39;s hop into Ergogen and get started. I&#39;ll see you over in <a href="https://flatfootfox.com/ergogen-part1-units-points/">Let&#39;s Design A Keyboard With Ergogen v4: Units &amp; Points (Part 1)</a>.</p>
    </section></div>
  </body>
</html>
