<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lwn.net/Articles/907613/">Original</a>
    <h1>LXC and LXD: a different container story</h1>
    
    <div id="readability-page-1" class="page"><div>
<center>
           <div><b>This article brought to you by LWN subscribers</b><p>Subscribers to LWN.net made this article — and everything that
       surrounds it — possible.  If you appreciate our content, please
       <a href="https://lwn.net/subscribe/">buy a subscription</a> and make the next
       set of articles possible.</p></div>
           </center>
           
<p><a href="https://lwn.net/Articles/902049/">OCI containers</a> are the most popular type
of Linux container, but they are not the only type, nor were they the
first.  <a href="https://linuxcontainers.org/">LXC</a> (short for &#34;LinuX
Containers&#34;)  predates Docker by several years, though it was also not the
first.  LXC dates back to its first release in 2008; the <a href="https://github.com/moby/moby/tree/v0.1.0">earliest version of
Docker</a>, which was tagged in 2013, was actually a wrapper around LXC.
The LXC project is still going strong and shows no signs of winding
down; <a href="https://discuss.linuxcontainers.org/t/lxc-5-0-lts-has-been-released/14381">LXC 5.0</a> was released in July and comes with a promise of support until
2027.  </p>

<h4>LXC</h4>

<p>LXC was initially developed by IBM, and was part of a <a href="https://lore.kernel.org/all/44242A3F.1010307@sw.ru/">collaboration
between several parties</a> looking to add namespaces to the kernel.
Eventually, 
Canonical took over stewardship of the project, and now hosts its
infrastructure and employs many of its maintainers.  The project includes a
C library called <tt>liblxc</tt> and a collection of command-line tools
built on top of it that can be used to create, interact with, and destroy
containers.  LXC does not provide or require a daemon to manage containers;
the tools it includes act directly on container processes.  </p>

<p>LXC was the first container implementation to be built
entirely on capabilities found in the mainline kernel; predecessors
required out-of-tree patches to work.  Like Docker, LXC containers are
created using a combination of <a href="https://man7.org/linux/man-pages/man7/cgroups.7.html">control
groups</a> and <a href="https://lwn.net/Articles/531114/">namespaces</a>.  Because LXC was
developed in parallel with the effort to add namespaces to the kernel, it
could be considered a sort of reference implementation of using namespaces
for containers on
Linux.  </p>

<p>Unlike Docker, LXC does not presume to espouse an opinion about what
kinds of
processes should run in a container.  By default, it will try to launch an
init system inside of the container, which can then launch other processes
— something that is <a href="https://zauner.nllk.net/post/0038-running-systemd-inside-a-docker-container/">notoriously
hard</a> to do in a Docker container. 
With the correct configuration, though, it is even possible to run LXC
containers 
nested within another LXC container, or to run the Docker daemon inside of
an LXC container.  </p>

<p>LXC containers are defined using a <a href="https://linuxcontainers.org/lxc/manpages/man5/lxc.container.conf.5.html">configuration
file</a>, which offers a great deal of control over how the container is
constructed.  
The <a href="https://linuxcontainers.org/lxc/manpages//man1/lxc-create.1.html"><tt>lxc-create</tt></a>
utility is used to create containers.
LXC does not bundle container configurations and images
together; instead, the container configuration specifies
a directory or block device
to use for
the container&#39;s root filesystem. LXC can use an existing root filesystem,
or <tt>lxc-create</tt> can construct one on the fly using a template. 
</p>

<p>
An LXC
template is a shell script that 
constructs a root filesystem using a few key variables that
<tt>lxc-create</tt> replaces before the template is run.  A handful of
templates are included; among them is an <a href="https://github.com/lxc/lxc/blob/master/templates/lxc-oci.in">OCI
template</a> that uses SUSE&#39;s <a href="https://umo.ci/">umoci</a> utility to
download and unpack a container image from an OCI container registry, which
gives LXC the ability to run all of the same containers that Docker and other
OCI runtimes can.  </p>

<p>A <a href="https://github.com/lxc/lxc-templates/">separate collection of
templates</a> that can build root filesystems for a variety of popular
distributions is available, but this approach has fallen out of favor
because the tools that these templates use often require root privileges.
These days, pre-built images are preferred because they can more easily be
used by unprivileged users.  
</p>

<p>
The LXC project has developed a tool called <a href="https://linuxcontainers.org/distrobuilder/introduction/"><tt>distrobuilder</tt></a>
to create these pre-built images, which are made
available on an <a href="https://us.lxd.images.canonical.com/">image
server</a> hosted by Canonical.  The <a href="https://github.com/lxc/lxc/blob/master/templates/lxc-download.in"><tt>lxc-download</tt></a>
template can be used to create a container based on an image from an image
server.  
</p>

<p>
In theory, anybody can host their own image server, but in
practice, few seem to do so, at least in public.  There does not appear to
be a large 
library of pre-packaged applications in this format like a user of Docker
or Helm might be accustomed to.  Canonical&#39;s image server only contains
base images for an assortment of distributions; any additional software
must be bundled into a custom image, or installed using the package manager
inside the container.  </p>

<p>Among the various options for running containers on Linux, LXC appears
to be the most flexible.  It comes with reasonable defaults, but it
makes no effort to hide the complexity of creating a container from the
user; every detail of the containers that it creates can be customized and
adjusted to taste.  Docker has found much popularity in papering over these
details, but at the cost of flexibility compared to LXC.  </p>

<h4>LXD</h4>

<p><a href="https://linuxcontainers.org/lxd/introduction/">LXD</a> is a
more specialized sister (or perhaps daughter) project of LXC; its
development is also sponsored by Canonical.  LXD was initially released
in 2015; <a href="https://discuss.linuxcontainers.org/t/lxd-5-5-has-been-released/14899">version 5.5</a>
came out in August.  Like LXC, LXD also has long-term support
branches; the most recent long-term support release is <a href="https://discuss.linuxcontainers.org/t/lxd-5-0-lts-has-been-released/13723">LXD 5.0.x</a>, which
will be supported until 2027.  As might be inferred from the name, 
LXD includes a daemon, which is built on top of <tt>liblxc</tt>.  </p>

<p>LXD does away with LXC&#39;s template system in favor of being purely
image-based.  Because of this, Docker container images cannot be used with
LXD — there is no LXD equivalent to LXC&#39;s OCI template.  LXD uses the same
image servers as the <tt>lxc-download</tt> template but requires a
different image format; <tt>distrobuilder</tt> contains support for
building images 
of <a href="https://distrobuilder.readthedocs.io/en/latest/building/">both
types</a> (as well as plain .tar.gz images), though, and Canonical&#39;s image
server carries both LXC and LXD versions of all of the images it hosts.  </p>

<p>Like the Docker daemon, LXD is controlled by an <a href="https://linuxcontainers.org/lxd/rest-api/">API</a> based on HTTP.
LXD also comes with a command-line client using this API called
<tt>lxc</tt> (not 
to be confused with the tools that come with LXC, which are named
<tt>lxc-*</tt>).  Also like Docker, LXD can listen on a UNIX socket, and in
this mode, authentication is largely-nonexistent; access to the API socket
is controlled using filesystem permissions.
</p>

<p>
As part of its <a href="https://ubuntu.com/landscape">Landscape</a> suite
of server-management tools, Canonical offers a <a href="https://landscape.canonical.com/static/doc/api/accesscontrol.html">role-based
access control (RBAC) service</a> that LXD can integrate with for more
fine-grained access control.  Landscape is only free for <a href="https://ubuntu.com/landscape/pricing">personal use or evaluation
purposes</a>, though; enterprises that want the additional security
controls provided by this feature must subscribe to Canonical&#39;s <a href="https://ubuntu.com/advantage">Ubuntu Advantage</a> service.  </p>

<p>LXD can also be used to <a href="https://linuxcontainers.org/lxd/docs/master/virtual-machines/">run virtual
machines</a>.  Working with virtual machines in LXD is more-or-less
identical to working with containers, and the same images can be used for
both; all that needs to be done to create a VM is to pass the <tt>--vm</tt>
flag to the <tt>lxc create</tt> command (once again, not to be confused
with the <tt>lxc-create</tt> command from LXC).  LXD uses <a href="https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine">KVM</a> and the <a href="https://www.qemu.org/">QEMU</a> emulator to run its virtual machines.
</p> 

<p>Several hosts running LXD can be <a href="https://linuxcontainers.org/lxd/docs/master/clustering/">combined
into a cluster</a>.  LXD cluster nodes
coordinate 
with each other 
using a protocol based 
on the <a href="https://raft.github.io/">Raft</a> consensus algorithm,
much like some 
<a href="https://lwn.net/Articles/905164/">OCI container
orchestrators</a> do.
Containers and virtual machines can be launched on a specific cluster node,
or jobs can be distributed to arbitrary <a href="https://linuxcontainers.org/lxd/docs/master/clustering/#cluster-groups">groups</a>
of nodes.  Like Swarm and Kubernetes, LXD bridges cluster networks between
nodes so that containers or VMs running on different nodes can communicate
with each other.  </p>

<p>LXD is an interesting project; the set of features it offers would seem
to make it a viable alternative to Swarm or Kubernetes, but for the lack of
compatibility with OCI containers.  This seems like a curious oversight;
LXC&#39;s OCI template demonstrates that it should be possible, and LXD appears
to have everything else it would need to compete in that arena, but its
developers <a href="https://discuss.linuxcontainers.org/t/using-oci-templates-in-lxd/1911/6">are
not interested</a>.  As it stands, LXD has
deliberately 
limited its audience to the set of people interested in running system
containers or virtual machines.  The tools that it offers to its chosen
audience are 
powerful; people who are weary of struggling with configuring other
virtual-machine managers would be well-advised to have a look at LXD.  </p> 

<h4>Conclusion</h4>

<p>The Linux Containers project as a whole seems healthy, with
committed maintainers backed by a corporate sponsor, regular releases, and
long-term support.  LXC offers a mature and stable set of tools, while LXD
offers a more &#34;modern&#34; feeling user interface to the same technology, and
throws in virtual machines and clustering for good measure.  LXC can be
made to run OCI containers, but LXD cannot; people who are deeply immersed
in the world of OCI might be better-served looking for something more
firmly rooted in that ecosystem.  For people looking for a different kind
of container, though, LXC and LXD are both solid options.  </p></div></div>
  </body>
</html>
