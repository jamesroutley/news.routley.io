<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://iangmcdowell.com/blog/posts/laying-out-a-book-with-css/">Original</a>
    <h1>Laying Out a Print Book with CSS</h1>
    
    <div id="readability-page-1" class="page"><div>

<article>
   
  <div><p><img loading="lazy" src="https://iangmcdowell.com/blog/book_layout_art.png" alt="code book"/>

<em>Obligatory Stable Diffusion image</em></p>
<p>Last year I published my debut technothriller, <a href="https://www.amazon.com/dp/B0BL2JD1LJ">The Anshar Gambit</a>, as an eBook. Satisfying, yes, but I’ve spent entirely too much of my life peddling bits. I wanted to <em>hold</em> it. Unsurprisingly, in order to get my book printed, I first needed to submit a pixel-perfect PDF of all the pages. And like any self-respecting nerd, I approached the challenge in the most convoluted way possible.</p>
<h2 id="the-sane-way-to-do-it">The sane way to do it</h2>
<p><img loading="lazy" src="https://iangmcdowell.com/blog/book_sane.png" alt="sane book"/>
</p>
<p>As you might expect, laying out a book is a solved problem. The simplest solution is to pay a professional. But I have ample time to learn and limited budget, so I wanted a DIY solution.</p>
<p>Most self-publishers use software explicitly built for this task. <a href="https://vellum.pub">Vellum</a> is the gold standard. It is very good and easy to use, and costs just $250. Another contender is <a href="https://www.atticus.io">Atticus</a>, which is pitched as an all-in-one writing platform for a more affordable $147. These are both good options, and while expensive for software, reasonable for the amount of time they save you. But I am a fool with more time than sense/cents, and I knew I could do it cheaper.</p>
<p><a href="https://reedsy.com/">Reedsy</a> offers an online tool that supports generating a basic print layout. And it’s free! That got my attention. I made it as far as uploading my manuscript, but hit a rendering bug displaying Latin Extended-A characters in a code-block. I reported the bug, and a nice CSR told me they’d forward it to their engineering team, who were unlikely to fix it. I decided not to invest more time hacking around their limitations to get a layout I wasn’t thrilled about anyway.</p>
<h2 id="the-less-sane-way-to-do-it">The less sane way to do it</h2>
<p><img loading="lazy" src="https://iangmcdowell.com/blog/book_less_sane.png" alt="less sane book"/>
</p>
<p>I’m too cheap to hire a professional, but maybe I can use their tools? <a href="https://www.adobe.com/products/indesign.html">Adobe InDesign</a> is unsurprisingly a popular choice, but I just hear the word ‘Adobe’ and my hand instinctively reaches back to protect my wallet. In retrospect I might have been able to get away with a one-month subscription for the relative deal of $31.49.</p>
<p><a href="https://affinity.serif.com/en-us/publisher/">Affinity Publisher</a> makes a well-regarded alternative that people claim is just as powerful. And for $70 you get a real license, none of that subscription BS. I was interested enough to start a free trial, but realized immediately I was in way over my head and had a steep learning curve to climb. If only there was a powerful layout tool I already knew how to use…</p>
<h2 id="the-way-i-did-it">The way I did it</h2>
<p><img loading="lazy" src="https://iangmcdowell.com/blog/book_crazy.png" alt="insane book"/>
</p>
<p>I’ve spent a non-trivial amount of my life positioning divs. It is low on my list of tasks I enjoy, but over the years I’ve gotten pretty good at cajoling bits into place. CSS is a hell of a hammer, and the more I thought about it, the more my book started looking like a nail.</p>
<p>That’s right, I decided to lay out a print book using cascading style sheets. You know, like everyone uses on the web. And no one uses in print. Well, almost no one; we’ll get to that later.</p>
<p>I already had my book rendered out as bunch of HTML files from my robust ebook pipeline. Haha, jk, I wrote a few hundred lines of sloppy Python/<a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">BeautifulSoup</a> that transforms my <a href="https://gottcode.org/focuswriter/">FocusWriter</a>-generated odt file into an ePub suitable for distribution. God bless <code>ebookify.py</code>. Anyhow, I was already waist-deep in the HTML swamp, and had something I could slap a stylesheet on.</p>
<p>But CSS isn’t really made for print, right? I mean, sure, like any totally normal person I use <code>@media print</code> to make my HTML resume look better when a recruiter runs off a copy, but laying out a 300+ page novel is a different beast. You’ve got page numbers, persistent headings, special cases for first of a chapter, weird paper-sizing, etc. Can CSS do all this?</p>
<p>Spoiler: Yes. But you have to push it to the bleeding edge.</p>
<h2 id="getting-started">Getting Started</h2>
<p>I tweaked <code>ebookify.py</code> to output a single concatenated HTML file containing the markup for all the chapters. My initial goal was to write a stylesheet against this that would make a reasonably good looking book when I hit print in Chrome.</p>
<p>Here’s what I started with:</p>
<p><img loading="lazy" src="https://iangmcdowell.com/blog/book_initial.png" alt="basic web layout"/>

<em>LGTM, ship it!</em></p>
<h3 id="fonts">Fonts</h3>
<p>CSS is great at sticking fonts on things. As a commercial work though, I needed to pay a little more attention to licensing. I wanted a nice serif font for the body text, and a futuristic sans font for the titles/headers.</p>
<p>Baskerville was an easy pick for the body; it’s a common/modern choice, and the license that comes with my Mac is already good for distribution. I looked up good pairings, saw it next to ‘Futura,’ and fell in love. Then I read Futura’s license.</p>
<blockquote>
<p>Licensed (protected) font. This font must not be modified, embedded, or exchanged in any manner without first obtaining permission of the legal owner.</p>
</blockquote>
<p>D’oh.</p>
<p>Sure, I could pay the $50, but I’ve already come this far for free – I want to get all the way there. Another trip to professor Google suggested <a href="https://fonts.google.com/specimen/Jost">Jost</a> as an alternative to Futura. It’s not as perfect as my first-love, but there’s more to a relationship than just looks. Like licenses (okay, so the metaphor breaks down).</p>
<p>Anyhow, CSS time!</p>
<pre tabindex="0"><code>body {
    font-family: &#34;Baskerville&#34;;
}

h2 {
    text-align: center;
    font-family: &#34;Jost&#34;;
 }
</code></pre><p><img loading="lazy" src="https://iangmcdowell.com/blog/book_fonted.png" alt="web layout with fonts"/>

<em>Better(?)</em></p>
<h3 id="basic-layout">Basic Layout</h3>
<p>It still looks like a web-page, it’s time to apply some print conventions. The chapter headings need some room, and maybe a sweet underline. The body text should be a column, with indented paragraphs. That kind of stuff.</p>
<p>A note on my CSS: Yes, I’m all over the place with my units (Inches! Pixels! Points! Ems!), and there’s no rhyme or reason to the order of my declarations. In my defense: it doesn’t matter. I’m not going to prod with this. No one’s going to be stuck maintaining it. And, god willing, I’ll never have to extend it. But you’re welcome to clean it up for use in your own project.</p>
<pre tabindex="0"><code>h2 {
    text-align: center;
    font-family: &#34;Jost&#34;;  
    margin-top: 1.4in;
    margin-bottom: .9in;
    font-weight: 300;
    display: inline-block; 
    /* Pad box to position the &#34;underline&#34; that&#39;s rendered using the border */
    padding: 0.1in 0.2in;
    border-bottom: 1px solid;
    line-height: 1em;
    font-size: 15pt;
}

p {
    margin:0;
    text-indent: 1.5em;
    font-size: 12pt;
    line-height: 14.3pt;
    text-align: justify;
    text-justify: inter-word;
    word-spacing: -.7px;
}

p:first-child {
    text-indent: 0;
}

.chapter {
    text-align: left;
}
</code></pre><p><img loading="lazy" src="https://iangmcdowell.com/blog/book_layout.png" alt="print-like layout"/>

<em>Vaguely print-like</em></p>
<h3 id="page-numbers">Page Numbers</h3>
<p>The basic layout is looking okay, but now we’re missing print specific stuff. Page numbers being a big-one, obviously. Dealbreaker for CSS, right?</p>
<p>Wrong!</p>
<p>Check out <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@page">@page</a>, sucka. CSS knows what pages are! And it can <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Counter_Styles/Using_CSS_counters">count</a>! And there are special sections on the page margin for sticking things like page numbers. It’s almost like someone was <a href="https://www.w3.org/TR/css-page-3/">thinking about laying out books with CSS</a>.</p>
<p>Of course, there’s a big difference between “something with a spec” and “something broadly implemented in browsers.” Let’s ask my good friend <a href="https://caniuse.com/css-paged-media">caniuse</a></p>
<p><img loading="lazy" src="https://iangmcdowell.com/blog/book_can_i_use.png" alt="caniuse showing support for @page"/>

<em>Woohoo! The dark green of full support.</em></p>
<p>Alright, let’s make some pages and page numbers!</p>
<pre tabindex="0"><code>
body {
    counter-reset: page_num chap_num;
}

@page {
    margin-top: .7in;
    /* Getting an extra .12 inches padding on the bottom from ?? Whatever, hack! */
    margin-bottom: .58in;
    padding: 0;
    size: 5.5in 8.5in;
    counter-increment: page_num;

    @bottom-center {
        font-family: &#34;Jost&#34;;
        font-weight: 300;
        content: counter(page_num);
        font-size: 9pt;
        position: relative;
        margin-top: -.35in;
    }
}
</code></pre><p><img loading="lazy" src="https://iangmcdowell.com/blog/book_page.png" alt="page layout, but page numbers missing"/>

<em>Umm…</em></p>
<p>It’s the correct size and stuff, but where are my numbers? They’re supported, right? Right? RIGHT??!!?</p>
<p><a href="https://github.com/Fyrd/caniuse/issues/4034">Wrong.</a></p>
<p>Oops, there’s a bug. In caniuse, haha. Not Chrome – <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=320370">Chrome has never supported @bottom-center</a>. Ditto goes for Firefox. I cannot use. At least, not all the cool parts.</p>
<p>I took a little solace that <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=286443">Kevin has been feeling my pain for 18 years</a>, but it still stung.</p>
<p>So what now? I’m sunk, right? None of the major browser vendors support the feature I need, and I can’t well have a book without page numbers. But I read through the caniuse bug, and lo:</p>
<blockquote>
<p>edgar444 commented on Jul 13, 2018</p>
<p>… [snip some CSS about rendering a header using @top-center]</p>
<p>There is software like weasyprint that did produce the red boxes.</p>
</blockquote>
<p>Q: What is a <a href="https://weasyprint.org/">weasyprint</a>?</p>
<p>A: An eldritch invocation for rendering html to pdf that supports a surprising amount of bleeding edge CSS.</p>
<p>I don’t believe in ‘manifesting,’ or whatever. But I’m pretty sure this software didn’t exist until I willed it to. I fired off a <code>brew install weasyprint</code> and crossed my fingers.</p>
<p>One more time with <del>feeling</del> weasing:</p>
<p><img loading="lazy" src="https://iangmcdowell.com/blog/book_page_weasy.png" alt="page layout with page numbers"/>

<em>Look at that beautiful page number!</em></p>

<p>Now we’re off to the races. Let’s marginalia all the things!</p>
<p>One problem though – I want different headers on the left and right pages. Also different left and right margins, since a lot of the paper gets buried in the binding. Surely CSS doesn’t support– aww, you know I’m only messing. CSS DOES ALL.</p>
<pre tabindex="0"><code>:root {
    --inside-margin: .75in;
    --outside-margin: .5in;
}

@page :left {
    margin-left: var(--outside-margin);
    margin-right: var(--inside-margin);
    @top-center {
        margin-bottom: -.22in;
        font-family: &#34;Jost&#34;;
        font-weight: 300;
        font-size: 9.2pt;
        content: &#34;IAN G. MCDOWELL&#34;;
    }
}

@page :right {
    margin-left: var(--inside-margin);
    margin-right: var(--outside-margin);

    @top-center {
        margin-bottom: -.23in;
        font-family: &#34;Jost&#34;;
        font-weight: 300;
        font-size: 10pt;
        content: &#34;The Anshar Gambit&#34;;
    }
}
</code></pre><p><img loading="lazy" src="https://iangmcdowell.com/blog/book_headers.png" alt="page layout with headers"/>

<em>Headers! This is a book! Wait, what’s that chapter doing there starting mid-page…</em></p>
<h3 id="more-bookish-things">More Bookish Things</h3>
<p>Anyone that ever word-processed pre-2006 knows that page breaks are a thing. Guess what? CSS breaks pages with the best of them. I’m also going to throw in a sweet custom SVG section break I made.</p>
<pre tabindex="0"><code>.chapter {
    break-after: always;
}

.divider {
    text-align: center;
    padding: .2in;
}

.divider img {
    width: 50%;
}
</code></pre><p><img loading="lazy" src="https://iangmcdowell.com/blog/book_breaks.png" alt="page layout with breaks"/>

Tada, chapters start on new pages. Also, look at that sweet mid-chapter break graphic (No, I’m not a designer. Yes, I’m irrationally proud).</p>
<p>But now our header is showing up on the first page of the chapter. That’s not professional. Surely CSS has a way to conditionally hide it?</p>
<p>Actually, no. Not elegantly. At least not that I could find. But I didn’t write CSS for a decade without learning to <em>HACK</em>. We’ll just make our chapter headers exude a giant white box that obliterates everything above them.</p>
<pre tabindex="0"><code>h2::before {
    content: &#39;&#39;;
    position: absolute;
    /* Need a negative offset as our parent is the non-margin parts of the page. */
    top: -1in;
    left: 0;
    width: 100%;
    height: 2in;
    background-color: white;
}

@page :right {
    ...
    @top-center {
        ...
        z-index: -1;
    }
}

@page :left {
    ...
    @top-center {
        ...
        z-index: -1;
    }
}
</code></pre><p><img loading="lazy" src="https://iangmcdowell.com/blog/book_suppress_header.png" alt="header suppressed on new chapter"/>

<em>Header be gone!</em></p>
<h2 id="conclusion">Conclusion</h2>
<p>There you have it: All the formatting of a traditional print book, achieved in the most asinine way possible. I didn’t get CSS to run doom or anything, but I’m still delighted that I made this work using only HTML, CSS, and a little weasy black magic.</p>
<p>It’s even got some advantages; if I change any text, the whole thing automatically reflows. And when I’m ready to send it to the printer, I can dive into the markup to hand-tweak anything that doesn’t look exactly right.</p>
<p>My author copies came in the mail today, and they look like… books!
<img loading="lazy" src="https://iangmcdowell.com/blog/book_print.jpg" alt="print copy"/>

<em>I’m holding HTML!</em></p>
<p>Total out-of-pocket cost: $0. It’s like Linux: free so long as your time has no value.</p>
<p><img loading="lazy" src="https://iangmcdowell.com/blog/book_flip.gif" alt="print copy"/>

<em>flippity-flip-flip</em></p>
<p>Would I recommend this approach to a friend? Hell no. Just use Vellum like a normal person. Will I share my stylesheet? I mean, I already kind of did, but if you ask nice I suppose I could give it to you as a file. Hit me up – <a href="mailto:ian@iangmcdowell.com">ian@iangmcdowell.com</a>. I will also listen to your angry CSS rants, though I will not help you fix issues :-)</p>
<h2 id="anything-else">Anything else?</h2>
<p>Pitch time!</p>
<p><a href="https://www.amazon.com/dp/B0BL2JD1LJ"><img loading="lazy" src="https://iangmcdowell.com/blog/anshar_cover.png" alt="The Anshar Gambit book cover"/>
</a></p>
<p>If you like riveting, fast-paced technothrillers with compelling characters, near-future technology, and orbital bombardment, you should check out <a href="https://www.amazon.com/dp/B0BL2JD1LJ">The Anshar Gambit</a>, available wherever mega-corporation monopolists sell books (read: Amazon). Now in paperback!</p>
<p>Alternatively/additionally, for those of you embracing the frugal spirit of this post, you can <a href="https://iangmcdowell.com/">sign up for my mailing list</a> to receive a free digital copy of the prequel novella, The Boreas Gap.</p>


  </div>

  
</article>
    </div></div>
  </body>
</html>
