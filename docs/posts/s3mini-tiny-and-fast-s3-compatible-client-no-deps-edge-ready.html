<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/good-lly/s3mini">Original</a>
    <h1>Show HN: S3mini ‚Äì Tiny and fast S3-compatible client, no-deps, edge-ready</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><code>s3mini</code> is an ultra-lightweight Typescript client (~14 KB minified, ‚âà15 % more ops/s) for S3-compatible object storage. It runs on Node, Bun, Cloudflare Workers, and other edge platforms. It has been tested on Cloudflare R2, Backblaze B2, DigitalOcean Spaces, and MinIO. (No Browser support!)</p>
<p dir="auto">[<a href="https://github.com/good-lly/s3mini">github</a>]
[<a href="https://github.com/good-lly/s3mini/issues">issues</a>]
[<a href="https://www.npmjs.com/package/s3mini" rel="nofollow">npm</a>]</p>

<ul dir="auto">
<li>üöÄ Light and fast: averages ‚âà15 % more ops/s and only ~14 KB (minified, not gzipped).</li>
<li>üîß Zero dependencies; supports AWS SigV4 (no pre-signed requests).</li>
<li>üü† Works on Cloudflare Workers; ideal for edge computing, Node, and Bun (no browser support).</li>
<li>üîë Only the essential S3 APIs‚Äîimproved list, put, get, delete, and a few more.</li>
<li>üì¶ <strong>BYOS3</strong> ‚Äî <em>Bring your own S3-compatible bucket</em> (tested on Cloudflare R2, Backblaze B2, DigitalOcean Spaces, MinIO and Garage! Ceph and AWS are in the queue).</li>
</ul>

<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/good-lly/s3mini/blob/dev/testedon.png"><img src="https://github.com/good-lly/s3mini/raw/dev/testedon.png" alt="Tested On"/></a></p>
<p dir="auto">Dev:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/bf7b30c3cfdbd3ccc409731dfcf7309229b1fc1f2eaeece077ae0163720a2d7a/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f636f6d6d69742d61637469766974792f6d2f676f6f642d6c6c792f73336d696e692f6465763f636f6c6f723d67726565656e"><img src="https://camo.githubusercontent.com/bf7b30c3cfdbd3ccc409731dfcf7309229b1fc1f2eaeece077ae0163720a2d7a/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f636f6d6d69742d61637469766974792f6d2f676f6f642d6c6c792f73336d696e692f6465763f636f6c6f723d67726565656e" alt="GitHub commit activity (branch)" data-canonical-src="https://img.shields.io/github/commit-activity/m/good-lly/s3mini/dev?color=greeen"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/6a746b9ad4507bf242d021923444bddc75cc1a3d306fdc55134a85e6ccba8fa8/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6973737565732f676f6f642d6c6c792f73336d696e69"><img src="https://camo.githubusercontent.com/6a746b9ad4507bf242d021923444bddc75cc1a3d306fdc55134a85e6ccba8fa8/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6973737565732f676f6f642d6c6c792f73336d696e69" alt="GitHub Issues or Pull Requests" data-canonical-src="https://img.shields.io/github/issues/good-lly/s3mini"/></a>
<a href="https://github.com/good-lly/s3mini/actions/workflows/codeql.yml"><img src="https://github.com/good-lly/s3mini/actions/workflows/codeql.yml/badge.svg?branch=dev" alt="CodeQL Advanced"/></a>
<a href="https://github.com/good-lly/s3mini/actions/workflows/test-e2e.yml"><img src="https://github.com/good-lly/s3mini/actions/workflows/test-e2e.yml/badge.svg?branch=dev" alt="Test:e2e(all)"/></a></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/822c31326e4a40a59e2a813db9dcbdb1bce1c5b687237c4aae892d8850a43e9b/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f73746172732f676f6f642d6c6c792f73336d696e693f7374796c653d736f6369616c"><img src="https://camo.githubusercontent.com/822c31326e4a40a59e2a813db9dcbdb1bce1c5b687237c4aae892d8850a43e9b/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f73746172732f676f6f642d6c6c792f73336d696e693f7374796c653d736f6369616c" alt="GitHub Repo stars" data-canonical-src="https://img.shields.io/github/stars/good-lly/s3mini?style=social"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/4de7585b00e2b338207229723bab399bde2b3fefa531015a529b52d874aa75fd/68747470733a2f2f696d672e736869656c64732e696f2f6e706d2f646d2f73336d696e69"><img src="https://camo.githubusercontent.com/4de7585b00e2b338207229723bab399bde2b3fefa531015a529b52d874aa75fd/68747470733a2f2f696d672e736869656c64732e696f2f6e706d2f646d2f73336d696e69" alt="NPM Downloads" data-canonical-src="https://img.shields.io/npm/dm/s3mini"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/863f019439a06855c998b1a1a01302f70728781442f5236090683d1793445959/68747470733a2f2f696d672e736869656c64732e696f2f6e706d2f762f73336d696e693f636f6c6f723d677265656e"><img src="https://camo.githubusercontent.com/863f019439a06855c998b1a1a01302f70728781442f5236090683d1793445959/68747470733a2f2f696d672e736869656c64732e696f2f6e706d2f762f73336d696e693f636f6c6f723d677265656e" alt="NPM Version" data-canonical-src="https://img.shields.io/npm/v/s3mini?color=green"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/179914f6471af92eb18a918ccc151661f36231a77b5a8665f45e294eb52428af/68747470733a2f2f696d672e736869656c64732e696f2f62756e646c656a732f73697a652f73336d696e693f636f6c6f723d677265656e"><img src="https://camo.githubusercontent.com/179914f6471af92eb18a918ccc151661f36231a77b5a8665f45e294eb52428af/68747470733a2f2f696d672e736869656c64732e696f2f62756e646c656a732f73697a652f73336d696e693f636f6c6f723d677265656e" alt="npm package minimized gzipped size" data-canonical-src="https://img.shields.io/bundlejs/size/s3mini?color=green"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/130a065a22021d83141baa1284b5479f286d238097574885c18c4f1a78669ae4/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f676f6f642d6c6c792f73336d696e69"><img src="https://camo.githubusercontent.com/130a065a22021d83141baa1284b5479f286d238097574885c18c4f1a78669ae4/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f676f6f642d6c6c792f73336d696e69" alt="GitHub License" data-canonical-src="https://img.shields.io/github/license/good-lly/s3mini"/></a></p>
<p dir="auto"><a href="https://github.com/good-lly/s3mini/issues/"> <img src="https://camo.githubusercontent.com/b20f68f697b27055937e1f8238eec47e2cb37f5fc74960da5dfbfe40e04af19a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f636f6e747269627574696f6e732d77656c636f6d652d627269676874677265656e2e737667" alt="Contributions welcome" data-canonical-src="https://img.shields.io/badge/contributions-welcome-brightgreen.svg"/></a></p>
<p dir="auto">Performance tests was done on local Minio instance. Your results may vary depending on environment and network conditions, so take it with a grain of salt.
<a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/good-lly/s3mini/dev/performance-screenshot.png"><img src="https://raw.githubusercontent.com/good-lly/s3mini/dev/performance-screenshot.png" alt="performance-image"/></a></p>

<ul dir="auto">
<li><a href="#supported-ops">Supported Ops</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#security-notes">Security Notes</a></li>
<li><a href="#contributions-welcomed">üíô Contributions welcomed!</a></li>
<li><a href="#license">License</a></li>
</ul>

<p dir="auto">The library supports a subset of S3 operations, focusing on essential features, making it suitable for environments with limited resources.</p>

<ul dir="auto">
<li>‚úÖ HeadBucket (bucketExists)</li>
<li>‚úÖ createBucket (createBucket)</li>
</ul>

<ul dir="auto">
<li>‚úÖ ListObjectsV2 (listObjects)</li>
<li>‚úÖ GetObject (getObject, getObjectResponse, getObjectWithETag, getObjectRaw, getObjectArrayBuffer, getObjectJSON)</li>
<li>‚úÖ PutObject (putObject)</li>
<li>‚úÖ DeleteObject (deleteObject)</li>
<li>‚úÖ HeadObject (objectExists, getEtag, getContentLength)</li>
<li>‚úÖ listMultipartUploads</li>
<li>‚úÖ CreateMultipartUpload (getMultipartUploadId)</li>
<li>‚úÖ completeMultipartUpload</li>
<li>‚úÖ abortMultipartUpload</li>
<li>‚úÖ uploadPart</li>
<li>‚ùå CopyObject: Not implemented (tbd)</li>
</ul>




<blockquote>
<p dir="auto"><strong><g-emoji alias="warning">‚ö†Ô∏è</g-emoji> Environment Support Notice</strong></p>
<p dir="auto">This library is designed to run in environments like <strong>Node.js</strong>, <strong>Bun</strong>, and <strong>Cloudflare Workers</strong>. It does <strong>not support browser environments</strong> due to the use of Node.js APIs and polyfills.</p>
<p dir="auto"><strong>Cloudflare Workers:</strong> To enable built-in Node.js Crypto API, add the <code>nodejs_compat</code> compatibility flag to your Wrangler configuration file. This also enables <code>nodejs_compat_v2</code> as long as your compatibility date is <code>2024-09-23</code> or later. <a href="https://developers.cloudflare.com/workers/configuration/compatibility-dates/#nodejs-compatibility-flag" rel="nofollow">Learn more about the Node.js compatibility flag and v2</a>.</p>
</blockquote>

<div dir="auto" data-snippet-clipboard-copy-content="import { s3mini, sanitizeETag } from &#39;s3mini&#39;;

const s3client = new s3mini({
  accessKeyId: config.accessKeyId,
  secretAccessKey: config.secretAccessKey,
  endpoint: config.endpoint,
  region: config.region,
});

// Basic bucket ops
let exists: boolean = false;
try {
  // Check if the bucket exists
  exists = await s3client.bucketExists();
} catch (err) {
  throw new Error(`Failed bucketExists() call, wrong credentials maybe: ${err.message}`);
}
if (!exists) {
  // Create the bucket based on the endpoint bucket name
  await s3client.createBucket();
}

// Basic object ops
// key is the name of the object in the bucket
const smallObjectKey: string = &#39;small-object.txt&#39;;
// content is the data you want to store in the object
// it can be a string or Buffer (recommended for large objects)
const smallObjectContent: string = &#39;Hello, world!&#39;;

// check if the object exists
const objectExists: boolean = await s3client.objectExists(smallObjectKey);
let etag: string | null = null;
if (!objectExists) {
  // put/upload the object, content can be a string or Buffer
  // to add object into &#34;folder&#34;, use &#34;folder/filename.txt&#34; as key
  const resp: Response = await s3client.putObject(smallObjectKey, smallObjectContent);
  // you can also get etag via getEtag method
  // const etag: string = await s3client.getEtag(smallObjectKey);
  etag = sanitizeETag(resp.headers.get(&#39;etag&#39;));
}

// get the object, null if not found
const objectData: string | null = await s3client.getObject(smallObjectKey);
console.log(&#39;Object data:&#39;, objectData);

// get the object with ETag, null if not found
const response2: Response = await s3mini.getObject(smallObjectKey, { &#39;if-none-match&#39;: etag });
if (response2) {
  // ETag changed so we can get the object data and new ETag
  // Note: ETag is not guaranteed to be the same as the MD5 hash of the object
  // ETag is sanitized to remove quotes
  const etag2: string = sanitizeETag(response2.headers.get(&#39;etag&#39;));
  console.log(&#39;Object data with ETag:&#39;, response2.body, &#39;ETag:&#39;, etag2);
} else {
  console.log(&#39;Object not found or ETag does match.&#39;);
}

// list objects in the bucket, null if bucket is empty
// Note: listObjects uses listObjectsV2 API and iterate over all pages
// so it will return all objects in the bucket which can take a while
// If you want to limit the number of objects returned, use the maxKeys option
// If you want to list objects in a specific &#34;folder&#34;, use &#34;folder/&#34; as prefix
// Example s3client.listObjects({&#34;/&#34; &#34;myfolder/&#34;})
const list: object[] | null = await s3client.listObjects();
if (list) {
  console.log(&#39;List of objects:&#39;, list);
} else {
  console.log(&#39;No objects found in the bucket.&#39;);
}

// delete the object
const wasDeleted: boolean = await s3client.deleteObject(smallObjectKey);

// Multipart upload
const multipartKey = &#39;multipart-object.txt&#39;;
const large_buffer = new Uint8Array(1024 * 1024 * 15); // 15 MB buffer
const partSize = 8 * 1024 * 1024; // 8 MB
const totalParts = Math.ceil(large_buffer.length / partSize);
// Beware! This will return always a new uploadId
// if you want to use the same uploadId, you need to store it somewhere
const uploadId = await s3client.getMultipartUploadId(multipartKey);
const uploadPromises = [];
for (let i = 0; i &lt; totalParts; i++) {
  const partBuffer = large_buffer.subarray(i * partSize, (i + 1) * partSize);
  // upload each part
  // Note: uploadPart returns a promise, so you can use Promise.all to upload all parts in parallel
  // but be careful with the number of parallel uploads, it can cause throttling
  // or errors if you upload too many parts at once
  // You can also use generator functions to upload parts in batches
  uploadPromises.push(s3client.uploadPart(multipartKey, uploadId, partBuffer, i + 1));
}
const uploadResponses = await Promise.all(uploadPromises);
const parts = uploadResponses.map((response, index) =&gt; ({
  partNumber: index + 1,
  etag: response.etag,
}));
// Complete the multipart upload
const completeResponse = await s3client.completeMultipartUpload(multipartKey, uploadId, parts);
const completeEtag = completeResponse.etag;

// List multipart uploads
// returns object with uploadId and key
const multipartUploads: object = await s3client.listMultipartUploads();
// Abort the multipart upload
const abortResponse = await s3client.abortMultipartUpload(multipartUploads.key, multipartUploads.uploadId);

// Multipart download
// lets test getObjectRaw with range
const rangeStart = 2048 * 1024; // 2 MB
const rangeEnd = 8 * 1024 * 1024 * 2; // 16 MB
const rangeResponse = await s3client.getObjectRaw(multipartKey, false, rangeStart, rangeEnd);
const rangeData = await rangeResponse.arrayBuffer();"><pre><span>import</span> <span>{</span> <span>s3mini</span><span>,</span> <span>sanitizeETag</span> <span>}</span> <span>from</span> <span>&#39;s3mini&#39;</span><span>;</span>

<span>const</span> <span>s3client</span> <span>=</span> <span>new</span> <span>s3mini</span><span>(</span><span>{</span>
  <span>accessKeyId</span>: <span>config</span><span>.</span><span>accessKeyId</span><span>,</span>
  <span>secretAccessKey</span>: <span>config</span><span>.</span><span>secretAccessKey</span><span>,</span>
  <span>endpoint</span>: <span>config</span><span>.</span><span>endpoint</span><span>,</span>
  <span>region</span>: <span>config</span><span>.</span><span>region</span><span>,</span>
<span>}</span><span>)</span><span>;</span>

<span>// Basic bucket ops</span>
<span>let</span> <span>exists</span>: <span>boolean</span> <span>=</span> <span>false</span><span>;</span>
<span>try</span> <span>{</span>
  <span>// Check if the bucket exists</span>
  <span>exists</span> <span>=</span> <span>await</span> <span>s3client</span><span>.</span><span>bucketExists</span><span>(</span><span>)</span><span>;</span>
<span>}</span> <span>catch</span> <span>(</span><span>err</span><span>)</span> <span>{</span>
  <span>throw</span> <span>new</span> <span>Error</span><span>(</span><span>`Failed bucketExists() call, wrong credentials maybe: <span><span>${</span><span>err</span><span>.</span><span>message</span><span>}</span></span>`</span><span>)</span><span>;</span>
<span>}</span>
<span>if</span> <span>(</span><span>!</span><span>exists</span><span>)</span> <span>{</span>
  <span>// Create the bucket based on the endpoint bucket name</span>
  <span>await</span> <span>s3client</span><span>.</span><span>createBucket</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>// Basic object ops</span>
<span>// key is the name of the object in the bucket</span>
<span>const</span> <span>smallObjectKey</span>: <span>string</span> <span>=</span> <span>&#39;small-object.txt&#39;</span><span>;</span>
<span>// content is the data you want to store in the object</span>
<span>// it can be a string or Buffer (recommended for large objects)</span>
<span>const</span> <span>smallObjectContent</span>: <span>string</span> <span>=</span> <span>&#39;Hello, world!&#39;</span><span>;</span>

<span>// check if the object exists</span>
<span>const</span> <span>objectExists</span>: <span>boolean</span> <span>=</span> <span>await</span> <span>s3client</span><span>.</span><span>objectExists</span><span>(</span><span>smallObjectKey</span><span>)</span><span>;</span>
<span>let</span> <span>etag</span>: <span>string</span> <span>|</span> <span>null</span> <span>=</span> <span>null</span><span>;</span>
<span>if</span> <span>(</span><span>!</span><span>objectExists</span><span>)</span> <span>{</span>
  <span>// put/upload the object, content can be a string or Buffer</span>
  <span>// to add object into &#34;folder&#34;, use &#34;folder/filename.txt&#34; as key</span>
  <span>const</span> <span>resp</span>: <span>Response</span> <span>=</span> <span>await</span> <span>s3client</span><span>.</span><span>putObject</span><span>(</span><span>smallObjectKey</span><span>,</span> <span>smallObjectContent</span><span>)</span><span>;</span>
  <span>// you can also get etag via getEtag method</span>
  <span>// const etag: string = await s3client.getEtag(smallObjectKey);</span>
  <span>etag</span> <span>=</span> <span>sanitizeETag</span><span>(</span><span>resp</span><span>.</span><span>headers</span><span>.</span><span>get</span><span>(</span><span>&#39;etag&#39;</span><span>)</span><span>)</span><span>;</span>
<span>}</span>

<span>// get the object, null if not found</span>
<span>const</span> <span>objectData</span>: <span>string</span> <span>|</span> <span>null</span> <span>=</span> <span>await</span> <span>s3client</span><span>.</span><span>getObject</span><span>(</span><span>smallObjectKey</span><span>)</span><span>;</span>
<span>console</span><span>.</span><span>log</span><span>(</span><span>&#39;Object data:&#39;</span><span>,</span> <span>objectData</span><span>)</span><span>;</span>

<span>// get the object with ETag, null if not found</span>
<span>const</span> <span>response2</span>: <span>Response</span> <span>=</span> <span>await</span> <span>s3mini</span><span>.</span><span>getObject</span><span>(</span><span>smallObjectKey</span><span>,</span> <span>{</span> <span>&#39;if-none-match&#39;</span>: <span>etag</span> <span>}</span><span>)</span><span>;</span>
<span>if</span> <span>(</span><span>response2</span><span>)</span> <span>{</span>
  <span>// ETag changed so we can get the object data and new ETag</span>
  <span>// Note: ETag is not guaranteed to be the same as the MD5 hash of the object</span>
  <span>// ETag is sanitized to remove quotes</span>
  <span>const</span> <span>etag2</span>: <span>string</span> <span>=</span> <span>sanitizeETag</span><span>(</span><span>response2</span><span>.</span><span>headers</span><span>.</span><span>get</span><span>(</span><span>&#39;etag&#39;</span><span>)</span><span>)</span><span>;</span>
  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#39;Object data with ETag:&#39;</span><span>,</span> <span>response2</span><span>.</span><span>body</span><span>,</span> <span>&#39;ETag:&#39;</span><span>,</span> <span>etag2</span><span>)</span><span>;</span>
<span>}</span> <span>else</span> <span>{</span>
  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#39;Object not found or ETag does match.&#39;</span><span>)</span><span>;</span>
<span>}</span>

<span>// list objects in the bucket, null if bucket is empty</span>
<span>// Note: listObjects uses listObjectsV2 API and iterate over all pages</span>
<span>// so it will return all objects in the bucket which can take a while</span>
<span>// If you want to limit the number of objects returned, use the maxKeys option</span>
<span>// If you want to list objects in a specific &#34;folder&#34;, use &#34;folder/&#34; as prefix</span>
<span>// Example s3client.listObjects({&#34;/&#34; &#34;myfolder/&#34;})</span>
<span>const</span> <span>list</span>: <span>object</span><span>[</span><span>]</span> <span>|</span> <span>null</span> <span>=</span> <span>await</span> <span>s3client</span><span>.</span><span>listObjects</span><span>(</span><span>)</span><span>;</span>
<span>if</span> <span>(</span><span>list</span><span>)</span> <span>{</span>
  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#39;List of objects:&#39;</span><span>,</span> <span>list</span><span>)</span><span>;</span>
<span>}</span> <span>else</span> <span>{</span>
  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#39;No objects found in the bucket.&#39;</span><span>)</span><span>;</span>
<span>}</span>

<span>// delete the object</span>
<span>const</span> <span>wasDeleted</span>: <span>boolean</span> <span>=</span> <span>await</span> <span>s3client</span><span>.</span><span>deleteObject</span><span>(</span><span>smallObjectKey</span><span>)</span><span>;</span>

<span>// Multipart upload</span>
<span>const</span> <span>multipartKey</span> <span>=</span> <span>&#39;multipart-object.txt&#39;</span><span>;</span>
<span>const</span> <span>large_buffer</span> <span>=</span> <span>new</span> <span>Uint8Array</span><span>(</span><span>1024</span> <span>*</span> <span>1024</span> <span>*</span> <span>15</span><span>)</span><span>;</span> <span>// 15 MB buffer</span>
<span>const</span> <span>partSize</span> <span>=</span> <span>8</span> <span>*</span> <span>1024</span> <span>*</span> <span>1024</span><span>;</span> <span>// 8 MB</span>
<span>const</span> <span>totalParts</span> <span>=</span> <span>Math</span><span>.</span><span>ceil</span><span>(</span><span>large_buffer</span><span>.</span><span>length</span> <span>/</span> <span>partSize</span><span>)</span><span>;</span>
<span>// Beware! This will return always a new uploadId</span>
<span>// if you want to use the same uploadId, you need to store it somewhere</span>
<span>const</span> <span>uploadId</span> <span>=</span> <span>await</span> <span>s3client</span><span>.</span><span>getMultipartUploadId</span><span>(</span><span>multipartKey</span><span>)</span><span>;</span>
<span>const</span> <span>uploadPromises</span> <span>=</span> <span>[</span><span>]</span><span>;</span>
<span>for</span> <span>(</span><span>let</span> <span>i</span> <span>=</span> <span>0</span><span>;</span> <span>i</span> <span>&lt;</span> <span>totalParts</span><span>;</span> <span>i</span><span>++</span><span>)</span> <span>{</span>
  <span>const</span> <span>partBuffer</span> <span>=</span> <span>large_buffer</span><span>.</span><span>subarray</span><span>(</span><span>i</span> <span>*</span> <span>partSize</span><span>,</span> <span>(</span><span>i</span> <span>+</span> <span>1</span><span>)</span> <span>*</span> <span>partSize</span><span>)</span><span>;</span>
  <span>// upload each part</span>
  <span>// Note: uploadPart returns a promise, so you can use Promise.all to upload all parts in parallel</span>
  <span>// but be careful with the number of parallel uploads, it can cause throttling</span>
  <span>// or errors if you upload too many parts at once</span>
  <span>// You can also use generator functions to upload parts in batches</span>
  <span>uploadPromises</span><span>.</span><span>push</span><span>(</span><span>s3client</span><span>.</span><span>uploadPart</span><span>(</span><span>multipartKey</span><span>,</span> <span>uploadId</span><span>,</span> <span>partBuffer</span><span>,</span> <span>i</span> <span>+</span> <span>1</span><span>)</span><span>)</span><span>;</span>
<span>}</span>
<span>const</span> <span>uploadResponses</span> <span>=</span> <span>await</span> <span>Promise</span><span>.</span><span>all</span><span>(</span><span>uploadPromises</span><span>)</span><span>;</span>
<span>const</span> <span>parts</span> <span>=</span> <span>uploadResponses</span><span>.</span><span>map</span><span>(</span><span>(</span><span>response</span><span>,</span> <span>index</span><span>)</span> <span>=&gt;</span> <span>(</span><span>{</span>
  <span>partNumber</span>: <span>index</span> <span>+</span> <span>1</span><span>,</span>
  <span>etag</span>: <span>response</span><span>.</span><span>etag</span><span>,</span>
<span>}</span><span>)</span><span>)</span><span>;</span>
<span>// Complete the multipart upload</span>
<span>const</span> <span>completeResponse</span> <span>=</span> <span>await</span> <span>s3client</span><span>.</span><span>completeMultipartUpload</span><span>(</span><span>multipartKey</span><span>,</span> <span>uploadId</span><span>,</span> <span>parts</span><span>)</span><span>;</span>
<span>const</span> <span>completeEtag</span> <span>=</span> <span>completeResponse</span><span>.</span><span>etag</span><span>;</span>

<span>// List multipart uploads</span>
<span>// returns object with uploadId and key</span>
<span>const</span> <span>multipartUploads</span>: <span>object</span> <span>=</span> <span>await</span> <span>s3client</span><span>.</span><span>listMultipartUploads</span><span>(</span><span>)</span><span>;</span>
<span>// Abort the multipart upload</span>
<span>const</span> <span>abortResponse</span> <span>=</span> <span>await</span> <span>s3client</span><span>.</span><span>abortMultipartUpload</span><span>(</span><span>multipartUploads</span><span>.</span><span>key</span><span>,</span> <span>multipartUploads</span><span>.</span><span>uploadId</span><span>)</span><span>;</span>

<span>// Multipart download</span>
<span>// lets test getObjectRaw with range</span>
<span>const</span> <span>rangeStart</span> <span>=</span> <span>2048</span> <span>*</span> <span>1024</span><span>;</span> <span>// 2 MB</span>
<span>const</span> <span>rangeEnd</span> <span>=</span> <span>8</span> <span>*</span> <span>1024</span> <span>*</span> <span>1024</span> <span>*</span> <span>2</span><span>;</span> <span>// 16 MB</span>
<span>const</span> <span>rangeResponse</span> <span>=</span> <span>await</span> <span>s3client</span><span>.</span><span>getObjectRaw</span><span>(</span><span>multipartKey</span><span>,</span> <span>false</span><span>,</span> <span>rangeStart</span><span>,</span> <span>rangeEnd</span><span>)</span><span>;</span>
<span>const</span> <span>rangeData</span> <span>=</span> <span>await</span> <span>rangeResponse</span><span>.</span><span>arrayBuffer</span><span>(</span><span>)</span><span>;</span></pre></div>
<p dir="auto">For more check <a href="https://github.com/good-lly/s3mini/blob/dev/USAGE.md">USAGE.md</a> file, examples and tests.</p>

<ul dir="auto">
<li>The library masks sensitive information (access keys, session tokens, etc.) when logging.</li>
<li>Always protect your AWS credentials and avoid hard-coding them in your application (!!!). Use environment variables. Use environment variables or a secure vault for storing credentials.</li>
<li>Ensure you have the necessary permissions to access the S3 bucket and perform operations.</li>
<li>Be cautious when using multipart uploads, as they can incur additional costs if not managed properly.</li>
<li>Authors are not responsible for any data loss or security breaches resulting from improper usage of the library.</li>
<li>If you find a security vulnerability, please report it to us directly via email. For more details, please refer to the <a href="https://github.com/good-lly/s3mini/blob/dev/SECURITY.md">SECURITY.md</a> file.</li>
</ul>

<p dir="auto">Contributions are greatly appreciated! If you have an idea for a new feature or have found a bug, we encourage you to get involved:</p>
<ul dir="auto">
<li>
<p dir="auto"><em>Report Issues</em>: If you encounter a problem or have a feature request, please open an issue on GitHub. Include as much detail as possible (environment, error messages, logs, steps to reproduce, etc.) so we can understand and address the issue.</p>
</li>
<li>
<p dir="auto"><em>Pull Requests</em>: We welcome PRs! If you want to implement a new feature or fix a bug, feel free to submit a pull request to the latest <code>dev branch</code>. For major changes, it&#39;s a good idea to discuss your plans in an issue first.</p>
</li>
<li>
<p dir="auto"><em>Lightweight Philosophy</em>: When contributing, keep in mind that s3mini aims to remain lightweight and dependency-free. Please avoid adding heavy dependencies. New features should provide significant value to justify any increase in size.</p>
</li>
<li>
<p dir="auto"><em>Community Conduct</em>: Be respectful and constructive in communications. We want a welcoming environment for all contributors. For more details, please refer to our <a href="https://github.com/good-lly/s3mini/blob/dev/CODE_OF_CONDUCT.md">CODE_OF_CONDUCT.md</a>. No one reads it, but it&#39;s there for a reason.</p>
</li>
</ul>
<p dir="auto">If you figure out a solution to your question or problem on your own, please consider posting the answer or closing the issue with an explanation. It could help the next person who runs into the same thing!</p>

<p dir="auto">This project is licensed under the MIT License - see the <a href="https://github.com/good-lly/s3mini/blob/dev/LICENSE.md">LICENSE.md</a> file for details.</p>

<p dir="auto">Developing and maintaining s3mini (and other open-source projects) requires time and effort. If you find this library useful, please consider sponsoring its development. Your support helps ensure I can continue improving s3mini and other projects. Thank you!</p>
<p dir="auto"><a href="https://github.com/sponsors/good-lly"><img src="https://camo.githubusercontent.com/a12b8f68983edf77bb6d60e2b29a80bcfafd07082c88b0a5decd3c0f3b1dd672/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2546302539462539322542385f4769744875622d53706f6e736f722d6666363962343f6c6f676f3d676974687562266c6f676f436f6c6f723d7768697465" alt="Become a Sponsor" data-canonical-src="https://img.shields.io/badge/%F0%9F%92%B8_GitHub-Sponsor-ff69b4?logo=github&amp;logoColor=white"/></a></p>
</article></div></div>
  </body>
</html>
