<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://kracekumar.com/post/chatgpt-gh-profile-lookup/">Original</a>
    <h1>Chatgpt Generate Ruby Code to Check User Exists in Github</h1>
    
    <div id="readability-page-1" class="page"><article role="main">
        <p>On saturday night, I want to work on a side project. To find a name for the project and I wanted to create an Github organization in the same name. I started trying out the name one after the other, all the names were taken and thought about writing small script in ruby. Then from nowhere I decided to let chatgpt to write the code for me.</p>
<p>In this blog post, I’ll share some of the code generated by chatgpt for the checking whether a profile name exists in the Github with increasing complexity.</p>
<p><a href="https://chat.openai.com/chat">You can signup for chatgpt from openai site.</a></p>

<p><img src="https://kracekumar.com/images/chatgpt/Screenshot_2022-12-04_at_17.59.46.png" alt="Case 1"/></p>
<p><strong>Prompt</strong></p>
<pre tabindex="0"><code>Can you write a ruby program to check a a list of profile names exists in github?
</code></pre><p><strong>Generated Code</strong></p>
<div><pre tabindex="0"><code data-lang="ruby"><span><span><span>require</span> <span>&#39;octokit&#39;</span>
</span></span><span><span>
</span></span><span><span><span># Replace with your access token</span>
</span></span><span><span><span>ACCESS_TOKEN</span> <span>=</span> <span>&#34;ACCESS_TOKEN&#34;</span>
</span></span><span><span>
</span></span><span><span><span># Replace with the list of profile names</span>
</span></span><span><span><span>profiles</span> <span>=</span> <span>[</span><span>&#34;profile1&#34;</span><span>,</span> <span>&#34;profile2&#34;</span><span>,</span> <span>&#34;profile3&#34;</span><span>]</span>
</span></span><span><span>
</span></span><span><span><span>client</span> <span>=</span> <span>Octokit</span><span>::</span><span>Client</span><span>.</span><span>new</span><span>(</span><span>access_token</span><span>:</span> <span>ACCESS_TOKEN</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span>profiles</span><span>.</span><span>each</span> <span>do</span> <span>|</span><span>profile</span><span>|</span>
</span></span><span><span>  <span>user</span> <span>=</span> <span>client</span><span>.</span><span>user</span><span>(</span><span>profile</span><span>)</span>
</span></span><span><span>  <span>if</span> <span>user</span>
</span></span><span><span>    <span>puts</span> <span>&#34;</span><span>#{</span><span>profile</span><span>}</span><span> exists on GitHub&#34;</span>
</span></span><span><span>  <span>else</span>
</span></span><span><span>    <span>puts</span> <span>&#34;</span><span>#{</span><span>profile</span><span>}</span><span> does not exist on GitHub&#34;</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span><span>end</span>
</span></span></code></pre></div><p>The code looks legit and may run, but there are two issues</p>
<ul>
<li>There is no instruction to install <code>octokit</code>.</li>
<li>Not reading the secret from the environment variable is a bad sign.</li>
</ul>
<p>Let’s enhance the instruction by explicitly stating it.</p>
<p><strong>Prompt</strong></p>
<pre tabindex="0"><code>Can you write a ruby program to check a a list of profile names exists in github? 
If you use external gem, specify the installation instruction. Also read secrets from environment variable.
</code></pre><p><strong>Generated code</strong></p>
<div><pre tabindex="0"><code data-lang="ruby"><span><span><span>require</span> <span>&#39;octokit&#39;</span>
</span></span><span><span>
</span></span><span><span><span># Replace with the list of profile names</span>
</span></span><span><span><span>profiles</span> <span>=</span> <span>[</span><span>&#34;profile1&#34;</span><span>,</span> <span>&#34;profile2&#34;</span><span>,</span> <span>&#34;profile3&#34;</span><span>]</span>
</span></span><span><span>
</span></span><span><span><span># Read access token from environment variable</span>
</span></span><span><span><span>access_token</span> <span>=</span> <span>ENV</span><span>[</span><span>&#34;ACCESS_TOKEN&#34;</span><span>]</span>
</span></span><span><span>
</span></span><span><span><span>client</span> <span>=</span> <span>Octokit</span><span>::</span><span>Client</span><span>.</span><span>new</span><span>(</span><span>access_token</span><span>:</span> <span>access_token</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span>profiles</span><span>.</span><span>each</span> <span>do</span> <span>|</span><span>profile</span><span>|</span>
</span></span><span><span>  <span>user</span> <span>=</span> <span>client</span><span>.</span><span>user</span><span>(</span><span>profile</span><span>)</span>
</span></span><span><span>  <span>if</span> <span>user</span>
</span></span><span><span>    <span>puts</span> <span>&#34;</span><span>#{</span><span>profile</span><span>}</span><span> exists on GitHub&#34;</span>
</span></span><span><span>  <span>else</span>
</span></span><span><span>    <span>puts</span> <span>&#34;</span><span>#{</span><span>profile</span><span>}</span><span> does not exist on GitHub&#34;</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span><span>end</span>
</span></span></code></pre></div><p>Along with the code, there is an installation line, <code>To install the octokit gem, run gem install octokit in your terminal.</code></p>
<p><strong>Output</strong></p>
<pre tabindex="0"><code>$ ruby case_1.rb
To use retry middleware with Faraday v2.0+, install `faraday-retry` gem
profile1 exists on GitHub
profile2 exists on GitHub
profile3 exists on GitHub
</code></pre><p>The code actually works!</p>
<p>Now let’s slightly modify the requirements to read list of profile names from a file.</p>

<p><strong>Prompt</strong></p>
<pre tabindex="0"><code>Can you write a ruby program to read a list of github profile from a text file, 
check each profile exists in github and write the result to a JSON file? 
If you use external gem, specify the installation instruction. Also read secrets from environment variable.
</code></pre><p><strong>Generated code</strong></p>
<div><pre tabindex="0"><code data-lang="ruby"><span><span><span>require</span> <span>&#39;octokit&#39;</span>
</span></span><span><span><span>require</span> <span>&#39;json&#39;</span>
</span></span><span><span>
</span></span><span><span><span># Read profile names from text file</span>
</span></span><span><span><span>profiles</span> <span>=</span> <span>File</span><span>.</span><span>readlines</span><span>(</span><span>&#34;profiles.txt&#34;</span><span>)</span><span>.</span><span>map</span><span>(</span><span>&amp;</span><span>:chomp</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span># Read access token from environment variable</span>
</span></span><span><span><span>access_token</span> <span>=</span> <span>ENV</span><span>[</span><span>&#34;ACCESS_TOKEN&#34;</span><span>]</span>
</span></span><span><span>
</span></span><span><span><span>client</span> <span>=</span> <span>Octokit</span><span>::</span><span>Client</span><span>.</span><span>new</span><span>(</span><span>access_token</span><span>:</span> <span>access_token</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span># Create a new hash to store the result</span>
</span></span><span><span><span>result</span> <span>=</span> <span>{}</span>
</span></span><span><span>
</span></span><span><span><span>profiles</span><span>.</span><span>each</span> <span>do</span> <span>|</span><span>profile</span><span>|</span>
</span></span><span><span>  <span>user</span> <span>=</span> <span>client</span><span>.</span><span>user</span><span>(</span><span>profile</span><span>)</span>
</span></span><span><span>  <span>if</span> <span>user</span>
</span></span><span><span>    <span>result</span><span>[</span><span>profile</span><span>]</span> <span>=</span> <span>true</span>
</span></span><span><span>  <span>else</span>
</span></span><span><span>    <span>result</span><span>[</span><span>profile</span><span>]</span> <span>=</span> <span>false</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span><span>end</span>
</span></span><span><span>
</span></span><span><span><span># Write the result to a JSON file</span>
</span></span><span><span><span>File</span><span>.</span><span>open</span><span>(</span><span>&#34;result.json&#34;</span><span>,</span><span>&#34;w&#34;</span><span>)</span> <span>do</span> <span>|</span><span>f</span><span>|</span>
</span></span><span><span>  <span>f</span><span>.</span><span>write</span><span>(</span><span>result</span><span>.</span><span>to_json</span><span>)</span>
</span></span><span><span><span>end</span>
</span></span></code></pre></div><p><strong>Output</strong></p>
<pre tabindex="0"><code>$cat profiles.txt
kracekumar
zzzzzz
404
$ruby case_2.rb
To use retry middleware with Faraday v2.0+, install `faraday-retry` gem
Traceback (most recent call last):
        15: from case_2.rb:15:in `&lt;main&gt;&#39;
        14: from case_2.rb:15:in `each&#39;
        13: from case_2.rb:16:in `block in &lt;main&gt;&#39;
        12: from /Users/krace/.rbenv/versions/2.7.2/lib/ruby/gems/2.7.0/gems/octokit-6.0.1/lib/octokit/client/users.rb:34:in `user&#39;
        11: from /Users/krace/.rbenv/versions/2.7.2/lib/ruby/gems/2.7.0/gems/octokit-6.0.1/lib/octokit/connection.rb:19:in `get&#39;
        10: from /Users/krace/.rbenv/versions/2.7.2/lib/ruby/gems/2.7.0/gems/octokit-6.0.1/lib/octokit/connection.rb:156:in `request&#39;
         9: from /Users/krace/.rbenv/versions/2.7.2/lib/ruby/gems/2.7.0/gems/sawyer-0.9.2/lib/sawyer/agent.rb:99:in `call&#39;
         8: from /Users/krace/.rbenv/versions/2.7.2/lib/ruby/gems/2.7.0/gems/faraday-2.7.1/lib/faraday/connection.rb:200:in `get&#39;
         7: from /Users/krace/.rbenv/versions/2.7.2/lib/ruby/gems/2.7.0/gems/faraday-2.7.1/lib/faraday/connection.rb:445:in `run_request&#39;
         6: from /Users/krace/.rbenv/versions/2.7.2/lib/ruby/gems/2.7.0/gems/faraday-2.7.1/lib/faraday/rack_builder.rb:153:in `build_response&#39;
         5: from /Users/krace/.rbenv/versions/2.7.2/lib/ruby/gems/2.7.0/gems/octokit-6.0.1/lib/octokit/middleware/follow_redirects.rb:61:in `call&#39;
         4: from /Users/krace/.rbenv/versions/2.7.2/lib/ruby/gems/2.7.0/gems/octokit-6.0.1/lib/octokit/middleware/follow_redirects.rb:73:in `perform_with_redirection&#39;
         3: from /Users/krace/.rbenv/versions/2.7.2/lib/ruby/gems/2.7.0/gems/faraday-2.7.1/lib/faraday/middleware.rb:17:in `call&#39;
         2: from /Users/krace/.rbenv/versions/2.7.2/lib/ruby/gems/2.7.0/gems/faraday-2.7.1/lib/faraday/response.rb:42:in `on_complete&#39;
         1: from /Users/krace/.rbenv/versions/2.7.2/lib/ruby/gems/2.7.0/gems/faraday-2.7.1/lib/faraday/middleware.rb:18:in `block in call&#39;
/Users/krace/.rbenv/versions/2.7.2/lib/ruby/gems/2.7.0/gems/octokit-6.0.1/lib/octokit/response/raise_error.rb:14:in `on_complete&#39;: GET https://api.github.com/users/404: 404 - Not Found // See: https://docs.github.com/rest/reference/users#get-a-user (Octokit::NotFound)
</code></pre><p>Ah ha. the <code>profile</code> 404 returns <code>404</code> and the program fails, now enhance the prompt to modify it.</p>
<p><strong>Prompt</strong></p>
<pre tabindex="0"><code>Can you write a ruby program to read a list of github profile from a text file, 
check each profile exists in github and write the result to a JSON file? The code should handle exceptions. 

If you use external gem, specify the installation instruction. Also read secrets from environment variable.
</code></pre><p><strong>Generated code</strong></p>
<div><pre tabindex="0"><code data-lang="ruby"><span><span><span>require</span> <span>&#39;octokit&#39;</span>
</span></span><span><span><span>require</span> <span>&#39;json&#39;</span>
</span></span><span><span>
</span></span><span><span><span># Read profile names from text file</span>
</span></span><span><span><span>profiles</span> <span>=</span> <span>File</span><span>.</span><span>readlines</span><span>(</span><span>&#34;profiles.txt&#34;</span><span>)</span><span>.</span><span>map</span><span>(</span><span>&amp;</span><span>:chomp</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span># Read access token from environment variable</span>
</span></span><span><span><span>access_token</span> <span>=</span> <span>ENV</span><span>[</span><span>&#34;ACCESS_TOKEN&#34;</span><span>]</span>
</span></span><span><span>
</span></span><span><span><span>client</span> <span>=</span> <span>Octokit</span><span>::</span><span>Client</span><span>.</span><span>new</span><span>(</span><span>access_token</span><span>:</span> <span>access_token</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span># Create a new hash to store the result</span>
</span></span><span><span><span>result</span> <span>=</span> <span>{}</span>
</span></span><span><span>
</span></span><span><span><span>profiles</span><span>.</span><span>each</span> <span>do</span> <span>|</span><span>profile</span><span>|</span>
</span></span><span><span>  <span>begin</span>
</span></span><span><span>    <span>user</span> <span>=</span> <span>client</span><span>.</span><span>user</span><span>(</span><span>profile</span><span>)</span>
</span></span><span><span>    <span>if</span> <span>user</span>
</span></span><span><span>      <span>result</span><span>[</span><span>profile</span><span>]</span> <span>=</span> <span>true</span>
</span></span><span><span>    <span>else</span>
</span></span><span><span>      <span>result</span><span>[</span><span>profile</span><span>]</span> <span>=</span> <span>false</span>
</span></span><span><span>    <span>end</span>
</span></span><span><span>  <span>rescue</span> <span>Octokit</span><span>::</span><span>NotFound</span>
</span></span><span><span>    <span>result</span><span>[</span><span>profile</span><span>]</span> <span>=</span> <span>false</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span><span>end</span>
</span></span><span><span>
</span></span><span><span><span># Write the result to a JSON file</span>
</span></span><span><span><span>File</span><span>.</span><span>open</span><span>(</span><span>&#34;result.json&#34;</span><span>,</span><span>&#34;w&#34;</span><span>)</span> <span>do</span> <span>|</span><span>f</span><span>|</span>
</span></span><span><span>  <span>f</span><span>.</span><span>write</span><span>(</span><span>result</span><span>.</span><span>to_json</span><span>)</span>
</span></span><span><span><span>end</span>
</span></span></code></pre></div><ul>
<li>Now the model generates the code with exception handling but only handles 404 without explicitly mentioning the specific exception in the prompt. Neat!</li>
</ul>
<p><strong>Output</strong></p>
<pre tabindex="0"><code>$ruby case_2.rb
To use retry middleware with Faraday v2.0+, install `faraday-retry` gem
$cat result.json 
{&#34;kracekumar&#34;:true,&#34;zzzzzz&#34;:true,&#34;404&#34;:false}
</code></pre>
<p><strong>Prompt</strong></p>
<pre tabindex="0"><code>Can you write a ruby program to read a list of github profile from a text file in the location /usr/share/dict/words, 
check each profile exists in github, check for rate limit and write the result to a JSON file? 
Print result of each user check in the terminal. The code should handle exceptions. 

If you use external gem, specify the installation instruction. Also read secrets from environment variable.
</code></pre><p><strong>Generated Code</strong></p>
<div><pre tabindex="0"><code data-lang="ruby"><span><span><span>require</span> <span>&#39;octokit&#39;</span>
</span></span><span><span><span>require</span> <span>&#39;json&#39;</span>
</span></span><span><span>
</span></span><span><span><span># Read profile names from text file</span>
</span></span><span><span><span>profiles</span> <span>=</span> <span>File</span><span>.</span><span>readlines</span><span>(</span><span>&#34;/usr/share/dict/words&#34;</span><span>)</span><span>.</span><span>map</span><span>(</span><span>&amp;</span><span>:chomp</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span># Read access token from environment variable</span>
</span></span><span><span><span>access_token</span> <span>=</span> <span>ENV</span><span>[</span><span>&#34;ACCESS_TOKEN&#34;</span><span>]</span>
</span></span><span><span>
</span></span><span><span><span>client</span> <span>=</span> <span>Octokit</span><span>::</span><span>Client</span><span>.</span><span>new</span><span>(</span><span>access_token</span><span>:</span> <span>access_token</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span># Create a new hash to store the result</span>
</span></span><span><span><span>result</span> <span>=</span> <span>{}</span>
</span></span><span><span>
</span></span><span><span><span>profiles</span><span>.</span><span>each</span> <span>do</span> <span>|</span><span>profile</span><span>|</span>
</span></span><span><span>  <span># Check for rate limit</span>
</span></span><span><span>  <span>rate_limit</span> <span>=</span> <span>client</span><span>.</span><span>rate_limit</span>
</span></span><span><span>  <span>if</span> <span>rate_limit</span><span>.</span><span>remaining</span> <span>==</span> <span>0</span>
</span></span><span><span>    <span>puts</span> <span>&#34;Rate limit exceeded. Waiting for reset at </span><span>#{</span><span>rate_limit</span><span>.</span><span>reset_at</span><span>}</span><span>...&#34;</span>
</span></span><span><span>    <span>sleep</span> <span>rate_limit</span><span>.</span><span>resets_in</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span>
</span></span><span><span>  <span>begin</span>
</span></span><span><span>    <span>user</span> <span>=</span> <span>client</span><span>.</span><span>user</span><span>(</span><span>profile</span><span>)</span>
</span></span><span><span>    <span>if</span> <span>user</span>
</span></span><span><span>      <span>result</span><span>[</span><span>profile</span><span>]</span> <span>=</span> <span>true</span>
</span></span><span><span>      <span>puts</span> <span>&#34;</span><span>#{</span><span>profile</span><span>}</span><span> exists on GitHub&#34;</span>
</span></span><span><span>    <span>else</span>
</span></span><span><span>      <span>result</span><span>[</span><span>profile</span><span>]</span> <span>=</span> <span>false</span>
</span></span><span><span>      <span>puts</span> <span>&#34;</span><span>#{</span><span>profile</span><span>}</span><span> does not exist on GitHub&#34;</span>
</span></span><span><span>    <span>end</span>
</span></span><span><span>  <span>rescue</span> <span>Octokit</span><span>::</span><span>NotFound</span>
</span></span><span><span>    <span>result</span><span>[</span><span>profile</span><span>]</span> <span>=</span> <span>false</span>
</span></span><span><span>    <span>puts</span> <span>&#34;</span><span>#{</span><span>profile</span><span>}</span><span> does not exist on GitHub&#34;</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span><span>end</span>
</span></span><span><span>
</span></span><span><span><span># Write the result to a JSON file</span>
</span></span><span><span><span>File</span><span>.</span><span>open</span><span>(</span><span>&#34;result.json&#34;</span><span>,</span><span>&#34;w&#34;</span><span>)</span> <span>do</span> <span>|</span><span>f</span><span>|</span>
</span></span><span><span>  <span>f</span><span>.</span><span>write</span><span>(</span><span>result</span><span>.</span><span>to_json</span><span>)</span>
</span></span><span><span><span>end</span>
</span></span></code></pre></div><p><strong>Output</strong></p>
<pre tabindex="0"><code>$ruby case_3.rb 
To use retry middleware with Faraday v2.0+, install `faraday-retry` gem
A exists on GitHub
a exists on GitHub
aa exists on GitHub
aal exists on GitHub
...
abarthrosis does not exist on GitHub
Traceback (most recent call last):
        2: from case_3.rb:15:in `&lt;main&gt;&#39;
        1: from case_3.rb:15:in `each&#39;
case_3.rb:19:in `block in &lt;main&gt;&#39;: undefined method `reset_at&#39; for #&lt;Octokit::RateLimit:0x0000000107ba8760&gt; (NoMethodError)
Did you mean?  resets_at
               resets_at=
</code></pre><p>Oops, the code breaks at line number 19  - <code>rate_limit.reset_at</code>.</p>
<p>Let’s give feedback to the chatgpt, saying the code fails at line 19.</p>
<p><strong>Prompt</strong></p>
<pre tabindex="0"><code>the above code failed with the following error, undefined method `reset_at&#39; for #&lt;Octokit::RateLimit:0x000000010498f210&gt; (NoMethodError)
Did you mean?  resets_at
               resets_at=

Can you fix it?
</code></pre><p><strong>Generated code</strong></p>
<div><pre tabindex="0"><code data-lang="ruby"><span><span><span>require</span> <span>&#39;octokit&#39;</span>
</span></span><span><span><span>require</span> <span>&#39;json&#39;</span>
</span></span><span><span>
</span></span><span><span><span># Read profile names from text file</span>
</span></span><span><span><span>profiles</span> <span>=</span> <span>File</span><span>.</span><span>readlines</span><span>(</span><span>&#34;/usr/share/dict/words&#34;</span><span>)</span><span>.</span><span>map</span><span>(</span><span>&amp;</span><span>:chomp</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span># Read access token from environment variable</span>
</span></span><span><span><span>access_token</span> <span>=</span> <span>ENV</span><span>[</span><span>&#34;ACCESS_TOKEN&#34;</span><span>]</span>
</span></span><span><span>
</span></span><span><span><span>client</span> <span>=</span> <span>Octokit</span><span>::</span><span>Client</span><span>.</span><span>new</span><span>(</span><span>access_token</span><span>:</span> <span>access_token</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span># Create a new hash to store the result</span>
</span></span><span><span><span>result</span> <span>=</span> <span>{}</span>
</span></span><span><span>
</span></span><span><span><span>profiles</span><span>.</span><span>each</span> <span>do</span> <span>|</span><span>profile</span><span>|</span>
</span></span><span><span>  <span># Check for rate limit</span>
</span></span><span><span>  <span>rate_limit</span> <span>=</span> <span>client</span><span>.</span><span>rate_limit</span>
</span></span><span><span>  <span>if</span> <span>rate_limit</span><span>.</span><span>remaining</span> <span>==</span> <span>0</span>
</span></span><span><span>    <span>puts</span> <span>&#34;Rate limit exceeded. Waiting for reset at </span><span>#{</span><span>rate_limit</span><span>.</span><span>resets_at</span><span>}</span><span>...&#34;</span>
</span></span><span><span>    <span>sleep</span> <span>rate_limit</span><span>.</span><span>resets_in</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span>
</span></span><span><span>  <span>begin</span>
</span></span><span><span>    <span>user</span> <span>=</span> <span>client</span><span>.</span><span>user</span><span>(</span><span>profile</span><span>)</span>
</span></span><span><span>    <span>if</span> <span>user</span>
</span></span><span><span>      <span>result</span><span>[</span><span>profile</span><span>]</span> <span>=</span> <span>true</span>
</span></span><span><span>      <span>puts</span> <span>&#34;</span><span>#{</span><span>profile</span><span>}</span><span> exists on GitHub&#34;</span>
</span></span><span><span>    <span>else</span>
</span></span><span><span>      <span>result</span><span>[</span><span>profile</span><span>]</span> <span>=</span> <span>false</span>
</span></span><span><span>      <span>puts</span> <span>&#34;</span><span>#{</span><span>profile</span><span>}</span><span> does not exist on GitHub&#34;</span>
</span></span><span><span>    <span>end</span>
</span></span><span><span>  <span>rescue</span> <span>Octokit</span><span>::</span><span>NotFound</span>
</span></span><span><span>    <span>result</span><span>[</span><span>profile</span><span>]</span> <span>=</span> <span>false</span>
</span></span><span><span>    <span>puts</span> <span>&#34;</span><span>#{</span><span>profile</span><span>}</span><span> does not exist on GitHub&#34;</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span><span>end</span>
</span></span><span><span>
</span></span><span><span><span># Write the result to a JSON file</span>
</span></span><span><span><span>File</span><span>.</span><span>open</span><span>(</span><span>&#34;result.json&#34;</span><span>,</span><span>&#34;w&#34;</span><span>)</span> <span>do</span> <span>|</span><span>f</span><span>|</span>
</span></span><span><span>  <span>f</span><span>.</span><span>write</span><span>(</span><span>result</span><span>.</span><span>to_json</span><span>)</span>
</span></span><span><span><span>end</span>
</span></span></code></pre></div><p>The model generated above code with a message,
<code>The error occurred because the Octokit::RateLimit object does not have a method named reset_at. The correct method is resets_at.</code> Great!</p>
<p><strong>Output</strong></p>
<pre tabindex="0"><code>$ruby case_3.rb 
To use retry middleware with Faraday v2.0+, install `faraday-retry` gem
Rate limit exceeded. Waiting for reset at 2022-12-04 19:46:29 +0000...
</code></pre><p>Now the bug is fixed and worked as expected! I don’t say issues. OF course! there can be all sort of exceptions that need to be handled - socket timeout, slow response time, 500s etc… Saving the results to a file after checking all profiles is problematic.</p>

<p><strong>Prompt</strong></p>
<pre tabindex="0"><code>Thanks, that fixed exception. Can you refactor the code into functions?
</code></pre><p><strong>Generated Code</strong></p>
<div><pre tabindex="0"><code data-lang="ruby"><span><span><span>require</span> <span>&#39;octokit&#39;</span>
</span></span><span><span><span>require</span> <span>&#39;json&#39;</span>
</span></span><span><span>
</span></span><span><span><span># Read profile names from text file</span>
</span></span><span><span><span>def</span> <span>read_profiles</span>
</span></span><span><span>  <span>File</span><span>.</span><span>readlines</span><span>(</span><span>&#34;/usr/share/dict/words&#34;</span><span>)</span><span>.</span><span>map</span><span>(</span><span>&amp;</span><span>:chomp</span><span>)</span>
</span></span><span><span><span>end</span>
</span></span><span><span>
</span></span><span><span><span># Check if user exists on GitHub</span>
</span></span><span><span><span>def</span> <span>check_user</span><span>(</span><span>user</span><span>)</span>
</span></span><span><span>  <span>begin</span>
</span></span><span><span>    <span>client</span><span>.</span><span>user</span><span>(</span><span>user</span><span>)</span>
</span></span><span><span>    <span>true</span>
</span></span><span><span>  <span>rescue</span> <span>Octokit</span><span>::</span><span>NotFound</span>
</span></span><span><span>    <span>false</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span><span>end</span>
</span></span><span><span>
</span></span><span><span><span># Check for rate limit and wait if necessary</span>
</span></span><span><span><span>def</span> <span>check_rate_limit</span>
</span></span><span><span>  <span>rate_limit</span> <span>=</span> <span>client</span><span>.</span><span>rate_limit</span>
</span></span><span><span>  <span>if</span> <span>rate_limit</span><span>.</span><span>remaining</span> <span>==</span> <span>0</span>
</span></span><span><span>    <span>puts</span> <span>&#34;Rate limit exceeded. Waiting for reset at </span><span>#{</span><span>rate_limit</span><span>.</span><span>resets_at</span><span>}</span><span>...&#34;</span>
</span></span><span><span>    <span>sleep</span> <span>rate_limit</span><span>.</span><span>resets_in</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span><span>end</span>
</span></span><span><span>
</span></span><span><span><span># Read access token from environment variable</span>
</span></span><span><span><span>access_token</span> <span>=</span> <span>ENV</span><span>[</span><span>&#34;ACCESS_TOKEN&#34;</span><span>]</span>
</span></span><span><span>
</span></span><span><span><span>client</span> <span>=</span> <span>Octokit</span><span>::</span><span>Client</span><span>.</span><span>new</span><span>(</span><span>access_token</span><span>:</span> <span>access_token</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span># Create a new hash to store the result</span>
</span></span><span><span><span>result</span> <span>=</span> <span>{}</span>
</span></span><span><span>
</span></span><span><span><span>profiles</span> <span>=</span> <span>read_profiles</span>
</span></span><span><span>
</span></span><span><span><span>profiles</span><span>.</span><span>each</span> <span>do</span> <span>|</span><span>profile</span><span>|</span>
</span></span><span><span>  <span>check_rate_limit</span>
</span></span><span><span>
</span></span><span><span>  <span>result</span><span>[</span><span>profile</span><span>]</span> <span>=</span> <span>check_user</span><span>(</span><span>profile</span><span>)</span>
</span></span><span><span>  <span>puts</span> <span>&#34;</span><span>#{</span><span>profile</span><span>}</span><span> exists on GitHub&#34;</span> <span>if</span> <span>result</span><span>[</span><span>profile</span><span>]</span>
</span></span><span><span>  <span>puts</span> <span>&#34;</span><span>#{</span><span>profile</span><span>}</span><span> does not exist on GitHub&#34;</span> <span>unless</span> <span>result</span><span>[</span><span>profile</span><span>]</span>
</span></span><span><span><span>end</span>
</span></span><span><span>
</span></span><span><span><span># Write the result to a JSON file</span>
</span></span><span><span><span>File</span><span>.</span><span>open</span><span>(</span><span>&#34;result.json&#34;</span><span>,</span><span>&#34;w&#34;</span><span>)</span> <span>do</span> <span>|</span><span>f</span><span>|</span>
</span></span><span><span>  <span>f</span><span>.</span><span>write</span><span>(</span><span>result</span><span>.</span><span>to_json</span><span>)</span>
</span></span><span><span><span>end</span>
</span></span></code></pre></div><p>The generated code is synatically invalid, since <code>client</code> variable is undefined in 21</p>
<p><strong>Prompt</strong></p>
<pre tabindex="0"><code>I get the error when I run the above code, Traceback (most recent call last):
        3: from case_3.rb:38:in `&lt;main&gt;&#39;
        2: from case_3.rb:38:in `each&#39;
        1: from case_3.rb:39:in `block in &lt;main&gt;&#39;
case_3.rb:21:in `check_rate_limit&#39;: undefined local variable or method `client&#39; for main:Object (NameError)
</code></pre><p><strong>Generated Code</strong></p>
<div><pre tabindex="0"><code data-lang="ruby"><span><span><span>require</span> <span>&#39;octokit&#39;</span>
</span></span><span><span><span>require</span> <span>&#39;json&#39;</span>
</span></span><span><span>
</span></span><span><span><span># Read profile names from text file</span>
</span></span><span><span><span>def</span> <span>read_profiles</span>
</span></span><span><span>  <span>File</span><span>.</span><span>readlines</span><span>(</span><span>&#34;/usr/share/dict/words&#34;</span><span>)</span><span>.</span><span>map</span><span>(</span><span>&amp;</span><span>:chomp</span><span>)</span>
</span></span><span><span><span>end</span>
</span></span><span><span>
</span></span><span><span><span># Check if user exists on GitHub</span>
</span></span><span><span><span>def</span> <span>check_user</span><span>(</span><span>client</span><span>,</span> <span>user</span><span>)</span>
</span></span><span><span>  <span>begin</span>
</span></span><span><span>    <span>client</span><span>.</span><span>user</span><span>(</span><span>user</span><span>)</span>
</span></span><span><span>    <span>true</span>
</span></span><span><span>  <span>rescue</span> <span>Octokit</span><span>::</span><span>NotFound</span>
</span></span><span><span>    <span>false</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span><span>end</span>
</span></span><span><span>
</span></span><span><span><span># Check for rate limit and wait if necessary</span>
</span></span><span><span><span>def</span> <span>check_rate_limit</span><span>(</span><span>client</span><span>)</span>
</span></span><span><span>  <span>rate_limit</span> <span>=</span> <span>client</span><span>.</span><span>rate_limit</span>
</span></span><span><span>  <span>if</span> <span>rate_limit</span><span>.</span><span>remaining</span> <span>==</span> <span>0</span>
</span></span><span><span>    <span>puts</span> <span>&#34;Rate limit exceeded. Waiting for reset at </span><span>#{</span><span>rate_limit</span><span>.</span><span>resets_at</span><span>}</span><span>...&#34;</span>
</span></span><span><span>    <span>sleep</span> <span>rate_limit</span><span>.</span><span>resets_in</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span><span>end</span>
</span></span><span><span>
</span></span><span><span><span># Read access token from environment variable</span>
</span></span><span><span><span>access_token</span> <span>=</span> <span>ENV</span><span>[</span><span>&#34;ACCESS_TOKEN&#34;</span><span>]</span>
</span></span><span><span>
</span></span><span><span><span>client</span> <span>=</span> <span>Octokit</span><span>::</span><span>Client</span><span>.</span><span>new</span><span>(</span><span>access_token</span><span>:</span> <span>access_token</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span># Create a new hash to store the result</span>
</span></span><span><span><span>result</span> <span>=</span> <span>{}</span>
</span></span><span><span>
</span></span><span><span><span>profiles</span> <span>=</span> <span>read_profiles</span>
</span></span><span><span>
</span></span><span><span><span>profiles</span><span>.</span><span>each</span> <span>do</span> <span>|</span><span>profile</span><span>|</span>
</span></span><span><span>  <span>check_rate_limit</span><span>(</span><span>client</span><span>)</span>
</span></span><span><span>
</span></span><span><span>  <span>result</span><span>[</span><span>profile</span><span>]</span> <span>=</span> <span>check_user</span><span>(</span><span>client</span><span>,</span> <span>profile</span><span>)</span>
</span></span><span><span>  <span>puts</span> <span>&#34;</span><span>#{</span><span>profile</span><span>}</span><span> exists on GitHub&#34;</span> <span>if</span> <span>result</span><span>[</span><span>profile</span><span>]</span>
</span></span><span><span>  <span>puts</span> <span>&#34;</span><span>#{</span><span>profile</span><span>}</span><span> does not exist on GitHub&#34;</span> <span>unless</span> <span>result</span><span>[</span><span>profile</span><span>]</span>
</span></span><span><span><span>end</span>
</span></span><span><span>
</span></span><span><span><span># Write the result to a JSON file</span>
</span></span><span><span><span>File</span><span>.</span><span>open</span><span>(</span><span>&#34;result.json&#34;</span><span>,</span><span>&#34;w&#34;</span><span>)</span> <span>do</span> <span>|</span><span>f</span><span>|</span>
</span></span><span><span>  <span>f</span><span>.</span><span>write</span><span>(</span><span>result</span><span>.</span><span>to_json</span><span>)</span>
</span></span><span><span><span>end</span>
</span></span></code></pre></div><p>Fix message is better: <code>The error occurred because the check_rate_limit and check_user functions did not have access to the client object. To fix the error, the client object must be passed as an argument to these functions.</code></p>
<p><strong>Output</strong></p>
<pre tabindex="0"><code>$ruby case_3.rb 
To use retry middleware with Faraday v2.0+, install `faraday-retry` gem
Rate limit exceeded. Waiting for reset at 2022-12-04 19:46:29 +0000...
</code></pre>
<p><strong>Prompt</strong></p>
<pre tabindex="0"><code>Can you write the test cases for the above code? 
</code></pre><p><strong>Generated Code</strong></p>
<div><pre tabindex="0"><code data-lang="ruby"><span><span><span>require</span> <span>&#39;minitest/autorun&#39;</span>
</span></span><span><span><span>require</span> <span>&#39;octokit&#39;</span>
</span></span><span><span><span>require</span> <span>&#39;json&#39;</span>
</span></span><span><span>
</span></span><span><span><span>class</span> <span>TestGitHubProfileChecker</span> <span>&lt;</span> <span>Minitest</span><span>::</span><span>Test</span>
</span></span><span><span>  <span>def</span> <span>setup</span>
</span></span><span><span>    <span>@access_token</span> <span>=</span> <span>ENV</span><span>[</span><span>&#34;ACCESS_TOKEN&#34;</span><span>]</span>
</span></span><span><span>    <span>@client</span> <span>=</span> <span>Octokit</span><span>::</span><span>Client</span><span>.</span><span>new</span><span>(</span><span>access_token</span><span>:</span> <span>@access_token</span><span>)</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span>
</span></span><span><span>  <span>def</span> <span>test_read_profiles</span>
</span></span><span><span>    <span>expected_profiles</span> <span>=</span> <span>[</span><span>&#34;test1&#34;</span><span>,</span> <span>&#34;test2&#34;</span><span>]</span>
</span></span><span><span>    <span>File</span><span>.</span><span>stub</span> <span>:readlines</span><span>,</span> <span>expected_profiles</span> <span>do</span>
</span></span><span><span>      <span>assert_equal</span> <span>expected_profiles</span><span>,</span> <span>read_profiles</span>
</span></span><span><span>    <span>end</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span>
</span></span><span><span>  <span>def</span> <span>test_check_user_exists</span>
</span></span><span><span>    <span>user</span> <span>=</span> <span>&#34;octocat&#34;</span>
</span></span><span><span>    <span>assert</span> <span>check_user</span><span>(</span><span>@client</span><span>,</span> <span>user</span><span>)</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span>
</span></span><span><span>  <span>def</span> <span>test_check_user_does_not_exist</span>
</span></span><span><span>    <span>user</span> <span>=</span> <span>&#34;not_a_real_user&#34;</span>
</span></span><span><span>    <span>refute</span> <span>check_user</span><span>(</span><span>@client</span><span>,</span> <span>user</span><span>)</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span>
</span></span><span><span>  <span>def</span> <span>test_check_rate_limit</span>
</span></span><span><span>    <span>rate_limit</span> <span>=</span> <span>@client</span><span>.</span><span>rate_limit</span>
</span></span><span><span>    <span>rate_limit</span><span>.</span><span>stub</span> <span>:remaining</span><span>,</span> <span>0</span> <span>do</span>
</span></span><span><span>      <span>rate_limit</span><span>.</span><span>stub</span> <span>:resets_at</span><span>,</span> <span>Time</span><span>.</span><span>now</span> <span>do</span>
</span></span><span><span>        <span>rate_limit</span><span>.</span><span>stub</span> <span>:resets_in</span><span>,</span> <span>0</span> <span>do</span>
</span></span><span><span>          <span>assert_output</span> <span>&#34;Rate limit exceeded. Waiting for reset at </span><span>#{</span><span>rate_limit</span><span>.</span><span>resets_at</span><span>}</span><span>...</span><span>\n</span><span>&#34;</span> <span>do</span>
</span></span><span><span>            <span>check_rate_limit</span><span>(</span><span>@client</span><span>)</span>
</span></span><span><span>          <span>end</span>
</span></span><span><span>        <span>end</span>
</span></span><span><span>      <span>end</span>
</span></span><span><span>    <span>end</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span><span>end</span>
</span></span></code></pre></div><p>After adding the previously generated code, a test case failed.</p>
<pre tabindex="0"><code>ruby test_case.rb 
To use retry middleware with Faraday v2.0+, install `faraday-retry` gem
Run options: --seed 34383

# Running:

..F.

Finished in 0.782971s, 5.1087 runs/s, 5.1087 assertions/s.

  1) Failure:
TestGitHubProfileChecker#test_check_rate_limit [test_case.rb:83]:
In stdout.
--- expected
+++ actual
@@ -1,2 +1 @@
-&#34;Rate limit exceeded. Waiting for reset at 2022-12-04 20:24:05 +0000...
-&#34;
+&#34;&#34;


4 runs, 4 assertions, 1 failures, 0 errors, 0 skips
</code></pre><p>Looking at the code, rate limit code was stubbed but doesn’t behave as expected. Again updating the prompt, a couple of times,
the model produces same test code and it is unable to fix it. After multiple prompts, the model stop generating complete code.</p>
<p><strong>Final generated code</strong></p>
<div><pre tabindex="0"><code data-lang="ruby"><span><span><span>require</span> <span>&#39;minitest/autorun&#39;</span>
</span></span><span><span><span>require</span> <span>&#39;octokit&#39;</span>
</span></span><span><span><span>require</span> <span>&#39;json&#39;</span>
</span></span><span><span>
</span></span><span><span><span>class</span> <span>TestGitHubProfileChecker</span> <span>&lt;</span> <span>Minitest</span><span>::</span><span>Test</span>
</span></span><span><span>  <span>def</span> <span>setup</span>
</span></span><span><span>    <span>@access_token</span> <span>=</span> <span>ENV</span><span>[</span><span>&#34;ACCESS_TOKEN&#34;</span><span>]</span>
</span></span><span><span>    <span>@client</span> <span>=</span> <span>Octokit</span><span>::</span><span>Client</span><span>.</span><span>new</span><span>(</span><span>access_token</span><span>:</span> <span>@access_token</span><span>)</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span>
</span></span><span><span>  <span>def</span> <span>test_read_profiles</span>
</span></span><span><span>    <span>expected_profiles</span> <span>=</span> <span>[</span><span>&#34;test1&#34;</span><span>,</span> <span>&#34;test2&#34;</span><span>]</span>
</span></span><span><span>    <span>File</span><span>.</span><span>stub</span> <span>:readlines</span><span>,</span> <span>expected_profiles</span> <span>do</span>
</span></span><span><span>      <span>assert_equal</span> <span>expected_profiles</span><span>,</span> <span>read_profiles</span>
</span></span><span><span>    <span>end</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span>
</span></span><span><span>  <span>def</span> <span>test_check_user_exists</span>
</span></span><span><span>    <span>user</span> <span>=</span> <span>&#34;octocat&#34;</span>
</span></span><span><span>    <span>assert</span> <span>check_user</span><span>(</span><span>@client</span><span>,</span> <span>user</span><span>)</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span>
</span></span><span><span>  <span>def</span> <span>test_check_user_does_not_exist</span>
</span></span><span><span>    <span>user</span> <span>=</span> <span>&#34;not_a_real_user&#34;</span>
</span></span><span><span>    <span>refute</span> <span>check_user</span><span>(</span><span>@client</span><span>,</span> <span>user</span><span>)</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span>
</span></span><span><span>  <span>def</span> <span>test_check_rate_limit</span>
</span></span><span><span>    <span>now</span> <span>=</span> <span>Time</span><span>.</span><span>now</span>
</span></span><span><span>    <span>rate_limit</span> <span>=</span> <span>Octokit</span><span>::</span><span>RateLimit</span><span>.</span><span>new</span><span>(</span><span>remaining</span><span>:</span> <span>0</span><span>,</span> <span>resets_at</span><span>:</span> <span>now</span><span>.</span><span>to_i</span><span>,</span> <span>resets_in</span><span>:</span> <span>0</span><span>)</span>
</span></span><span><span>    <span>@client</span><span>.</span><span>stub</span> <span>:rate_limit</span><span>,</span> <span>rate_limit</span> <span>do</span>
</span></span><span><span>      <span>assert_output</span> <span>&#34;Rate limit exceeded. Waiting for reset at </span><span>#{</span><span>now</span><span>}</span><span>...</span><span>\n</span><span>&#34;</span> <span>do</span>
</span></span><span><span>        <span>check_rate_limit</span><span>(</span><span>@client</span><span>)</span>
</span></span></code></pre></div><p><strong>Final conversation</strong></p>
<pre tabindex="0"><code>Me: How many lines of code are you allowed to generate in a given time?
Model: There is no specific limit on the number of lines of code that can be generated in a given time. 
The quality and accuracy of the code is more important than the quantity of code generated.
Me: But your previous code generation was incomplete. can you tell me what happened?
Model: I apologize if my previous code generation was incomplete. There can be a number of reasons why this may have happened. 
For example, the prompt may not have provided enough information to accurately generate the code, or there may have been a technical issue with the code generation system. In any case, I will do my best to provide complete and accurate code in response to future prompts.
</code></pre>
<ul>
<li>Given enough context and iteration the model is able to correct the simple errors.</li>
<li>It take many attempts to get something working, but it’s far away from production quality code(could be pure model safe-guard).</li>
<li>It’s able to remember the previous context and improvise based on feedback.</li>
<li>Once things get slightly complicated the model fails to generate syntactically correct code.</li>
</ul>
<p>It was definitely fun to play around with the model but making the model to produce fool proof code seems very far away.</p>


        
          
        

        

        
          

          
                  
       <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"/></a></article></div>
  </body>
</html>
