<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://techlog.jenslink.net/posts/ipv6-is-hard/">Original</a>
    <h1>IPv6 Is Hard</h1>
    
    <div id="readability-page-1" class="page"><div><div>
        <p>Yesterday I read this <a href="https://chaos.social/@goetz/114001310396231712">toot (German)</a> over on mastodon
which starts with “IPv6 is hard.”</p>
<p><strong>No it’s not. It’s different.</strong></p>
<p>I ran across this multiple times: There is an A and an AAAA-record for a FQDN, but the
web server is only reachable via IPv4. You can easily test this with <a href="https://curl.se/">curl</a></p>
<div><pre tabindex="0"><code data-lang="shell">$ curl -4  https://github.com -o /dev/null
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
<span>100</span>  273k    <span>0</span>  273k    <span>0</span>     <span>0</span>  3417k      <span>0</span> --:--:-- --:--:-- --:--:-- 3553k
$ curl -6  https://github.com -o /dev/null
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  <span>0</span>     <span>0</span>    <span>0</span>     <span>0</span>    <span>0</span>     <span>0</span>      <span>0</span>      <span>0</span> --:--:-- --:--:-- --:--:--     <span>0</span>
curl: <span>(</span>7<span>)</span> Couldn<span>&#39;</span>t connect to server
</code></pre></div><p>When using IPv4 273k are “saved” to /dev/null, using IPv6 we get an error message “Couldn’t connect to server”</p>
<p><strong>Note</strong> that I’m using GitHub here because it is a well known example for not
offering IPv6 as a time of writing, and it probably will have not IPv6 soon.</p>
<p>So in the case of the toot mentioned above there is an AAAA for the FQDN. But the connection doesn’t work. But the end user
doesn’t notice. Because there is a browser feature called <a href="https://datatracker.ietf.org/doc/html/rfc8305">Happy Eyeballs (HE)</a>.
Basically: A browser tries both protocols and uses the
faster on. In case of non-working IPv6 IPv4 is always faster.</p>
<p>HE can have some funny side effects. In a project a connection to a development web server sometimes worked and sometimes
didn’t. The solution was quite simple. The customer used a split VPN tunnel. IPv4 was routed via the VPN tunnel and those
IPv4 addresses were allowed in the web servers access list. IPv6 was routed via the normal Internet connection and those
addresses weren’t allowed.</p>
<p>But back to the original problem: In another toot we learn that a support ticket
was opened four weeks ago and that traceroute
was prohibited. But there is always the option to use the <em>-T</em> option for traceroute or <em>tcptraceroute</em>. This use tcp instead
of UDP (standard traceroute) or ICMP (Windows tracert).</p>
<p>When you run traceroute -T for both IPv4 and IPv6 you’ll see that in this case IPv6 ends one hop earlier than IPv4. Or
in this case the last hop loops back to itself.</p>
<p>This could mean that there is a missing firewall rule allowing traffic to the server or there is a routing issue on the
firewall.</p>
<p>But we can learn much more from this:</p>
<ul>
<li>If browser wouldn’t do happy eyeballs, the support hotline would have been exploded</li>
<li>There is no external monitoring, at least not for IPv6</li>
<li>There is no automation or at least no complete automation</li>
</ul>
<p>So please: If you do IPv6 take it seriously. If you don’t take it seriously,
don’t do IPv6. That leaves to people thinking that
IPv6 is hard and can not be done.</p>
<p>Some notes: I’ll cover traceroute and co. in a future blog post and regarding
GitHub check out this
<a href="https://github.com/orgs/community/discussions/151477">link</a>.</p>

      </div></div></div>
  </body>
</html>
