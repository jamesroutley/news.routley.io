<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lapcatsoftware.com/articles/2025/1/6.html">Original</a>
    <h1>Little Snitch feature nobody knows about</h1>
    
    <div id="readability-page-1" class="page">
<nav>
Previous: <a href="https://lapcatsoftware.com/articles/2025/1/5.html">New secure note on macOS Sequoia</a>
</nav>
<header><a href="https://lapcatsoftware.com">Jeff Johnson</a> (<a href="https://underpassapp.com">My apps</a>, <a href="https://www.paypal.me/JeffJohnsonWI">PayPal.Me</a>, <a href="https://mastodon.social/@lapcatsoftware" title="@lapcatsoftware@mastodon.social">Mastodon</a>)</header>

<h3>January 24 2025</h3>

<p><a href="https://www.obdev.at/products/littlesnitch/">Little Snitch</a> by Objective Development is the first app that I install on a new Mac. In fact I just bought a new Mac, an M4 MacBook Pro with nano-texture display, and I installed Little Snitch via thumb drive even before connecting the Mac to the internet. While setting up my new Mac, which came with macOS 15.2 preinstalled, I noticed that Safari attempted to connect to <code>ssl.gstatic.com</code> on launch. That domain is owned by Google!</p>
<p><img src="https://lapcatsoftware.com/articles/2025/1/6-images/1.png" width="588" height="350" alt="Safari wants to connect to ssl.gstatic.com on TCP port 443 (https)"/></p>
<p>I denied the connection, but it kept happening on every launch, despite the fact that I set Safari to open with a new private window and empty page. Moreover, it happened on every launch of Safari Technology Preview too. In the Little Snitch alert window, I pressed the info button, which revealed that the connection was initiated by Safari Search Helper, a separate process from the main Safari app.</p>
<p><img src="https://lapcatsoftware.com/articles/2025/1/6-images/2.png" width="670" height="662" alt="Established by /System/Volumes/Preboot/Cryptexes/Incoming/OS/System/Library/PrivateFrameworks/SafariShared.framework/Versions/A/XPCServices/com.apple.Safari.SearchHelper.xpc/Contents/MacOS/com.apple.Safari.SearchHelper"/></p>
<p>Like most web browsers nowadays, Safari launches other processes to perform dedicated tasks. To see this in action, just search for &#34;Safari&#34; in Activity Monitor. The advantage of using separate processes is that each process can have separate privileges, and if one process happens to crash, it doesn&#39;t cause the entire app to crash. When an internet connection is initiated by a process launched by an app, Little Snitch attempts to attribute the connection to the main app rather than to the helper process. This attribution usually makes more sense to the Little Snitch user.</p>
<p>I haven&#39;t figured out exactly why Safari Search Helper connects to <code>ssl.gstatic.com</code>, but it&#39;s definitely related to using Google as the search engine in Safari Search Settings. If I change the search engine to DuckDuckGo, for example, the connection attempts no longer occur on launch. Indeed, if I switch the search engine back from DuckDuckGo to Google in Safari Settings popup button, a connection to <code>ssl.gstatic.com</code> occurs <em>immediately</em>. None of the other search engine choices provoke a connection. I decided to permanently deny all connections to <code>ssl.gstatic.com</code> from Safari, because there&#39;s no good reason for Safari to silently contact Google when I&#39;m not even searching.</p>
<p>Unfortunately, my new Little Snitch rule had an undesirable side effect. Although I&#39;m trying to wean myself off, I still use Gmail, and when you set up Gmail in Mail app, it authenticates your Google account in Safari. However, the authentication kept failing for me. Looking in the Safari web inspector console, it became clear that the problem was some denied <code>ssl.gstatic.com</code> connections. Thus, I was forced to disable my Little Snitch rule and allow Safari to connect to <code>ssl.gstatic.com</code> in order to authenticate Gmail for Mail app.</p>
<p>Oddly, the <code>ssl.gstatic.com</code> connections from Safari stopped entirely after I allowed it to connect once. I discovered, comparing Safari preferences before and after, that <code>WBSOfflineSearchSuggestionsModelLastUpdateDateKey</code> had been set.</p>
<blockquote><code>defaults read com.apple.Safari WBSOfflineSearchSuggestionsModelLastUpdateDateKey</code></blockquote>
<p>I also discovered through experimentation, giving <code>WBSOfflineSearchSuggestionsModelLastUpdateDateKey</code> different date values (technically, they&#39;re string values of dates), that Safari checks for updates once a week. Thus, it was clear that Safari would make future <code>ssl.gstatic.com</code> connections, if allowed by Little Snitch. By the way, I should note that I&#39;ve disabled &#34;Include search engine suggestions&#34; in Safari Search Settings, yet Safari is still apparently trying to download suggestions from Google?</p>
<p>What I wanted to do was create a Little Snitch rule that applied to Safari Search Helper but not to websites loaded in Safari tabs. I tried creating a new rule using the explicit path on disk of Safari Search Helper, but that didn&#39;t work. Little Snitch seemed to ignore that rule and continued to attribute Safari Search Helper connections to the Safari app.</p>
<p>I emailed Objective Development to ask whether there&#39;s any way to separate the rules in Little Snitch for the two processes, Safari and Safari Search Helper. At first, they said no, but then on reflection, they said yes!</p>
<p><img src="https://lapcatsoftware.com/articles/2025/1/6-images/3.png" width="578" height="566" alt="Safari via com.apple.Safari.SearchHelper"/></p>
<p>The trick is to use &#34;via&#34; in the Little Snitch rule. When you&#39;re creating the rules, enter the full file paths of the two processes, separated by &#34;via&#34;. Little Snitch will automatically replace the paths with the process names. Make sure you match both of the processes by code signing identity too. The above rule denies <code>ssl.gstatic.com</code> connections initiated by Safari Search Helper while otherwise allowing such connections by Safari.</p>
<p>It&#39;s nice to know that this trick exists, though it&#39;s unlikely that you&#39;ll need to use it much. I thought the trick might help with Google Chrome, but it turns out that most Chrome connections are initiated by the Google Chrome Helper process: not only the web page connections but also the silent connections that run in the background, for example to <code>googleapis.com</code>, <code>accounts.google.com</code>, <code>tools.google.com</code>, <code>clients1.google.com</code>, <code>clients2.google.com</code>, <code>clients3.google.com</code>, etc. Needless to say, Google Chrome phones home a lot! It was disappointing to learn that Safari makes a silent connection to Google too. I guess that the massive yearly default search engine payment from Google to Apple buys a lot of access.</p>

<header><a href="https://lapcatsoftware.com">Jeff Johnson</a> (<a href="https://underpassapp.com">My apps</a>, <a href="https://www.paypal.me/JeffJohnsonWI">PayPal.Me</a>, <a href="https://mastodon.social/@lapcatsoftware" title="@lapcatsoftware@mastodon.social">Mastodon</a>)</header>
<nav><a href="https://lapcatsoftware.com/articles/index.html" title="The Desolation of Blog">Articles index</a></nav>


</div>
  </body>
</html>
