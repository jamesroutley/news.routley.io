<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.noredink.com/post/699829728548372480/svgs-as-elm-code">Original</a>
    <h1>SVGs as Elm Code</h1>
    
    <div id="readability-page-1" class="page"><div>
                            <p>Moving SVGs out of the file system and into regular Elm code can make icons easier to manage, especially if you find you need to make accessibility improvements.</p><p>Imagine we have an arbitrary SVG file straight from our Design team’s tools:</p><pre><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;&lt;svg version=&#34;1.1&#34; id=&#34;Layer_1&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34; xmlns:xlink=&#34;http://www.w3.org/1999/xlink&#34; x=&#34;0px&#34; y=&#34;0px&#34; viewbox=&#34;0 0 21 21&#34; style=&#34;enable-background:new 0 0 21 21;&#34; xml:space=&#34;preserve&#34;&gt;&lt;style type=&#34;text/css&#34;&gt;
        .st0{fill:#FFFFFF;stroke:#146AFF;stroke-width:2;}
&lt;/style&gt;&lt;title&gt;star-outline&lt;/title&gt;&lt;desc&gt;Created with Something Proprietary 123.&lt;/desc&gt;&lt;g id=&#34;Page-1&#34;&gt;&lt;g id=&#34;star-outline&#34;&gt;&lt;path id=&#34;path-1_1_&#34; class=&#34;st0&#34; d=&#34;M11.1,1.4l2.4,4.8c0.1,0.2,0.3,0.4,0.6,0.4l5.2,0.8c0.4,0.1,0.7,0.4,0.6,0.8
                        c0,0.2-0.1,0.3-0.2,0.4l-3.8,3.8c-0.2,0.2-0.2,0.4-0.2,0.6l0.9,5.3c0.1,0.4-0.2,0.8-0.6,0.8c-0.2,0-0.3,0-0.5-0.1l-4.7-2.5
                        c-0.2-0.1-0.5-0.1-0.7,0l-4.7,2.5c-0.4,0.2-0.8,0.1-1-0.3c-0.1-0.1-0.1-0.3-0.1-0.5l0.9-5.3c0-0.2,0-0.5-0.2-0.6L1.2,8.7
                        c-0.3-0.3-0.3-0.8,0-1c0.1-0.1,0.3-0.2,0.4-0.2l5.2-0.8c0.2,0,0.4-0.2,0.6-0.4l2.4-4.8c0.2-0.4,0.6-0.5,1-0.3
                        C10.9,1.1,11,1.3,11.1,1.4z&#34;&gt;&lt;/path&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;
</code></pre><p>Notice that there’s lots of extraneous information in the SVG — including some information that’s distinctly unhelpful! The <code>title</code> of the SVG ends up being used as the accessible name of the SVG — it’s more or less equivalent to an <code>img</code> tag’s <code>alt</code>. A title of “star-outline” will not help our users to understand what this icon is supposed to represent.</p><p>Compare the raw SVG value to what it might look like if rewritten as Elm code and tidied-up by a human developer:</p><pre><code>import Svg exposing (..)
import Svg.Attributes exposing (..)


starOutline : Svg msg
starOutline =
    svg
        [ x &#34;0px&#34;
        , y &#34;0px&#34;
        , viewBox &#34;0 0 21 21&#34;
        ]
        [ Svg.path
                [ fill &#34;#FFF&#34;
                , stroke &#34;#146AFF&#34;
                , strokeWidth &#34;2&#34;
                , d &#34;M11.1,1.4l2.4,4.8c0.1,0.2,0.3,0.4,0.6,0.4l5.2,0.8c0.4,0.1,0.7,0.4,0.6,0.8 c0,0.2-0.1,0.3-0.2,0.4l-3.8,3.8c-0.2,0.2-0.2,0.4-0.2,0.6l0.9,5.3c0.1,0.4-0.2,0.8-0.6,0.8c-0.2,0-0.3,0-0.5-0.1l-4.7-2.5  c-0.2-0.1-0.5-0.1-0.7,0l-4.7,2.5c-0.4,0.2-0.8,0.1-1-0.3c-0.1-0.1-0.1-0.3-0.1-0.5l0.9-5.3c0-0.2,0-0.5-0.2-0.6L1.2,8.7 c-0.3-0.3-0.3-0.8,0-1c0.1-0.1,0.3-0.2,0.4-0.2l5.2-0.8c0.2,0,0.4-0.2,0.6-0.4l2.4-4.8c0.2-0.4,0.6-0.5,1-0.3 C10.9,1.1,11,1.3,11.1,1.4z&#34;
                ]
                []
        ]
</code></pre><p><a href="https://href.li/?https://ellie-app.com/k3Y9DBWSv8ta1">Example 1 Ellie link</a></p><p>Once the SVG is rewritten in Elm, we can leverage the Elm type system to guarantee that icons in our application are always rendered in a consistent way. By exposing the Icon type but <em>not</em> exposing the Icon constructor, we can ensure that there’s only one way to produce HTML from an Icon. This strategy is the opaque type pattern, which you can learn more about in <a href="https://href.li/?https://ckoster22.medium.com/advanced-types-in-elm-opaque-types-ec5ec3b84ed2">former NoRedInk engineer Charlie Koster’s blog post series on advanced types in Elm</a> and in <a href="https://href.li/?https://elm-radio.com/episode/intro-to-opaque-types/">the Elm Radio podcast’s Intro to Opaque Types episode</a>.</p><pre><code>module Icons exposing (Icon, toHtml, starOutline)

type Icon =
  -- `Never` is used here so that our Icon type doesn&#39;t need a type hole. Essentially, the `Never` is saying &#34;this kind of Svg cannot produce messages ever&#34;
  Icon (Svg Never)


toHtml : Icon -&gt; Html msg
toHtml (Icon icon) =
    -- &#34;Html.map never&#34; transforms `Svg msg` into `Svg Never`
    Html.map never icon


starOutline : Icon -- notice the type changed
starOutline =
    svg
        ...
        |&gt; Icon
</code></pre><p>Now that we’ve got consistently-rendered icons, we can start thinking about what an <em>accessible</em> way to render the SVGs might be. <a href="https://href.li/?https://cariefisher.com/a11y-svg-updated/">Carie Fisher’s article Accessible SVGs - Perfect Patterns For Screen Reader Users</a> is <em>the</em> resource to use when considering how to render SVGs in an accessible way. We will be using Pattern 5, <code>&lt;svg&gt;</code> + <code>role=&#34;img&#34;</code> + <code>&lt;title&gt;</code>, to ensure that our meaningful icons have appropriate text alternatives. (You might also want to read through the <a href="https://href.li/?https://www.w3.org/WAI/tutorials/images/">WAI’s Images Tutorial</a> if you haven’t already — it might surprise you!)</p><p>We need to conditionally insert a <code>title</code> element into the list of SVG children — which means we need to change how we’re modeling <code>Icon</code>. We can easily &amp; safely do this, though, because we’ve used an opaque type to minimize API disturbances.</p><pre><code>type Icon
    = Icon
        { attributes : List (Attribute Never)
        , label : Maybe String
        , children : List (Svg Never)
        }


toHtml : Icon -&gt; Html msg
toHtml (Icon icon) =
    case icon.label of
        Just label -&gt;
            svg icon.attributes (Svg.title [] [ text label ] :: icon.children)
                |&gt; Html.map never

        Nothing -&gt;
            svg icon.attributes icon.children
                |&gt; Html.map never


emptyStar : Icon
emptyStar =
    Icon
        { attributes =
            [ x &#34;0px&#34;
            , y &#34;0px&#34;
            , viewBox &#34;0 0 21 21&#34;
            ]
        , label = Nothing
        , children =
            [ Svg.path
                [ fill &#34;#FFF&#34;
                , stroke &#34;#146AFF&#34;
                , strokeWidth &#34;2&#34;
                , d &#34;M11.1,1.4l2.4,4.8c0.1,0.2,0.3,0.4,0.6,0.4l5.2,0.8c0.4,0.1,0.7,0.4,0.6,0.8 c0,0.2-0.1,0.3-0.2,0.4l-3.8,3.8c-0.2,0.2-0.2,0.4-0.2,0.6l0.9,5.3c0.1,0.4-0.2,0.8-0.6,0.8c-0.2,0-0.3,0-0.5-0.1l-4.7-2.5  c-0.2-0.1-0.5-0.1-0.7,0l-4.7,2.5c-0.4,0.2-0.8,0.1-1-0.3c-0.1-0.1-0.1-0.3-0.1-0.5l0.9-5.3c0-0.2,0-0.5-0.2-0.6L1.2,8.7 c-0.3-0.3-0.3-0.8,0-1c0.1-0.1,0.3-0.2,0.4-0.2l5.2-0.8c0.2,0,0.4-0.2,0.6-0.4l2.4-4.8c0.2-0.4,0.6-0.5,1-0.3 C10.9,1.1,11,1.3,11.1,1.4z&#34;
                ]
                []
            ]
        }
</code></pre><p><a href="https://href.li/?https://ellie-app.com/k3Yb3CRHz8Ta1">Example 2 Ellie Link</a></p><p>At this point, the internals of Icon can handle a text alternative being present, but there’s no way from the API to actually set the text alternative . We need to expose a way to set the value of the label of <code>emptyStar</code> and any other icons we later create.</p><p>We could change <code>emptyStar</code> to take a <code>Maybe String</code>, or we could add a <code>withLabel : String → Icon → Icon</code> helper, or we could move the <code>label</code> value off of the <code>Icon</code> type and thread the value through <code>toHtml</code>.</p><p>At NoRedInk, we use the <code>withLabel : String → Icon → Icon</code> pattern, but any of these patterns could work.</p><pre><code>withLabel : String -&gt; Icon -&gt; Icon
withLabel label (Icon icon) =
    Icon { icon | label = Just label }
</code></pre><p>Once we have a way to add the text alternative to the Icon, we’re ready for the “role” portion of the  <code>&lt;svg&gt;</code> + <code>role=&#34;img&#34;</code> + <code>&lt;title&gt;</code> pattern.</p><pre><code>import Accessibility.Role as Role -- this is from tesk9/accessible-html

toHtml : Icon -&gt; Html msg
toHtml (Icon icon) =
    case icon.label of
        Just label -&gt;
            svg (Role.img :: icon.attributes)
                (Svg.title [] [ text label ] :: icon.children)
                |&gt; Html.map never

        Nothing -&gt;
            svg icon.attributes icon.children
                |&gt; Html.map never
</code></pre><p><a href="https://href.li/?https://ellie-app.com/k3Ybkn2S6Nna1">Example 3 Ellie Link</a></p><p>Now, our functional icons should render nicely with a <code>title</code> and with the appropriate role! (Although if we were supporting Internet Explorer, we would also want to add <code>focusable=false</code>)</p><p>We still have the decorative icons to consider, though. We can mark these decorative icons as hidden in the accessibility tree so that assistive technologies know to ignore it with <code>aria-hidden=true</code>:</p><pre><code>toHtml : Icon -&gt; Html msg
toHtml (Icon icon) =
    case icon.label of
        Just label -&gt;
            svg (Role.img :: icon.attributes)
                (Svg.title [] [ text label ] :: icon.children)
                |&gt; Html.map never

        Nothing -&gt;
            svg (Aria.hidden True :: icon.attributes)
                icon.children
                |&gt; Html.map never
</code></pre><p><a href="https://href.li/?https://ellie-app.com/k3YbBhvwT4Ha1">Example 4 Ellie Link</a></p><p>And that’s it!</p><p>Over time, it’s likely that an Elm-based SVG icon library will need to support more and more customization: colors, styles, attributes, animations, hover effects. All of these and more can be added to the Icon opaque type, without breaking current icons.</p><p>There we have it: tidy icon modeling leading to tidy icons.</p><p><img src="https://user-images.githubusercontent.com/8811312/199557776-d58d63dd-07d2-4cfb-9e37-7b2e9dca81b8.png" alt="Photo of the author"/></p>
                        </div></div>
  </body>
</html>
