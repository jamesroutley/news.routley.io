<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.aos.sh/2024/08/16/embedding-scripts-in-nix-flakes/">Original</a>
    <h1>Embedding Scripts in Nix Flakes</h1>
    
    <div id="readability-page-1" class="page"><div>
        
        <p>A somewhat common theme I’ve noticed when working on various projects is the
need for “one-off” re-usable scripts, these are typically more than a few lines
of code.</p>
<p>For example, in my <a href="https://adventofcode.com/">Advent of Code</a> repository I have a small
Python script that pulls the input down given a year and day. But rather
than wanting to manage this script explicitly, I wanted to encapsulate
it as part of my flake so I can call it directly via nix.</p>
<p>It turns out, Nix has the concept of
<a href="https://nixos.wiki/wiki/Nix-writers">writers</a>. These are functions that allow
you to write other languages inline, in nix code.<sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup> One <em>other</em> nice thing about
this: you can add language-specific libraries as dependencies.</p>
<p><a href="https://github.com/aos/advent/blob/12ec07784457c0b21408cb363f0110872ff96281/flake.nix#L10-L23">Here’s my Python script now</a>:</p>
<div><pre tabindex="0"><code data-lang="nix"><span><span>pkgs.writers.writePython3Bin <span>&#34;get_input&#34;</span> {
</span></span><span><span>  libraries = [ pkgs.python3Packages.requests ];
</span></span><span><span>} <span>&#39;&#39;
</span></span></span><span><span><span>  import requests
</span></span></span><span><span><span>  import sys
</span></span></span><span><span><span>
</span></span></span><span><span><span>  year, day = sys.argv[1], sys.argv[2]
</span></span></span><span><span><span>  url = &#39;https://adventofcode.com/{}/day/{}/input&#39;.format(year, day)
</span></span></span><span><span><span>  cookie = open(&#39;cookie.txt&#39;).read().strip()
</span></span></span><span><span><span>
</span></span></span><span><span><span>  r = requests.get(url, cookies={&#39;session&#39;: cookie})
</span></span></span><span><span><span>  print(r.text)
</span></span></span><span><span><span>&#39;&#39;</span>;
</span></span></code></pre></div><p>Notice I was able to add <code>requests</code> as a <code>library</code>. From here, I am able to
call this script directly via the command:</p>
<pre tabindex="0"><code>$ nix run . -- 2022 5
</code></pre><p>There are some other ways this can be extended of course:</p>
<ol>
<li>Adding more scripts, effectively making the flake a trivial command runner.</li>
<li>If the script becomes too large, you can always split it back out into its
own file, then directly reading that file into the flake.</li>
<li>Placing the script as a package in a dev shell, so that it’s available via <code>nix develop</code>.</li>
</ol>


      </div></div>
  </body>
</html>
