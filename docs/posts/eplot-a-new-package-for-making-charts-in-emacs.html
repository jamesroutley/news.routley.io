<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lars.ingebrigtsen.no/2024/06/26/a-new-package-for-making-charts-in-emacs-eplot/">Original</a>
    <h1>Eplot: A new package for making charts in Emacs</h1>
    
    <div id="readability-page-1" class="page"><div><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-9.jpeg"><img decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-9.jpeg" alt="" width="840" height="738" srcset="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-9.jpeg 1448w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-9-300x264.jpeg 300w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-9-1024x900.jpeg 1024w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-9-768x675.jpeg 768w" sizes="(max-width: 840px) 100vw, 840px"/></a></p><p>One of the items on my <a screenshot="true" href="https://lars.ingebrigtsen.no/2024/06/17/a-super-simple-todo-package-for-emacs/">todo list</a> was:</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-2.jpeg"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-2.jpeg" alt="" width="462" height="39" srcset="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-2.jpeg 462w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-2-300x25.jpeg 300w" sizes="(max-width: 462px) 100vw, 462px"/></a></p><p>And that’s because I’ve been looking for an easy way to do simple plots for yonks.  When <a screenshot="true" href="https://lars.ingebrigtsen.no/2024/03/07/movie-ratings-r-us/">I did a post about movie ratings</a>, I tried <tt>chart.el</tt>:</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-3.jpeg"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-3.jpeg" alt="" width="840" height="982" srcset="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-3.jpeg 1859w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-3-256x300.jpeg 256w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-3-875x1024.jpeg 875w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-3-768x899.jpeg 768w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-3-1313x1536.jpeg 1313w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-3-1750x2048.jpeg 1750w" sizes="(max-width: 840px) 100vw, 840px"/></a></p><p>It’s a built-in thing in Emacs that has its origins as a testing tool for <tt>eieio</tt>, and as such, it is pretty limited.  But it basically did what I needed?  Except for…  man, look at that Y axis.  This cannot stand!</p><p>Bad axes marking is a personal bugaboo — I hate them sooo much!  But it’s easy to understand how they end up that way, because it’s a genuinely tricky problem.</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20.jpeg"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20.jpeg" alt="" width="262" height="338" srcset="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20.jpeg 262w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-233x300.jpeg 233w" sizes="(max-width: 262px) 100vw, 262px"/></a></p><p>For instance, for decades Google Finance had charts looking like this, with totally nonsensical axes.</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-1.jpeg"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-1.jpeg" alt="" width="300" height="500" srcset="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-1.jpeg 300w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-1-180x300.jpeg 180w" sizes="(max-width: 300px) 100vw, 300px"/></a></p><p>They basically just use the largest number as the highest Y marking, and then add a couple lines equidistant towards origo, and then go off and collect their paychecks.</p><p>These useless charts were there until, I think, 2021?  I used to check them irregularly for years to see whether they’d gotten sufficiently embarrassed by this shameful thing, but nope.  But then they reimplemented the entire site, and they finally got proper axes.</p><p>I was particularly interested because I worked for a stock broker, and one of the first things I did (back in 1997-ish) was implementing a <a href="https://quimby.gnus.org/circus/chart/chart-manual.php" data-cached-time="2024-06-20T20:33:04" data-cached-image="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/ewp7XjR7e.png" onmouseenter="hoverLink(event)">chart library</a>:</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20.png"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20.png" alt="" width="300" height="200"/></a></p><p>And the problem isn’t exactly “hard” in a “solve for Eulers dilemma” maths way, but it just requires some thought about what “pleasing numbers” are (basically 1, 2 and 5 in various scales), and thoughtful handling of the many border cases you get when plotting stock charts (a range can be between $0.00001 and $0.00002, or between 1e9 and 1e10 etc etc), and how do to time periods (years, sure, but then half years and then quarters and months and weeks? and then possibly divide months into weeks? so many details).</p><p>So why didn’t I just use this PHP thing for my charts?  Well, while it’s really convenient to generate stuff on a web server — that’s not really very convenient when you’re futzing around in Emacs with some numbers.  There’s a reason Excel and Jiputer Notebooks are so popular, after all — interactively massaging the data until it shows what you want it to show is where it’s at.  I mean, giving others an optimal experience of the data.</p><p>Now, of course <a href="https://orgmode.org/worg/org-tutorials/org-plot.html" data-cached-time="2024-06-20T20:33:12" data-cached-image="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/ewpbrLPk8.png" onmouseenter="hoverLink(event)">Org</a> has functions for doing plots, but…  it uses Gnuplot as the backend, and I’ve never enjoyed how Gnuplot does anything:</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-4.jpeg"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-4.jpeg" alt="" width="840" height="602" srcset="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-4.jpeg 1512w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-4-300x215.jpeg 300w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-4-1024x735.jpeg 1024w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-20-4-768x551.jpeg 768w" sizes="(max-width: 840px) 100vw, 840px"/></a></p><p>Again, look at that Y axis and roll your eyes.  I mean, it’s chosen nice numbers for the axis, but the formatting?</p><p>I mean, Gnuplot is perfectly OK, but…</p><p>But mainly, I had a stomach bug thing, so I didn’t really have anything to do, so I decided to type up this thing anyway.  So:</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/movie-plot-1.png"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/movie-plot-1.png" alt="" width="400" height="400" srcset="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/movie-plot-1.png 400w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/movie-plot-1-300x300.png 300w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/movie-plot-1-150x150.png 150w" sizes="(max-width: 400px) 100vw, 400px"/></a></p><p>Look!  The Y axis!  It has numbers that make sense!</p><p>And…  I wasn’t really going to implement everything from <tt>chart.php</tt>, but when I got started, it was just irresistible to do everything.</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-2.jpeg"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-2.jpeg" alt="" width="468" height="312" srcset="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-2.jpeg 468w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-2-300x200.jpeg 300w" sizes="(max-width: 468px) 100vw, 468px"/></a></p><p>But also more, like “dark mode”.</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-3.jpeg"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-3.jpeg" alt="" width="472" height="313" srcset="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-3.jpeg 472w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-3-300x199.jpeg 300w" sizes="(max-width: 472px) 100vw, 472px"/></a></p><p>One fun thing in the PHP library are the gradients, which were painstakingly written by hand (including a GIF colour map resource thing, if I remember correctly).  So they were painted pixel by pixel, I think?  But in the Emacs Lisp version, I just use SVG, and SVG has support for gradients.  So I just make a polygon and gradient that (as shown above).</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21.png"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21.png" alt="" width="300" height="200"/></a></p><p>And here’s the PHP original.  Looks pretty similar?</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-1.png"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-1.png" alt="" width="300" height="200"/></a></p><p>Just about the only thing I didn’t implement was this other, weird gradient, because…  er…  well, it would be hard!  I’d have to re-implement the pixel by pixel thing…  or at least line by line thing, and that would involve math and stuff.</p><p>But it’s not like anybody would use that…</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-2.png"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-2.png" alt="" width="300" height="200"/></a></p><p>But it does look nice in the backgrounds?  *sigh*  Nah, not gonna implement it.</p><p>So what does the Emacs user interface for this look like?</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-4.jpeg"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-4.jpeg" alt="" width="840" height="983" srcset="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-4.jpeg 1499w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-4-256x300.jpeg 256w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-4-875x1024.jpeg 875w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-4-768x899.jpeg 768w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-4-1312x1536.jpeg 1312w" sizes="(max-width: 840px) 100vw, 840px"/></a></p><p>You go to a buffer with a lot of numbers in, and you type <tt>M-x eplot</tt>.  (Yes, I had to call the thing <tt>eplot</tt>, since <tt>chart</tt> was taken.)</p><p>It’ll then pop up a buffer and show the plot.</p><p>But how do you then adjust the plot?  After all, the point of all this is that it should be easy to tweak plots until you get what you want, so…</p><p>To digress a bit — sometimes I happen upon what seems to be nice libraries (or frameworks, as they often call themselves), and the selling point is often “we do all the boring stuff for you!  Things just work!”  And then they present a minimal example, like I’ve done here, and then they sort of leave it hanging how you do the rest.</p><p>So when you google that, you discover that if you want to change any of the defaults, you have to write a depth-first traversal algorithm (in Haskell), and then override all of the stuff everywhere, and then you end up with 4x as much code as if you’d just written the darn thing yourself the way you wanted it.</p><p>That is: Many frameworks seem to actually have the motto “we make the simple things trivial, and then the slightly more difficult things almost impossible”.</p><p>So — I hope I haven’t landed there myself?</p><p>OK, the first “extra” thing I did was introduce the concept of “headers”, like this:</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-5.jpeg"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-5.jpeg" alt="" width="549" height="695" srcset="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-5.jpeg 549w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-5-237x300.jpeg 237w" sizes="(max-width: 549px) 100vw, 549px"/></a></p><p>I’m using a compact format with a small chart, just as a demonstration here — don’t need all that scrolling on the blog here.</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-6.jpeg"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-6.jpeg" alt="" width="514" height="656" srcset="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-6.jpeg 514w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-6-235x300.jpeg 235w" sizes="(max-width: 514px) 100vw, 514px"/></a></p><p>And that’s basically it — most of the different variations you see in the very first image on this blog post are by these simple headers thingies.</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-7.jpeg"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-7.jpeg" alt="" width="520" height="667" srcset="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-7.jpeg 520w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-7-234x300.jpeg 234w" sizes="(max-width: 520px) 100vw, 520px"/></a></p><p>All the useful things can be controlled by these headers, so iterating through this stuff is fast — just add some headers and <tt>C-c C-c</tt> and then you immediately see the results.  (Yes, there’s an <tt>eplot</tt> mode to make this easier.)</p><p><a href="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-8.jpeg"><img loading="lazy" decoding="async" src="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-8.jpeg" alt="" width="516" height="659" srcset="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-8.jpeg 516w, https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/2024-06-21-8-235x300.jpeg 235w" sizes="(max-width: 516px) 100vw, 516px"/></a></p><p>Yada yada.  I’ve even written a README.md file that documents all the various possibilities.</p><p>This is still very much a work in progress, but I’ve put it on <a href="https://github.com/larsmagne/eplot" data-cached-time="2024-06-26T16:34:43" data-cached-image="https://lars.ingebrigtsen.no/wp-content/uploads/2024/06/ewpqTOLvE.png" onmouseenter="hoverLink(event)">Microsoft Github</a>.  I think it should basically be somewhat useful now, but I’ve been hacking away at this for a week now, and I keep redoing everything, so perhaps not?  In any case, the code is a complete mess now as I’ve been programming it test case by test case, in the least efficient way possible, and I need to consolidate a lot of code paths, and make the code more readable.</p><p>But I feel like taking a break now, so I just pushed it.  So there.  Caveat end userage.</p></div></div>
  </body>
</html>
