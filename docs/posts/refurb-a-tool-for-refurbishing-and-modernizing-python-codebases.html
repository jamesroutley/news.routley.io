<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/dosisod/refurb">Original</a>
    <h1>Show HN: Refurb â€“ A tool for refurbishing and modernizing Python codebases</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">A tool for refurbishing and modernizing Python codebases.</p>
<h2 dir="auto"><a id="user-content-example" aria-hidden="true" href="#example"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Example</h2>
<div dir="auto" data-snippet-clipboard-copy-content="# main.py

for filename in [&#34;file1.txt&#34;, &#34;file2.txt&#34;]:
    with open(filename) as f:
        contents = f.read()

    lines = contents.splitlines()

    for line in lines:
        if not line or line.startswith(&#34;# &#34;) or line.startswith(&#34;// &#34;):
            continue

        for word in line.split():
            print(f&#34;[{word}]&#34;, end=&#34;&#34;)

        print(&#34;&#34;)"><pre><span># main.py</span>

<span>for</span> <span>filename</span> <span>in</span> [<span>&#34;file1.txt&#34;</span>, <span>&#34;file2.txt&#34;</span>]:
    <span>with</span> <span>open</span>(<span>filename</span>) <span>as</span> <span>f</span>:
        <span>contents</span> <span>=</span> <span>f</span>.<span>read</span>()

    <span>lines</span> <span>=</span> <span>contents</span>.<span>splitlines</span>()

    <span>for</span> <span>line</span> <span>in</span> <span>lines</span>:
        <span>if</span> <span>not</span> <span>line</span> <span>or</span> <span>line</span>.<span>startswith</span>(<span>&#34;# &#34;</span>) <span>or</span> <span>line</span>.<span>startswith</span>(<span>&#34;// &#34;</span>):
            <span>continue</span>

        <span>for</span> <span>word</span> <span>in</span> <span>line</span>.<span>split</span>():
            <span>print</span>(<span>f&#34;[<span><span>{</span><span>word</span><span>}</span></span>]&#34;</span>, <span>end</span><span>=</span><span>&#34;&#34;</span>)

        <span>print</span>(<span>&#34;&#34;</span>)</pre></div>
<p dir="auto">Running:</p>
<div data-snippet-clipboard-copy-content="$ refurb main.py
main.py:3:17 [FURB109]: Use `in (x, y, z)` instead of `in [x, y, z]`
main.py:4:5 [FURB101]: Use `y = Path(x).read_text()` instead of `with open(x, ...) as f: y = f.read()`
main.py:10:40 [FURB102]: Replace `x.startswith(y) or x.startswith(z)` with `x.startswith((y, z))`
main.py:16:9 [FURB105]: Use `print() instead of `print(&#34;&#34;)`"><pre><code>$ refurb main.py
main.py:3:17 [FURB109]: Use `in (x, y, z)` instead of `in [x, y, z]`
main.py:4:5 [FURB101]: Use `y = Path(x).read_text()` instead of `with open(x, ...) as f: y = f.read()`
main.py:10:40 [FURB102]: Replace `x.startswith(y) or x.startswith(z)` with `x.startswith((y, z))`
main.py:16:9 [FURB105]: Use `print() instead of `print(&#34;&#34;)`
</code></pre></div>
<h2 dir="auto"><a id="user-content-installing" aria-hidden="true" href="#installing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installing</h2>
<p dir="auto">Before installing, it is recommended that you setup a <a href="https://docs.python.org/3/tutorial/venv.html" rel="nofollow">virtual environment</a>.</p>
<div data-snippet-clipboard-copy-content="$ pip3 install refurb
$ refurb file.py"><pre><code>$ pip3 install refurb
$ refurb file.py
</code></pre></div>
<blockquote>
<p dir="auto">Note: Refurb only supports Python 3.10. It can check Python 3.6 code and up, but Refurb
itself must be ran through Python 3.10.</p>
</blockquote>
<h2 dir="auto"><a id="user-content-explanations-for-checks" aria-hidden="true" href="#explanations-for-checks"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Explanations For Checks</h2>
<p dir="auto">You can use <code>refurb --explain FURB123</code>, where <code>FURB123</code> is the error code you are trying to look up.
For example:</p>
<div data-snippet-clipboard-copy-content="$ refurb --explain FURB123
Don&#39;t cast a variable or literal if it is already of that type. For
example:

Bad:

```
name = str(&#34;bob&#34;)
num = int(123)
```

Good:

```
name = &#34;bob&#34;
num = 123"><pre><code>$ refurb --explain FURB123
Don&#39;t cast a variable or literal if it is already of that type. For
example:

Bad:

```
name = str(&#34;bob&#34;)
num = int(123)
```

Good:

```
name = &#34;bob&#34;
num = 123
</code></pre></div>
<h2 dir="auto"><a id="user-content-ignoring-errors" aria-hidden="true" href="#ignoring-errors"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Ignoring Errors</h2>
<p dir="auto">Use <code>--ignore 123</code> to ignore error 123. The error code can be in the form <code>FURB123</code> or <code>123</code>.
This flag can be repeated.</p>
<blockquote>
<p dir="auto">The <code>FURB</code> prefix indicates that this is a built-in error. The <code>FURB</code> prefix is optional,
but for all other errors (ie, <code>ABC123</code>), the prefix is required.</p>
</blockquote>
<h2 dir="auto"><a id="user-content-configuring-refurb" aria-hidden="true" href="#configuring-refurb"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Configuring Refurb</h2>
<p dir="auto">In addition to the command line arguments, you can also add your settings in the <code>pyproject.toml</code> file.
For example, the following command line arguments:</p>
<div data-snippet-clipboard-copy-content="refurb file.py --ignore 100 --load some_module"><pre><code>refurb file.py --ignore 100 --load some_module
</code></pre></div>
<p dir="auto">Corresponds to the following in your <code>pyproject.toml</code> file:</p>
<div data-snippet-clipboard-copy-content="[tool.refurb]
ignore = [100]
load = [&#34;some_module&#34;]"><pre><code>[tool.refurb]
ignore = [100]
load = [&#34;some_module&#34;]
</code></pre></div>
<p dir="auto">Now all you need to type is <code>refurb file.py</code>! Supplying command line arguments will
override any existing settings in the config file.</p>
<h2 dir="auto"><a id="user-content-plugins" aria-hidden="true" href="#plugins"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Plugins</h2>
<p dir="auto">Installing plugins for Refurb is very easy:</p>
<div data-snippet-clipboard-copy-content="$ pip3 install refurb-plugin-example"><pre><code>$ pip3 install refurb-plugin-example
</code></pre></div>
<p dir="auto">Where <code>refurb-plugin-example</code> is the name of the plugin. Refurb will automatically load
any installed plugins.</p>
<p dir="auto">To make your own Refurb plugin, see the <a href="https://github.com/dosisod/refurb-plugin-example"><code>refurb-plugin-example</code> repository</a>
for more info.</p>
<h2 dir="auto"><a id="user-content-writing-your-own-check" aria-hidden="true" href="#writing-your-own-check"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Writing Your Own Check</h2>
<p dir="auto">If you want to extend Refurb but don&#39;t want to make a full-fledged plugin,
you can easily create a one-off check file with the <code>refurb gen</code> command.</p>
<blockquote>
<p dir="auto">Note that this command uses the <code>fzf</code> fuzzy-finder for getting user input,
so you will need to <a href="https://github.com/junegunn/fzf#installation">install fzf</a> before continuing.</p>
</blockquote>
<p dir="auto">Here is the basic overview for creating a new check using the <code>refurb gen</code> command:</p>
<ol dir="auto">
<li>First select the node type you want to accept</li>
<li>Then type in where you want to save the auto generated file</li>
<li>Add your code to the new file</li>
</ol>
<p dir="auto">To get an idea of what you need to add to your check, use the <code>--debug</code> flag to see the
AST representation for a given file (ie, <code>refurb --debug file.py</code>). Take a look at the
files in the <code>refurb/checks/</code> folder for some examples.</p>
<p dir="auto">Then, to load your new check, use <code>refurb file.py --load your.path.here</code></p>
<blockquote>
<p dir="auto">Note that when using <code>--load</code>, you need to use dots in your argument, just like
importing a normal python module.</p>
</blockquote>
<h2 dir="auto"><a id="user-content-developing" aria-hidden="true" href="#developing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Developing</h2>
<p dir="auto">To setup locally, run:</p>
<div data-snippet-clipboard-copy-content="$ git clone https://github.com/dosisod/refurb
$ cd refurb
$ make install
$ make install-local"><pre><code>$ git clone https://github.com/dosisod/refurb
$ cd refurb
$ make install
$ make install-local
</code></pre></div>
<p dir="auto">Tests can be ran all at once using <code>make</code>, or you can run each tool on its own using
<code>make black</code>, <code>make flake8</code>, and so on.</p>
<p dir="auto">Unit tests can be ran with <code>pytest</code> or <code>make test</code>.</p>
<blockquote>
<p dir="auto">Since the end-to-end (e2e) tests are slow, they are not ran when running <code>make</code>.
You will need to run <code>make test-e2e</code> to run them.</p>
</blockquote>
<h2 dir="auto"><a id="user-content-why-does-this-exist" aria-hidden="true" href="#why-does-this-exist"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Why Does This Exist?</h2>
<p dir="auto">I love doing code reviews: I like taking something and making it better, faster, more
elegant, and so on. Lots of static analysis tools already exist, but none of them seem
to be focused on making code more elegant, more readable, or more modern. That is where
Refurb comes in.</p>
<p dir="auto">Refurb is heavily inspired by <a href="https://rust-lang.github.io/rust-clippy/master/index.html" rel="nofollow">clippy</a>,
the built-in linter for Rust.</p>
<h2 dir="auto"><a id="user-content-what-refurb-is-not" aria-hidden="true" href="#what-refurb-is-not"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>What Refurb Is Not</h2>
<p dir="auto">Refurb is not a style/type checker. It is not meant as a first-line of defense for
linting and finding bugs, it is meant for making good code even better.</p>
</article>
          </div></div>
  </body>
</html>
