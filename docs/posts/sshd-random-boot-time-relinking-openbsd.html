<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://undeadly.org/cgi?action=article;sid=20230119075627">Original</a>
    <h1>SSHD: Random boot time relinking, OpenBSD</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>Contributed by
<a href="https://www.openbsdfoundation.org/donations.html">rueda</a>
on <time datetime="2023-01-19T03:42:43Z">2023-01-19</time>
from the sshd-mk-thngs-hrdr dept.</p>
<p>As with library order randomisation
(<code>libc.so</code>/<code>libcrypto</code>/<code>ld.so</code>)
at boot
and kernel relinking at boot,
boot time relinking of
<a href="https://man.openbsd.org/"><code>sshd(8)</code></a>
is now implemented in -current.
Theo de Raadt committed the
<a href="https://marc.info/?l=openbsd-cvs&amp;m=167407459325339&amp;w=2">changes</a>:</p>

<blockquote>
<pre>CVSROOT:	/cvs
Module name:	src
Changes by:	deraadt@cvs.openbsd.org	2023/01/18 13:43:15

Modified files:
	usr.bin/ssh/sshd: Makefile 

Log message:
Create and install sshd random relink kit.
../Makefile.inc and Makfile are concatenated for reuse, which hopefully won&#39;t
be too fragile, we&#39;ll see if we need a different approach.
The resulting sshd binary is tested with the new <a href="https://man.openbsd.org/sshd.8#V">sshd -V</a> option before
installation.  As the binary layout is now semi-unknown (meaning
relative, fixed, and gadget offsets are not precisely known), change
the filesystem permissions to 511 to prevent what I call &#34;logged in <abbr>BROP</abbr>&#34;.
I have ideas for improving this further but this is a first step
ok djm</pre>
</blockquote>
<p><a href="https://marc.info/?l=openbsd-cvs&amp;m=167407467525399&amp;w=2">and</a></p>
<blockquote>
<pre>CVSROOT:	/cvs
Module name:	src
Changes by:	deraadt@cvs.openbsd.org	2023/01/18 13:44:40

Modified files:
	etc            : <a href="https://man.openbsd.org/rc.8">rc</a> 

Log message:
process the sshd random-relink kit if it is found.  sshd&#39;s text segment
is now garbled, and in the future <abbr>xonly</abbr> univirse you&#39;ll have poor success
downloading it or libc to know where gadgets are.
ok djm</pre>
</blockquote>
<p>
Please test aggressively. </p><p>
We look forward to the next steps hinted at in the first of these commit messages. </p><p>
If this works out, there are <a href="https://marc.info/?l=openbsd-tech&amp;m=167388832715992&amp;w=2">indications</a> other early-boot network daemons will get similar treatement sooner rather than later.
</p></div></div>
  </body>
</html>
