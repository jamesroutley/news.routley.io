<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/soloterm/screen">Original</a>
    <h1>Show HN: A terminal emulator in pure PHP</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Screen is a terminal renderer written in pure PHP. It powers <a href="https://github.com/soloterm/solo">Solo for Laravel</a> and
can be used to build rich text-based user interfaces in any PHP application.</p>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p dir="auto">Screen is a library intended to be integrated into PHP applications. It is not a standalone terminal application.</p>
</div>

<p dir="auto">A terminal renderer processes text and ANSI escape sequences to create a virtual representation of terminal output.
Unlike a full terminal emulator, Screen focuses specifically on correctly interpreting and rendering text content with
formatting rather than handling input, interactive sessions, or process management.</p>
<p dir="auto">Terminal renderers interpret escape sequences to:</p>
<ul dir="auto">
<li>Track cursor position</li>
<li>Apply text colors and styles (bold, underline, etc.)</li>
<li>Manage screen content</li>
<li>Handle special character sets</li>
<li>Generate a final rendered output</li>
</ul>
<p dir="auto">Screen implements this functionality in pure PHP, allowing developers to build terminal user interfaces without relying
on external dependencies or native code.</p>

<p dir="auto">Screen was originally created to solve a specific problem in <a href="https://github.com/soloterm/solo">Solo for Laravel</a>.</p>
<p dir="auto">Solo provides a TUI (Text User Interface) that runs multiple processes simultaneously in separate panels, similar to
tmux. However, when these processes output ANSI escape codes for cursor movement and screen manipulation, they could
potentially &#34;break out&#34; of their visual containers and interfere with other parts of the interface.</p>
<p dir="auto">To solve this problem, Screen creates a virtual terminal buffer where:</p>
<ol dir="auto">
<li>All ANSI operations (cursor movements, color changes, screen clears) are safely interpreted within an isolated
environment</li>
<li>The final rendered state is captured after all operations are processed</li>
<li>Only the final visual output is displayed to the user&#39;s terminal</li>
</ol>
<p dir="auto">This approach provides complete control over how terminal output is rendered, ensuring that complex ANSI operations stay
contained within their designated areas. While initially built for Solo, Screen has evolved into a standalone library
that can be used in any PHP application requiring terminal rendering.</p>

<ul dir="auto">
<li><strong>Pure PHP Implementation</strong>: Only one dependency (<a href="https://github.com/soloterm/grapheme">Grapheme</a>, another Solo
library)</li>
<li><strong>Comprehensive ANSI Support</strong>: Handles cursor positioning, text styling, and screen manipulation</li>
<li><strong>Unicode/Multibyte Support</strong>: Properly handles UTF-8 characters including emojis and wide characters</li>
<li><strong>Buffer Management</strong>: Maintains separate buffers for text content and styling</li>
<li><strong>Character Width Handling</strong>: Correctly calculates display width for CJK and other double-width characters</li>
<li><strong>Scrolling</strong>: Support for vertical scrolling with proper content management</li>
</ul>

<p dir="auto">Install via Composer:</p>
<div dir="auto" data-snippet-clipboard-copy-content="composer require soloterm/screen"><pre>composer require soloterm/screen</pre></div>

<ul dir="auto">
<li>PHP 8.1 or higher</li>
<li>mbstring extension</li>
</ul>

<p dir="auto">Here&#39;s a simple example of using Screen:</p>
<div dir="auto" data-snippet-clipboard-copy-content="use SoloTerm\Screen\Screen;

// Create a screen with dimensions (columns, rows)
$screen = new Screen(80, 24);

// Write text and ANSI escape sequences
$screen-&gt;write(&#34;Hello, \e[1;32mWorld!\e[0m&#34;);

// Move cursor and add more text
$screen-&gt;write(&#34;\e[5;10HPositioned text&#34;);

// Get the rendered content
echo $screen-&gt;output();"><pre><span>use</span> <span>SoloTerm</span>\<span>Screen</span>\<span>Screen</span>;

<span>// Create a screen with dimensions (columns, rows)</span>
<span><span>$</span>screen</span> = <span>new</span> <span>Screen</span>(<span>80</span>, <span>24</span>);

<span>// Write text and ANSI escape sequences</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;<span>Hello, </span>\e<span>[1;32mWorld!</span>\e<span>[0m</span>&#34;</span>);

<span>// Move cursor and add more text</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\e<span>[5;10HPositioned text</span>&#34;</span>);

<span>// Get the rendered content</span>
<span>echo</span> <span><span>$</span>screen</span>-&gt;<span>output</span>();</pre></div>

<p dir="auto">Screen operates with several key components:</p>

<p dir="auto">The main class that coordinates all functionality. It takes care of cursor positioning, content writing, and rendering
the final output.</p>
<div dir="auto" data-snippet-clipboard-copy-content="$screen = new Screen(80, 24); // width, height
$screen-&gt;write(&#34;Text and ANSI codes&#34;);"><pre><span><span>$</span>screen</span> = <span>new</span> <span>Screen</span>(<span>80</span>, <span>24</span>); <span>// width, height</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;<span>Text and ANSI codes</span>&#34;</span>);</pre></div>

<p dir="auto">Screen uses multiple buffer types to track content and styling:</p>
<ul dir="auto">
<li><strong>PrintableBuffer</strong>: Stores visible characters and handles width calculations</li>
<li><strong>AnsiBuffer</strong>: Tracks styling information (colors, bold, underline, etc.)</li>
</ul>

<p dir="auto">Screen correctly interprets ANSI escape sequences for:</p>
<ul dir="auto">
<li>Cursor movement (up, down, left, right, absolute positioning)</li>
<li>Text styling (colors, bold, italic, underline)</li>
<li>Screen clearing and line manipulation</li>
<li>Scrolling</li>
</ul>


<div dir="auto" data-snippet-clipboard-copy-content="// Move cursor to position (row 5, column 10)
$screen-&gt;write(&#34;\e[5;10H&#34;);

// Move cursor up 3 lines
$screen-&gt;write(&#34;\e[3A&#34;);

// Save and restore cursor position
$screen-&gt;write(&#34;\e7&#34;); // Save
$screen-&gt;write(&#34;More text&#34;);
$screen-&gt;write(&#34;\e8&#34;); // Restore"><pre><span>// Move cursor to position (row 5, column 10)</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\e<span>[5;10H</span>&#34;</span>);

<span>// Move cursor up 3 lines</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\e<span>[3A</span>&#34;</span>);

<span>// Save and restore cursor position</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\e<span>7</span>&#34;</span>); <span>// Save</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;<span>More text</span>&#34;</span>);
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\e<span>8</span>&#34;</span>); <span>// Restore</span></pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="// Bold red text
$screen-&gt;write(&#34;\e[1;31mImportant message\e[0m&#34;);

// Background colors
$screen-&gt;write(&#34;\e[44mBlue background\e[0m&#34;);

// 256-color support
$screen-&gt;write(&#34;\e[38;5;208mOrange text\e[0m&#34;);

// RGB colors
$screen-&gt;write(&#34;\e[38;2;255;100;0mCustom color\e[0m&#34;);"><pre><span>// Bold red text</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\e<span>[1;31mImportant message</span>\e<span>[0m</span>&#34;</span>);

<span>// Background colors</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\e<span>[44mBlue background</span>\e<span>[0m</span>&#34;</span>);

<span>// 256-color support</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\e<span>[38;5;208mOrange text</span>\e<span>[0m</span>&#34;</span>);

<span>// RGB colors</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\e<span>[38;2;255;100;0mCustom color</span>\e<span>[0m</span>&#34;</span>);</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="// Clear screen
$screen-&gt;write(&#34;\e[2J&#34;);

// Clear from cursor to end of line
$screen-&gt;write(&#34;\e[0K&#34;);

// Insert lines
$screen-&gt;write(&#34;\e[2L&#34;);

// Scroll up
$screen-&gt;write(&#34;\e[2S&#34;);"><pre><span>// Clear screen</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\e<span>[2J</span>&#34;</span>);

<span>// Clear from cursor to end of line</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\e<span>[0K</span>&#34;</span>);

<span>// Insert lines</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\e<span>[2L</span>&#34;</span>);

<span>// Scroll up</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\e<span>[2S</span>&#34;</span>);</pre></div>

<p dir="auto">You can respond to terminal queries by setting a callback:</p>
<div dir="auto" data-snippet-clipboard-copy-content="$screen-&gt;respondToQueriesVia(function($response) {
    // Process response (like cursor position)
    echo $response;
});"><pre><span><span>$</span>screen</span>-&gt;<span>respondToQueriesVia</span>(<span>function</span>(<span><span>$</span>response</span>) {
    <span>// Process response (like cursor position)</span>
    <span>echo</span> <span><span>$</span>response</span>;
});</pre></div>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p dir="auto">This is still a work in progress. We need some more tests / use cases here.</p>
</div>
<div dir="auto"><h2 tabindex="-1" dir="auto">Example: building a simple UI</h2><a id="user-content-example-building-a-simple-ui" aria-label="Permalink: Example: building a simple UI" href="#example-building-a-simple-ui"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="use SoloTerm\Screen\Screen;

$screen = new Screen(80, 24);

// Draw a border
$screen-&gt;write(&#34;‚îå&#34; . str_repeat(&#34;‚îÄ&#34;, 78) . &#34;‚îê\n&#34;);
for ($i = 0; $i &lt; 22; $i++) {
    $screen-&gt;write(&#34;‚îÇ&#34; . str_repeat(&#34; &#34;, 78) . &#34;‚îÇ\n&#34;);
}
$screen-&gt;write(&#34;‚îî&#34; . str_repeat(&#34;‚îÄ&#34;, 78) . &#34;‚îò&#34;);

// Add a title
$screen-&gt;write(&#34;\e[1;30H\e[1;36mMy Application\e[0m&#34;);

// Add some content
$screen-&gt;write(&#34;\e[5;5HWelcome to the application!&#34;);
$screen-&gt;write(&#34;\e[7;5HPress &#39;q&#39; to quit.&#34;);

// Render
echo $screen-&gt;output();"><pre><span>use</span> <span>SoloTerm</span>\<span>Screen</span>\<span>Screen</span>;

<span><span>$</span>screen</span> = <span>new</span> <span>Screen</span>(<span>80</span>, <span>24</span>);

<span>// Draw a border</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;<span>‚îå</span>&#34;</span> . <span>str_repeat</span>(<span>&#34;<span>‚îÄ</span>&#34;</span>, <span>78</span>) . <span>&#34;<span>‚îê</span>\n&#34;</span>);
<span>for</span> (<span><span>$</span>i</span> = <span>0</span>; <span><span>$</span>i</span> &lt; <span>22</span>; <span><span>$</span>i</span>++) {
    <span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;<span>‚îÇ</span>&#34;</span> . <span>str_repeat</span>(<span>&#34;<span> </span>&#34;</span>, <span>78</span>) . <span>&#34;<span>‚îÇ</span>\n&#34;</span>);
}
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;<span>‚îî</span>&#34;</span> . <span>str_repeat</span>(<span>&#34;<span>‚îÄ</span>&#34;</span>, <span>78</span>) . <span>&#34;<span>‚îò</span>&#34;</span>);

<span>// Add a title</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\e<span>[1;30H</span>\e<span>[1;36mMy Application</span>\e<span>[0m</span>&#34;</span>);

<span>// Add some content</span>
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\e<span>[5;5HWelcome to the application!</span>&#34;</span>);
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\e<span>[7;5HPress &#39;q&#39; to quit.</span>&#34;</span>);

<span>// Render</span>
<span>echo</span> <span><span>$</span>screen</span>-&gt;<span>output</span>();</pre></div>
<div dir="auto"><h2 tabindex="-1" dir="auto">Handling unicode and wide characters</h2><a id="user-content-handling-unicode-and-wide-characters" aria-label="Permalink: Handling unicode and wide characters" href="#handling-unicode-and-wide-characters"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Screen properly handles Unicode characters including emoji and CJK characters that take up multiple columns:</p>
<div dir="auto" data-snippet-clipboard-copy-content="$screen-&gt;write(&#34;Regular text: Hello&#34;);
$screen-&gt;write(&#34;\nWide characters: ‰Ω†Â•Ω‰∏ñÁïå&#34;);
$screen-&gt;write(&#34;\nEmoji: üöÄ üë®‚Äçüë©‚Äçüëß‚Äçüë¶ üåç&#34;);"><pre><span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;<span>Regular text: Hello</span>&#34;</span>);
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\n<span>Wide characters: ‰Ω†Â•Ω‰∏ñÁïå</span>&#34;</span>);
<span><span>$</span>screen</span>-&gt;<span>write</span>(<span>&#34;\n<span>Emoji: üöÄ üë®‚Äçüë©‚Äçüëß‚Äçüë¶ üåç</span>&#34;</span>);</pre></div>

<p dir="auto">Screen includes a comprehensive testing suite that features a unique visual comparison system:</p>


<p dir="auto">Screen employs an innovative screenshot-based testing approach (see <code>ComparesVisually</code> trait) that validates the visual
output:</p>
<ol dir="auto">
<li>The test renders content in a real terminal (iTerm)</li>
<li>It captures a screenshot of the terminal output</li>
<li>It runs the same content through the Screen renderer</li>
<li>It captures a screenshot of the rendered output</li>
<li>It compares the screenshots pixel-by-pixel to ensure accuracy</li>
</ol>
<p dir="auto">This testing strategy ensures that Screen&#39;s rendering accurately matches real terminal behavior, especially for complex
scenarios involving:</p>
<ul dir="auto">
<li>Multi-byte characters</li>
<li>Complex ANSI formatting</li>
<li>Cursor movements</li>
<li>Scrolling behavior</li>
<li>Line wrapping</li>
</ul>
<p dir="auto">For environments without screenshot capabilities, tests can fall back to fixture-based comparison, making the test suite
versatile for CI/CD pipelines.</p>
<p dir="auto">To enable screenshots for all tests, use the following command:</p>
<div dir="auto" data-snippet-clipboard-copy-content="ENABLE_SCREENSHOT_TESTING=1 composer test"><pre>ENABLE_SCREENSHOT_TESTING=1 composer <span>test</span></pre></div>
<p dir="auto">To enable screenshots for only the tests that don&#39;t already have fixtures, use the following command:</p>
<div dir="auto" data-snippet-clipboard-copy-content="ENABLE_SCREENSHOT_TESTING=2 composer test"><pre>ENABLE_SCREENSHOT_TESTING=2 composer <span>test</span></pre></div>

<p dir="auto">Contributions are welcome! Please feel free to submit a pull request.</p>

<p dir="auto">The MIT License (MIT).</p>

<p dir="auto">This is free! If you want to support me:</p>
<ul dir="auto">
<li>Sponsor my open source work: <a href="https://aaronfrancis.com/backstage" rel="nofollow">aaronfrancis.com/backstage</a></li>
<li>Check out my courses:
<ul dir="auto">
<li><a href="https://masteringpostgres.com" rel="nofollow">Mastering Postgres</a></li>
<li><a href="https://highperformancesqlite.com" rel="nofollow">High Performance SQLite</a></li>
<li><a href="https://screencasting.com" rel="nofollow">Screencasting</a></li>
</ul>
</li>
<li>Help spread the word about things I make</li>
</ul>

<p dir="auto">Solo Screen was developed by Aaron Francis. If you like it, please let me know!</p>
<ul dir="auto">
<li>Twitter: <a href="https://twitter.com/aarondfrancis" rel="nofollow">https://twitter.com/aarondfrancis</a></li>
<li>Website: <a href="https://aaronfrancis.com" rel="nofollow">https://aaronfrancis.com</a></li>
<li>YouTube: <a href="https://youtube.com/@aarondfrancis" rel="nofollow">https://youtube.com/@aarondfrancis</a></li>
<li>GitHub: <a href="https://github.com/aarondfrancis">https://github.com/aarondfrancis</a></li>
</ul>
</article></div></div>
  </body>
</html>
