<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/danja/dogalog">Original</a>
    <h1>Dogalog: A realtime Prolog-based livecoding music environment</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Dogalog is a realtime Prolog-based livecoding music environment where you write logic rules to create algorithmic rhythmic patterns and melodies.</p>


<ul dir="auto">
<li><strong>Livecoding</strong>: Auto-evaluation with visual feedback - code changes apply automatically</li>
<li><strong>State Preservation</strong>: Cycle counters and cooldowns persist across updates</li>
<li><strong>Interactive Tutorial</strong>: Built-in 13-step guided tutorial for learning</li>
<li><strong>PWA Support</strong>: Install as an app, works offline</li>
<li><strong>Mobile-First</strong>: Touch-friendly UI optimized for all devices</li>
<li><strong>Modular Architecture</strong>: Clean separation of concerns, all files &lt;100 lines</li>
<li><strong>Comprehensive Testing</strong>: 123 tests with 88%+ coverage</li>
</ul>


<p dir="auto">Open the dev server URL, click <strong>Tutorial</strong> to learn, or click <strong>Start</strong> and begin livecoding!</p>

<p dir="auto">Rules are Prolog-like statements that define when sounds should play:</p>
<div dir="auto" data-snippet-clipboard-copy-content="% Kick drum on every beat
event(kick, 60, 80, T) :- beat(T, 1).

% Snare on beats 2 and 4
event(snare, 60, 90, T) :- beat(T, 2).

% Hi-hats every 8th note
event(hat, 60, 70, T) :- every(T, 0.5)."><pre><span>% Kick drum on every beat</span>
<span>event</span>(<span>kick</span>, <span>60</span>, <span>80</span>, <span>T</span>) <span>:-</span> beat(<span>T</span>, <span>1</span>)<span>.</span>

<span>% Snare on beats 2 and 4</span>
<span>event</span>(<span>snare</span>, <span>60</span>, <span>90</span>, <span>T</span>) <span>:-</span> beat(<span>T</span>, <span>2</span>)<span>.</span>

<span>% Hi-hats every 8th note</span>
<span>event</span>(<span>hat</span>, <span>60</span>, <span>70</span>, <span>T</span>) <span>:-</span> every(<span>T</span>, <span>0</span><span>.</span>5).</pre></div>
<p dir="auto">The system asks <code>event(Voice, Pitch, Velocity, Time)</code> on every step and plays all matching results.</p>


<ul dir="auto">
<li><code>beat(T, N)</code> - Trigger on beat N (1 = downbeat, 2 = halfway, 4 = quarter notes)</li>
<li><code>every(T, Step)</code> - Trigger at regular intervals (0.5 = twice per beat)</li>
<li><code>phase(T, N, K)</code> - Trigger on phase K of N divisions</li>
<li><code>euc(T, K, N, B, R)</code> - Euclidean rhythm (K hits over N steps)</li>
</ul>

<ul dir="auto">
<li><code>prob(P)</code> - Succeed with probability P (0.0-1.0)</li>
<li><code>choose(List, X)</code> - Pick random element</li>
<li><code>cycle(List, X)</code> - Cycle through elements sequentially (stateful!)</li>
<li><code>pick(List, X)</code> - Backtrack through all elements</li>
<li><code>rand(Min, Max, X)</code> - Random float</li>
<li><code>randint(Min, Max, X)</code> - Random integer</li>
</ul>

<ul dir="auto">
<li><code>scale(Root, Mode, Degree, Oct, Midi)</code> - Convert scale degree to MIDI note</li>
<li><code>chord(Root, Quality, Oct, Midi)</code> - Generate chord tones</li>
<li><code>transpose(Note, Offset, Out)</code> - Transpose by semitones</li>
</ul>

<ul dir="auto">
<li><code>within(T, Start, End)</code> - Time range check (for song structure)</li>
<li><code>cooldown(Now, Last, Gap)</code> - Prevent rapid retriggering</li>
<li><code>eq(A, B)</code>, <code>lt(A, B)</code>, <code>gt(A, B)</code> - Comparisons</li>
<li><code>distinct(List)</code> - Check all elements are unique</li>
<li><code>add(A, B, C)</code> - Arithmetic</li>
<li><code>range(Start, End, Step, X)</code> - Generate number sequences</li>
<li><code>rotate(List, Shift, OutList)</code> - Rotate lists</li>
</ul>

<ul dir="auto">
<li><code>kick</code> - Synthesized kick drum</li>
<li><code>snare</code> - Noise-based snare</li>
<li><code>hat</code> - Noise-based hi-hat</li>
<li><code>sine</code> - Sine wave monosynth (use MIDI pitch)</li>
</ul>


<p dir="auto">Four-on-the-floor with backbeat:</p>
<div dir="auto" data-snippet-clipboard-copy-content="event(kick, 60, 100, T) :- euc(T, 4, 16, 4, 0).
event(snare, 60, 90, T) :- euc(T, 2, 16, 4, 4)."><pre><span>event</span>(<span>kick</span>, <span>60</span>, <span>100</span>, <span>T</span>) <span>:-</span> euc(<span>T</span>, <span>4</span>, <span>16</span>, <span>4</span>, <span>0</span>)<span>.</span>
<span>event</span>(<span>snare</span>, <span>60</span>, <span>90</span>, <span>T</span>) <span>:-</span> euc(<span>T</span>, <span>2</span>, <span>16</span>, <span>4</span>, <span>4</span>)<span>.</span></pre></div>
<p dir="auto">Complex polyrhythm:</p>
<div dir="auto" data-snippet-clipboard-copy-content="event(kick, 60, 100, T) :- euc(T, 3, 8, 0.5, 0).
event(snare, 60, 80, T) :- euc(T, 5, 8, 0.5, 2)."><pre><span>event</span>(<span>kick</span>, <span>60</span>, <span>100</span>, <span>T</span>) <span>:-</span> euc(<span>T</span>, <span>3</span>, <span>8</span>, <span>0</span><span>.</span>5, 0).
<span>event</span>(<span>snare</span>, <span>60</span>, <span>80</span>, <span>T</span>) <span>:-</span> euc(<span>T</span>, <span>5</span>, <span>8</span>, <span>0</span><span>.</span>5, 2).</pre></div>

<p dir="auto">Pentatonic melody:</p>
<div dir="auto" data-snippet-clipboard-copy-content="note(N) :- cycle([1, 3, 4, 5, 8], D), scale(60, minor_pent, D, 0, N).
event(sine, N, 70, T) :- every(T, 0.5), note(N)."><pre><span>note</span>(<span>N</span>) <span>:-</span> cycle([<span>1</span>, <span>3</span>, <span>4</span>, <span>5</span>, <span>8</span>], <span>D</span>), scale(<span>60</span>, <span>minor_pent</span>, <span>D</span>, <span>0</span>, <span>N</span>)<span>.</span>
<span>event</span>(<span>sine</span>, <span>N</span>, <span>70</span>, <span>T</span>) <span>:-</span> every(<span>T</span>, <span>0</span><span>.</span>5), note(N).</pre></div>
<p dir="auto">Available modes: <code>major</code>, <code>minor</code>, <code>dorian</code>, <code>phrygian</code>, <code>lydian</code>, <code>mixolydian</code>, <code>locrian</code>, <code>minor_pent</code>, <code>major_pent</code>, <code>blues</code>, <code>whole_tone</code>, <code>chromatic</code></p>

<div dir="auto" data-snippet-clipboard-copy-content="arp(N) :- chord(60, minor, 0, Notes), choose(Notes, N).
event(sine, N, 70, T) :- every(T, 0.25), arp(N)."><pre><span>arp</span>(<span>N</span>) <span>:-</span> chord(<span>60</span>, <span>minor</span>, <span>0</span>, <span>Notes</span>), choose(<span>Notes</span>, <span>N</span>)<span>.</span>
<span>event</span>(<span>sine</span>, <span>N</span>, <span>70</span>, <span>T</span>) <span>:-</span> every(<span>T</span>, <span>0</span><span>.</span>25), arp(N).</pre></div>
<p dir="auto">Chord qualities: <code>maj</code>, <code>min</code>, <code>dim</code>, <code>aug</code>, <code>sus2</code>, <code>sus4</code>, <code>maj7</code>, <code>min7</code>, <code>dom7</code>, <code>dim7</code></p>

<p dir="auto">Random velocities:</p>
<div dir="auto" data-snippet-clipboard-copy-content="vel(V) :- choose([60, 80, 100], V).
event(hat, 60, V, T) :- every(T, 0.25), vel(V)."><pre><span>vel</span>(<span>V</span>) <span>:-</span> choose([<span>60</span>, <span>80</span>, <span>100</span>], <span>V</span>)<span>.</span>
<span>event</span>(<span>hat</span>, <span>60</span>, <span>V</span>, <span>T</span>) <span>:-</span> every(<span>T</span>, <span>0</span><span>.</span>25), vel(V).</pre></div>
<p dir="auto">Sparse pattern:</p>
<div dir="auto" data-snippet-clipboard-copy-content="event(snare, 60, 80, T) :- beat(T, 2), prob(0.3)."><pre><span>event</span>(<span>snare</span>, <span>60</span>, <span>80</span>, <span>T</span>) <span>:-</span> beat(<span>T</span>, <span>2</span>), prob(<span>0</span><span>.</span>3).</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Song Structure with <code>within</code></h3><a id="user-content-song-structure-with-within" aria-label="Permalink: Song Structure with within" href="#song-structure-with-within"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="% Intro: just kick (beats 0-8)
event(kick, 60, 100, T) :- beat(T, 1).

% Verse: add snare (beats 8-16)
event(snare, 60, 80, T) :- beat(T, 2), within(T, 8, 16).

% Chorus: add melody (beats 16-24)
melody(N) :- scale(60, major, D, 0, N), cycle([1,3,5,8], D).
event(sine, N, 70, T) :- every(T, 0.5), melody(N), within(T, 16, 24)."><pre><span>% Intro: just kick (beats 0-8)</span>
<span>event</span>(<span>kick</span>, <span>60</span>, <span>100</span>, <span>T</span>) <span>:-</span> beat(<span>T</span>, <span>1</span>)<span>.</span>

<span>% Verse: add snare (beats 8-16)</span>
<span>event</span>(<span>snare</span>, <span>60</span>, <span>80</span>, <span>T</span>) <span>:-</span> beat(<span>T</span>, <span>2</span>), within(<span>T</span>, <span>8</span>, <span>16</span>)<span>.</span>

<span>% Chorus: add melody (beats 16-24)</span>
<span>melody</span>(<span>N</span>) <span>:-</span> scale(<span>60</span>, <span>major</span>, <span>D</span>, <span>0</span>, <span>N</span>), cycle([<span>1</span>,<span>3</span>,<span>5</span>,<span>8</span>], <span>D</span>)<span>.</span>
<span>event</span>(<span>sine</span>, <span>N</span>, <span>70</span>, <span>T</span>) <span>:-</span> every(<span>T</span>, <span>0</span><span>.</span>5), melody(N), within(T, 16, 24).</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="% Regular pattern
event(kick, 60, 100, T) :- beat(T, 1).

% Fill every 4+ bars
fill(T) :- beat(T, 1), cooldown(T, last_fill, 4).
event(snare, 60, V, T) :- fill(T), every(T, 0.25), choose([80,90,100], V)."><pre><span>% Regular pattern</span>
<span>event</span>(<span>kick</span>, <span>60</span>, <span>100</span>, <span>T</span>) <span>:-</span> beat(<span>T</span>, <span>1</span>)<span>.</span>

<span>% Fill every 4+ bars</span>
<span>fill</span>(<span>T</span>) <span>:-</span> beat(<span>T</span>, <span>1</span>), cooldown(<span>T</span>, <span>last_fill</span>, <span>4</span>)<span>.</span>
<span>event</span>(<span>snare</span>, <span>60</span>, <span>V</span>, <span>T</span>) <span>:-</span> fill(<span>T</span>), every(<span>T</span>, <span>0</span><span>.</span>25), choose([80,90,100], V).</pre></div>


<div dir="auto" data-snippet-clipboard-copy-content="npm install          # Install dependencies
npm run dev          # Start dev server (http://localhost:5173)
npm run build        # Build for production
npm run preview      # Preview production build
npm test             # Run tests
npm run test:ui      # Run tests with UI
npm run test:coverage # Generate coverage report
npm run docs:html    # Build manual and cheatsheet"><pre>npm install          <span><span>#</span> Install dependencies</span>
npm run dev          <span><span>#</span> Start dev server (http://localhost:5173)</span>
npm run build        <span><span>#</span> Build for production</span>
npm run preview      <span><span>#</span> Preview production build</span>
npm <span>test</span>             <span><span>#</span> Run tests</span>
npm run test:ui      <span><span>#</span> Run tests with UI</span>
npm run test:coverage <span><span>#</span> Generate coverage report</span>
npm run docs:html    <span><span>#</span> Build manual and cheatsheet</span></pre></div>

<div data-snippet-clipboard-copy-content="src/
├── prolog/          # Prolog engine
│   ├── builtins/    # Builtin predicates (modular)
│   ├── parser.js    # Parser
│   ├── resolution.js # SLD resolution with generators
│   ├── tokenizer.js # Tokenizer
│   ├── unify.js     # Unification
│   └── terms.js     # Term constructors
├── audio/           # WebAudio synthesis
│   └── audioEngine.js
├── scheduler/       # Timing and execution
│   ├── scheduler.js
│   ├── stateManager.js
│   └── transitionManager.js
├── livecoding/      # Auto-evaluation
│   ├── codeValidator.js
│   └── liveEvaluator.js
├── tutorial/        # Tutorial system
│   ├── tutorialManager.js
│   ├── tutorialOverlay.js
│   └── steps.js
├── ui/              # User interface
│   ├── components/  # Reusable components
│   ├── template.js
│   ├── controls.js
│   └── validationIndicator.js
├── help/            # Documentation
│   └── builtinDocs.js
├── config/          # Configuration
│   └── defaults.js
├── app.js           # Application orchestrator
└── main.js          # Entry point"><pre><code>src/
├── prolog/          # Prolog engine
│   ├── builtins/    # Builtin predicates (modular)
│   ├── parser.js    # Parser
│   ├── resolution.js # SLD resolution with generators
│   ├── tokenizer.js # Tokenizer
│   ├── unify.js     # Unification
│   └── terms.js     # Term constructors
├── audio/           # WebAudio synthesis
│   └── audioEngine.js
├── scheduler/       # Timing and execution
│   ├── scheduler.js
│   ├── stateManager.js
│   └── transitionManager.js
├── livecoding/      # Auto-evaluation
│   ├── codeValidator.js
│   └── liveEvaluator.js
├── tutorial/        # Tutorial system
│   ├── tutorialManager.js
│   ├── tutorialOverlay.js
│   └── steps.js
├── ui/              # User interface
│   ├── components/  # Reusable components
│   ├── template.js
│   ├── controls.js
│   └── validationIndicator.js
├── help/            # Documentation
│   └── builtinDocs.js
├── config/          # Configuration
│   └── defaults.js
├── app.js           # Application orchestrator
└── main.js          # Entry point
</code></pre></div>

<ul dir="auto">
<li><strong>Prolog Engine</strong>: Custom implementation with SLD resolution using ES6 generators for backtracking</li>
<li><strong>Livecoding</strong>: Debounced auto-evaluation (300ms) with syntax validation</li>
<li><strong>State Management</strong>: Centralized state for cycle counters and cooldowns (persists across code updates)</li>
<li><strong>Scheduler</strong>: Time-grid based (16th notes) with swing and lookahead support</li>
<li><strong>Audio</strong>: WebAudio synthesis without samples - all sounds generated in real-time</li>
<li><strong>UI</strong>: Mobile-first, progressive enhancement, DOM-based components</li>
</ul>

<ul dir="auto">
<li>123 tests across 16 test files</li>
<li>Coverage: 88.52% statements, 90.42% functions</li>
<li>Integration tests for livecoding, state preservation, example loading</li>
<li>UI component tests with vitest + jsdom</li>
</ul>

<ul dir="auto">
<li>Installable on mobile and desktop</li>
<li>Offline support with service worker</li>
<li>Caches all assets and documentation</li>
<li>Manifest with icons and theme colors</li>
</ul>

<ul dir="auto">
<li><strong>Interactive Tutorial</strong>: Click &#34;Tutorial&#34; button in the app for 13 guided steps</li>
<li><strong><a href="https://danja.github.io/dogalog/docs/tutorial.html" rel="nofollow">Full Tutorial</a></strong>: Comprehensive guide teaching both Prolog and livecoding</li>
<li><strong><a href="https://danja.github.io/dogalog/docs/manual.html" rel="nofollow">Manual</a></strong>: Complete reference for all built-ins and syntax</li>
<li><strong><a href="https://danja.github.io/dogalog/docs/cheatsheet.html" rel="nofollow">Cheatsheet</a></strong>: Quick reference for common patterns</li>
<li><strong>Live Demo</strong>: <a href="https://danja.github.io/dogalog/" rel="nofollow">GitHub Pages</a></li>
</ul>


<ol dir="auto">
<li>User edits code in editor</li>
<li>After 300ms debounce, code is validated</li>
<li>If valid: parse → compile → swap program (with smooth transition)</li>
<li>State (cycles, cooldowns) persists across updates</li>
<li>Visual indicator shows validation state (green/red/yellow)</li>
</ol>

<div dir="auto" data-snippet-clipboard-copy-content="% This pattern&#39;s state persists when you edit other code:
drums(D) :- cycle([kick, snare, hat], D).
event(D, 60, 80, T) :- beat(T, 1), drums(D).

% Editing this won&#39;t reset the cycle counter!"><pre><span>% This pattern&#39;s state persists when you edit other code:</span>
<span>drums</span>(<span>D</span>) <span>:-</span> cycle([<span>kick</span>, <span>snare</span>, <span>hat</span>], <span>D</span>)<span>.</span>
<span>event</span>(<span>D</span>, <span>60</span>, <span>80</span>, <span>T</span>) <span>:-</span> beat(<span>T</span>, <span>1</span>), drums(<span>D</span>)<span>.</span>

<span>% Editing this won&#39;t reset the cycle counter!</span></pre></div>

<p dir="auto">Euclidean rhythms distribute K hits as evenly as possible over N steps using the Euclidean algorithm. The result is musically interesting patterns used in music worldwide:</p>
<ul dir="auto">
<li><code>euc(T, 3, 8, 0.5, 0)</code> - Tresillo pattern (Cuban music)</li>
<li><code>euc(T, 5, 8, 0.5, 0)</code> - Cinquillo pattern</li>
<li><code>euc(T, 5, 12, 0.5, 0)</code> - Common rock beat</li>
</ul>

<ul dir="auto">
<li>Modern browsers with WebAudio API</li>
<li>Chrome/Edge 90+</li>
<li>Firefox 88+</li>
<li>Safari 14.1+</li>
<li>Mobile browsers (iOS Safari, Chrome Android)</li>
</ul>

<p dir="auto">MIT</p>

<p dir="auto">Built with vanilla JavaScript, CodeMirror 6, and WebAudio API. Inspired by TidalCycles, Sonic Pi, and Datalog.</p>
</article></div></div>
  </body>
</html>
