<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lwn.net/Articles/921497/">Original</a>
    <h1>Using low-cost wireless sensors in the unlicensed bands</h1>
    
    <div id="readability-page-1" class="page"><div>
<center>
           <div><b>LWN.net needs you!</b><p>Without subscribers, LWN would simply not exist.  Please consider
       <a href="https://lwn.net/subscribe/">signing up for a subscription</a> and helping
       to keep LWN publishing</p></div>
           </center>
           
<p>When it comes to home automation, people often end up with devices
supporting the <a href="https://csa-iot.org/all-solutions/zigbee/">Zigbee</a> or <a href="https://www.z-wave.com">Z-Wave</a> protocols, but those devices are
relatively expensive. When I was looking for a way to keep an eye on the
temperature at home a few years ago, I bought a bunch of cheap
temperature and humidity sensors emitting radio signals in the unlicensed
ISM (Industrial, Scientific, and Medical) frequency bands instead. Thanks to <a href="https://github.com/merbanan/rtl_433">rtl_433</a> and, more recently, <a href="https://github.com/NorthernMan54/rtl_433_ESP">rtl_433_ESP</a> and <a href="https://github.com/1technophile/OpenMQTTGateway">OpenMQTTGateway</a>,
I was able to integrate their measurements easily into my home-automation
system.  </p>

<h4>Unlicensed spectrum</h4>

<p>Most of the radio spectrum is licensed by national regulators to
specific users. This is why mobile operators or TV broadcasters have to pay
a hefty licensing fee for the exclusive right to transmit on a specific
frequency. The upside is that they can be relatively sure that no one else
interferes with their transmissions.  </p>

<p>However, there are also some frequency bands that are free to use by any
transmitter: the ISM bands. That&#39;s why many manufacturers of doorbells,
weather stations, and all sorts of wireless sensor devices choose to
transmit in those bands. The specific frequencies depend on the region,
as the radio regulations from the <a href="https://www.itu.int">International Telecommunication Union</a> (ITU)
divide the world into <a href="https://en.wikipedia.org/wiki/ITU_Region">three regions</a> with
their own frequency allocations.  </p>

<p>Because devices don&#39;t have an exclusive right to transmit in the ISM
band, there&#39;s much more potential for interference. However, manufacturers
have to follow some rules, for instance about the permitted transmit power
and the duty cycle (the maximal ratio of time transmitting over total
time). That&#39;s why, in many situations, interference isn&#39;t that bad, for
example when a lot of temperature sensors transmit every minute with a
random start time.  </p>

<p>To be able to read the sensor measurements, three things are needed: a
receiver, an antenna, and a decoder. The first two are quite easy to
find. A decoder is sometimes a bit more effort. Many of these sensors use a
proprietary protocol, but luckily most don&#39;t use any
encryption. There&#39;s a whole community of enthusiasts who try to
reverse-engineer protocols of wireless sensors and implement decoders in
open-source software.  </p>

<h4>A generic data receiver</h4>

<p>The most well-known project to capture wireless sensor measurements is
Benjamin Larsson&#39;s GPLv2-licensed rtl_433. It&#39;s a generic data
receiver for the 433.92MHz, 868MHz, 315MHz, 345MHz, and 915MHz ISM
bands. At the time of writing, the project&#39;s README on GitHub lists 234
supported device protocols, ranging from temperature sensors, soil-moisture
sensors, wireless switches, and contact sensors to doorbells, tire-pressure
monitoring systems, and energy monitors.  </p>

<p>Rtl_433 is written in C99 and compiles on Linux, macOS, and Windows. Low
resource consumption and few dependencies are two of its main design
goals. This makes it possible to run rtl_433 on embedded hardware, like
routers. The Raspberry Pi is also supported well.  </p>

<p>The software supports various receivers using Osmocom&#39;s <a href="https://osmocom.org/projects/rtl-sdr/wiki">rtl-sdr</a> or
Pothosware&#39;s <a href="https://github.com/pothosware/SoapySDR/">SoapySDR</a>
to interface with SDR (software-defined radio) devices. The rtl-sdr project
builds on the discovery from more than a decade ago that a cheap DVB-T TV
tuner dongle with the Realtek RTL2832U chipset can be used to build a
wideband software-defined radio receiver. There are now even <a href="https://www.rtl-sdr.com/buy-rtl-sdr-dvb-t-dongles/">RTL-SDR
dongles</a> that are specifically designed for SDR purposes. So rtl-sdr
talks to the RTL-SDR dongle, which returns the radio signal that is then decoded
by rtl_433 and translated into sensor measurements from specific supported
devices. In the same way, SoapySDR acts as a driver for other SDR devices, such 
as <a href="https://limemicro.com/products/boards/limesdr/">LimeSDR</a> 
and <a href="https://greatscottgadgets.com/hackrf/one/">HackRF One</a>. </p>

<h4>Using rtl_433</h4>

<p><a href="https://lwn.net/Articles/921539/">
<img src="https://static.lwn.net/images/2023/rtl-sdr-with-sensor-sm.png" alt="[RTL-SDR, antenna, and sensor]" title="RTL-SDR, antenna, and sensor" width="300" height="225"/>
</a></p><p>The cheapest way to start with rtl_433 would be to buy such an RTL-SDR
dongle. This also requires an antenna, preferably one with a length
that works well with the wavelength for the frequency of the target
devices. Some RTL-SDR dongles come in a kit with a telescoping dipole
antenna, dipole base, tripod mount, and other accessories. At RTL-SDR.com
there&#39;s a thorough explanation of <a href="https://www.rtl-sdr.com/using-our-new-dipole-antenna-kit/">how to use
the dipole antenna kit</a>. Something to be mindful of: when plugging the
RTL-SDR dongle directly into a USB port, it will pick up a lot of RF noise
from the computer. Using a short USB extension cable avoids this.  </p>

<p>After installing <a href="https://osmocom.org/projects/rtl-sdr/repository/rtl-sdr/revisions/master/entry/rtl-sdr.rules">udev
rules for the RTL-SDR</a> and connecting a supported RTL-SDR dongle with its
antenna, just running <tt>rtl_433</tt> finds the dongle and configures it
to start listening at 433.92MHz with a sample rate of 250,000 samples per
second. The software immediately starts spitting out decoded sensor
measurements for all devices transmitting in the neighborhood. Rtl_433
supports a lot of options to choose the frequency, sample rate, device
decoders, and output format.</p>

<h4>Integrating rtl_433 with a home-automation system</h4>

<p>Rtl_433 can be run as a service, for instance using a systemd service
unit. George Hertz has created a multi-architecture Docker image, <a href="https://github.com/hertzg/rtl_433_docker">hertzg/rtl_433</a>, that
also runs on the Raspberry Pi. For automated processing, rtl_433 supports
publishing sensor measurements to an <a href="https://lwn.net/Articles/753705/">MQTT broker</a>, an <a href="https://en.wikipedia.org/wiki/InfluxDB">InfluxDB</a> time 
series database, or a syslog server. The MQTT export is especially
interesting: many home-automation controllers, including <a href="https://lwn.net/Articles/822350/">Home Assistant</a> and <a href="https://lwn.net/Articles/631827/">openHAB</a>, support MQTT.  </p>

<p>There are some caveats to using rtl_433 for home automation. First,
although many of these devices transmit an ID to be able to distinguish
them, their ID changes after replacing the battery. So a rule such
as &#34;if the temperature of the sensor with ID 106 is above 8 degrees, send a
warning&#34; needs to be changed after replacing the device&#39;s battery. Luckily
it&#39;s quite common to run these devices a year or longer on a
battery. Another drawback is that most of these devices transmit their data
unencrypted. So they&#39;re not recommended for critical purposes, as people
can sniff or even spoof the transmissions.  </p>

<h4>Adding support for new devices</h4>

<p><a href="https://lwn.net/Articles/921541/">
<img src="https://static.lwn.net/images/2023/rtl433-spectrogram-sm.png" alt="[Spectrogram]" title="Spectrogram" width="300" height="196"/>
</a></p><p>Rtl_433 is a collaborative effort, with many developers adding support
for their wireless devices. The project has some documentation about <a href="https://triq.org/rtl_433/CONTRIBUTING.html#supporting-additional-devices-and-test-data">supporting
new devices</a>. The endeavor always starts with recording test signals
representing different conditions of the sensor, while taking note of what the
device is showing on its display at the same time of the signal.  </p>

<p>The project has extensive documentation about <a href="https://triq.org/rtl_433/PRIMER.html">SDR concepts</a>, <a href="https://triq.org/rtl_433/IQ_FORMATS.html">I/Q (in-phase / quadrature)
formats</a>, and <a href="https://triq.org/rtl_433/PULSE_FORMATS.html">pulse formats</a>. This
is all necessary background information to be able to analyze the signals for
adding support for a new device. There&#39;s also a <a href="https://triq.org/rtl_433/ANALYZE.html">step-by-step plan to analyze
devices</a>.  </p>

<p>Rtl_433 also has a lot of supporting web-based tools to analyze
signals. For instance, to visualize the <a href="https://triq.org/iqs/">I/Q
spectrogram of test signals</a> (seen above at left), to view and analyze <a href="https://triq.org/pdv">pulses from test signals</a>, and even to <a href="https://triq.net/bitbench">analyze bit strings</a> to get an idea of
what&#39;s in the data. All these are powerful tools that help with
reverse-engineering the protocol and adding a decoder for the device to
rtl_433.  </p>

<h4>Receiving sensors with a microcontroller</h4>

<p>While rtl_433 is a powerful solution, the fact that it needs a computer
with a full operating system can be a disadvantage. Some people prefer
using a microcontroller, which runs more reliably and with lower power
consumption. One of these solutions is Florian Robert&#39;s GPLv3-licensed
OpenMQTTGateway. It 
not only supports receiving measurements from Bluetooth Low Energy devices,
it also supports various <a href="https://docs.openmqttgateway.com/use/rf.html#changing-active-receiver-modules">RF
devices</a> using different receiver and decoder modules. The list of <a href="https://compatible.openmqttgateway.com/index.php/devices/">supported
devices</a> is big, but it depends on the microcontroller and receiver
hardware you set up.  </p>

<blockquote>
<a href="https://lwn.net/Articles/921540/">
<img src="https://static.lwn.net/images/2023/rtl433-esp-discovery-sm.png" alt="[Home Assistant dashboard]" title="Home Assistant dashboard"/>
</a>
</blockquote>

<p>The results of the measurements are published to an MQTT broker, for
instance for integration in Home Assistant or another home-automation
gateway. OpenMQTTGateway even supports Home Assistant&#39;s autodiscovery
protocol. So all sensors the device recognizes will automatically be added
into Home Assistant&#39;s devices, ready to be shown on its web-based
dashboard (seen above).  </p>

<p>On boards with an ESP32 microcontroller, <a href="https://github.com/1technophile/OpenMQTTGateway/releases/tag/v1.0.0">OpenMQTTGateway
1.0</a> introduced support for a subset of the rtl_433 decoders. It does
this by using NorthernMan54&#39;s GPLv3-licensed Arduino library <a href="https://github.com/NorthernMan54/rtl_433_ESP">rtl_433_ESP</a>. This
is a port of rtl_433 to the ESP32 microcontroller, using a CC1101 or SX127X
receiver chip. These two are popular chips built into boards combining a
microcontroller and receiver module.  While rtl_433 implements signal
demodulation in software, rtl_433_ESP uses the receiver chipset to do
this. This limits the <a href="https://github.com/NorthernMan54/rtl_433_ESP#enabled-device-decoders">available
device decoders</a>, but at this writing, 81 of the 234 decoders of
rtl_433 will run on the ESP32.  </p>

<h4>Conclusion</h4>

<p><a href="https://lwn.net/Articles/921556/">
<img src="https://static.lwn.net/images/2023/rtl433-lilygo-sm.png" alt="[LILYGO]" title="LILYGO" width="300" height="225"/>
</a></p><p>Since the first time I bought 433MHz sensors, I have put one in every
room at home, in my fridge, my freezer, and on my terrace outside. I
have been running rtl_433 with an RTL-SDR dongle for years on a Raspberry
Pi to receive all these sensor measurements. The data are sent to the <a href="https://mosquitto.org">Eclipse Mosquitto</a> MQTT broker and then fed
into the home-automation controller Home Assistant. 

</p><p>
Recently I have been
evaluating OpenMQTTGateway with rtl_433_ESP on a <a href="https://www.lilygo.cc/products/lora3?variant=42476923879605">LILYGO
LoRa32 V2.1_1.6.1 
433MHz</a> board (seen at right). Since it seems to support all of my
433MHz temperature 
sensors, I&#39;m 
considering a switch to this lower-power solution, which will free up the
RTL-SDR for other purposes. However, 
the rtl_433_ESP&#39;s README mentions that the CC1101 receiver module is not 
as sensitive as the RTL-SDR dongle, resulting in only half the range. I 
had the same experience with the SX127X receiver on the LILYGO board. 
But those boards are so cheap that I could easily place a couple in 
various places to receive all of my sensors. Since they all send their 
decoded sensor values to the same MQTT broker, the result should be the 
same as having a single receiver with a longer range.  </p>

<p>With this setup, Home Assistant allows me to see the temperature and
humidity around the house in a web-based dashboard; I even get warnings
when the temperature of the fridge or freezer rises too much. Other people
are using sensors to monitor their pool temperature, their oil tank&#39;s
level, water leaks, or the wind speed measured by their weather station.
</p>

<p>All in all, these tools are quite useful for receiving measurements from
a wide 
range of cheap 
wireless sensors. For a better range, more decoders, or when preferring a
computer over a microcontroller, rtl_433 is a good choice. In other
cases, OpenMQTTGateway with rtl_433_ESP on an ESP32 microcontroller board
is a welcome addition to the toolbox of the open-source home-automation
enthusiast.  </p></div></div>
  </body>
</html>
