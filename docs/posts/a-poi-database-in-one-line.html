<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.dbreunig.com/2024/04/18/a-poi-database-in-one-line.html">Original</a>
    <h1>A POI database in one line</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody">
    <p>This week, the <a href="https://overturemaps.org/">Overture Maps Foundation</a> released <a href="https://github.com/OvertureMaps/overturemaps-py">a handy command-line tool</a> for downloading a subset of the Overture dataset. Usage is simple:</p>

<div><div><pre><code><span>$ </span>pip <span>install </span>overturemaps
<span>$ </span>overturemaps download <span>--bbox</span><span>=</span><span>-71</span>.068,42.353,-71.058,42.363 <span>-f</span> geojson <span>--type</span><span>=</span>building <span>-o</span> boston.geojson
</code></pre></div></div>

<p>This command downloads a GeoJSON file containing all the Overture buildings in a chunk of Boston. We’re outputting GeoJSON to a local file named <code>boston.geojson</code>.</p>

<p>With the new tool, I wanted to revisit the exercise of creating a POI database with Overture. <a href="https://gist.github.com/dbreunig/bd13dd99d6d708560bfcca9f45c9fb29">Last time</a>, it took us 162 lines of wrangling with the <code>aws-cli</code> and <code>duckdb</code> to get us something usable. How many lines will it take us this time?</p>

<p>It’s just one line:</p>

<div><div><pre><code><span>$ </span>overturemaps download <span>--bbox</span><span>=</span><span>-71</span>.068,42.353,-71.058,42.363 <span>-f</span> geojsonseq <span>--type</span><span>=</span>place | geojson-to-sqlite boston.db places - <span>--nl</span> <span>--pk</span><span>=</span><span>id</span>
</code></pre></div></div>

<p>We made three tweaks to the <code>overturemaps</code> maps call: specifying we want <code>place</code> data, outputting <code>geojsonseq</code> (or new-line delimited GeoJSON), and removing the output arguments. With no output specified, place data is output to <code>stdout</code>, which we can pipe to Simon Willison’s <a href="https://simonwillison.net/2020/Jan/31/geojson-sqlite/">geojson-to-sqlite</a>, taking care to specify we’re using new-line delimited GeoJSON and that the primary key is <code>id</code>.</p>

<p>On my machine, this task took ~9 seconds to pull down 1,648 places from the global Overture places dataset.</p>

<p>But we can do better! If we wanted to grab all the places in my town, I’d have to figure out the bounding box. Which is kind of a pain. Thankfully, LLMs are spookily good at producing bounding boxes for towns, cities, states, and regions. So lets incorporate Simon’s <a href="https://llm.datasette.io/en/stable/">llm</a> tool to generate our bounding box (here, with OpenAI’s <code>gpt-3.5</code>), using command substitution:</p>

<div><div><pre><code><span>$ </span>overturemaps download <span>--bbox</span><span>=</span><span>$(</span>llm <span>&#39;Give me a bounding box for Alameda, California expressed as only four numbers delineated by commas, with no spaces, longitude preceding latitude.&#39;</span><span>)</span> <span>-f</span> geojsonseq <span>--type</span><span>=</span>place | geojson-to-sqlite alameda.db places - <span>--nl</span> <span>--pk</span><span>=</span><span>id</span>
</code></pre></div></div>

<p><code>llm</code> returns “-122.336,37.572,-122.187,37.804”, which is dead on.</p>

<p>This one-liner downloads 4,005 places and loads them into a sqlite database in about 14 seconds.</p>

  </div></div>
  </body>
</html>
