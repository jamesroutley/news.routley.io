<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rohangautam.github.io/blog/chebyshev_gauss/">Original</a>
    <h1>Gaussian integration is cool</h1>
    
    <div id="readability-page-1" class="page"><div id="skip">
			


<ul>
	<li><time datetime="2025-06-08">08 June 2025</time></li>
	<li><a href="https://olivia.website/tags/simulation/">simulation</a>, </li>
	<li><a href="https://olivia.website/tags/numerical-techniques/">numerical_techniques</a></li>
</ul>

<p>Numerical integration techniques are often used in a variety of domains where exact solutions are not available. In this blog, we&#39;ll look at a numerical integration technique called gaussian quadrature, specifically chebyshev-gauss quadrature. This is applicable for evaluating definite integrals over <span><span><math><semantics><mrow><mo>[</mo><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">[-1,1]</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span>[</span><span>−</span><span>1</span><span>,</span><span>1</span><span>]</span></span></span></span> and with a special functional form - we&#39;ll also look into how we can tweak an generic function over an arbitrary interval to fit this form.</p>
<nav><ol><li><a href="#gaussian-quadrature">Gaussian quadrature </a></li><li><a href="#chebyshev-gauss-quadrature">Chebyshev-Gauss quadrature </a><ol><li><a href="#extending-to-general-functions-and-integration-intervals">Extending to general functions and integration intervals </a></li></ol></li><li><a href="#let&#39;s-see-it-in-action!">Let&#39;s see it in action! </a></li><li><a href="#parting-thoughts">Parting thoughts </a></li></ol></nav><figure><picture><source type="image/avif" srcset="/img/-4sMW8E34_-400.avif 400w, /img/-4sMW8E34_-800.avif 800w, /img/-4sMW8E34_-1200.avif 1200w" sizes="100vw"/><source type="image/webp" srcset="/img/-4sMW8E34_-400.webp 400w, /img/-4sMW8E34_-800.webp 800w, /img/-4sMW8E34_-1200.webp 1200w" sizes="100vw"/><img alt="Fig 1: Comparing the accuracy of a basic integration technique (note log scale) with chebyshev-gauss quadrature" loading="lazy" decoding="async" src="https://olivia.website/img/-4sMW8E34_-400.webp" width="1200" height="377"/></picture><figcaption>Fig 1: Comparing the accuracy of a basic integration technique (note log scale) with chebyshev-gauss quadrature</figcaption></figure>

<p>At it&#39;s core, gaussian quadrature gives us a way to evaluate a definite integral of a function by using the function evaluations at special points called nodes, the exact location of which can vary depending on the technique used - we&#39;ll look at a specific example using chebyshev nodes later on. Here&#39;s the basic idea for a definite integral over <span><span><math><semantics><mrow><mo>[</mo><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">[-1,1]</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span>[</span><span>−</span><span>1</span><span>,</span><span>1</span><span>]</span></span></span></span>, we&#39;ll extend this to an arbitrary interval <span><span><math><semantics><mrow><mo>[</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[a,b]</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span>[</span><span>a</span><span>,</span><span>b</span><span>]</span></span></span></span> later on. An integral of <span><span><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span>f</span></span></span></span> can be expressed as a weighted sum of <span><span><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span>f</span></span></span></span> evaluated at <span><span><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span>n</span></span></span></span> nodes :</p>
<p><span><span><span><math><semantics><mrow><msubsup><mo>∫</mo><mrow><mo>−</mo><mn>1</mn></mrow><mrow><mn>1</mn></mrow></msubsup><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mi>d</mi><mi>x</mi><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi></mrow></msubsup><mrow><mi>w</mi><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>)</mo><mi>f</mi><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>)</mo></mrow></mrow><annotation encoding="application/x-tex">\int_{-1}^{1}f(x)dx = \sum_{i=1}^{n}{w(x_i)f(x_i)}
</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span><span>∫</span><span><span><span><span>​</span></span><span><span><span>−</span><span>1</span></span></span></span><span><span><span>​</span></span><span><span><span>1</span></span></span></span><span><span><span>​</span></span>​</span></span></span><span>f</span><span>(</span><span>x</span><span>)</span><span>d</span><span>x</span><span>=</span><span><span><span><span><span>​</span></span><span><span><span>i</span><span>=</span><span>1</span></span></span></span><span><span><span>​</span></span><span><span>∑</span></span></span><span><span><span>​</span></span><span><span><span>n</span></span></span></span><span><span><span>​</span></span>​</span></span></span><span><span>w</span><span>(</span><span><span>x</span><span><span><span><span>​</span></span><span><span>i</span></span></span><span><span><span>​</span></span>​</span></span></span><span>)</span><span>f</span><span>(</span><span><span>x</span><span><span><span><span>​</span></span><span><span>i</span></span></span><span><span><span>​</span></span>​</span></span></span><span>)</span></span></span></span></span></span></p>
<p>Elementary integration techniques work by approximating the function <span><span><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span>f</span></span></span></span> with a polynomial. If we sample the function at n points, we can fit a polynomial of degree n-1, and integrate <em>that</em> to get the approximation. Basically this means that with n nodes, we can integrate polynomials with degree n-1. In contrast, Gaussian quadrature can estimate a polynomial of order 2n-1 with n nodes and another set of n weights. The weights are easily determined based on the specific technique, but now you need roughly half the number of function evaluations for an accurate integral approximation.</p>
<p>This is a great improvement in terms of numerical accuracy for the accuracy you get per function evaluation at a node. Gaussian quadrature does this by carefully selecting nodes - the nodes are given by the roots of an orthogonal polynomial function. These orthogonal polynomials act as a &#34;basis&#34;, just like spline coefficients do for <a href="https://rohangautam.github.io/blog/b_spline_intro/">spline fitting</a> (with the difference of global instead of local support). By the definition of orthogonality, these have an inner product (dot product in euclidean space) of zero with each other, and that simplifies the necessary calculations (<a href="https://math.stackexchange.com/questions/1877415/proving-exactness-of-gauss-legendre-integration-formula">proof</a>) .</p>

<p>This flavour of gaussian quadrature involves using the roots of chebyshev polynomials to decide which nodes to evaluate the function for integration at. The roots of this polynomial are concentrated more on the edges of the domain helping counter oscillation at the boundaries when fitting polynomials (<a href="https://en.wikipedia.org/wiki/Runge%27s_phenomenon">Runge&#39;s phenomenon</a>). Additionally, the weights w are fixed at <span><span><math><semantics><mrow><mi>π</mi><mi mathvariant="normal">/</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">\pi/n</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span>π</span><span>/</span><span>n</span></span></span></span> , where n is the number of nodes - a parameter you choose.</p>
<figure><picture><source type="image/avif" srcset="/img/wgxIX_3WfQ-400.avif 400w" sizes="100vw"/><img alt="Fig 2: Visualising the distribution of chebyshev nodes." loading="lazy" decoding="async" src="https://olivia.website/img/wgxIX_3WfQ-400.webp" width="400" height="312"/></picture><figcaption>Fig 2: Visualising the distribution of chebyshev nodes.</figcaption></figure>
<p>This specific form of gaussian quadrature can integrate functions of this form:</p>
<p><span><span><span><math><semantics><mrow><msubsup><mo>∫</mo><mrow><mo>−</mo><mn>1</mn></mrow><mrow><mn>1</mn></mrow></msubsup><mfrac><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mrow><msqrt><mrow><mn>1</mn><mo>−</mo><msup><mi>x</mi><mn>2</mn></msup></mrow></msqrt></mrow></mfrac><mi>d</mi><mi>x</mi><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi></mrow></msubsup><mrow><msub><mi>w</mi><mi>i</mi></msub><mi>f</mi><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>)</mo></mrow></mrow><annotation encoding="application/x-tex">\int_{-1}^{1}\frac{f(x)}{\sqrt{1-x^2}}dx = \sum_{i=1}^{n}{w_if(x_i)}
</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span><span>∫</span><span><span><span><span>​</span></span><span><span><span>−</span><span>1</span></span></span></span><span><span><span>​</span></span><span><span><span>1</span></span></span></span><span><span><span>​</span></span>​</span></span></span><span><span></span><span><span><span><span><span>​</span></span><span><span><span><span><span>√</span></span><span><span><span><span>​</span></span><span><span>1</span><span>−</span><span><span>x</span><span><span><span><span>​</span></span><span><span>2</span></span></span><span><span><span>​</span></span>​</span></span></span></span></span><span><span><span>​</span></span><span></span></span><span><span><span>​</span></span>​</span></span></span></span></span></span><span><span><span>​</span></span><span></span></span><span><span><span>​</span></span><span><span><span>f</span><span>(</span><span>x</span><span>)</span></span></span></span><span><span><span>​</span></span>​</span></span></span><span></span></span><span>d</span><span>x</span><span>=</span><span><span><span><span><span>​</span></span><span><span><span>i</span><span>=</span><span>1</span></span></span></span><span><span><span>​</span></span><span><span>∑</span></span></span><span><span><span>​</span></span><span><span><span>n</span></span></span></span><span><span><span>​</span></span>​</span></span></span><span><span><span>w</span><span><span><span><span>​</span></span><span><span>i</span></span></span><span><span><span>​</span></span>​</span></span></span><span>f</span><span>(</span><span><span>x</span><span><span><span><span>​</span></span><span><span>i</span></span></span><span><span><span>​</span></span>​</span></span></span><span>)</span></span></span></span></span></span></p>
<p>where the nodes <span><span><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span><span>x</span><span><span><span><span>​</span></span><span><span>i</span></span></span><span><span><span>​</span></span>​</span></span></span></span></span></span> are <a href="https://en.wikipedia.org/wiki/Chebyshev_nodes#Definition">chebyshev nodes of the first order</a>, and <span><span><math><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">w_i</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span><span>w</span><span><span><span><span>​</span></span><span><span>i</span></span></span><span><span><span>​</span></span>​</span></span></span></span></span></span> is constant :</p>
<p><span><span><span><math><semantics><mrow><mtable><mtr><mtd><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>=</mo><mi>cos</mi><mo>(</mo><mrow><mi>π</mi><mo>(</mo><mi>i</mi><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>5</mn><mo>)</mo></mrow><mi mathvariant="normal">/</mi><mrow><mi>n</mi></mrow><mo>)</mo></mrow></mtd></mtr><mtr><mtd><mrow><msub><mi>w</mi><mi>i</mi></msub><mo>=</mo><mi>π</mi><mi mathvariant="normal">/</mi><mi>n</mi></mrow></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{array}{lcl}
x_i=\cos({\pi(i+0.5)}/{n})\\
w_i=\pi/n
\end{array}
</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span><span><span></span><span><span><span><span><span>​</span></span><span><span><span>x</span><span><span><span><span>​</span></span><span><span>i</span></span></span><span><span><span>​</span></span>​</span></span></span><span>=</span><span>cos</span><span>(</span><span><span>π</span><span>(</span><span>i</span><span>+</span><span>0</span><span>.</span><span>5</span><span>)</span></span><span>/</span><span><span>n</span></span><span>)</span></span></span><span><span><span>​</span></span><span><span><span>w</span><span><span><span><span>​</span></span><span><span>i</span></span></span><span><span><span>​</span></span>​</span></span></span><span>=</span><span>π</span><span>/</span><span>n</span></span></span><span><span><span>​</span></span>​</span></span></span><span></span></span></span></span></span></span></span></p>
<p>Let&#39;s extend this to arbitrary intervals and functional forms.</p>
<h2 id="extending-to-general-functions-and-integration-intervals" tabindex="-1">Extending to general functions and integration intervals <a href="#extending-to-general-functions-and-integration-intervals">#</a></h2>
<p>Basically, our goal is to make Chebyshev-Gauss quadrature it work for the following integral:</p>
<p><span><span><span><math><semantics><mrow><msubsup><mo>∫</mo><mrow><mi>a</mi></mrow><mrow><mi>b</mi></mrow></msubsup><mi>f</mi><mo>(</mo><mi>y</mi><mo>)</mo><mi>d</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">\int_{a}^{b}f(y)dy
</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span><span>∫</span><span><span><span><span>​</span></span><span><span><span>a</span></span></span></span><span><span><span>​</span></span><span><span><span>b</span></span></span></span><span><span><span>​</span></span>​</span></span></span><span>f</span><span>(</span><span>y</span><span>)</span><span>d</span><span>y</span></span></span></span></span></p>
<p>Note that we don&#39;t have <span><span><math><semantics><mrow><msqrt><mrow><mn>1</mn><mo>−</mo><msup><mi>x</mi><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{1-x^2}</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span><span><span>√</span></span><span><span><span><span>​</span></span><span><span>1</span><span>−</span><span><span>x</span><span><span><span><span>​</span></span><span><span>2</span></span></span><span><span><span>​</span></span>​</span></span></span></span></span><span><span><span>​</span></span><span></span></span><span><span><span>​</span></span>​</span></span></span></span></span></span> in the denominator and the intervals of integration are arbitrary. We&#39;ll take this general representation and massage it into the form that the numerical integration expects. I&#39;m using <span><span><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span>y</span></span></span></span> as the variable here. Figure 3 shows this transformation.</p>
<figure><picture><source type="image/avif" srcset="/img/dB41vqRxPH-400.avif 400w, /img/dB41vqRxPH-800.avif 800w, /img/dB41vqRxPH-1200.avif 1200w" sizes="100vw"/><source type="image/webp" srcset="/img/dB41vqRxPH-400.webp 400w, /img/dB41vqRxPH-800.webp 800w, /img/dB41vqRxPH-1200.webp 1200w" sizes="100vw"/><img alt="Fig 3: A rough sketch of converting a function with arbitrary integration bounds into the right functional form for chebyshev-gauss quadrature." loading="lazy" decoding="async" src="https://olivia.website/img/dB41vqRxPH-400.webp" width="1200" height="2243"/></picture><figcaption>Fig 3: A rough sketch of converting a function with arbitrary integration bounds into the right functional form for chebyshev-gauss quadrature.</figcaption></figure>

<p>This is my first time trying a <a href="https://marimo.io/">marimo notebook</a>. It reminds me of what <a href="https://plutojl.org/">pluto</a> is for julia - in the sense it&#39;s a reactive notebook, but with a lot of other cool features. The result is a highly interactive, embeddable notebook experience that&#39;s great for short blogs like this - and runs in the browser with WASM! I&#39;ve also made the code available as a gist <a href="https://gist.github.com/RohanGautam/2f4951f0c8163836737e8c7423f8ec95">here</a>.</p>
<p>You can play around with the slider which controls the number of nodes used for integration. Changing it effects all other conencted cells, allowing you to compare the accuracy of the two integral approximation techniques. For this example, we integrate <span><span><math><semantics><mrow><mi>sin</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\sin(x)</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span>sin</span><span>(</span><span>x</span><span>)</span></span></span></span> from <span><span><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span>0</span></span></span></span> to <span><span><math><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span aria-hidden="true"><span></span><span></span><span><span>π</span></span></span></span>.</p>


<p>This is a cool numerical integration technique I thought I&#39;d share. I used it in my library for estimating rates of sea level change - check out <a href="https://github.com/RohanGautam/EIV_IGP_jax">EIV_IGP_jax</a>. A gaussian process prior is fit with MCMC on the <em>rate</em> of sea level change, which is then compared to the observation (heights and times) of sea level proxies by integrating the rate process. The integration step uses chebyshev-gauss quadrature. The <a href="https://github.com/RohanGautam/EIV_IGP_jax/blob/main/src/utils.py#L30">specific implementation</a> of the quadrature in that project makes heavy use of <a href="https://numpy.org/doc/stable/user/basics.broadcasting.html#a-practical-example-vector-quantization">broadcasting operations</a> for efficient vectorisation of these calculations over a grid. That was a fun project too, and maybe can be a blog for another day.</p>
<hr/>



<ul><li>Previous: <a href="https://olivia.website/blog/fast_sweeping/fastsweeping/">SDFs and Fast sweeping in JAX</a></li>
</ul>

		</div></div>
  </body>
</html>
